"use strict";(self.webpackChunkgrafana_lokiexplore_app=self.webpackChunkgrafana_lokiexplore_app||[]).push([[271],{32271:(e,n,t)=>{t.r(n),t.d(n,{default:()=>un});var r=t(85959),l=t.n(r),o=t(46089),a=t(82007),s=t(93241),i=t(18531),c=t(36464),u=t(66854);const d=e=>e.filter(e=>!!e.value&&!!e.key).map(e=>({key:e.key,value:e.value,operator:u.KQ.Equal})),m=e=>new c.K(e).getLabelsExpr();var p=t(91603),f=t(21532),g=t(25953),v=t(78363),b=t(90020);function y(e,n,t,r,l,o,a){try{var s=e[o](a),i=s.value}catch(e){return void t(e)}s.done?n(i):Promise.resolve(i).then(r,l)}function h(e){return function(){var n=this,t=arguments;return new Promise(function(r,l){var o=e.apply(n,t);function a(e){y(o,r,l,a,s,"next",e)}function s(e){y(o,r,l,a,s,"throw",e)}a(void 0)})}}const D=(0,s.memoize)((e,n)=>h(function*(){const t=yield E(e);if(t){const e=d(n),r=(0,v.eY)(e,t),l=(0,v.cd)(t),o=m(e),a=o?l({expr:`{${o}} ${b.gp}`}):Promise.resolve([]);try{return Promise.all([r.then(e=>e.map(e=>({value:e.text,group:"Labels"})).sort((e,n)=>e.value.localeCompare(n.value))),a.then(e=>{if(e instanceof Error)throw g.v.error(e,{msg:"DefaultColumnsFields::getKeys - Failed to fetch detected fields"}),e;return e.map(e=>({value:e.label,group:"Fields"})).sort((e,n)=>e.value.localeCompare(n.value))})]).then(e=>(0,s.flatten)(e))}catch(e){return g.v.error(e,{msg:"DefaultColumnsFields::getKeys - Failed to fetch labels!"}),[]}}return[]})(),(e,n)=>e+JSON.stringify(n)),w={value:p.IJ,label:(0,p.hC)(p.IJ)},C=(e,n,t)=>h(function*(){const r=n.columns[t],l=yield D(e,n.labels).then(e=>e.filter(e=>(e=>!n.columns.some(n=>n&&n===e.value))(e)||r===e.value)),o=[];return n.columns.includes(p.IJ)||o.push(w),o.push(...l),o})(),E=e=>h(function*(){const n=yield(0,i.getDataSourceSrv)().get(e);if(!(n instanceof i.DataSourceWithBackend)){const e=new Error("DefaultColumnsState::getDatasource - Invalid datasource!");throw g.v.error(e),e}return n})(),O=e=>e.labels.every(e=>""!==e.key&&void 0!==e.value),x=e=>e.columns.every(e=>e),P=e=>!(e.columns.length&&e.labels.length&&O(e)&&(e=>x(e))(e));function I(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function S(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}const _=(0,r.createContext)({apiDefaultColumnsState:void 0,apiRecords:null,dsUID:"",expandedRecords:[],metadata:{},records:null,setApiDefaultColumnsState:()=>{},setDsUID:()=>{},setExpandedRecords:()=>{},setMetadata:()=>{},setRecords:()=>{},validation:{isInvalid:!1,hasDuplicates:!1,hasInvalidRecords:!1,hasPendingChanges:!1}}),j=({children:e,initialDSUID:n})=>{var t;const[o,a]=(0,r.useState)(null),[i,c]=(0,r.useState)(null),[u,d]=(0,r.useState)(null),[m,p]=(0,r.useState)(n),[g,v]=(0,r.useState)([]);var b;const y=null!==(b=null==o||null===(t=o[m])||void 0===t?void 0:t.records)&&void 0!==b?b:null;var h;const D=null!==(h=null==i?void 0:i[m].records)&&void 0!==h?h:null,w=(0,r.useCallback)(e=>{d(e)},[]),C=(0,r.useCallback)(e=>{p(e),c(null),a(null)},[]),E=(0,r.useCallback)(e=>{a((0,s.cloneDeep)(e))},[]),O=(0,r.useCallback)(e=>{null===o&&E(e),c(e)},[E,o]),x=(0,r.useCallback)(e=>{const n=S(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(n){I(e,n,t[n])})}return e}({},o),{[null!=m?m:""]:e});a(n)},[m,o]),j=(0,r.useCallback)(e=>{v(e)},[]),k=(0,r.useCallback)(e=>{x({records:e})},[x]),{isInvalid:L,hasDuplicates:R,hasInvalidRecords:N,hasPendingChanges:T}=(0,r.useMemo)(()=>{var e,n;const t=null!==(n=null==o||null===(e=o[m])||void 0===e?void 0:e.records)&&void 0!==n?n:null,r=null==t?void 0:t.filter(e=>P(e)),l=!!t&&(e=>{const n=new Set;return e.forEach(e=>{const t=e.labels.sort();n.add(JSON.stringify(t))}),n.size!==e.length})(t);var a;const s=null!==(a=r&&(null==r?void 0:r.length)>0)&&void 0!==a&&a,i=s||l;var c;const u=null!==(c=((e,n)=>{const t=e,r=n;return e&&!(t&&r&&(0,f.n)(t,r))})(t,D))&&void 0!==c&&c;return{hasDuplicates:l,hasInvalidRecords:s,isInvalid:i,hasPendingChanges:u}},[m,o,D]);return l().createElement(_.Provider,{value:{apiRecords:D,records:y,validation:{hasDuplicates:R,isInvalid:L,hasInvalidRecords:N,hasPendingChanges:T},metadata:u,setMetadata:w,dsUID:m,setDsUID:C,apiDefaultColumnsState:i,setApiDefaultColumnsState:O,setRecords:k,expandedRecords:g,setExpandedRecords:j}},e)},k=()=>(0,r.useContext)(_);var L=t(66732);const R=e=>{const n=(0,a.useStyles2)(N),{dsUID:t,setDsUID:r}=k();return l().createElement("div",{className:n.datasource},l().createElement(i.DataSourcePicker,{width:60,filter:e=>"loki"===e.type,current:""!==t?t:null,onChange:e=>{(0,L.ke)(e.uid),r(e.uid)}}))},N=e=>({datasource:(0,o.css)({marginBottom:e.spacing(2)})});var T=t(65755),M=t(34509);function V(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function B(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}function U({recordIndex:e,containerDragging:n}){const{dsUID:t,records:r,setRecords:s}=k(),i=null==r?void 0:r[e];var c;const u=null!==(c=null==i?void 0:i.columns)&&void 0!==c?c:[],d=(0,a.useStyles2)($,n);if(!i){const n=new Error("Columns: missing record!");throw g.v.error(n,{msg:`Columns: no record at ${e} for datasource ${t}`}),n}return l().createElement("div",{className:d.columns},null==u?void 0:u.map((n,c)=>{const m=n||"__pendingIdx__";return l().createElement(T.sx,{draggableId:m,key:m,index:c},(m,f)=>l().createElement("div",B(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(n){V(e,n,t[n])})}return e}({key:c,ref:m.innerRef},m.draggableProps,m.dragHandleProps),{className:(0,o.cx)(d.column,f.isDropAnimating?d["column--drop-animating"]:void 0)}),l().createElement(a.Icon,{"aria-label":"Drag and drop icon",title:"Drag and drop to reorder",name:"draggabledots",size:"lg",className:d.column__dragIcon}),l().createElement(a.Combobox,{invalid:!n,value:{value:n,label:(0,p.hC)(n)},placeholder:"Select column",width:"auto",minWidth:30,isClearable:!1,onChange:n=>((n,t)=>{r&&(r[e].columns[t]=n,s(r))})(null==n?void 0:n.value,c),createCustomValue:!0,options:e=>C(t,i,c).then(n=>n.filter(n=>n.value.includes(e)))}),u.length>1&&l().createElement(a.IconButton,{variant:"destructive",tooltip:`Remove ${(0,p.hC)(n)}`,name:"minus",size:"lg",className:d.column__removeIcon,onClick:()=>{return n=c,void(r&&(r[e].columns.splice(n,1),s(r),(0,M.EE)(M.NO.default_columns_config,M.ir.default_columns_config.remove_column)));var n}})))}))}const $=(e,n)=>({columns:(0,o.css)({display:"flex",overflow:"hidden",flexDirection:"column",paddingBottom:n?e.spacing(6):e.spacing(1)}),column:(0,o.css)({marginTop:e.spacing(1),display:"flex",alignItems:"center",transition:e.transitions.create(["background-color","opacity"],{duration:"350ms"}),opacity:1}),"column--drop-animating":(0,o.css)({opacity:.6}),column__removeIcon:(0,o.css)({marginLeft:e.spacing(1)}),column__dragIcon:(0,o.css)({cursor:"drag",opacity:.4,marginRight:e.spacing(1)})});function A(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function z(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}function q({recordIndex:e}){const{setRecords:n,records:t}=k(),r=null==t?void 0:t[e];var o;const a=null!==(o=null==r?void 0:r.columns)&&void 0!==o?o:[];return l().createElement(T.JY,{onDragEnd:r=>{r.destination&&t&&function({records:e,columns:n,recordIndex:t,sourceIndex:r,destinationIndex:l,setRecords:o}){const[a]=n.splice(r,1);if(n.splice(l,0,a),e){e[t].columns=n,o(e)}}({columns:a,records:t,recordIndex:e,setRecords:n,sourceIndex:r.source.index,destinationIndex:r.destination.index})}},l().createElement(T.gL,{droppableId:"order-fields",direction:"vertical"},(n,t)=>l().createElement("div",z(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(n){A(e,n,t[n])})}return e}({},n.droppableProps),{ref:n.innerRef}),l().createElement(U,{containerDragging:t.isDraggingOver,recordIndex:e}))))}const W="Only selecting the log line is probably redundant!";function F({recordIndex:e}){const{dsUID:n,records:t,setRecords:r}=k(),o=null==t?void 0:t[e],s=!(o&&(i=o,1===i.columns.length&&i.columns[0]===p.IJ));var i;const c=!o||x(o),u=!c||!!(null==o?void 0:o.columns.length),d=(0,a.useStyles2)(Q,!u);if(!o){const t=new Error("DefaultColumnsFields: missing record!");throw g.v.error(t,{msg:`DefaultColumnsFields: no record at ${e} for datasource ${n}`}),t}return l().createElement("div",{className:d.fieldsContainer},!s&&l().createElement(a.Alert,{severity:"warning",title:W}),l().createElement(q,{recordIndex:e}),l().createElement(a.Button,{disabled:!c,tooltip:s?c?"Add a default column to display in the logs":"Invalid columns":W,variant:"secondary",fill:"outline",icon:"plus",onClick:()=>(()=>{if(t){const n=t[e];n.columns=[...n.columns,""],r(t),(0,M.EE)(M.NO.default_columns_config,M.ir.default_columns_config.add_column)}})(),className:d.fieldsContainer__button},"Add column"))}const Q=(e,n)=>({fieldsContainer:(0,o.css)({label:"fieldsContainer"}),fieldsContainer__button:(0,o.css)({alignSelf:"flex-start",marginTop:e.spacing(1),borderColor:n?e.colors.error.border:e.colors.border.strong})});var G=t(79729),Y=t(76644),J=t(83142);function H({recordIndex:e,expr:n}){const{dsUID:t,records:r}=k(),o=null==r?void 0:r[e],s={refId:`gld-sample-${e}`,expr:`{${n}} ${b.gp}`,maxLines:100,direction:J.t.Scan},i=(0,G.MC)({datasource:{uid:t},queries:[s]}),c=(0,a.useStyles2)(K),u={enableLogDetails:(0,L.YM)("enableLogDetails",!1),showLogContextToggle:(0,L.YM)("showLogContextToggle",!1),showTime:(0,L.YM)("showTime",!1),wrapLogMessage:(0,L.YM)("wrapLogMessage",!0),fontSize:(0,L.YM)("fontSize","small"),enableInfiniteScrolling:(0,L.YM)("enableInfiniteScrolling",!0),noInteractions:!0,showControls:(0,L.YM)("showControls",!1),displayedFields:null==o?void 0:o.columns},d=new Y.Fn("logs","10.0.0",()=>u);return l().createElement("div",{className:c.panelWrap},l().createElement(G.Eb,{hoverHeader:!0,title:"",viz:d.build(),dataProvider:i}))}const K=e=>({panelWrap:(0,o.css)({marginTop:e.spacing(2),label:"panelWrap",height:"320px"})});function X({recordIndex:e}){const{records:n}=k(),t=null==n?void 0:n[e];var r;const o=d(null!==(r=null==t?void 0:t.labels)&&void 0!==r?r:[]),a=m(o);return a?l().createElement(G.BF,{timeRange:{from:"now-24h",to:"now"},withQueryController:!0},l().createElement(H,{recordIndex:e,expr:a})):null}function Z({record:e,isOpen:n}){const t=(0,a.useStyles2)(ee);return l().createElement("div",{className:t.label},l().createElement("h5",{className:t.label__title},"Display columns",l().createElement(a.Tooltip,{content:"Default columns to display in logs visualizations"},l().createElement(a.Icon,{className:t.label__icon,name:"info-circle"}))),!n&&l().createElement("span",{className:t.label__pills},e.columns.filter(e=>e).map(e=>l().createElement("span",{className:t.label__pill,key:e},(0,p.hC)(e)))))}const ee=e=>({label:(0,o.css)({display:"flex",alignItems:"center",overflow:"hidden",padding:e.spacing(.5,0),minHeight:"32px"}),label__pills:(0,o.css)({display:"flex",flexWrap:"wrap",gap:e.spacing(1),marginLeft:e.spacing(1)}),label__pill:(0,o.css)({border:`1px solid ${e.colors.border.weak}`,borderRadius:e.shape.radius.pill,padding:e.spacing(.25,1.25,.25,1.25),boxShadow:e.shadows.z1}),label__icon:(0,o.css)({marginLeft:e.spacing(.5)}),label__title:(0,o.css)({margin:0,display:"flex",alignItems:"center",flex:"1 0 auto"})});function ne({recordIndex:e}){const{setExpandedRecords:n,expandedRecords:t,records:r}=k(),o=null==r?void 0:r[e],s=null==t?void 0:t.findIndex(n=>n===e),i=(-1!==s?t[s]:void 0)===e,c=(0,a.useStyles2)(te,i);return o?l().createElement(a.Collapse,{className:c.collapse,isOpen:i,label:l().createElement(Z,{record:o,isOpen:i}),onToggle:()=>{if(i){const e=[...t];null==e||e.splice(s,1),n(e)}else n([...null!=t?t:[],e])}},l().createElement("div",{className:c.content},l().createElement(F,{recordIndex:e})),l().createElement(X,{recordIndex:e})):null}const te=(e,n)=>({content:(0,o.css)({paddingLeft:e.spacing(2)}),collapse:(0,o.css)({margin:e.spacing(2),boxShadow:e.shadows.z1,width:"auto","> div:first-of-type":{borderBottom:n?`1px solid ${e.colors.border.weak}`:"none",boxShadow:n?e.shadows.z1:"none"}})});function re({recordIndex:e}){const n=(0,a.useStyles2)(le),{records:t,setRecords:r}=k();if(!t)return null;return l().createElement("div",{className:n.close},l().createElement(a.IconButton,{tooltip:"Delete record",size:"xl",name:"times","aria-labelledby":"Delete record",onClick:()=>(t.splice(e,1),r(t),void(0,M.EE)(M.NO.default_columns_config,M.ir.default_columns_config.delete_record))}))}const le=e=>({close:(0,o.css)({position:"absolute",right:"2px",top:"6px"})});function oe(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function ae(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(n){oe(e,n,t[n])})}return e}function se(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}function ie({recordIndex:e}){const{setRecords:n,records:t}=k();var r;const o=null!==(r=null==t?void 0:t[e])&&void 0!==r?r:null,s=!!o&&!O(o),i=(0,a.useStyles2)(ce);return l().createElement("div",{className:i.labelContainer},l().createElement(a.Button,{disabled:s,tooltip:"Add new label to match against user query",variant:"secondary",fill:"outline",icon:"plus",onClick:()=>(()=>{if(t){const l=t.slice(0,e),o=t.splice(e,1)[0],a=t.slice(e,t.length);var r;const s=[...l,se(ae({},o),{labels:[...null!==(r=null==o?void 0:o.labels)&&void 0!==r?r:[],{key:""}]}),...a];n(s),(0,M.EE)(M.NO.default_columns_config,M.ir.default_columns_config.add_label)}})(),className:i.labelContainer__add},"Add label"))}const ce=e=>({labelContainer:(0,o.css)({label:"labelContainer",display:"flex",flexDirection:"row",alignItems:"center"}),labelContainer__add:(0,o.css)({})});var ue=t(53571);function de(e,n,t,r,l,o,a){try{var s=e[o](a),i=s.value}catch(e){return void t(e)}s.done?n(i):Promise.resolve(i).then(r,l)}const me=({recordIndex:e,labelIndex:n})=>{const{dsUID:t,records:r,setRecords:o}=k(),s=null==r?void 0:r[e].labels,i=null==s?void 0:s[n].key,c=(0,a.useStyles2)(fe);return l().createElement("div",{className:c.valuesFieldsContainer},l().createElement(a.Combobox,{value:i,invalid:!i,"data-testid":ue.b.appConfig.defaultColumns.labels.key,placeholder:"Select label name",width:"auto",minWidth:30,maxWidth:90,createCustomValue:!0,onChange:t=>(t=>{if(r){const l=r[e],a=null==l?void 0:l.labels[n];a.key=t,a.value=void 0,o(r)}})(null==t?void 0:t.value),options:e=>pe(null!=s?s:[],t).then(n=>n.filter(n=>n.value.includes(e)))}))},pe=(0,s.memoize)((e,n)=>{return(t=function*(){const t=yield E(n);if(!t||!t.getResource){const e=new Error(`Data source ${n} not found`);return g.v.error(e,{msg:"DefaultColumnsLabelName::getLabels - Data source not found!"}),[]}const r=d(null!=e?e:[]),l=(0,v.eY)(r,t),o=(yield l).map(e=>({value:e.text})),a=o.findIndex(e=>e.value===b.OX);if(-1!==a){const e=o.splice(a,1);o.unshift(e[0])}return o},function(){var e=this,n=arguments;return new Promise(function(r,l){var o=t.apply(e,n);function a(e){de(o,r,l,a,s,"next",e)}function s(e){de(o,r,l,a,s,"throw",e)}a(void 0)})})();var t}),fe=e=>({valuesContainer:(0,o.css)({label:"valuesContainer",marginLeft:e.spacing(2),marginBottom:e.spacing(2),marginTop:e.spacing(1)}),valueContainer:(0,o.css)({label:"valueContainer",display:"flex",flexDirection:"row",alignItems:"center"}),valueContainer__add:(0,o.css)({marginTop:e.spacing(2)}),valuesFieldsContainer:(0,o.css)({}),fieldsContainer:(0,o.css)({marginLeft:e.spacing(2)})});var ge=t(10405);function ve(e,n,t,r,l,o,a){try{var s=e[o](a),i=s.value}catch(e){return void t(e)}s.done?n(i):Promise.resolve(i).then(r,l)}function be({recordIndex:e,labelIndex:n}){const{dsUID:t,records:r,setRecords:o,setExpandedRecords:i,expandedRecords:c}=k(),m=null==r?void 0:r[e].labels,p=null==m?void 0:m[n],f=(0,a.useStyles2)(ye),g=(0,s.memoize)(e=>{return(n=function*(){const n=yield E(t);if(n){var r;const l=null!==(r=null==m?void 0:m.filter(n=>n.key!==e.key))&&void 0!==r?r:[],o=d(l),a={value:'""',key:e.key,operator:u.KQ.NotEqual},i=yield(0,ge.Ne)(o,a,n,t);if((0,s.isArray)(i))return i.map(e=>{const n=e.text.toString();return{value:n,label:n}}).filter(n=>{const t=n.value===e.value,r=!(null==m?void 0:m.some(e=>e.key===a.key&&e.value===n.value));return t||r})}return[]},function(){var e=this,t=arguments;return new Promise(function(r,l){var o=n.apply(e,t);function a(e){ve(o,r,l,a,s,"next",e)}function s(e){ve(o,r,l,a,s,"throw",e)}a(void 0)})})();var n});return p?l().createElement("span",{className:f.defaultColumnsLabelValue},l().createElement(a.Combobox,{"data-testid":ue.b.appConfig.defaultColumns.labels.value,invalid:!(null==p?void 0:p.value),placeholder:"Select label value",width:"auto",minWidth:30,value:null==p?void 0:p.value,maxWidth:90,disabled:!p.key,createCustomValue:!0,onChange:t=>(t=>{if(r){const l=r[e];l.labels[n].value=t.value,o(r),0===l.columns.length&&i([...c,e])}})(t),options:e=>g(p).then(n=>n.filter(n=>n.value.includes(e)))})):null}const ye=e=>({defaultColumnsLabelValue:(0,o.css)({label:"defaultColumnsLabelValue",marginLeft:e.spacing(1)})});function he({recordIndex:e,labelIndex:n}){const t=(0,a.useStyles2)(De),{records:r,setRecords:o}=k(),s=null==r?void 0:r[e].labels,i=null==s?void 0:s[n];var c;return l().createElement("div",{className:t.valueContainer},l().createElement(a.IconButton,{variant:"destructive",tooltip:`Remove ${null!==(c=null==i?void 0:i.key)&&void 0!==c?c:""}${(null==i?void 0:i.value)?` = ${i.value}`:""}`,name:"minus",size:"lg",className:t.valueContainer__remove,onClick:()=>{r&&(r[e].labels.splice(n,1),o(r),(0,M.EE)(M.NO.default_columns_config,M.ir.default_columns_config.remove_label))}}))}const De=e=>({valueContainer:(0,o.css)({label:"valueContainer",display:"flex",flexDirection:"row",alignItems:"center"}),valueContainer__remove:(0,o.css)({marginLeft:e.spacing(1)})});function we({recordIndex:e}){var n;const{records:t}=k(),r=(0,a.useStyles2)(Ce);if(!t)throw new Error("Records::missing localDefaultColumnsState");const o=t[e];return l().createElement(l().Fragment,null,l().createElement("h5",{className:r.labelTitle},"Labels match",l().createElement(a.Tooltip,{content:"Queries containing these labels will display the selected columns"},l().createElement(a.Icon,{className:r.labelIcon,name:"info-circle"}))),null===(n=o.labels)||void 0===n?void 0:n.map((n,t)=>l().createElement("div",{key:t,className:r.labelContainer__wrap},l().createElement("div",{className:r.labelContainer},l().createElement(me,{recordIndex:e,labelIndex:t}),l().createElement(be,{recordIndex:e,labelIndex:t}),o.labels.length>1&&l().createElement(he,{recordIndex:e,labelIndex:t})))),l().createElement(ie,{recordIndex:e}))}const Ce=e=>({labelTitle:(0,o.css)({marginTop:e.spacing(1.5),display:"flex",alignItems:"center"}),labelIcon:(0,o.css)({marginLeft:e.spacing(.5)}),labelContainer__wrap:(0,o.css)({display:"flex",flexDirection:"column"}),labelContainer:(0,o.css)({label:"labelContainer",display:"flex",marginBottom:e.spacing(1),marginTop:e.spacing(1)})}),Ee=({})=>{const e=(0,a.useStyles2)(Oe),{records:n}=k();return l().createElement("div",{className:e.recordsContainer},null==n?void 0:n.map((n,t)=>l().createElement("div",{className:e.recordContainer,key:t},l().createElement("div",{className:e.recordContainer__content},l().createElement(we,{recordIndex:t})),l().createElement(ne,{recordIndex:t}),l().createElement(re,{recordIndex:t}))))},Oe=e=>({recordContainer:(0,o.css)({border:`1px solid ${e.colors.border.weak}`,borderRadius:e.shape.radius.sm,paddingBottom:e.spacing(2),marginBottom:e.spacing(3),position:"relative",boxShadow:e.shadows.z2}),recordContainer__content:(0,o.css)({paddingLeft:e.spacing(2)}),recordsContainer:(0,o.css)({paddingBottom:e.spacing(2)})});var xe=t(27247),Pe=t(31269),Ie=t(79213);function Se(e,n,t,r,l,o,a){try{var s=e[o](a),i=s.value}catch(e){return void t(e)}s.done?n(i):Promise.resolve(i).then(r,l)}function _e(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function je(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(n){_e(e,n,t[n])})}return e}function ke(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}function Le(e,n){if(null==e)return{};var t,r,l=function(e,n){if(null==e)return{};var t,r,l={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}const Re=(0,Ie.TP)("logsdrilldown.grafana.app","v1beta1"),Ne=(0,xe.xP)({reducerPath:"logsdrilldownAPIv1beta1",baseQuery:function({baseURL:e}){return function(n){return(t=function*(){try{var t;const l=je({},n.headers);var r;"PATCH"===(null===(t=n.method)||void 0===t?void 0:t.toUpperCase())&&(null==e?void 0:e.startsWith("/apis/"))&&!l["Content-Type"]&&(l["Content-Type"]="application/strategic-merge-patch+json");const o=yield(0,Pe.lastValueFrom)((0,i.getBackendSrv)().fetch(ke(je({},n),{url:e+n.url,showErrorAlert:null!==(r=n.showErrorAlert)&&void 0!==r&&r,data:n.body,headers:l}))),{data:a}=o;return{data:a,meta:Le(o,["data"])}}catch(e){return n.manageError?n.manageError(e):(0,Ie.ss)(e)}},function(){var e=this,n=arguments;return new Promise(function(r,l){var o=t.apply(e,n);function a(e){Se(o,r,l,a,s,"next",e)}function s(e){Se(o,r,l,a,s,"throw",e)}a(void 0)})})();var t}}({baseURL:Re}),endpoints:()=>({})}).enhanceEndpoints({addTagTypes:["API Discovery","LogsDrilldownDefaultColumns"]}).injectEndpoints({endpoints:e=>({getApiResources:e.query({query:()=>({url:"/"}),providesTags:["API Discovery"]}),listLogsDrilldownDefaultColumns:e.query({query:e=>({url:"/logsdrilldowndefaultcolumns",params:{pretty:e.pretty,allowWatchBookmarks:e.allowWatchBookmarks,continue:e.continue,fieldSelector:e.fieldSelector,labelSelector:e.labelSelector,limit:e.limit,resourceVersion:e.resourceVersion,resourceVersionMatch:e.resourceVersionMatch,sendInitialEvents:e.sendInitialEvents,timeoutSeconds:e.timeoutSeconds,watch:e.watch}}),providesTags:["LogsDrilldownDefaultColumns"]}),createLogsDrilldownDefaultColumns:e.mutation({query:e=>({url:"/logsdrilldowndefaultcolumns",method:"POST",body:e.logsDrilldownDefaultColumns,params:{pretty:e.pretty,dryRun:e.dryRun,fieldManager:e.fieldManager,fieldValidation:e.fieldValidation}}),invalidatesTags:["LogsDrilldownDefaultColumns"]}),deletecollectionLogsDrilldownDefaultColumns:e.mutation({query:e=>({url:"/logsdrilldowndefaultcolumns",method:"DELETE",params:{pretty:e.pretty,continue:e.continue,dryRun:e.dryRun,fieldSelector:e.fieldSelector,gracePeriodSeconds:e.gracePeriodSeconds,ignoreStoreReadErrorWithClusterBreakingPotential:e.ignoreStoreReadErrorWithClusterBreakingPotential,labelSelector:e.labelSelector,limit:e.limit,orphanDependents:e.orphanDependents,propagationPolicy:e.propagationPolicy,resourceVersion:e.resourceVersion,resourceVersionMatch:e.resourceVersionMatch,sendInitialEvents:e.sendInitialEvents,timeoutSeconds:e.timeoutSeconds}}),invalidatesTags:["LogsDrilldownDefaultColumns"]}),getLogsDrilldownDefaultColumns:e.query({query:e=>({url:`/logsdrilldowndefaultcolumns/${e.name}`,params:{pretty:e.pretty}}),providesTags:["LogsDrilldownDefaultColumns"]}),replaceLogsDrilldownDefaultColumns:e.mutation({query:e=>({url:`/logsdrilldowndefaultcolumns/${e.name}`,method:"PUT",body:e.logsDrilldownDefaultColumns,params:{pretty:e.pretty,dryRun:e.dryRun,fieldManager:e.fieldManager,fieldValidation:e.fieldValidation}}),invalidatesTags:["LogsDrilldownDefaultColumns"]}),deleteLogsDrilldownDefaultColumns:e.mutation({query:e=>({url:`/logsdrilldowndefaultcolumns/${e.name}`,method:"DELETE",params:{pretty:e.pretty,dryRun:e.dryRun,gracePeriodSeconds:e.gracePeriodSeconds,ignoreStoreReadErrorWithClusterBreakingPotential:e.ignoreStoreReadErrorWithClusterBreakingPotential,orphanDependents:e.orphanDependents,propagationPolicy:e.propagationPolicy}}),invalidatesTags:["LogsDrilldownDefaultColumns"]}),updateLogsDrilldownDefaultColumns:e.mutation({query:e=>({url:`/logsdrilldowndefaultcolumns/${e.name}`,method:"PATCH",body:e.patch,params:{pretty:e.pretty,dryRun:e.dryRun,fieldManager:e.fieldManager,fieldValidation:e.fieldValidation,force:e.force}}),invalidatesTags:["LogsDrilldownDefaultColumns"]}),getLogsDrilldownDefaultColumnsStatus:e.query({query:e=>({url:`/logsdrilldowndefaultcolumns/${e.name}/status`,params:{pretty:e.pretty}}),providesTags:["LogsDrilldownDefaultColumns"]}),replaceLogsDrilldownDefaultColumnsStatus:e.mutation({query:e=>({url:`/logsdrilldowndefaultcolumns/${e.name}/status`,method:"PUT",body:e.logsDrilldownDefaultColumns,params:{pretty:e.pretty,dryRun:e.dryRun,fieldManager:e.fieldManager,fieldValidation:e.fieldValidation}}),invalidatesTags:["LogsDrilldownDefaultColumns"]}),updateLogsDrilldownDefaultColumnsStatus:e.mutation({query:e=>({url:`/logsdrilldowndefaultcolumns/${e.name}/status`,method:"PATCH",body:e.patch,params:{pretty:e.pretty,dryRun:e.dryRun,fieldManager:e.fieldManager,fieldValidation:e.fieldValidation,force:e.force}}),invalidatesTags:["LogsDrilldownDefaultColumns"]})}),overrideExisting:!1}),{useGetApiResourcesQuery:Te,useLazyGetApiResourcesQuery:Me,useListLogsDrilldownDefaultColumnsQuery:Ve,useLazyListLogsDrilldownDefaultColumnsQuery:Be,useCreateLogsDrilldownDefaultColumnsMutation:Ue,useDeletecollectionLogsDrilldownDefaultColumnsMutation:$e,useGetLogsDrilldownDefaultColumnsQuery:Ae,useLazyGetLogsDrilldownDefaultColumnsQuery:ze,useReplaceLogsDrilldownDefaultColumnsMutation:qe,useDeleteLogsDrilldownDefaultColumnsMutation:We,useUpdateLogsDrilldownDefaultColumnsMutation:Fe,useGetLogsDrilldownDefaultColumnsStatusQuery:Qe,useLazyGetLogsDrilldownDefaultColumnsStatusQuery:Ge,useReplaceLogsDrilldownDefaultColumnsStatusMutation:Ye,useUpdateLogsDrilldownDefaultColumnsStatusMutation:Je}=Ne;var He=t(88428);const Ke=({})=>{const{setApiDefaultColumnsState:e,dsUID:n,setMetadata:t,metadata:o,apiRecords:s}=k(),{currentData:i,error:c,isLoading:u}=Ae({name:n}),d=(0,He.Gj)(c);return(0,r.useEffect)(()=>{const r={};var l;if(!u&&(!(null==o?void 0:o.resourceVersion)||!i||(null==i?void 0:i.metadata.resourceVersion)!==(null==o?void 0:o.resourceVersion)))if(t(null!==(l=null==i?void 0:i.metadata)&&void 0!==l?l:null),i){if(!i.metadata.name){const e=new Error("DefaultColumns::Unexpected result for defaultColumnsFromAPI - missing metadata name");throw g.v.error(e),e}if(i.metadata.name!==n){const e=new Error("DefaultColumns::Unexpected result for defaultColumnsFromAPI - invalid datasource uid");throw g.v.error(e),e}r[i.metadata.name]={records:i.spec.records},e(r)}else if(d){if(404!==d.status){const e=new Error("DefaultColumns::Unexpected result for default columns - api error");throw g.v.error(e,(0,He.O8)(d)),e}null===s&&e({[n]:{records:[]}})}},[s,null==o?void 0:o.resourceVersion,t,i,d,u,n,e]),u?l().createElement(a.LoadingPlaceholder,{text:"Loading..."}):l().createElement(Ee,null)};function Xe(){const{validation:e,records:n,setRecords:t}=k();return n?l().createElement(a.Button,{variant:"secondary",fill:"outline",icon:"plus",disabled:e.isInvalid,onClick:()=>{t([...null!=n?n:[],{columns:[],labels:[{key:""}]}]),(0,M.EE)(M.NO.default_columns_config,M.ir.default_columns_config.add_record)}},"Add"):null}function Ze(){const{dsUID:e,metadata:n,records:t,validation:r}=k(),[o,{error:s}]=Ue(),[i,{error:c}]=qe(),u=(0,a.useStyles2)(en,r.isInvalid),d=null===n;if(!t||!e)return null;if(s){const e=(0,He.Gj)(s);g.v.error(new Error("DefaultColumnsSubmit::createNewRecord"),e?(0,He.O8)(e):{msg:"DefaultColumnsSubmit:createNewRecord error"})}if(c){const e=(0,He.Gj)(c);g.v.error(new Error("DefaultColumnsSubmit::updateRecord"),e?(0,He.O8)(e):{msg:"DefaultColumnsSubmit:updateRecord error"})}return l().createElement(a.Button,{variant:"primary",tooltip:nn(r),disabled:!r.hasPendingChanges||r.isInvalid,className:u.button,onClick:()=>{if(e&&t){const r={records:t.map(e=>({labels:e.labels.filter(e=>!!e.value&&!!e.key),columns:e.columns}))};d?o({pretty:"true",logsDrilldownDefaultColumns:{metadata:{name:e},apiVersion:"logsdrilldown.grafana.app/v1beta1",kind:"LogsDrilldownDefaultColumns",spec:r}}):i({pretty:"true",name:e,logsDrilldownDefaultColumns:{metadata:{name:e,resourceVersion:n.resourceVersion},apiVersion:"logsdrilldown.grafana.app/v1beta1",kind:"LogsDrilldownDefaultColumns",spec:r}}),(0,M.EE)(M.NO.default_columns_config,M.ir.default_columns_config.save)}}},d?"Create default columns":"Update default columns")}const en=(e,n)=>({button:(0,o.css)({borderColor:n?e.colors.error.border:e.colors.border.strong})}),nn=e=>e.hasPendingChanges?e.hasDuplicates?"Duplicates detected":e.hasInvalidRecords?"Invalid records detected":void 0:"No changes detected";function tn(){const{validation:e,setRecords:n,apiRecords:t}=k();return l().createElement(a.ConfirmButton,{onConfirm:()=>{null!==t&&(n((0,s.cloneDeep)(t)),(0,M.EE)(M.NO.default_columns_config,M.ir.default_columns_config.undo))},closeOnConfirm:!0,confirmText:"Reset",confirmVariant:"destructive","aria-disabled":!e.hasPendingChanges,disabled:!e.hasPendingChanges},"Reset")}function rn(){const e=(0,a.useStyles2)(ln);return l().createElement("footer",{className:e.wrap},l().createElement(Xe,null),l().createElement("div",{className:e.submitWrap},l().createElement(tn,null),l().createElement(Ze,null)))}const ln=e=>({wrap:(0,o.css)({display:"flex",gap:e.spacing(1),alignItems:"center",justifyContent:"space-between",position:"sticky",bottom:0,left:0,background:e.colors.background.secondary,zIndex:e.zIndex.navbarFixed,padding:e.spacing(1,2),border:`1px solid ${e.colors.border.weak}`,boxShadow:e.shadows.z3,borderRadius:e.shape.radius.sm}),submitWrap:(0,o.css)({gap:e.spacing(1),display:"flex"})});var on=t(98626);function an(){return l().createElement("section",null,l().createElement("h2",null,"Default columns"),!on.mV&&l().createElement("p",null,"Default columns requires ",l().createElement("code",null,"kubernetesLogsDrilldown")," feature flag to be enabled."),!on.vg&&l().createElement("p",null,"Default columns requires Grafana 12.4 or greater."))}var sn=t(96056);const cn=e=>({introText:(0,o.css)({display:"flex",alignItems:"center",marginBottom:e.spacing(2),gap:e.spacing(1)}),main:(0,o.css)({width:"100%"})}),un=()=>{var e;const n=null!==(e=(0,L.QB)())&&void 0!==e?e:(0,L.x0)(),t=(0,a.useStyles2)(cn);return n?on.f5?l().createElement("main",{className:t.main},l().createElement("div",{className:t.introText},l().createElement(a.Badge,{color:"blue",text:"Experimental"}),l().createElement("span",null,"Configure default fields to display instead of the full log line:")),l().createElement(j,{initialDSUID:n},l().createElement("header",null,l().createElement(R,null)),l().createElement(l().Fragment,null,l().createElement("section",null,l().createElement(Ke,null))),l().createElement(rn,null))):l().createElement(an,null):l().createElement(sn.Q,null)}}}]);
//# sourceMappingURL=271.js.map?_cache=ccaa9b9eacefdc7b7a3e