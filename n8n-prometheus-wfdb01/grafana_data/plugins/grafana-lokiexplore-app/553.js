"use strict";(self.webpackChunkgrafana_lokiexplore_app=self.webpackChunkgrafana_lokiexplore_app||[]).push([[553],{98626:(e,t,n)=>{n.d(t,{f5:()=>l,mV:()=>o,vg:()=>i});var r=n(29368),a=n.n(r),s=n(18531);const i=!a().ltr(s.config.buildInfo.version,"12.4.0-20854440429"),o=s.config.featureToggles.kubernetesLogsDrilldown,l=o&&i},47709:(e,t,n)=>{n.d(t,{F:()=>l});var r=n(85959),a=n.n(r),s=n(46089),i=n(82007),o=n(53571);const l=e=>{const{buttonFill:t,hideExclude:n,isExcluded:r,isIncluded:s,onClear:l,onExclude:u,onInclude:d,titles:p}=e,g=(0,i.useStyles2)(c,s,r,n);return a().createElement("div",{className:g.container},a().createElement(i.Button,{variant:s?"primary":"secondary",fill:t,size:"sm","aria-selected":s,className:g.includeButton,onClick:s?l:d,"data-testid":o.b.exploreServiceDetails.buttonFilterInclude,title:null==p?void 0:p.include},"Include"),!n&&a().createElement(i.Button,{variant:r?"primary":"secondary",fill:t,size:"sm","aria-selected":r,className:g.excludeButton,onClick:r?l:u,title:null==p?void 0:p.exclude,"data-testid":o.b.exploreServiceDetails.buttonFilterExclude},"Exclude"))},c=(e,t,n,r)=>({container:(0,s.css)({display:"flex",justifyContent:"center"}),excludeButton:(0,s.css)({borderLeft:n?void 0:"none",borderRadius:`0 ${e.shape.radius.default} ${e.shape.radius.default} 0`}),includeButton:(0,s.css)({borderBottomRightRadius:0,borderTopRightRadius:0,borderRight:t||r?void 0:"none"})})},47191:(e,t,n)=>{n.d(t,{R:()=>o});var r=n(85959),a=n.n(r),s=n(46089),i=n(82007);const o=({children:e})=>{const t=(0,i.useStyles2)(l);return a().createElement("div",{className:t.wrap},a().createElement(i.EmptyState,{variant:"not-found",message:e?"":"An error occurred"},e&&e))},l=e=>({wrap:(0,s.css)({margin:"0 auto"})})},41745:(e,t,n)=>{n.d(t,{P:()=>pt,y:()=>dt});var r=n(85959),a=n.n(r),s=n(90219),i=n(87781),o=n(18531),l=n(76644),c=n(42245),u=n(82007),d=n(79213),p=n(66709),g=n(34509),h=n(21532),f=n(34702),v=n(11263),m=n(77839),b=n(36838),y=n(48502),S=n(66854),w=n(89924);function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let E={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},x={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_={"!":"1",'"':"'","#":"3",$:"4","%":"5","&":"7","(":"9",")":"0","*":"8","+":"=",":":";","<":",",">":".","?":"/","@":"2","^":"6",_:"-","|":"\\","~":"`"},C={command:"meta",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl",option:"alt",plus:"+",return:"enter"},P=null;for(let e=1;e<20;++e)E[111+e]="f"+e;for(let e=0;e<=9;++e)E[e+96]=e.toString();function k(e){if("keypress"===e.type){let t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return E[e.which]?E[e.which]:x[e.which]?x[e.which]:String.fromCharCode(e.which).toLowerCase()}function L(e,t){return e.sort().join(",")===t.sort().join(",")}function j(e){return"shift"===e||"ctrl"===e||"alt"===e||"meta"===e}function F(e,t,n){return n||(n=function(){if(!P){P={};for(let e in E){const t=parseInt(e,10);t>95&&t<112||E.hasOwnProperty(e)&&(P[E[e]]=e)}}return P}()[e]?"keydown":"keypress"),"keypress"===n&&t.length&&(n="keydown"),n}function T(e,t){let n,r,a,s=[];for(n=function(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+")}(e),a=0;a<n.length;++a)r=n[a],C[r]&&(r=C[r]),t&&"keypress"!==t&&_[r]&&(r=_[r],s.push("shift")),j(r)&&s.push(r);if(!r)throw new Error("Unable to get key");return{action:t=F(r,s,t),key:r,modifiers:s}}function D(e,t){return null!==e&&e!==document&&(e===t||D(e.parentNode,t))}const $=new class{constructor(e){O(this,"target",void 0),O(this,"_callbacks",{}),O(this,"_directMap",{}),O(this,"_sequenceLevels",{}),O(this,"_resetTimer",void 0),O(this,"_ignoreNextKeyup",!1),O(this,"_ignoreNextKeypress",!1),O(this,"_nextExpectedAction",!1),O(this,"_globalCallbacks",{}),O(this,"_resetSequences",e=>{e=e||{};let t,n=!1;for(t in this._sequenceLevels)e[t]?n=!0:this._sequenceLevels[t]=0;n||(this._nextExpectedAction=!1)}),O(this,"_getMatches",(e,t,n,r,a,s)=>{let i,o,l=[],c=n.type;if(!this._callbacks[e])return[];for("keyup"===c&&j(e)&&(t=[e]),i=0;i<this._callbacks[e].length;++i)if(o=this._callbacks[e][i],(r||!o.seq||this._sequenceLevels[o.seq]===o.level)&&c===o.action&&("keypress"===c&&!n.metaKey&&!n.ctrlKey||L(t,o.modifiers))){let t=!r&&o.combo===a,n=r&&o.seq===r&&o.level===s;(t||n)&&this._callbacks[e].splice(i,1),l.push(o)}return l}),O(this,"_fireCallback",(e,t,n,r)=>{const a=t.target||t.srcElement;var s;a&&a instanceof HTMLElement&&this.stopCallback(t,a,n,r)||!1===e(t,n)&&((s=t).preventDefault?s.preventDefault():s.returnValue=!1,function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(t))}),O(this,"_handleKey",(e,t,n)=>{let r,a=this._getMatches(e,t,n),s={},i=0,o=!1;for(r=0;r<a.length;++r){var l;if(a[r].seq)i=Math.max(i,null!==(l=a[r].level)&&void 0!==l?l:0)}for(r=0;r<a.length;++r){const t=a[r].seq;if(t){if(a[r].level!==i)continue;o=!0,s[t]=1,this._fireCallback(a[r].callback,n,a[r].combo,t);const l=t.lastIndexOf(e),c=t.slice(0,l);for(const[e,t]of Object.entries(this._sequenceLevels))t>0&&e.startsWith(c)&&(s[e]=1);continue}o||this._fireCallback(a[r].callback,n,a[r].combo)}var c;for(const t of null!==(c=this._callbacks[e])&&void 0!==c?c:[])t.action===n.type&&t.seq&&0===t.level&&(s[t.seq]=1);let u="keypress"===n.type&&this._ignoreNextKeypress;n.type!==this._nextExpectedAction||j(e)||u||this._resetSequences(s),this._ignoreNextKeypress=o&&"keydown"===n.type}),O(this,"_handleKeyEvent",e=>{if(!(e instanceof KeyboardEvent))throw new Error("Didn't get a KeyboardEvent");const t=e;if(t.repeat)return;"number"!=typeof t.which&&(t.which=t.keyCode);let n=k(t);n&&("keyup"!==t.type||this._ignoreNextKeyup!==n?this.handleKey(n,function(e){let t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}(t),t):this._ignoreNextKeyup=!1)}),O(this,"_resetSequenceTimer",()=>{clearTimeout(this._resetTimer),this._resetTimer=setTimeout(this._resetSequences,1e3)}),O(this,"_bindSequence",(e,t,n,r)=>{this._sequenceLevels[e]=0;const a=t=>()=>{this._nextExpectedAction=t,++this._sequenceLevels[e],this._resetSequenceTimer()},s=t=>{this._fireCallback(n,t,e),"keyup"!==r&&(this._ignoreNextKeyup=k(t)),this._resetSequenceTimer()};for(let n=0;n<t.length;++n){let i=n+1===t.length?s:a(r||T(t[n+1]).action);this._bindSingle(t[n],i,r,e,n)}}),O(this,"_bindSingle",(e,t,n,r,a)=>{this._directMap[e+":"+n]=t;let s,i=(e=e.replace(/\s+/g," ")).split(" ");if(i.length>1)return void this._bindSequence(e,i,t,n);s=T(e,n),this._callbacks[s.key]=this._callbacks[s.key]||[];const o={ctrlKey:!1,metaKey:!1,type:s.action};this._getMatches(s.key,s.modifiers,o,r,e,a);const l={action:s.action,callback:t,combo:e,level:a,modifiers:s.modifiers,seq:r};this._callbacks[s.key][r?"unshift":"push"](l)}),O(this,"_bindMultiple",(e,t,n)=>{for(let r=0;r<e.length;++r)this._bindSingle(e[r],t,n)}),O(this,"bind",(e,t,n)=>(e=e instanceof Array?e:[e],this._bindMultiple(e,t,n),self)),O(this,"unbind",(e,t)=>this.bind(e,function(){},t)),O(this,"bindGlobal",(e,t,n)=>{if(this.bind(e,t,n),e instanceof Array)for(let t=0;t<e.length;t++)this._globalCallbacks[e[t]]=!0;else this._globalCallbacks[e]=!0}),O(this,"unbindGlobal",(e,t)=>{if(this.unbind(e,t),e instanceof Array)for(let t=0;t<e.length;t++)this._globalCallbacks[e[t]]=!1;else this._globalCallbacks[e]=!1}),O(this,"trigger",(e,t)=>{let n=this;return n._directMap[e+":"+t]&&n._directMap[e+":"+t]({},e),n}),O(this,"reset",()=>(this._callbacks={},this._directMap={},this)),O(this,"stopCallback",(e,t,n,r)=>{if(this._globalCallbacks[n]||r&&this._globalCallbacks[r])return!1;if((" "+t.className+" ").indexOf(" mousetrap ")>-1)return!1;if(D(t,this.target))return!1;if("composedPath"in e&&"function"==typeof e.composedPath){let n=e.composedPath()[0];n!==e.target&&n instanceof HTMLElement&&(t=n)}return Boolean("INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||"isContentEditable"in t&&t.isContentEditable)}),O(this,"handleKey",(...e)=>this._handleKey(...e)),O(this,"addKeycodes",e=>{for(let t in e)e.hasOwnProperty(t)&&(E[t]=e[t]);P=null}),this.target=e,this.target.addEventListener("keypress",e=>{e instanceof KeyboardEvent&&this._handleKeyEvent(e)}),this.target.addEventListener("keydown",e=>{e instanceof KeyboardEvent&&this._handleKeyEvent(e)}),this.target.addEventListener("keyup",e=>{e instanceof KeyboardEvent&&this._handleKeyEvent(e)})}}(document);class N{addBinding(e){$.bind(e.key,t=>{t.preventDefault(),t.stopPropagation(),t.returnValue=!1,e.onTrigger()},"keydown"),this._binds.push(e)}removeAll(){this._binds.forEach(e=>{$.unbind(e.key,e.type)}),this._binds=[]}constructor(){var e,t,n;n=[],(t="_binds")in(e=this)?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}}var A=n(88428),B=n(88100);function M(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function I(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var s=e.apply(t,n);function i(e){M(s,r,a,i,o,"next",e)}function o(e){M(s,r,a,i,o,"throw",e)}i(void 0)})}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const V=(0,o.getAppEvents)();function z(e){const t=new N;let n=null;const r=V.subscribe(i.SetPanelAttentionEvent,e=>{"string"==typeof e.payload.panelId&&(n=e.payload.panelId)});function a(e,t){return()=>{const r=l.jh.findObject(e,e=>e.state.key===n&&e.isActive);r&&r instanceof l.Eb&&t(r)}}return t.addBinding({key:"p l",onTrigger:a(e,U)}),t.addBinding({key:"a l",onTrigger:function(e,t){return()=>{l.jh.findAllObjects(e,e=>e instanceof l.Eb&&e.isActive).forEach(e=>{e&&e instanceof l.Eb&&t(e)})}}(e,U)}),t.addBinding({key:"p x",onTrigger:a(e,e=>I(function*(){const t=(0,w.iD)(e);t&&o.locationService.push(t)})())}),t.addBinding({key:"t c",onTrigger:()=>{!function(e){const t=window.__grafanaSceneContext;window.__grafanaSceneContext=e}(l.jh.getTimeRange(e)),V.publish(new W)}}),t.addBinding({key:"t v",onTrigger:()=>{const t=new Q({updateUrl:!1});e.publishEvent(t),V.publish(t)}}),t.addBinding({key:"d r",onTrigger:()=>l.jh.getTimeRange(e).onRefresh()}),t.addBinding({key:"t z",onTrigger:()=>{q(e)}}),t.addBinding({key:"ctrl+z",onTrigger:()=>{q(e)}}),t.addBinding({key:"t a",onTrigger:()=>{const t=(0,B.m0)(e);null==t||t.toAbsolute()}}),t.addBinding({key:"t left",onTrigger:()=>{G(e,"left")}}),t.addBinding({key:"t right",onTrigger:()=>{G(e,"right")}}),()=>{t.removeAll(),r.unsubscribe()}}function q(e){const t=(0,B.m0)(e);null==t||t.onZoom()}function G(e,t){const n=(0,B.m0)(e);n&&("left"===t&&n.onMoveBackward(),"right"===t&&n.onMoveForward())}function U(e){const t=e.state.options;var n;null!=(n=t)&&"object"==typeof n&&"legend"in n&&"boolean"==typeof t.legend.showLegend&&e.onOptionsChange({legend:{showLegend:!t.legend.showLegend}})}class W extends i.BusEventBase{}R(W,"type","copy-time");class Q extends i.BusEventWithPayload{}R(Q,"type","paste-time");var K=n(25953),H=n(72152),J=n(90708),Y=n(74532),X=n(34907),Z=n(48848),ee=n(69683),te=n(78363),ne=n(10405),re=n(35591),ae=function(e){return e.seconds="s",e.minutes="m",e.hours="h",e.days="d",e.weeks="w",e.years="y",e}(ae||{});const se=new RegExp(RegExp("^(?:(?<value>\\d+)(?<type>ms|s|m|h|d|w|y))|0$")),ie=new Error(`Must be of format "(number)(unit)", for example "1m", or just "0". Available units: ${Object.values(ae).join(", ")}`),oe={ms:1,s:1e3,m:6e4,h:36e5,d:864e5,w:6048e5,y:31536e6};function le(e){let t=e;const n=[];if(function e(r){var a,s,i,o;const l=se.exec(r),c=(null==l||null===(a=l.groups)||void 0===a?void 0:a.value)&&(null==l||null===(s=l.groups)||void 0===s?void 0:s.type);if(!l||!c)throw ie;l&&(null===(i=l.groups)||void 0===i?void 0:i.value)&&(null===(o=l.groups)||void 0===o?void 0:o.type)&&(t=t.replace(l[0],""),n.push([Number(l.groups.value),l.groups.type])),t&&e(t)}(e),!n.length)throw ie;return n.reduce((e,[t,n])=>e+t*oe[n],0)}const ce=(e,t)=>{const{jsonData:n}=p.plugin.meta;if((null==n?void 0:n.interval)||(null==t?void 0:t.limits.retention_period)){let r=0,a=0;if(null==n?void 0:n.interval)try{r=Math.floor(le(n.interval)/1e3)}catch(e){K.v.error(e,{msg:`${n.interval} is not a valid interval string!`})}if(null==t?void 0:t.limits.retention_period)try{a=Math.floor(le(null==t?void 0:t.limits.retention_period)/1e3)}catch(e){K.v.error(e,{msg:`${null==t?void 0:t.limits.retention_period} is not a valid interval string!`})}if(r||a){const t=(0,i.getTimeZone)();return e.filter(e=>{const n=i.rangeUtil.convertRawToRange(e,t);if(n){const e=Math.floor((n.to.valueOf()-n.from.valueOf())/1e3);return 0===e||e<=1.1*a||e<=r}return!1})}}return e},ue=[{from:"now-1m",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-1-mins","Last minute")},{from:"now-5m",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-5-mins","Last 5 minutes")},{from:"now-15m",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-15-mins","Last 15 minutes")},{from:"now-30m",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-30-mins","Last 30 minutes")},{from:"now-1h",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-1-hour","Last 1 hour")},{from:"now-3h",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-3-hours","Last 3 hours")},{from:"now-6h",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-6-hours","Last 6 hours")},{from:"now-12h",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-12-hours","Last 12 hours")},{from:"now-24h",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-24-hours","Last 24 hours")},{from:"now-2d",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-2-days","Last 2 days")},{from:"now-7d",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-7-days","Last 7 days")},{from:"now-30d",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-30-days","Last 30 days")},{from:"now-60d",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-60-days","Last 60 days")},{from:"now-90d",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-90-days","Last 90 days")},{from:"now-6M",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.last-6-months","Last 6 months")},{from:"now-1d/d",to:"now-1d/d",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.yesterday","Yesterday")},{from:"now-2d/d",to:"now-2d/d",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.day-before-yesterday","Day before yesterday")},{from:"now-3d/d",to:"now-3d/d",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.day-three-days-ago","Three days ago")},{from:"now-4d/d",to:"now-4d/d",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.day-four-days-ago","Four days ago")},{from:"now-5d/d",to:"now-5d/d",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.day-five-days-ago","Five days ago")},{from:"now-6d/d",to:"now-6d/d",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.day-five-days-ago","Six days ago")},{from:"now-7d/d",to:"now-7d/d",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.this-day-last-week","This day last week")},{from:"now-1w/w",to:"now-1w/w",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.previous-week","Previous week")},{from:"now-2w/w",to:"now-2w/w",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.two-weeks-ago","Two weeks ago")},{from:"now-3w/w",to:"now-3w/w",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.three-weeks-ago","Three weeks ago")},{from:"now-4w/w",to:"now-4w/w",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.four-weeks-ago","Four weeks ago")},{from:"now-1M/M",to:"now-1M/M",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.previous-month","Previous month")},{from:"now-2M/M",to:"now-2M/M",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.two-months-ago","Two months ago")},{from:"now-3M/M",to:"now-3M/M",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.three-months-ago","Three months ago")},{from:"now/d",to:"now/d",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.today","Today")},{from:"now/d",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.today-so-far","Today so far")},{from:"now/w",to:"now/w",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.this-week","This week")},{from:"now/w",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.this-week-so-far","This week so far")},{from:"now/M",to:"now/M",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.this-month","This month")},{from:"now/M",to:"now",display:(0,re.t)("grafana-ui.date-time-pickers.quick-options.this-month-so-far","This month so far")}];var de,pe,ge,he=n(45553),fe=n(75548),ve=n(98626),me=n(96056),be=n(96991),ye=n(61402),Se=n(173);class we extends l.Bs{}ge=function({model:e}){var t,n;const r=l.jh.getVariables(e).useState();let s=r.variables;return(null===(t=e.state.include)||void 0===t?void 0:t.length)&&(s=r.variables.filter(t=>{var n,r;return null===(n=e.state.include)||void 0===n?void 0:n.includes(null!==(r=t.state.name)&&void 0!==r?r:"")})),(null===(n=e.state.exclude)||void 0===n?void 0:n.length)&&(s=r.variables.filter(t=>{var n,r;return!(null===(n=e.state.exclude)||void 0===n?void 0:n.includes(null!==(r=t.state.name)&&void 0!==r?r:""))})),a().createElement(a().Fragment,null,s.map(t=>a().createElement(l.Lp,{key:t.state.key,variable:t,layout:e.state.layout})))},(pe="Component")in(de=we)?Object.defineProperty(de,pe,{value:ge,enumerable:!0,configurable:!0,writable:!0}):de[pe]=ge;var Oe=n(46089),Ee=n(9598);function xe(e){const t=(0,u.useStyles2)(_e);return a().createElement(a().Fragment,null,a().createElement(u.Alert,{className:t.alert,severity:"info",title:"Welcome to Grafana Logs Drilldown!",onRemove:e.onRemove},a().createElement("div",null,"Check out our"," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://grafana.com/docs/grafana-cloud/visualizations/simplified-exploration/logs/",rel:"noreferrer"},"Get started doc"),", or see"," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://github.com/grafana/explore-logs/releases",rel:"noreferrer"},"recent changes"),".",a().createElement("br",null),"Help us shape the future of the app."," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://forms.gle/1sYWCTPvD72T1dPH9",rel:"noreferrer"},"Send us feedback")," ","or engage with us on"," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://github.com/grafana/explore-logs/?tab=readme-ov-file#explore-logs",rel:"noreferrer"},"GitHub"),".")))}function _e(e){return{alert:(0,Oe.css)({flex:"none"})}}var Ce=n(32085),Pe=n(81459),ke=n(66732);class Le extends l.Bs{}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Le,"Component",({model:e})=>{const t=(0,he.cR)(e),n=l.jh.getTimeRange(e),{filters:r}=t.useState();(0,he.ir)(e).useState(),(0,he.iw)(e).useState(),(0,he.oY)(e).useState(),(0,he.Gk)(e).useState(),(0,he.Ku)(e).useState(),n.useState();const s=l.jh.getAncestor(e,pt),o=s.getContentScene();if(!(o instanceof ye.Mn&&o.state.embedded))return K.v.error(new Error("Service scene does not exist, or is not embedded!")),null;const c=l.Go.getUrlState(s);if(0===r.length)return null;const{labelName:d,labelValue:p}=(0,fe.xb)(o,t);return a().createElement(u.LinkButton,{onClick:()=>{(0,g.EE)(g.NO.service_details,g.ir.service_details.embedded_go_to_explore_clicked)},href:i.urlUtil.renderUrl(ee.bw.logs(p,d),c),variant:"secondary",icon:"arrow-right"},"Logs Drilldown")});const je=()=>{const e=(0,u.useStyles2)(Fe);return a().createElement("div",{className:e.wrapper},a().createElement("a",{href:"https://forms.gle/1sYWCTPvD72T1dPH9",className:e.feedback,title:"Share your thoughts about Logs in Grafana.",target:"_blank",rel:"noreferrer noopener"},a().createElement(u.Icon,{name:"comment-alt-message"})," Give feedback"))},Fe=e=>({feedback:(0,Oe.css)({"&:hover":{color:e.colors.text.link},alignSelf:"center",color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize}),wrapper:(0,Oe.css)({display:"flex",gap:e.spacing(1),marginLeft:"auto",position:"relative",top:e.spacing(-1)})});var Te=n(67478),De=n(53571);const $e=({onRemove:e,pattern:t,size:n="lg"})=>{const s=(0,u.useStyles2)(Be),[i,o]=(0,r.useState)(!1);return a().createElement("div",{className:s.pattern,onClick:()=>o(!i),onMouseLeave:()=>o(!1),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||o(!i)},role:"button",tabIndex:0},a().createElement(u.Tag,{title:t,key:t,name:i?t:Ae(t,n),className:s.tag}),a().createElement(u.Button,{"aria-label":"Remove pattern","data-testid":De.b.exploreServiceDetails.buttonRemovePattern,variant:"secondary",size:"sm",className:s.removeButton,onClick:e},a().createElement(u.Icon,{name:"times"})))},Ne={lg:Math.round(window.innerWidth/8),sm:50};function Ae(e,t){const n=e.length;if(n<Ne[t])return e;const r=Math.round(.4*Ne[t]);return`${e.substring(0,r)} â€¦ ${e.substring(n-r)}`}const Be=e=>({pattern:(0,Oe.css)({cursor:"pointer",display:"flex",fontFamily:"monospace",gap:e.spacing(.25),overflow:"hidden"}),removeButton:(0,Oe.css)({paddingLeft:2.5,paddingRight:2.5,borderTopLeftRadius:0,borderBottomLeftRadius:0}),tag:(0,Oe.css)({backgroundColor:e.colors.secondary.main,border:`solid 1px ${e.colors.secondary.border}`,borderBottomRightRadius:0,borderTopRightRadius:0,boxSizing:"border-box",color:e.colors.secondary.text,overflow:"hidden",padding:e.spacing(.25,.75),textOverflow:"ellipsis"})}),Me=({onRemove:e,patterns:t})=>{const n=(0,u.useStyles2)(Ie);if(!t||0===t.length)return null;const r=t.filter(e=>"include"===e.type),s=t.filter(e=>"include"!==e.type),i=n=>{(0,Te.bN)(),e(t.filter(e=>e!==n)),(0,g.EE)(g.NO.service_details,g.ir.service_details.pattern_removed,{excludePatternsLength:s.length-("include"!==(null==n?void 0:n.type)?1:0),includePatternsLength:r.length-("include"===(null==n?void 0:n.type)?1:0),type:n.type})};return a().createElement("div",null,r.length>0&&a().createElement("div",{className:n.patternsContainer},a().createElement(u.Text,{variant:"bodySmall",weight:"bold","data-testid":De.b.patterns.buttonIncludedPattern},"Included pattern",t.length>1?"s":""),a().createElement("div",{className:n.patterns},r.map(e=>a().createElement($e,{key:e.pattern,pattern:e.pattern,size:"lg",onRemove:()=>i(e)})))),s.length>0&&a().createElement("div",{className:n.patternsContainer},a().createElement(u.Text,{variant:"bodySmall",weight:"bold","data-testid":De.b.patterns.buttonExcludedPattern},"Excluded pattern",s.length>1?"s":"",":"),a().createElement("div",{className:n.patterns},s.map(e=>a().createElement($e,{key:e.pattern,pattern:e.pattern,size:s.length>1?"sm":"lg",onRemove:()=>i(e)})))))};function Ie(e){return{patterns:(0,Oe.css)({alignItems:"center",display:"flex",flexWrap:"wrap",gap:e.spacing(1)}),patternsContainer:(0,Oe.css)({overflow:"hidden"})}}var Re=n(13574);function Ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ze(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}class qe extends l.Bs{onActivate(){l.jh.getAncestor(this,pt).state.embedded&&this.setState({embeddedLink:new Le({})})}constructor(e){const t=(0,ke.nV)();super(ze(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Ve(e,t,n[t])})}return e}({},e),{collapsed:t})),Ve(this,"toggleCollapsedState",()=>{const e=!this.state.collapsed;this.setState({collapsed:e}),(0,ke.BS)(e),(0,o.reportInteraction)("grafana_logs_app_filters_collapse_toggled",{collapsed:e})}),this.addActivationHandler(this.onActivate.bind(this)),(0,o.reportInteraction)("grafana_logs_app_filters_collapse_state",{collapsed:t})}}function Ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ue(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}Ve(qe,"Component",({model:e})=>{const t=l.jh.getAncestor(e,pt),{controls:n,patterns:r,embedded:s}=t.useState(),i=l.jh.getAncestor(e,Ye),{levelsRenderer:c,lineFilterRenderer:d}=i.useState(),p=(0,o.useChromeHeaderHeight)(),{collapsed:g}=e.useState(),h=(0,u.useStyles2)(e=>function(e,t,n=!1){return{controlsContainer:(0,Oe.css)({display:"flex",flexDirection:"column",gap:e.spacing(1),label:"controlsContainer",padding:e.spacing(2)}),controlsFirstRowContainer:(0,Oe.css)({[e.breakpoints.down("md")]:{flexDirection:"column-reverse"},alignItems:"flex-start",display:"flex",gap:e.spacing(2),justifyContent:"space-between",label:"controls-first-row"}),controlsRowContainer:(0,Oe.css)({[e.breakpoints.down("lg")]:{flexDirection:"column"},"&:empty":{display:"none"},alignItems:"flex-start",display:n?"none":"flex",gap:e.spacing(2),label:"controls-row"}),controlsWrapper:(0,Oe.css)({display:"flex",flexDirection:"column",label:"controlsWrapper",marginTop:e.spacing(.375)}),filters:(0,Oe.css)({display:"flex",label:"filters"}),filtersWrap:(0,Oe.css)({alignItems:"flex-end",display:"flex",flexWrap:"wrap",gap:e.spacing(2),label:"filtersWrap",width:"calc(100% - 450)"}),firstRowWrapper:(0,Oe.css)({"& > div > div":{[e.breakpoints.down("lg")]:{flexDirection:"column"},gap:"16px",label:"first-row-wrapper"}}),stickyControlsContainer:(0,Oe.css)({background:e.colors.background.canvas,boxShadow:e.shadows.z1,gap:e.spacing(0),left:0,position:"sticky",top:t,zIndex:e.zIndex.navbarFixed}),timeRange:(0,Oe.css)({display:"flex",flexDirection:"row",gap:e.spacing(1),label:"timeRange"}),timeRangeDatasource:(0,Oe.css)({display:"flex",flexWrap:"wrap",gap:e.spacing(1),justifyContent:"flex-end",label:"timeRangeDatasource"}),iconCollapsed:(0,Oe.css)({svg:{transform:"rotate(90deg)"}}),iconExpanded:(0,Oe.css)({svg:{transform:"rotate(-90deg)"}})}}(e,null!=p?p:40,g)),f=(0,ee.FT)();return a().createElement("div",{className:(0,Oe.cx)(h.controlsContainer,"sticky"===e.state.position?h.stickyControlsContainer:void 0)},a().createElement(a().Fragment,null,n&&a().createElement("div",{className:h.controlsFirstRowContainer},a().createElement("div",{className:h.filtersWrap},a().createElement("div",{className:(0,Oe.cx)(h.filters,h.firstRowWrapper)},n.map(e=>e instanceof l.G1?a().createElement(e.Component,{key:e.state.key,model:e}):null)),s&&a().createElement(Re.$,{indexScene:t})),a().createElement("div",{className:h.controlsWrapper},!t.state.embedded&&a().createElement(je,null),a().createElement("div",{className:h.timeRangeDatasource},f!==m.G3.explore&&a().createElement(u.ToolbarButton,{className:g?h.iconCollapsed:h.iconExpanded,variant:g?"active":"canvas",icon:"arrow-from-right",onClick:e.toggleCollapsedState,tooltip:g?(0,re.t)("logs.logs-drilldown-header.expand","Expand filters"):(0,re.t)("logs.logs-drilldown-header.collapse","Collapse filters")}),e.state.embeddedLink&&a().createElement(e.state.embeddedLink.Component,{model:e.state.embeddedLink}),n.map(e=>e.state.key===Je?a().createElement(e.Component,{key:e.state.key,model:e}):null),a().createElement("div",{className:h.timeRange},n.map(e=>e instanceof we||e instanceof l.G1?null:a().createElement(e.Component,{key:e.state.key,model:e})))))),a().createElement("div",{className:h.controlsRowContainer},c&&a().createElement(c.Component,{model:c}),n&&a().createElement("div",{className:h.filtersWrap},a().createElement("div",{className:h.filters},n.map(e=>e instanceof we&&e.state.key===Qe?a().createElement(e.Component,{key:e.state.key,model:e}):null)))),(0,ke.Qi)()&&a().createElement("div",{className:h.controlsRowContainer},n&&a().createElement("div",{className:h.filtersWrap},a().createElement("div",{className:h.filters},n.map(e=>e instanceof we&&e.state.key===Ke?a().createElement(e.Component,{key:e.state.key,model:e}):null)))),a().createElement("div",{className:h.controlsRowContainer},a().createElement(Me,{patterns:r,onRemove:e=>t.setState({patterns:e})})),a().createElement("div",{className:h.controlsRowContainer},d&&a().createElement(d.Component,{model:d}))))});const We=`${Ee.s_}.interceptBannerStorageKey`,Qe="vars-fields-metadata",Ke="vars-json-fields",He="vars-timepicker",Je="vars-ds";class Ye extends l.Bs{onActivate(){const e=(0,ee.FT)();this.setState({levelsRenderer:new Ce.qV({}),lineFilterRenderer:new Pe.Y({}),variableLayout:new qe({position:e===m.G3.explore?"sticky":"relative"})})}dismiss(){this.setState({interceptDismissed:!0}),localStorage.setItem(We,"true")}constructor(e){super(Ue(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Ge(e,t,n[t])})}return e}({},e),{interceptDismissed:!!localStorage.getItem(We)})),this.addActivationHandler(this.onActivate.bind(this))}}function Xe(e){return{body:(0,Oe.css)({display:"flex",flexDirection:"column",flexGrow:1,gap:e.spacing(1),label:"body-wrapper",padding:`0 ${e.spacing(2)} ${e.spacing(2)}`}),bodyContainer:(0,Oe.css)({display:"flex",flexDirection:"column",flexGrow:1,minHeight:"100%"}),container:(0,Oe.css)({display:"flex",flexDirection:"column",flexGrow:1,maxWidth:"100vw",minHeight:"100%"}),controlsContainer:(0,Oe.css)({display:"flex",flexDirection:"column",gap:e.spacing(1),label:"controlsContainer"})}}Ge(Ye,"Component",({model:e})=>{const t=l.jh.getAncestor(e,pt),{contentScene:n}=t.useState(),{interceptDismissed:r,variableLayout:s}=e.useState(),i=(0,u.useStyles2)(Xe);return n?a().createElement("div",{className:i.bodyContainer},a().createElement("div",{className:i.container},!r&&a().createElement(xe,{onRemove:()=>{e.dismiss()}}),s&&a().createElement(s.Component,{model:s}),a().createElement("div",{className:i.body},n&&a().createElement(n.Component,{model:n})))):(K.v.warn("content scene not defined"),null)});var Ze=n(17796),et=n(39731),tt=n(90020);function nt(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}const rt=(e,t)=>{return(n=function*(){const n=[],r=yield(0,B.hJ)(e);if(!r)return;n.push((0,s.createAssistantContextItem)("datasource",{datasourceUid:r.uid}));const a=(0,he.cR)(e);a.state.filters.length>0&&n.push(...a.state.filters.map(e=>(0,s.createAssistantContextItem)("label_value",{datasourceUid:r.uid,labelName:e.key,labelValue:`${at(e.operator)}${(0,tt.Dx)(e.value)}`})));const i=(0,he.iw)(e);i.state.filters.length>0&&n.push(...i.state.filters.map(e=>(0,s.createAssistantContextItem)("label_value",{datasourceUid:r.uid,labelName:e.key,labelValue:e.value})));const o=(0,he.oY)(e);o.state.filters.length>0&&n.push(...o.state.filters.map(e=>(0,s.createAssistantContextItem)("structured",{title:"Structured metadata filters",hidden:!0,data:{datasourceUid:r.uid,fieldName:e.key,fieldValue:`${at(e.operator)}${(0,tt.Dx)(e.value)}`}})));const l=(0,he.ir)(e);l.state.filters.length>0&&n.push(...l.state.filters.map(e=>{const t=(0,he.bu)(e);return(0,s.createAssistantContextItem)("structured",{title:"Parsed fields filters",hidden:!0,data:{datasourceUid:r.uid,fieldName:e.key,parser:t.parser,fieldValue:`${at(e.operator)}${(0,tt.Dx)(t.value)}`}})})),t(n)},function(){var e=this,t=arguments;return new Promise(function(r,a){var s=n.apply(e,t);function i(e){nt(s,r,a,i,o,"next",e)}function o(e){nt(s,r,a,i,o,"throw",e)}i(void 0)})})();var n};function at(e){return e!==S.w7.Equal?e:""}var st=n(57985);function it(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function ot(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var s=e.apply(t,n);function i(e){it(s,r,a,i,o,"next",e)}function o(e){it(s,r,a,i,o,"throw",e)}i(void 0)})}}function lt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ct(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){lt(e,t,n[t])})}return e}function ut(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const dt="showLogsButtonScene";class pt extends l.Bs{onActivate(){var e;const t={};this.setVariableProviders();l.jh.findByKeyAndType(this,dt,Ze.H).setState({hidden:!1}),this.state.contentScene||(t.contentScene=this.getContentScene()),this.setTagProviders(),this.setState(t),this.updatePatterns(this.state,(0,he.Ku)(this)),this.state.embedded||(this.resetVariablesIfNotInUrl((0,he.ir)(this),(0,he.n5)(tt.mB)),this.resetVariablesIfNotInUrl((0,he.iw)(this),(0,he.n5)(tt._Y))),this._subs.add(this.subscribeToState((e,t)=>{this.updatePatterns(e,(0,he.Ku)(this));const n=e.lokiConfig;if(n&&n!==v.X&&n!==t.lokiConfig){l.jh.findByKeyAndType(this,He,l.KE).setState({quickRanges:ce(ue,n)})}}));const n=l.jh.getTimeRange(this);this._subs.add(n.subscribeToState(this.limitMaxInterval(n))),this._subs.add(this.subscribeToEvent(Q,this.subscribeToPasteTimeEvent));const r=(0,he.ir)(this).state.filters,a=(0,he.oY)(this).state.filters,i=(0,he.YS)(this);i.updateFilters([...a,...r]),this._subs.add(i.subscribeToState(this.subscribeToCombinedFieldsVariable));const o=z(this);void 0!==this.state.embedded&&this.state.embedded!==(null===(e=(0,H.JO)().getServiceSceneState())||void 0===e?void 0:e.embedded)&&(0,H.JO)().setEmbedded(this.state.embedded),this.setState({currentFiltersMatchReference:this.currentFiltersMatchReference()}),this._subs.add((0,he.cR)(this).subscribeToState(()=>ot(function*(){this.setState({currentFiltersMatchReference:this.currentFiltersMatchReference()})}).call(this)));const c=[];return this._subs.add((0,s.isAssistantAvailable)().subscribe(e=>{e&&!this.assistantInitialized&&(c.push(this.provideAssistantQuestions()),c.push(this.provideAssistantContext()))})),this._subs.add(this.subscribeToLokiConfigAPI()),this._subs.add(this.subscribeToDataSourceChange()),this.getDefaultColumnsFromAppPlatform(),()=>{o(),c.forEach(e=>e.unregister())}}getDefaultColumnsFromAppPlatform(){return ot(function*(){if(ve.f5){const e=(0,he.S9)(this).state.value.toString(),t=(0,H.JO)().getDefaultColumns(e);if(t)this.setState({defaultColumnsRecords:t});else{const t=(0,d.TP)("logsdrilldown.grafana.app","v1beta1"),n=new Request(`${t}/logsdrilldowndefaultcolumns/${e}`),r=yield fetch(n);if(r.ok){const t=(yield r.json()).spec.records;this.setState({defaultColumnsRecords:t}),(0,H.JO)().setDefaultColumns(t,e)}}}}).call(this)}currentFiltersMatchReference(){return!(this.state.referenceLabels&&this.state.referenceLabels.length>0)||(0,fe.E1)(this.state.referenceLabels||[],(0,he.cR)(this).state.filters)}getContentScene(){var e;if(this.state.embedded){const e=i.urlUtil.getUrlSearchParams(),t=(0,A.nv)(e),n=(0,A.sJ)(e);return new ye.Mn({drillDownLabel:t||void 0,embedded:!0,pageSlug:n||m.G3.logs})}return function(e){if((0,ee.FT)()===m.G3.explore)return new Se.y({});return new ye.Mn({drillDownLabel:e})}(null===(e=this.state.routeMatch)||void 0===e?void 0:e.params.breakdownLabel)}provideAssistantQuestions(){return(0,ee.FT)()===m.G3.explore?(0,s.provideQuestions)(`${Ee.Gy}/**`,[{prompt:"How do I select the right service to see logs?"},{prompt:"Help me find labels with error spikes"}]):(0,s.provideQuestions)(`${Ee.Gy}/**`,[{prompt:"Find the root cause of recent errors"},{prompt:"Detect spikes or anomalies in log volume"},{prompt:"Summarize what's been happening lately"}])}subscribeToDataSourceChange(){return(0,he.S9)(this).subscribeToState((e,t)=>{e.value!==t.value&&(this.state.$lokiConfig.runQueries(),this.getDefaultColumnsFromAppPlatform())})}subscribeToLokiConfigAPI(){var e;if(this.state.lokiConfig!==v.X&&!(null===(e=this.state.$lokiConfig.state.data)||void 0===e?void 0:e.series.length)){const e=(0,H.JO)().getLokiConfig();e?this.setState({lokiConfig:e}):this.state.$lokiConfig.runQueries()}return this.state.$lokiConfig.subscribeToState((e,t)=>{var n,r,a;if((null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Error)this.setState({lokiConfig:v.X}),(0,H.JO)().setLokiConfig(v.X);else if((null===(r=e.data)||void 0===r?void 0:r.state)===i.LoadingState.Done&&(null===(a=e.data)||void 0===a?void 0:a.series.length)>0){var s;const t=null===(s=e.data)||void 0===s?void 0:s.series[0].fields[0].values[0];t&&(this.setState({lokiConfig:t}),(0,H.JO)().setLokiConfig(t))}})}provideAssistantContext(){const e=(0,s.providePageContext)(`${Ee.Gy}/**`,[]);return this._subs.add((0,he.S9)(this).subscribeToState(()=>ot(function*(){yield rt(this,e)}).call(this))),this._subs.add((0,he.cR)(this).subscribeToState(()=>ot(function*(){yield rt(this,e)}).call(this))),this._subs.add((0,he.iw)(this).subscribeToState(()=>ot(function*(){yield rt(this,e)}).call(this))),this._subs.add((0,he.ir)(this).subscribeToState(()=>ot(function*(){yield rt(this,e)}).call(this))),this.assistantInitialized=!0,e}setTagProviders(){this.setLabelsProviders()}setLabelsProviders(){const e=(0,he.cR)(this);e._getOperators=()=>(0,fe.Ht)(e),e.setState({getTagKeysProvider:te.f$,getTagValuesProvider:ne.jw})}limitMaxInterval(e){return(t,n)=>{const{jsonData:r}=p.plugin.meta;if(null==r?void 0:r.interval)try{var a;const s=i.rangeUtil.intervalToSeconds(null!==(a=null==r?void 0:r.interval)&&void 0!==a?a:"");if(!s)return;const c=t.value.to.diff(t.value.from,"seconds");if(c>s){if(c<=n.value.to.diff(n.value.from,"seconds"))e.setState({from:n.from,to:n.to,value:n.value});else{const t=new l.JZ(be.sp);e.setState({from:t.state.from,to:t.state.to,value:t.state.value})}(0,o.getAppEvents)().publish({payload:["Time range interval exceeds maximum interval configured by the administrator."],type:i.AppEvents.alertWarning.name}),(0,g.EE)("all","interval_too_long",{attempted_duration_seconds:c,configured_max_interval:s})}}catch(e){console.error(e)}}}setVariableProviders(){const e=(0,he.iw)(this),t=(0,he.YS)(this);t._getOperators=()=>(0,fe.Ht)(t),e.setState({getTagKeysProvider:this.getLevelsTagKeysProvider(),getTagValuesProvider:this.getLevelsTagValuesProvider()}),t.setState({getTagKeysProvider:this.getCombinedFieldsTagKeysProvider(),getTagValuesProvider:this.getCombinedFieldsTagValuesProvider()})}getCombinedFieldsTagKeysProvider(){return(e,t)=>{const n=(0,he.oY)(this),r=(0,he.ir)(this),a=(0,b.O)(tt.sL),s=n.state.filters.filter(e=>e.key!==t),i=r.state.filters.filter(e=>e.key!==t),o=this.renderVariableFilters(tt.mB,i),c=this.renderVariableFilters(tt._P,s),u=a.replace(tt.Gd,o).replace(tt.w0,c),d=l.jh.interpolate(this,u);return(0,te.ld)({expr:d,sceneRef:this,timeRange:l.jh.getTimeRange(this).state.value,variableType:tt.sL})}}getCombinedFieldsTagValuesProvider(){return(e,t)=>{const n=(0,b.O)(tt.sL),r=(0,he.oY)(this),a=(0,he.ir)(this),s=r.state.filters.filter(e=>e.key!==t.key&&(0,J.BG)(e.operator)),i=a.state.filters.filter(e=>e.key!==t.key&&(0,J.BG)(e.operator)),o=this.renderVariableFilters(tt.mB,i),c=this.renderVariableFilters(tt._P,s),u=n.replace(tt.Gd,o).replace(tt.w0,c),d=(0,st.Sh)(this,u);return(0,ne.O2)(t,e,d,this,l.jh.getTimeRange(this).state.value,tt.sL)}}getLevelsTagKeysProvider(){return(e,t)=>{const n=e.state.filters.filter(e=>e.key!==t),r=this.renderVariableFilters(tt._Y,n),a=(0,b.O)(tt._Y).replace(tt.Gd,r),s=l.jh.interpolate(this,a);return(0,te.ld)({expr:s,sceneRef:this,timeRange:l.jh.getTimeRange(this).state.value,variableType:tt._Y})}}getLevelsTagValuesProvider(){return(e,t)=>{const n=e.state.filters.filter(e=>e.key!==t.key&&e.operator===S.w7.Equal),r=this.renderVariableFilters(tt._Y,n),a=(0,b.O)(tt._Y).replace(tt.Gd,r),s=(0,st.Sh)(this,a);return(0,ne.O2)(t,e,s,this,l.jh.getTimeRange(this).state.value,tt._Y)}}renderVariableFilters(e,t){if(e===tt.mB)return(0,st.ZX)(t);if(e===tt._P)return(0,st.E3)(t);if(e===tt._Y)return(0,st.E3)(t);{const e=new Error("getFieldsTagValuesProvider only supports fields, metadata, and levels");throw K.v.error(e),e}}resetVariablesIfNotInUrl(e,t){const n=o.locationService.getLocation();null===new URLSearchParams(n.search).get(t)&&e.setState({filters:[]})}updatePatterns(e,t){var n;const r=(0,Z.M)(null!==(n=e.patterns)&&void 0!==n?n:[]);t.changeValueTo(r)}getUrlState(){return{patterns:JSON.stringify(this.state.patterns)}}updateFromUrl(e){const t={};e.patterns&&"string"==typeof e.patterns&&(t.patterns=JSON.parse(e.patterns)),this.setState(t)}resetToReferenceQuery(){(0,he.cR)(this).setState({filters:this.state.referenceLabels||[]})}constructor(e){var t;const{jsonData:n}=p.plugin.meta;var r,a,s;const u=null!==(s=null!==(a=null!==(r=null==n?void 0:n.dataSource)&&void 0!==r?r:(0,ke.QB)())&&void 0!==a?a:(0,ke.x0)())&&void 0!==s?s:"grafanacloud-logs",{unsub:d,variablesScene:g}=function(e,t,n,r,a){const s=null==a?void 0:a.filter(e=>{var t;return"structuredMetadata"===(null===(t=e.meta)||void 0===t?void 0:t.parser)}),i=null==a?void 0:a.filter(e=>{var t;return"structuredMetadata"!==(null===(t=e.meta)||void 0===t?void 0:t.parser)}),o=new l.H9({allowCustomValue:!0,datasource:tt.eL,expressionBuilder:st.VW,hide:c.zL.dontHide,key:"adhoc_service_filter",label:"Labels",layout:"combobox",name:tt.MB,onAddCustomValue:st.c0,filters:null!=t?t:[]});o._getOperators=function(){return Y.II};const u=new l.H9({allowCustomValue:!0,applyMode:"manual",expressionBuilder:st.ZX,hide:c.zL.hideVariable,label:"Detected fields",layout:"combobox",name:tt.mB,filters:null!=i?i:[]});u._getOperators=()=>Y.II;const d=new l.H9({allowCustomValue:!0,applyMode:"manual",expressionBuilder:e=>(0,st.E3)(e),hide:c.zL.hideVariable,label:"Metadata",layout:"combobox",name:tt._P,filters:null!=s?s:[]});d._getOperators=()=>Y.II;const p=new l.H9({allowCustomValue:!0,applyMode:"manual",hide:c.zL.hideVariable,label:"Fields",layout:"combobox",name:tt.sL,onAddCustomValue:st.PP,skipUrlSync:!0}),g=new l.H9({applyMode:"manual",expressionBuilder:st._q,hide:c.zL.hideVariable,label:"Error levels",layout:"vertical",name:tt._Y,supportsMultiValueOperators:!0});var h;const v=new l.H9({expressionBuilder:st.CY,filters:null!==(h=null==r?void 0:r.map((e,t)=>ut(ct({},e),{keyLabel:t.toString()})))&&void 0!==h?h:[],getTagKeysProvider:()=>Promise.resolve({replace:!0,values:[]}),getTagValuesProvider:()=>Promise.resolve({replace:!0,values:[]}),hide:c.zL.hideVariable,layout:"horizontal",name:tt.NW});v._getOperators=()=>Y.eb;const m=new l.mI({hide:n?c.zL.hideVariable:c.zL.dontHide,label:"Data source",name:tt.EY,pluginId:"loki",value:e}),b=m.subscribeToState(e=>{const t=`${e.value}`;e.value&&(0,ke.ke)(t)}),y=new l.H9({allowCustomValue:!0,expressionBuilder:(0,st.Hs)(),getTagKeysProvider:()=>Promise.resolve({replace:!0,values:[]}),getTagValuesProvider:()=>Promise.resolve({replace:!0,values:[]}),name:tt.lV}),S=new l.H9({allowCustomValue:!0,expressionBuilder:(0,st.tR)(),getTagKeysProvider:()=>Promise.resolve({replace:!0,values:[]}),getTagValuesProvider:()=>Promise.resolve({replace:!0,values:[]}),layout:"horizontal",name:tt.pw});return{unsub:b,variablesScene:new l.Pj({variables:[S,m,o,u,g,d,y,p,new l.yP({hide:c.zL.hideVariable,name:tt.uw,value:""}),new l.H9({expressionBuilder:st.CY,hide:c.zL.hideVariable,name:tt.WM}),v,new f.m({hide:c.zL.hideVariable,name:tt.QE,options:[{label:tt.YN,value:tt.YN}],skipUrlSync:!0,value:tt.YN})]})}}(u,null==e?void 0:e.initialLabels,e.embedded,e.defaultLineFilters,e.initialFields),v=[new l.G1({children:[new l.vA({body:new we({include:[tt.MB],key:"vars-labels",layout:"vertical"})}),new Ze.H({disabled:!0,key:dt})],direction:"row",key:"vars-row__datasource-labels-timepicker-button"}),new we({include:[tt._P],key:"vars-metadata",layout:"vertical"}),new we({include:[tt.mB],key:"vars-fields",layout:"vertical"}),new we({include:[tt.EY],key:Je,layout:"horizontal"}),new we({include:[tt.sL],key:Qe,layout:"vertical"}),new we({include:[tt.lV,tt.pw],key:Ke,layout:"vertical"}),new l.KE({hidePicker:e.hideTimePicker,key:He,quickRanges:ce(ue)})];var m,b,S,w;e.hideTimePicker||v.push(new l.WM({key:"vars-refresh"})),"explore"===(0,ee.FT)()&&o.config.featureToggles.exploreLogsAggregatedMetrics&&v.push(new et.s({isOpen:!1,key:"vars-toolbar"})),super(ut(ct({$timeRange:null!==(m=e.$timeRange)&&void 0!==m?m:new l.JZ({}),$variables:null!==(b=e.$variables)&&void 0!==b?b:g,$lokiConfig:(0,X.V6)(),controls:null!==(S=e.controls)&&void 0!==S?S:v,embedded:null!==(w=e.embedded)&&void 0!==w&&w,patterns:[]},e),{body:new Ye({})})),lt(t=this,"_urlSync",new l.So(t,{keys:["patterns"]})),lt(t,"assistantInitialized",!1),lt(t,"subscribeToCombinedFieldsVariable",(e,n)=>{if(!(0,h.B)(e.filters,null==n?void 0:n.filters)){const n=e.filters.filter(e=>(0,y.OH)(e)),r=e.filters.filter(e=>!(0,y.OH)(e));(0,he.ir)(t).updateFilters(r),(0,he.oY)(t).updateFilters(n)}}),lt(t,"subscribeToPasteTimeEvent",()=>ot(function*(){const e=yield I(function*(){const e=yield navigator.clipboard.readText();let t;try{t=JSON.parse(e);const n=(0,A.OK)(t);if(n)return{isError:!1,range:n}}catch(e){}return{isError:!0,range:e}})();if(e.isError)return;const n=l.jh.getTimeRange(t),r="string"==typeof e.range.to?e.range.to:void 0,a="string"==typeof e.range.from?e.range.from:void 0,s=i.rangeUtil.convertRawToRange(e.range);n&&s?n.setState({from:a,to:r,value:s}):K.v.error(new Error("Invalid time range from clipboard"),{from:null!=a?a:"",msg:"Invalid time range from clipboard",sceneTimeRange:typeof n,to:null!=r?r:""})})()),t._subs.add(d),t.addActivationHandler(t.onActivate.bind(t)),(0,B.hJ)(t).then(e=>{t.setState({ds:e})})}}lt(pt,"Component",({model:e})=>{const{body:t}=e.useState();return(0,he.S9)(e).state.options.length?t?a().createElement(t.Component,{model:t}):a().createElement(u.LoadingPlaceholder,{text:"Loading..."}):a().createElement(me.Q,null)})},32085:(e,t,n)=>{n.d(t,{dm:()=>b,kz:()=>v,qV:()=>m});var r=n(85959),a=n.n(r),s=n(46089),i=n(76644),o=n(82007),l=n(66854),c=n(67478),u=n(53571),d=n(45553),p=n(90020);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){g(e,t,n[t])})}return e}function f(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const v="levels-var-custom-renderer";class m extends i.Bs{onActivate(){this.onFilterChange(),this._subs.add((0,d.iw)(this).subscribeToEvent(i.oh,()=>{this.onFilterChange()}))}onFilterChange(){const e=(0,d.iw)(this);this.setState({options:e.state.filters.map(e=>{var t,n;return{selected:!0,text:null!==(n=null===(t=e.valueLabels)||void 0===t?void 0:t[0])&&void 0!==n?n:e.value,value:e.value}})})}constructor(e){super(f(h({},e),{isLoading:!1,isOpen:!1,key:v,visible:!1})),g(this,"getTagValues",()=>{var e,t;this.setState({isLoading:!0});const n=(0,d.iw)(this);var r;const a=null==n||null===(t=n.state)||void 0===t||null===(e=t.getTagValuesProvider)||void 0===e?void 0:e.call(t,n,null!==(r=n.state.filters[0])&&void 0!==r?r:{key:p.e4});null==a||a.then(e=>{if(Array.isArray(e.values)){var t;const r=e.values.map(e=>{var t;return{selected:n.state.filters.some(t=>t.value===e.text),text:e.text,value:null!==(t=e.value)&&void 0!==t?t:e.text}}),a=null===(t=this.state.options)||void 0===t?void 0:t.filter(e=>e.selected&&!r.some(t=>t.value===e.value)),s=a?[...r,...a]:[...r];this.setState({isLoading:!1,options:s})}})}),g(this,"updateFilters",(e,t)=>{var n;const r=(0,d.iw)(this),a=null===(n=this.state.options)||void 0===n?void 0:n.filter(e=>e.selected);var s;r.updateFilters(null!==(s=null==a?void 0:a.map(e=>({key:p.e4,operator:l.w7.Equal,value:e.text})))&&void 0!==s?s:[],{forcePublish:t,skipPublish:e})}),g(this,"onChangeOptions",e=>{var t;(0,c.bN)(),this.setState({options:null===(t=this.state.options)||void 0===t?void 0:t.map(t=>e.some(e=>e.value===t.value)?f(h({},t),{selected:!0}):f(h({},t),{selected:!1}))}),this.state.isOpen?this.updateFilters(!0):this.updateFilters(!1)}),g(this,"openSelect",e=>{this.setState({isOpen:e})}),g(this,"onCloseMenu",()=>{this.openSelect(!1),this.updateFilters(!1,!0)}),g(this,"onCreateCustomOption",e=>{const t={selected:!0,text:e,value:e};this.setState({options:this.state.options?[...this.state.options,t]:[t]})}),this.addActivationHandler(this.onActivate.bind(this))}}function b(e){const t=i.jh.findObject(e,e=>e instanceof m);t instanceof m&&t.onFilterChange()}g(m,"Component",({model:e})=>{const{isLoading:t,isOpen:n,options:r,visible:s}=e.useState(),l=(0,o.useStyles2)(y);return(0,d.iw)(e).useState(),s?a().createElement("div",{"data-testid":u.b.variables.levels.inputWrap,className:l.wrapper},a().createElement(i.Zx,{layout:"vertical",label:"Log levels"}),a().createElement(o.MultiSelect,{"aria-label":"Log level filters",prefix:a().createElement(o.Icon,{size:"lg",name:"filter"}),placeholder:"All levels",className:l.control,onChange:e.onChangeOptions,onCloseMenu:()=>e.onCloseMenu(),onOpenMenu:e.getTagValues,onFocus:()=>e.openSelect(!0),menuShouldPortal:!0,allowCustomValue:!0,onCreateOption:e.onCreateCustomOption,isOpen:n,isLoading:t,isClearable:!0,blurInputOnSelect:!1,closeMenuOnSelect:!1,openMenuOnFocus:!0,showAllSelectedWhenOpen:!0,hideSelectedOptions:!1,value:null==r?void 0:r.filter(e=>e.selected),options:null==r?void 0:r.map(e=>({label:e.text,value:e.value}))})):null});const y=()=>({control:(0,s.css)({flex:"1"}),wrapper:(0,s.css)({flex:"0 0 auto",whiteSpace:"nowrap"})})},81459:(e,t,n)=>{n.d(t,{Y:()=>w,F:()=>O});var r=n(85959),a=n.n(r),s=n(46089),i=n(93241),o=n(76644),l=n(82007),c=n(34509),u=n(66854),d=n(67478),p=n(45553),g=n(90072);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function v({onClick:e,props:t}){const[n,s]=(0,r.useState)(!1),i=(0,l.useStyles2)(m);return a().createElement(a().Fragment,null,a().createElement("span",null,a().createElement("div",{className:i.titleWrap},a().createElement("span",null,"Line filter"),a().createElement(l.IconButton,{onClick:e,name:"times",size:"xs","aria-label":"Remove line filter"})),a().createElement("span",{className:i.collapseWrap},a().createElement(g._,f(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){h(e,t,n[t])})}return e}({},t),{focus:n,setFocus:s,type:"variable"})),n&&a().createElement(l.IconButton,{className:i.collapseBtn,tooltip:"Collapse",size:"lg","aria-label":"Collapse filter",onClick:()=>s(!1),name:"table-collapse-all"}))))}const m=e=>({collapseBtn:(0,s.css)({marginLeft:e.spacing(1)}),collapseWrap:(0,s.css)({display:"flex"}),titleWrap:(0,s.css)({display:"flex",fontSize:e.typography.bodySmall.fontSize,gap:e.spacing(1),marginBottom:e.spacing(.5)})});function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){b(e,t,n[t])})}return e}function S(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}class w extends o.Bs{isFilterExclusive({operator:e}){return e===u.cK.negativeMatch||e===u.cK.negativeRegex}updateFilter(e,t,n=!0){n?(this.updateVariableLineFilter(e,t,!0),this.updateVariableDebounced(e,t,!1,!0)):this.updateVariableLineFilter(e,t)}constructor(...e){super(...e),b(this,"handleEnter",(e,t,n)=>{"Enter"===e.key&&((0,d.bN)(),this.updateVariableLineFilter(n,S(y({},n),{value:t})))}),b(this,"onRegexToggle",e=>{let t;switch(e.operator){case u.cK.match:t=u.cK.regex;break;case u.cK.negativeMatch:t=u.cK.negativeRegex;break;case u.cK.regex:t=u.cK.match;break;case u.cK.negativeRegex:t=u.cK.negativeMatch;break;default:throw new Error("Invalid operator!")}this.updateFilter(e,S(y({},e),{operator:t}),!1)}),b(this,"onToggleExclusive",e=>{let t;switch(e.operator){case u.cK.match:t=u.cK.negativeMatch;break;case u.cK.negativeMatch:t=u.cK.match;break;case u.cK.regex:t=u.cK.negativeRegex;break;case u.cK.negativeRegex:t=u.cK.regex;break;default:throw new Error("Invalid operator!")}this.updateFilter(e,S(y({},e),{operator:t}),!1)}),b(this,"onCaseSensitiveToggle",e=>{const t=e.key===u.ld.caseSensitive?u.ld.caseInsensitive:u.ld.caseSensitive;this.updateFilter(e,S(y({},e),{key:t}),!1)}),b(this,"onInputChange",(e,t)=>{this.updateFilter(t,S(y({},t),{value:e.target.value}),!0)}),b(this,"removeFilter",e=>{(0,d.bN)();const t=(0,p.Gk)(this),n=t.state.filters.filter(t=>void 0!==t.keyLabel&&t.keyLabel!==e.keyLabel);t.setState({filters:n})}),b(this,"updateVariableLineFilter",(e,t,n=!1,r=!1)=>{const a=(0,p.Gk)(this),s=a.state.filters.filter(t=>void 0!==t.keyLabel&&t.keyLabel!==e.keyLabel);a.updateFilters([{key:t.key,keyLabel:e.keyLabel,operator:t.operator,value:t.value},...s],{forcePublish:r,skipPublish:n}),(0,c.EE)(c.NO.service_details,c.ir.service_details.search_string_in_variables_changed,{caseSensitive:t.key,containsLevel:e.value.toLowerCase().includes("level"),operator:t.operator,searchQueryLength:e.value.length})}),b(this,"updateVariableDebounced",(0,i.debounce)((e,t,n=!1,r=!1)=>{this.updateVariableLineFilter(e,t,n,r)},1e3))}}function O(e){e.sort((e,t)=>{var n,r;return parseInt(null!==(n=e.keyLabel)&&void 0!==n?n:"0",10)-parseInt(null!==(r=t.keyLabel)&&void 0!==r?r:"0",10)})}function E(e){return{lineFiltersWrap:(0,s.css)({display:"flex",flexWrap:"wrap",gap:`${e.spacing(.25)} ${e.spacing(2)}`,label:"lineFiltersWrap"})}}b(w,"Component",({model:e})=>{const t=(0,p.Gk)(e),{filters:n}=t.useState(),r=(0,l.useStyles2)(E);return O(n),n.length?a().createElement("div",{className:r.lineFiltersWrap},n.map(t=>{const n={caseSensitive:t.key===u.ld.caseSensitive,exclusive:e.isFilterExclusive(t),handleEnter:(n,r)=>e.handleEnter(n,t.value,t),lineFilter:t.value,onCaseSensitiveToggle:()=>e.onCaseSensitiveToggle(t),onInputChange:n=>e.onInputChange(n,t),onRegexToggle:()=>e.onRegexToggle(t),regex:t.operator===u.cK.regex||t.operator===u.cK.negativeRegex,setExclusive:()=>e.onToggleExclusive(t),updateFilter:(n,r)=>e.updateFilter(t,S(y({},t),{value:n}),r)};return a().createElement(v,{key:t.keyLabel,onClick:()=>e.removeFilter(t),props:n})})):null})},13574:(e,t,n)=>{n.d(t,{$:()=>i});var r=n(85959),a=n.n(r),s=n(82007);function i({indexScene:e}){const{currentFiltersMatchReference:t}=e.useState();return!t&&a().createElement(s.Button,{icon:"repeat",variant:"secondary",onClick:()=>e.resetToReferenceQuery(),tooltip:"Reset label filters to initial values."},"Reset")}},17796:(e,t,n)=>{n.d(t,{H:()=>g});var r=n(85959),a=n.n(r),s=n(46089),i=n(76644),o=n(82007),l=n(67478),c=n(90708),u=n(53571),d=n(45553);function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g extends i.Bs{onActivate(){const e=(0,d.cR)(this),t=e.state.filters.some(e=>(0,c.BG)(e.operator));this.setState({disabled:!t}),e.subscribeToState(e=>{const t=e.filters.some(e=>(0,c.BG)(e.operator));this.setState({disabled:!t})})}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){p(e,t,n[t])})}return e}({},e)),p(this,"getLink",()=>{const e=(0,d.cR)(this).state.filters.find(e=>(0,c.BG)(e.operator));return e?(0,l.k9)(e.key,e.value):""}),this.addActivationHandler(this.onActivate.bind(this))}}function h(e){return{button:(0,s.css)({[e.breakpoints.down("lg")]:{alignSelf:"flex-end"},[e.breakpoints.down("md")]:{alignSelf:"flex-start",marginTop:e.spacing(1)},alignSelf:"flex-start",marginTop:"22px"})}}p(g,"Component",({model:e})=>{const{disabled:t,hidden:n}=e.useState(),r=(0,o.useStyles2)(h);if(!0===n)return null;const s=e.getLink();return a().createElement(o.LinkButton,{"data-testid":u.b.index.header.showLogsButton,disabled:t||!s,fill:"outline",className:r.button,href:s},"Show logs")})},39731:(e,t,n)=>{n.d(t,{s:()=>f});var r=n(85959),a=n.n(r),s=n(46089),i=n(18531),o=n(76644),l=n(82007),c=n(62533),u=n(34509),d=n(53571),p=n(173);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const h=`${c.id}.serviceSelection.aggregatedMetrics`;class f extends o.Bs{constructor(e){const t=localStorage.getItem(h),n=i.config.featureToggles.exploreLogsAggregatedMetrics&&"false"!==t;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){g(e,t,n[t])})}return e}({isOpen:!1,options:{aggregatedMetrics:{active:null!=n&&n,disabled:!1,userOverride:"true"===t}}},e)),g(this,"toggleAggregatedMetricsOverride",()=>{const e=!this.state.options.aggregatedMetrics.active;(0,u.EE)(u.NO.service_selection,u.ir.service_selection.aggregated_metrics_toggled,{enabled:e}),localStorage.setItem(h,e.toString()),this.setState({options:{aggregatedMetrics:{active:e,disabled:this.state.options.aggregatedMetrics.disabled,userOverride:e}}})}),g(this,"onToggleOpen",e=>{this.setState({isOpen:e})})}}function v(e){return{heading:(0,s.css)({fontWeight:e.typography.fontWeightMedium,paddingBottom:e.spacing(2)}),options:(0,s.css)({alignItems:"center",columnGap:e.spacing(2),display:"grid",gridTemplateColumns:"1fr 50px",rowGap:e.spacing(1)}),popover:(0,s.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`,borderRadius:e.shape.radius.default,boxShadow:e.shadows.z3,display:"flex",flexDirection:"column",marginRight:e.spacing(2),padding:e.spacing(2)})}}g(f,"Component",({model:e})=>{const{isOpen:t,options:n}=e.useState(),r=(0,l.useStyles2)(v),s=()=>a().createElement("div",{className:r.popover,role:"dialog","aria-modal":"true","aria-label":"Query options",onClick:e=>e.stopPropagation()},a().createElement("div",{className:r.heading},"Query options"),a().createElement("div",{className:r.options},a().createElement("div",{title:"Aggregated metrics will return service queries results much more quickly, but with lower resolution"},"Aggregated metrics"),a().createElement("span",{title:n.aggregatedMetrics.disabled?`Aggregated metrics can only be enabled for queries starting after ${p.X.toLocaleString()}`:""},a().createElement(l.Switch,{label:"Toggle aggregated metrics","data-testid":d.b.index.aggregatedMetricsToggle,value:n.aggregatedMetrics.active,disabled:n.aggregatedMetrics.disabled,onChange:e.toggleAggregatedMetricsOverride}))));return n.aggregatedMetrics?a().createElement(l.Dropdown,{overlay:s,placement:"bottom",onVisibleChange:e.onToggleOpen},a().createElement(l.ToolbarButton,{icon:"cog",variant:"canvas",isOpen:t,"data-testid":d.b.index.aggregatedMetricsMenu})):a().createElement(a().Fragment,null)})},96056:(e,t,n)=>{n.d(t,{Q:()=>c});var r=n(85959),a=n.n(r),s=n(46089),i=n(71792),o=n(87781),l=n(82007);const c=()=>{const e=(0,l.useStyles2)(u),t=(0,l.useTheme2)();return a().createElement("div",{className:e.wrap},a().createElement("div",{className:e.graphicContainer},a().createElement(i.A,{src:(t.isDark,"/public/plugins/grafana-lokiexplore-app/img/grot_loki.svg")})),a().createElement("div",{className:e.text},a().createElement("h3",{className:e.title},"Welcome to Grafana Logs Drilldown"),a().createElement("p",null,"We noticed there is no Loki datasource configured.",a().createElement("br",null),"Add a"," ",a().createElement("a",{className:"external-link",href:o.locationUtil.assureBaseUrl("/connections/datasources/new")},"Loki datasource")," ","to view logs."),a().createElement("br",null),a().createElement("p",null,"Click"," ",a().createElement("a",{href:"https://grafana.com/docs/grafana/latest/explore/simplified-exploration/logs/",target:"_blank",className:"external-link",rel:"noreferrer"},"here")," ","to learn more...")))},u=e=>({graphicContainer:(0,s.css)({[e.breakpoints.up("md")]:{alignSelf:"flex-end",height:"auto",padding:e.spacing(1),width:"300px"},[e.breakpoints.up("lg")]:{alignSelf:"flex-end",height:"auto",padding:e.spacing(1),width:"400px"},display:"flex",height:"250px",justifyContent:"center",margin:"0 auto",padding:e.spacing(1),width:"200px"}),text:(0,s.css)({alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center"}),title:(0,s.css)({marginBottom:"1.5rem"}),wrap:(0,s.css)({[e.breakpoints.up("md")]:{flexDirection:"row",margin:"4rem auto auto auto"},alignItems:"center",display:"flex",flexDirection:"column",margin:"0 auto auto auto",padding:"2rem",textAlign:"center"})})},96991:(e,t,n)=>{n.d(t,{Oo:()=>w,c:()=>S,sp:()=>v,uL:()=>y});var r=n(85959),a=n.n(r),s=n(87781),i=n(18531),o=n(76644),l=n(82007),c=n(77839),u=n(25953),d=n(67478),p=n(9598),g=n(69683),h=n(95002),f=n(41745);const v={from:"now-15m",to:"now"};function m(e){return new o.P1({body:new f.P({$timeRange:new o.JZ(v),routeMatch:e})})}function b(e){const{component:t,isLoading:n}=(0,i.usePluginComponent)("grafana-lokiexplore-app/embedded-logs-exploration/v1"),s=(0,r.useMemo)(()=>t,[n]);return n?a().createElement(l.LoadingPlaceholder,{text:"Loading..."}):s?a().createElement(s,e):(console.error("No grafana-lokiexplore-app/embedded-logs-exploration/v1 component found in the Grafana registry! You might need to restart your Grafana instance?"),null)}function y(){return new o.jD({drilldowns:[{getPage:(e,t)=>O(e,t,c.G3.embed),routePath:g.HU.embed}],getScene:e=>function(){const e="now-15m",t="now",n='{service_name=~"tempo-distributor|tempo-ingester"} | user!="03428" |~ "(?i)Error" | json | logfmt | drop __error__, __error_details__ |  msg!="Failed to get keys from redis"',r={from:(0,s.dateTimeParse)(e),raw:{from:e,to:t},to:(0,s.dateTimeParse)(t)},a={embedded:!0,embedderName:"EmbeddedLogs",options:{emptyStates:{logs:{customPrompt:"Write a haiku about Loki Logs",promptCTA:"Where are my logs?"}}},query:n,timeRangeState:new o.JZ({from:e,to:t,value:r}).state,referenceQuery:n};return new o.P1({body:new o.dM({component:b,props:a})})}(),layout:s.PageLayoutType.Custom,routePath:`${c.G3.embed}`,title:"Grafana Logs Drilldown â€” Embedded",url:(0,p._F)(c.G3.embed)})}function S(){return new o.jD({drilldowns:[{defaultRoute:!0,getPage:(e,t)=>O(e,t,c.G3.logs),routePath:g.HU.logs},{getPage:(e,t)=>O(e,t,c.G3.labels),routePath:g.HU.labels},{getPage:(e,t)=>O(e,t,c.G3.patterns),routePath:g.HU.patterns},{getPage:(e,t)=>O(e,t,c.G3.fields),routePath:g.HU.fields},{getPage:(e,t)=>E(e,t,c._J.label),routePath:g.KL.label},{getPage:(e,t)=>E(e,t,c._J.field),routePath:g.KL.field}],getScene:e=>m(e),layout:s.PageLayoutType.Custom,preserveUrlKeys:g.Zt,routePath:`${c.G3.explore}/*`,title:"Grafana Logs Drilldown",url:(0,p._F)(c.G3.explore)})}function w(){return new o.jD({$behaviors:[()=>{(0,d.Ns)()}],getScene:()=>new o.P1({body:new o.G1({children:[],direction:"column"})}),hideFromBreadcrumbs:!0,routePath:"*",title:"",url:s.urlUtil.renderUrl(p.Gy,void 0)})}function O(e,t,n){const{labelName:r,labelValue:a}=(0,g.XJ)(e);return new o.jD({getParentPage:()=>t,getScene:e=>m(e),layout:s.PageLayoutType.Custom,preserveUrlKeys:g.tm,routePath:g.HU[n],title:(0,h.Zr)(n),url:g.bw[n](a,r)})}function E(e,t,n){const{breakdownLabel:r,labelName:a,labelValue:i}=(0,g.XJ)(e);if(!r){const e=new Error("Breakdown value missing!");throw u.v.error(e,{breakdownLabel:null!=r?r:"",labelName:a,labelValue:i,msg:"makeBreakdownValuePage: Breakdown value missing!"}),e}return new o.jD({getParentPage:()=>t,getScene:e=>m(e),layout:s.PageLayoutType.Custom,preserveUrlKeys:g.tm,routePath:g.KL[n],title:(0,h.Zr)(r),url:g.mC[n](i,a,r)})}},89924:(e,t,n)=>{n.d(t,{jF:()=>N,Ci:()=>k,GD:()=>L,Ze:()=>C,BR:()=>P,iD:()=>j,K_:()=>A});var r=n(85959),a=n.n(r),s=n(46089),i=n(90219),o=n(87781),l=n(18531),c=n(76644),u=n(34509),d=n(25953),p=n(16979),g=n(88100),h=n(66732),f=n(41745),v=n(88351),m=n(59857),b=n(45865),y=n(52165),S=n(88428);const w=(e,t,n=!1)=>{t||(t=(0,g.u9)(e)),t=t.replace(/\s+/g," ").trimEnd();const r=(0,g.U4)(e),a=c.jh.getTimeRange(e).state.value,s=(0,h.B)(e),i=(0,h.k5)(),u=function(){const e=new URLSearchParams(window.location.search).get("urlColumns");if(e)try{const t=(0,S.aJ)(JSON.parse(e));let n={};for(const e in t)n[e]=t[e];return n}catch(e){console.error(e)}return}(),d=JSON.stringify({"loki-explore":{range:(0,o.toURLRange)(a.raw),queries:[{refId:"logs",expr:t,datasource:r}],panelsState:{logs:{displayedFields:s,visualisationType:"json"===i?"logs":i,columns:u,labelFieldName:"table"===i?y.bz:void 0,sortOrder:(0,h.YM)("sortOrder",o.LogsSortOrder.Descending)}},datasource:r}});var p;const f=null!==(p=l.config.appSubUrl)&&void 0!==p?p:"",v=o.urlUtil.renderUrl(`${f}/explore`,{panes:d,schemaVersion:1});return n&&window.open(v,"_blank"),v};var O=n(99330);function E(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}var C=function(e){return e.timeseries="timeseries",e.histogram="histogram",e}({}),P=function(e){return e.avg="avg",e.count="count",e}({}),k=function(e){return e.collapsed="Collapse",e.expanded="Expand",e}({});class L extends c.Bs{addItem(e){this.state.body&&this.state.body.addItem(e)}setItems(e){this.state.body&&this.state.body.setItems(e)}constructor(e){var t;super(e),(t=this).addActivationHandler(()=>{const e=[{text:"Navigation",type:"group"},{href:j(t),iconClassName:"compass",onClick:()=>T(),shortcut:"p x",text:"Explore"}];let n;try{n=c.jh.getAncestor(t,c.Eb)}catch(n){return void t.setState({body:new c.Lw({items:e})})}const r=(0,g.UX)(t,e=>e instanceof m.O,m.O),a=t.state.panelType&&"avg"===(null==r?void 0:r.state.queryType),s=(null==r?void 0:r.state.supportsHistogram)&&"int"===t.state.fieldType;(a||s||(null==n?void 0:n.state.collapsible))&&function(e){e.push({text:"visualization_divider",type:"divider"}),e.push({text:"Visualization",type:"group"})}(e),(null==n?void 0:n.state.collapsible)&&function(e,t){const n=c.jh.getAncestor(t,c.Eb);e.push({iconClassName:n.state.collapsed?"table-collapse-all":"table-expand-all",onClick:()=>{const e=n.state.collapsed?"Expand":"Collapse",r=c.jh.getAncestor(t,c.G1);(0,b.Zb)(r,e),n.setState({collapsed:!n.state.collapsed}),(0,h.IW)("collapsed",e)},text:n.state.collapsed?"Expand":"Collapse"})}(e,t),a&&function(e,t){e.push({iconClassName:"histogram"!==t.state.panelType?"graph-bar":"chart-line",onClick:()=>{const e=c.jh.getAncestor(t,c.xK),n=c.jh.getAncestor(t,m.O),r=n.state.viz.clone(),a="timeseries"!==t.state.panelType?"timeseries":"histogram";(0,h.IW)("panelType",a),e.setState({body:new m.O({viz:r,queryType:n.state.queryType,supportsHistogram:!0})});const s=(0,g.UX)(e,e=>e instanceof v.E,v.E);s&&s.rebuildChangedPanels("panelType"),D(a)},text:"histogram"!==t.state.panelType?"Histogram":"Time series"})}(e,t),s&&function(e,t){const n=c.jh.getAncestor(t,m.O),r="avg"===n.state.queryType;e.push({iconClassName:"heart-rate",onClick:()=>{const e="avg"===n.state.queryType?"count":"avg";n.setState({queryType:e});const r=(0,g.UX)(t,e=>e instanceof v.E,v.E);r&&r.rebuildChangedPanels("queryType"),$(e)},text:r?"Plot series":"Plot average"})}(e,t),t.setState({body:new c.Lw({items:e})}),t._subs.add((0,i.isAssistantAvailable)().subscribe(e=>{return(n=function*(){if(e){const e=yield(0,l.getDataSourceSrv)().get((0,g.U4)(t));t.addItem({text:"ai_divider",type:"divider"}),t.addItem({text:"AI",type:"group"}),t.addItem({iconClassName:"ai-sparkle",text:"Explain in Assistant",onClick:()=>{(0,i.openAssistant)({origin:"logs-drilldown-panel",prompt:"Help me understand this query and provide a summary of the data. Be concise and to the point.",context:[(0,i.createAssistantContextItem)("datasource",{datasourceUid:e.uid}),(0,i.createAssistantContextItem)("structured",{title:"Logs Drilldown Query",data:{query:(0,p.B)(t)}})]})}})}},function(){var e=this,t=arguments;return new Promise(function(r,a){var s=n.apply(e,t);function i(e){E(s,r,a,i,o,"next",e)}function o(e){E(s,r,a,i,o,"throw",e)}i(void 0)})})();var n}))})}}x(L,"Component",({model:e})=>{const{body:t}=e.useState(),{component:n,isLoading:s}=(0,l.usePluginComponent)("grafana/add-to-dashboard-form/v1");return(0,r.useEffect)(()=>{const t=!s&&Boolean(n);s||n||d.v.warn("Failed to load add to dashboard component: grafana/add-to-dashboard-form/v1"),t&&function(e,t,n){if(!e.state.body||!e.state.body.state.items)return;let r;const a=e.state.body.state.items.findIndex((e,t)=>"group"===e.type&&e.text===n?(r=t,!1):void 0!==r&&"group"===e.type||"divider"===e.type);if(a<0)return void e.addItem(t);const s=e.state.body.state.items.slice();s.splice(a,0,t),e.setItems(s)}(e,{text:"Add to Dashboard",onClick:()=>{e.publishEvent(new N(F(e)),!0)},iconClassName:"apps"},"Navigation")},[s,n,e]),t?a().createElement(t.Component,{model:t}):a().createElement(a().Fragment,null)});const j=e=>{const t=c.jh.getAncestor(e,f.P),n=(0,p.B)(e);return w(t,n)},F=e=>{var t,n,r;const a=c.jh.getAncestor(e,f.P);let s;try{s=c.jh.getAncestor(e,c.Eb)}catch(e){}const i=(0,p.B)(e),o=(0,g.U4)(a),l=c.jh.getTimeRange(a).state.value,u=(0,O.sI)(i)?"logs":"timeseries",d=(0,O.sI)(i)?"Logs":"Metric query",h=null==s||null===(n=s.state.$data)||void 0===n||null===(t=n.state.data)||void 0===t?void 0:t.request,v=null==h||null===(r=h.targets)||void 0===r?void 0:r[0],m=v&&"legendFormat"in v&&"string"==typeof v.legendFormat?v.legendFormat:"",b=_(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){x(e,t,n[t])})}return e}({},h),{type:u,title:d,targets:[{refId:"A",expr:i,legendFormat:m}],datasource:{type:"loki",uid:o},fieldConfig:null==s?void 0:s.state.fieldConfig,options:null==s?void 0:s.state.options});return{panel:b,timeRange:l}},T=()=>{(0,u.EE)(u.NO.all,u.ir.all.open_in_explore_menu_clicked)},D=e=>{(0,u.EE)(u.NO.service_details,u.ir.service_details.change_viz_type,{newVizType:e})},$=e=>{(0,u.EE)(u.NO.service_details,u.ir.service_details.change_query_type,{newQueryType:e})};class N extends o.BusEventBase{constructor(e){super(),x(this,"payload",void 0),this.payload=e}}x(N,"type","add-to-dashboard");const A=e=>({panelWrapper:(0,s.css)({display:"flex",flexDirection:"column",height:"100%",label:"panel-wrapper",position:"absolute",width:"100%",'button[aria-label="Panel status"]':{background:"transparent",color:e.colors.error.text}})})},5378:(e,t,n)=>{n.d(t,{g:()=>N});var r=n(85959),a=n.n(r),s=n(46089),i=n(87781),o=n(76644),l=n(82007),c=n(34509),u=n(77839),d=n(88428),p=n(67478),g=n(57985),h=n(69683),f=n(18531),v=n(93241),m=n(25953),b=n(95002);function y(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function S(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var s=e.apply(t,n);function i(e){y(s,r,a,i,o,"next",e)}function o(e){y(s,r,a,i,o,"throw",e)}i(void 0)})}}function w(e){let t=e.replace(`${window.location.protocol}//${window.location.host}${f.config.appSubUrl}`,"");return t.startsWith("/")?t.substring(1,t.length):t}const O=(0,v.memoize)(function(e){return S(function*(){const t=(0,f.getAppEvents)();try{return(yield(0,f.getBackendSrv)().post("/api/short-urls",{path:w(e)})).url}catch(e){m.v.error(e,{msg:"Error when creating shortened link"}),t.publish({payload:["Error generating shortened link"],type:i.AppEvents.alertError.name})}})()}),E=e=>new ClipboardItem({"text/plain":O(e)}),x=e=>{const t=(0,i.toUtc)(e.state.value.from),n=(0,i.toUtc)(e.state.value.to),r=f.locationService.getLocation(),a=i.urlUtil.getUrlSearchParams();return a.from=t.toISOString(),a.to=n.toISOString(),i.urlUtil.renderUrl(r.pathname,a)};function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class C extends o.Bs{setIsOpen(e){this.setState({isOpen:e})}onCopyLink(e,t,r){var a;e?(a=r||n.g.location.href,S(function*(){const e=(0,f.getAppEvents)();try{if("undefined"!=typeof ClipboardItem&&navigator.clipboard.write)yield navigator.clipboard.write([E(a)]);else{const e=yield O(a);(0,b.Dk)(e)}e.publish({payload:["Shortened link copied to clipboard"],type:i.AppEvents.alertSuccess.name})}catch(t){m.v.error(t,{msg:"Error in createAndCopyShortLink:"}),e.publish({payload:["Error generating shortened link"],type:i.AppEvents.alertError.name})}})(),(0,f.reportInteraction)("grafana_explore_shortened_link_clicked",{isAbsoluteTime:t})):((0,b.Dk)(void 0!==r?`${window.location.protocol}//${window.location.host}${f.config.appSubUrl}${r}`:n.g.location.href),this.state.onCopyLink&&this.state.onCopyLink(e,t,r))}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){_(e,t,n[t])})}return e}({isOpen:!1,lastSelected:P},e))}}_(C,"MenuActions",({model:e})=>{const t=[{items:[{absTime:!1,getUrl:()=>{},icon:"link",key:"copy-shortened-link",label:"Copy shortened URL",shorten:!0},{absTime:!1,getUrl:()=>{},icon:"link",key:"copy-link",label:"Copy URL",shorten:!1}],key:"normal",label:"Normal URL links"},{items:[{absTime:!0,getUrl:()=>x(void 0!==e.state.getSceneTimeRange?e.state.getSceneTimeRange():o.jh.getTimeRange(e)),icon:"clock-nine",key:"copy-short-link-abs-time",label:"Copy absolute shortened URL",shorten:!0},{absTime:!0,getUrl:()=>x(void 0!==e.state.getSceneTimeRange?e.state.getSceneTimeRange():o.jh.getTimeRange(e)),icon:"clock-nine",key:"copy-link-abs-time",label:"Copy absolute URL",shorten:!1}],key:"timesync",label:"Time-sync URL links (share with time range intact)"}];return a().createElement(l.Menu,null,t.map(t=>a().createElement(l.MenuGroup,{key:t.key,label:t.label},t.items.map(t=>a().createElement(l.Menu.Item,{key:t.key,label:t.label,icon:t.icon,onClick:()=>{const n=t.getUrl();e.onCopyLink(t.shorten,t.absTime,n),e.setState({lastSelected:t})}})))))}),_(C,"Component",({model:e})=>{const{isOpen:t,lastSelected:n}=e.useState();return a().createElement(l.ButtonGroup,null,a().createElement(l.ToolbarButton,{tooltip:n.label,icon:n.icon,variant:"canvas",narrow:!0,onClick:()=>{const t=n.getUrl();e.onCopyLink(n.shorten,n.absTime,t)},"aria-label":"Copy shortened URL"},a().createElement("span",null,"Share")),a().createElement(l.Dropdown,{overlay:a().createElement(C.MenuActions,{model:e}),placement:"bottom-end",onVisibleChange:e.setIsOpen.bind(e)},a().createElement(l.ToolbarButton,{narrow:!0,variant:"canvas",isOpen:t,"aria-label":"Open copy link options"})))});const P={absTime:!1,getUrl:()=>{},icon:"share-alt",key:"copy-link",label:"Copy shortened URL",shorten:!0};var k,L,j,F=n(45395),T=n(61402),D=n(66732);function $(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}class N extends o.Bs{onActivate(){this.setState({maxLines:(0,D.w0)(this)}),this.state.shareButtonScene||this.setState({shareButtonScene:new C({})})}getPageSlug(){const e=(0,h.FT)();if(e!==u.G3.embed)return e;const t=o.jh.getAncestor(this,T.Mn),n=(0,d.mx)(t.state.pageSlug);return n||void 0}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}function A(e){return e===u._J.field?u.G3.fields:e===u._J.label?u.G3.labels:e}j=({model:e})=>{const t=(0,l.useStyles2)(M);let n,r=!1;const d=o.jh.getAncestor(e,T.Mn);if(d.state.embedded&&d.state.pageSlug)n=A(d.state.pageSlug);else if(n=e.getPageSlug(),!n||!Object.values(u.G3).includes(n)){const e=(0,h.er)();r=!0,e&&(n=A(e))}const f=d.useState(),{$data:v,loading:m,logsCount:b,totalLogsCount:y}=f,S=$(f,["$data","loading","logsCount","totalLogsCount"]),{maxLines:w}=e.useState(),O=S.loadingStates;return a().createElement(l.Box,{paddingY:0},a().createElement("div",{className:t.actions},a().createElement(l.Stack,{gap:1},e.state.shareButtonScene&&a().createElement(e.state.shareButtonScene.Component,{model:e.state.shareButtonScene}))),a().createElement(l.TabsBar,null,F._.filter(e=>!(e.value===u.G3.patterns&&!d.state.$patternsData)).map((e,t)=>a().createElement(l.Tab,{"data-testid":e.testId,key:t,label:e.displayName,active:n===e.value,counter:O[e.displayName]?void 0:B(e,S),suffix:e.displayName===u.ob.logs?({className:e})=>function(e,t,n,r){const o=(0,l.useStyles2)(I),c=(0,i.getValueFormat)("short");if(void 0===t&&void 0!==n&&n<r){var u;const t=c(n,0);return a().createElement("span",{className:(0,s.cx)(e,o.logsCountStyles)},t.text,null===(u=t.suffix)||void 0===u?void 0:u.trim())}if(void 0!==t){var d;const n=c(t,0);return a().createElement("span",{className:(0,s.cx)(e,o.logsCountStyles)},n.text,null===(d=n.suffix)||void 0===d?void 0:d.trim())}return a().createElement("span",{className:(0,s.cx)(e,o.emptyCountStyles)})}(e,y,b,null!=w?w:g.by):void 0,icon:O[e.displayName]?"spinner":void 0,href:(0,p.rs)(e.value,d),onChangeTab:()=>{(e.value&&e.value!==n||r)&&(0,c.EE)(c.NO.service_details,c.ir.service_details.action_view_changed,{newActionView:e.value,previousActionView:n})}}))))},(L="Component")in(k=N)?Object.defineProperty(k,L,{value:j,enumerable:!0,configurable:!0,writable:!0}):k[L]=j;const B=(e,t)=>{switch(e.value){case"fields":return t.fieldsCount;case"patterns":return t.patternsCount;case"labels":return t.labelsCount;default:return}};function M(e){return{actions:(0,s.css)({[e.breakpoints.up(e.breakpoints.values.md)]:{position:"absolute",right:0,zIndex:2},display:"flex",justifyContent:"flex-end"})}}function I(e){return{emptyCountStyles:(0,s.css)({display:"inline-block",fontSize:e.typography.bodySmall.fontSize,marginLeft:e.spacing(1),minWidth:"1em",padding:e.spacing(.25,1)}),logsCountStyles:(0,s.css)({backgroundColor:e.colors.action.hover,borderRadius:e.spacing(3),color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,label:"counter",marginLeft:e.spacing(1),padding:e.spacing(.25,1)})}}},45395:(e,t,n)=>{n.d(t,{_:()=>Le,n:()=>je});var r=n(76644),a=n(96145),s=n(77839),i=n(53571),o=n(76830),l=n(58072),c=n(85959),u=n.n(c),d=n(46089),p=n(87781),g=n(82007),h=n(21532),f=n(41745),v=n(61402),m=n(18531),b=n(25953),y=n(90708),S=n(45553),w=n(67478),O=n(34509);function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e){var t,n;const{indexScene:a,pattern:s,type:i}=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){E(e,t,n[t])})}return e}({},e),o=r.jh.getAncestor(a,f.P);if(!o)return void b.v.warn("logs exploration scene not found");(0,w.bN)();const{patterns:l=[]}=o.state,c=l.filter(e=>e.pattern!==s);var u;const d=null!==(u=null===(t=c.filter(e=>"include"===e.type))||void 0===t?void 0:t.length)&&void 0!==u?u:0;var p;const g=null!==(p=null===(n=c.filter(e=>"exclude"===e.type))||void 0===n?void 0:n.length)&&void 0!==p?p:0;(0,O.EE)(O.NO.service_details,O.ir.service_details.pattern_selected,{excludePatternsLength:g+("exclude"===i?1:0),includePatternsLength:d+("include"===i?1:0),type:i}),"undo"===i?o.setState({patterns:c}):o.setState({patterns:[...c,{pattern:s,type:i}]})}var _=n(57985),C=n(90020),P=n(47709),k=n(79405);const L=e=>({logsStatsRow:(0,d.css)({margin:`${e.spacing(1.15)}px 0`}),logsStatsRowActive:(0,d.css)({color:e.colors.primary.text,position:"relative"}),logsStatsRowBar:(0,d.css)({background:e.colors.text.disabled,height:e.spacing(.5),overflow:"hidden"}),logsStatsRowCount:(0,d.css)({marginLeft:e.spacing(.75),textAlign:"right"}),logsStatsRowInnerBar:(0,d.css)({background:e.colors.primary.main,height:e.spacing(.5),overflow:"hidden"}),logsStatsRowLabel:(0,d.css)({display:"flex",marginBottom:"1px"}),logsStatsRowPercent:(0,d.css)({marginLeft:e.spacing(.75),textAlign:"right",width:e.spacing(4.5)}),logsStatsRowValue:(0,d.css)({flex:1,overflow:"hidden",textOverflow:"ellipsis"})}),j=({active:e,count:t,proportion:n,value:r})=>{const a=(0,g.useStyles2)(L),s=`${Math.round(100*n)}%`,i={width:s};return u().createElement("div",{className:e?`${a.logsStatsRow} ${a.logsStatsRowActive}`:a.logsStatsRow},u().createElement("div",{className:a.logsStatsRowLabel},u().createElement("div",{className:a.logsStatsRowValue,title:r},r),u().createElement("div",{className:a.logsStatsRowCount},t),u().createElement("div",{className:a.logsStatsRowPercent},s)),u().createElement("div",{className:a.logsStatsRowBar},u().createElement("div",{className:a.logsStatsRowInnerBar,style:i})))};function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const D=e=>({logsStats:(0,d.css)({background:"inherit",color:e.colors.text.primary,marginTop:e.spacing(1),maxHeight:"40vh",overflowY:"auto",width:"fit-content",wordBreak:"break-all"}),logsStatsBody:(0,d.css)({padding:"5px 0px"}),logsStatsClose:(0,d.css)({cursor:"pointer"}),logsStatsHeader:(0,d.css)({borderBottom:`1px solid ${e.colors.border.medium}`,display:"flex"}),logsStatsTitle:(0,d.css)({display:"inline-block",flexGrow:1,fontWeight:e.typography.fontWeightMedium,paddingRight:e.spacing(2),textOverflow:"ellipsis",whiteSpace:"nowrap"})}),$=e=>{const t=(0,g.useStyles2)(D),{stats:n,value:r}=e,a=n.slice(0,10);let s=a.find(e=>e.value===r),i=n.slice(10);!s&&(s=i.find(e=>e.value===r),i=i.filter(e=>e.value!==r));const o=i.reduce((e,t)=>e+t.count,0),l=a.reduce((e,t)=>e+t.count,0)+o;let c=[...a];return o>0&&c.push({count:o,proportion:o/l,value:"Other"}),c.sort((e,t)=>t.count-e.count),u().createElement("div",{className:t.logsStats},u().createElement("div",{className:t.logsStatsHeader},u().createElement("div",{className:t.logsStatsTitle},"From a sample of ",l," rows found")),u().createElement("div",{className:t.logsStatsBody},c.map(e=>u().createElement(j,T(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){F(e,t,n[t])})}return e}({key:e.value},e),{active:e.value===r})))))};var N=n(88100);function A(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}const B=({exploration:e,maxLines:t,pattern:n})=>{const a=function(e){const t=[];let n=e.indexOf("<_>");for(;-1!==n;)t.push(n),n=e.indexOf("<_>",n+1);return t}(n),[s,i]=(0,c.useState)(void 0),[o,l]=(0,c.useState)(!1),d=(0,g.useStyles2)(M),h=(0,c.useRef)(null),f=(0,c.useRef)(null),v=()=>{return(o=function*(){(0,O.EE)(O.NO.service_details,O.ir.service_details.pattern_field_clicked);const o=function(e,t,n){let r=1;const a=e.replace(/<_>/g,()=>`<field_${r++}>`),s=n.state.filterExpression,i=t.map((e,t)=>`field_${t+1}`).join(" ,");return`{${s}} |> \`${e}\` | pattern \`${a}\` | keep ${i} | line_format ""`}(n,a,(0,S.cR)(e)),c=yield(0,N.hJ)(e),u=r.jh.getTimeRange(e).state.value;s&&o===h.current&&u===f.current||(h.current=o,f.current=u,null==c||c.query({app:"",interval:"",intervalMs:0,range:u,requestId:"1",scopedVars:{},startTime:0,targets:[(0,_.l)(o,{maxLines:t})],timezone:""}).forEach(e=>{var n,r;e.state!==p.LoadingState.Done||(null===(n=e.errors)||void 0===n?void 0:n.length)?(e.state===p.LoadingState.Error||(null===(r=e.errors)||void 0===r?void 0:r.length))&&(i(void 0),l(!0)):(i(function(e,t,n){const r=new Map;e.data[0].fields[0].values.toArray().forEach(e=>{Object.keys(e).forEach(t=>{var n,a;r.has(t)||r.set(t,new Map),null===(a=r.get(t))||void 0===a||a.set(e[t],((null===(n=r.get(t))||void 0===n?void 0:n.get(e[t]))||0)+1)})});const a=[];for(let e=0;e<=t;e++){var s;const t=[];null===(s=r.get(`field_${e+1}`))||void 0===s||s.forEach((e,r)=>{t.push({count:e,proportion:e/n,value:r})}),t.sort((e,t)=>t.count-e.count),a.push(t)}return a}(e,a.length,t)),l(!1))}))},function(){var e=this,t=arguments;return new Promise(function(n,r){var a=o.apply(e,t);function s(e){A(a,n,r,s,i,"next",e)}function i(e){A(a,n,r,s,i,"throw",e)}s(void 0)})})();var o},m=(0,c.useMemo)(()=>n.split("<_>"),[n]);return u().createElement("div",null,m.map((e,t)=>u().createElement("span",{key:t},e,t!==a.length&&u().createElement(g.Toggletip,{onOpen:v,content:u().createElement(u().Fragment,null,s&&s[t].length>0&&u().createElement($,{stats:s[t],value:""}),s&&0===s[t].length&&u().createElement("div",null,"No available stats for this field in the current timestamp."),!s&&o&&u().createElement("div",null,"Could not load stats for this pattern."),!s&&!o&&u().createElement("div",{style:{padding:"10px"}},u().createElement(g.Spinner,{size:"xl"})))},u().createElement("span",{className:d.pattern},"<_>")))))};function M(e){return{pattern:(0,d.css)({"&:hover":{backgroundColor:e.colors.emphasize(e.colors.background.primary,.2)},backgroundColor:e.colors.emphasize(e.colors.background.primary,.1),cursor:"pointer",margin:"0 2px"})}}var I=n(34907),R=n(48848),V=n(66732);function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class q extends r.Bs{onActivate(){if(this.state.body)return;const e=(0,_.l)(C.SA);this.replacePatternsInQuery(e);const t=(0,I.rS)([e]);t.getResultsStream().subscribe(e=>{this.onQueryWithFiltersResult(e)}),this.setState({body:new r.G1({children:[new r.vA({body:void 0,height:0,width:"100%"}),new r.vA({body:r.d0.logs().setHoverHeader(!0).setOption("showLogContextToggle",!0).setOption("showTime",!0).setOption("noInteractions",!0).setOption("controlsStorageKey",V.Bz).setData(t).build(),height:300,width:"100%"})],direction:"column"})})}replacePatternsInQuery(e){const t={pattern:this.state.pattern,type:"include"},n=(0,R.M)([t]);e.expr=e.expr.replace(C.sC,n)}removePatternFromFilterExclusion(){const e=r.jh.getAncestor(this,W);var t;const n=null!==(t=e.state.patternsNotMatchingFilters)&&void 0!==t?t:[],a=n.findIndex(e=>e===this.state.pattern);-1!==a&&(n.splice(a,1),e.setState({patternsNotMatchingFilters:n}))}setWarningMessage(e){const t=this.getNoticeFlexItem(),n=this.getVizFlexItem();return t instanceof r.vA&&t.setState({body:new r.dM({reactNode:e}),height:"auto",isHidden:!1}),n}getNoticeFlexItem(){const e=this.getFlexItemChildren();return null==e?void 0:e[0]}getVizFlexItem(){const e=this.getFlexItemChildren();return null==e?void 0:e[1]}getFlexItemChildren(){var e;return null===(e=this.state.body)||void 0===e?void 0:e.state.children}excludeThisPatternFromFiltering(){const e=r.jh.getAncestor(this,W);var t;const n=null!==(t=e.state.patternsNotMatchingFilters)&&void 0!==t?t:[];e.setState({patternsNotMatchingFilters:[...n,this.state.pattern]})}static Component({model:e}){const{body:t}=e.useState();return t?u().createElement(t.Component,{model:t}):null}constructor(e){super(e),z(this,"clearFilters",()=>{const e=(0,S.ir)(this),t=(0,S.Gk)(this),n=(0,S.iw)(this);if(e.setState({filters:[]}),n.setState({filters:[]}),t.state.filters.length){t.setState({filters:[]});const e=this.getNoticeFlexItem();null==e||e.setState({isHidden:!0}),this.removePatternFromFilterExclusion()}}),z(this,"onQueryError",e=>{if(e.data.state===p.LoadingState.Done&&(0===e.data.series.length||e.data.series.every(e=>0===e.length))||e.data.state===p.LoadingState.Error){let t;try{t={msg:"onQueryError",pattern:this.state.pattern,request:JSON.stringify(e.data.request),traceIds:JSON.stringify(e.data.traceIds)}}catch(e){t={msg:"Failed to encode context",pattern:this.state.pattern}}b.v.error(new Error("Pattern sample query returns no results"),t),this.setWarningMessage(u().createElement(g.Alert,{severity:"error",title:""},"This pattern returns no logs."));const n=this.getVizFlexItem();n instanceof r.vA&&n.setState({isHidden:!0})}}),z(this,"onQueryWithFiltersResult",e=>{const t=(0,_.l)(C.pT);this.replacePatternsInQuery(t);const n=(0,I.rS)([t]);if(n.getResultsStream().subscribe(this.onQueryError),e.data.state===p.LoadingState.Done&&(0===e.data.series.length||e.data.series.every(e=>0===e.length))){const e=this.getNoticeFlexItem(),t=this.getVizFlexItem();if(e instanceof r.vA&&e.setState({body:new r.dM({reactNode:u().createElement(g.Alert,{severity:"warning",title:""},"The logs returned by this pattern do not match the current query filters.",u().createElement(g.Button,{className:o.ZI.button,onClick:()=>this.clearFilters()},"Clear filters"))}),height:"auto",isHidden:!1}),t instanceof r.vA){const e=t.state.body;e instanceof r.Eb&&(null==e||e.setState({$data:n}))}this.excludeThisPatternFromFiltering()}e.data.state===p.LoadingState.Error&&this.onQueryError(e)}),this.addActivationHandler(this.onActivate.bind(this))}}function G({row:e,tableViz:t}){const{expandedRows:n}=t.useState(),r=null==n?void 0:n.find(t=>t.state.key===e.pattern);return(0,c.useEffect)(()=>{if(!r){const r=(a=e.pattern,new q({key:a,pattern:a}));var n;t.setState({expandedRows:[...null!==(n=t.state.expandedRows)&&void 0!==n?n:[],r]})}var a},[e,t,r]),r?u().createElement(r.Component,{model:r}):null}const U=[""," K"," Mil"," Bil"," Tri"," Quadr"," Quint"," Sext"," Sept"];class W extends r.Bs{onActivate(){var e;const t=null===(e=r.jh.getAncestor(this,f.P).state.ds)||void 0===e?void 0:e.maxLines;this.setState({maxLines:t})}buildColumns(e,t,n,a,s,i,o){const l=Z(n),c=r.jh.getTimeRange(this).state.value,h=[{cell:e=>{const t={series:[e.cell.row.original.dataFrame],state:p.LoadingState.Done,timeRange:c},n=new r.Zv({data:t}),a=r.d0.timeseries().setData(n).setHoverHeader(!0).setOption("tooltip",{mode:g.TooltipDisplayMode.None}).setCustomFieldConfig("hideFrom",{legend:!0,tooltip:!0}).setCustomFieldConfig("axisPlacement",g.AxisPlacement.Hidden).setDisplayMode("transparent").build();return u().createElement("div",{className:l.tableTimeSeriesWrap},u().createElement("div",{className:l.tableTimeSeries},u().createElement(a.Component,{model:a})))},header:"",id:"volume-samples"},{cell:e=>{const t=(0,p.scaledUnits)(1e3,U)(e.cell.row.original.sum);var n,r;return u().createElement("div",{className:l.countTextWrap},u().createElement("div",null,null!==(n=t.prefix)&&void 0!==n?n:"",t.text,null!==(r=t.suffix)&&void 0!==r?r:""))},header:"Count",id:"count",sortType:"number"},{cell:t=>u().createElement("div",{className:l.countTextWrap},u().createElement("div",null,(100*t.cell.row.original.sum/e).toFixed(0),"%")),header:"%",id:"percent",sortType:"number"},{cell:e=>u().createElement("div",{className:(0,d.cx)(Y(),l.tablePatternTextDefault)},u().createElement(B,{exploration:(0,N.Ti)(this),pattern:e.cell.row.original.pattern,maxLines:a})),header:"Pattern",id:"pattern"},{cell:e=>{if(null==i?void 0:i.includes(e.cell.row.original.pattern))return;const n=null==t?void 0:t.find(t=>t.pattern===e.cell.row.original.pattern),r="include"===(null==n?void 0:n.type),a="exclude"===(null==n?void 0:n.type);return u().createElement(P.F,{isExcluded:a,isIncluded:r,onInclude:()=>e.cell.row.original.includeLink(),onExclude:()=>e.cell.row.original.excludeLink(),onClear:()=>e.cell.row.original.undoLink(),buttonFill:"outline"})},disableGrow:!0,header:void 0,id:"include"}];return s.some(e=>e.levels.length>0)&&h.splice(1,0,{header:"Levels",id:"levels",cell:e=>(e.cell.row.original.levels.sort(),e.cell.row.original.levels.map(t=>u().createElement(g.Button,{key:t,size:"sm",variant:o.some(e=>(0,y.BG)(e.operator)&&e.value===t)?"primary":"secondary",fill:"outline",className:l.levelWrap,onClick:()=>{e.cell.row.original.togglePatternLevel(t)}},t)))}),h}buildTableData(e,t){const n=r.jh.getAncestor(this,f.P);return e.filter(e=>!t.size||t.has(e.pattern)).map(e=>({dataFrame:e.dataFrame,excludeLink:()=>x({indexScene:n,pattern:e.pattern,type:"exclude"}),includeLink:()=>x({indexScene:n,pattern:e.pattern,type:"include"}),togglePatternLevel:e=>{(0,k.Qt)(C.e4,e,"toggle",n,C._Y)},pattern:e.pattern,sum:e.sum,levels:e.levels,undoLink:()=>x({indexScene:n,pattern:e.pattern,type:"undo"})}))}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}var Q,K,H;H=function({model:e}){const t=r.jh.getAncestor(e,f.P),{patterns:n}=t.useState(),a=(0,g.useTheme2)(),s=X(a),o=r.jh.getAncestor(e,se),{legendSyncPatterns:l}=o.useState(),{patternFrames:c,patternsNotMatchingFilters:d}=e.useState();let p=null!=c?c:[];const h=(0,S.iw)(e),{filters:v}=h.useState(),m=r.jh.getAncestor(e,be);var b;const y=(null!==(b=m.state.patternFrames)&&void 0!==b?b:[]).reduce((e,t)=>e+t.sum,0),w=e.buildTableData(p,l);var O;const E=e.buildColumns(y,n,a,null!==(O=e.state.maxLines)&&void 0!==O?O:_.by,p,d,v);return u().createElement("div",{"data-testid":i.b.patterns.tableWrapper,className:s.tableWrap},u().createElement(g.InteractiveTable,{columns:E,data:w,getRowId:e=>e.pattern,renderExpandedRow:t=>u().createElement(G,{tableViz:e,row:t})}))},(K="Component")in(Q=W)?Object.defineProperty(Q,K,{value:H,enumerable:!0,configurable:!0,writable:!0}):Q[K]=H;const J=m.config.theme2,Y=()=>(0,d.css)({fontFamily:J.typography.fontFamilyMonospace,minWidth:"200px",overflow:"hidden",overflowWrap:"break-word"}),X=e=>({link:(0,d.css)({textDecoration:"underline"}),tableWrap:(0,d.css)({"> div":{height:"calc(100vh - 450px)",minHeight:"470px"},th:{backgroundColor:e.colors.background.canvas,position:"sticky",top:0,zIndex:e.zIndex.navbarFixed}})}),Z=e=>({levelWrap:(0,d.css)({fontSize:e.typography.bodySmall.fontSize,fontFamily:e.typography.fontFamilyMonospace,"&:not(:last-child)":{marginRight:e.spacing(.5)}}),countTextWrap:(0,d.css)({fontSize:e.typography.bodySmall.fontSize}),tablePatternTextDefault:(0,d.css)({fontFamily:e.typography.fontFamilyMonospace,fontSize:e.typography.bodySmall.fontSize,maxWidth:"100%",minWidth:"200px",overflow:"hidden",overflowWrap:"break-word",wordBreak:"break-word"}),tableTimeSeries:(0,d.css)({height:"30px",overflow:"hidden"}),tableTimeSeriesWrap:(0,d.css)({pointerEvents:"none",width:"230px"})});function ee(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function te(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var s=e.apply(t,n);function i(e){ee(s,r,a,i,o,"next",e)}function o(e){ee(s,r,a,i,o,"throw",e)}i(void 0)})}}function ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function re(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const ae=m.config.theme2.visualization.palette;class se extends r.Bs{onActivate(){this.updateBody();const e=r.jh.getAncestor(this,be);this.updatePatterns(e.state.patternFrames),this._subs.add(r.jh.getAncestor(this,v.Mn).subscribeToState((e,t)=>{var n,a,s,i,o,l;const c=null==e||null===(s=e.$patternsData)||void 0===s||null===(a=s.state)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.series,u=null==t||null===(l=t.$patternsData)||void 0===l||null===(o=l.state)||void 0===o||null===(i=o.data)||void 0===i?void 0:i.series;if(!(0,h.B)(c,u)){const e=r.jh.getAncestor(this,be);this.updatePatterns(e.state.patternFrames),e.setState({filteredPatterns:void 0})}})),this._subs.add(r.jh.getAncestor(this,be).subscribeToState((e,t)=>{const n=r.jh.getAncestor(this,be);e.filteredPatterns&&!(0,h.B)(e.filteredPatterns,t.filteredPatterns)?this.updatePatterns(n.state.filteredPatterns):n.state.patternFilter||this.updatePatterns(n.state.patternFrames)})),this._subs.add((0,S.iw)(this).subscribeToState((e,t)=>{if(!(0,h.B)(e.filters,t.filters)){const e=r.jh.getAncestor(this,be);this.updatePatterns(e.state.patternFrames)}}))}updatePatterns(){return te(function*(e=[]){var t;e=this.filterPatternFramesByLevel(e),null===(t=this.state.body)||void 0===t||t.forEachChild(t=>{t instanceof r.Eb&&t.setState({$data:this.getTimeseriesDataNode(e)}),t instanceof W&&t.setState({patternFrames:e})})}).apply(this,arguments)}updateBody(){return te(function*(){var e,t;const n=r.jh.getAncestor(this,be).state.patternFrames;(null===(t=r.jh.getAncestor(this,v.Mn).state.$patternsData)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.series)&&n?this.setState({body:this.getSingleViewLayout(),legendSyncPatterns:new Set,loading:!1}):b.v.warn("Failed to update PatternsFrameScene body")}).call(this)}extendTimeSeriesLegendBus(e,t){const n=t.onToggleSeriesVisibility;t.onToggleSeriesVisibility=(t,r)=>{var a;null==n||n(t,r);const s=null===(a=e.state.fieldConfig.overrides)||void 0===a?void 0:a[0],i=null==s?void 0:s.matcher.options.names,o=new Set;i&&i.forEach(o.add,o),this.setState({legendSyncPatterns:o})}}getSingleViewLayout(){const e=r.jh.getAncestor(this,be).state.patternFrames;if(!e)return void b.v.warn("Failed to set getSingleViewLayout");const t=this.getTimeSeries(e);return new r.gF({autoRows:"200px",children:[t,new W({patternFrames:e})],isLazy:!0,templateColumns:"100%"})}getTimeSeries(e){const t=r.jh.getAncestor(this,f.P),n=r.d0.timeseries().setData(this.getTimeseriesDataNode(e)).setOption("legend",{asTable:!0,displayMode:g.LegendDisplayMode.Table,placement:"right",showLegend:!0,width:200}).setHoverHeader(!0).setUnit("short").setLinks([{onClick:e=>{x({indexScene:t,pattern:e.origin.labels.name,type:"include"})},targetBlank:!1,title:"Include",url:"#"},{onClick:e=>{x({indexScene:t,pattern:e.origin.labels.name,type:"exclude"})},targetBlank:!1,title:"Exclude",url:"#"}]).build();return n.setState({extendPanelContext:(e,t)=>this.extendTimeSeriesLegendBus(e,t)}),n}getTimeseriesDataNode(e){const t=r.jh.getTimeRange(this).state.value;return new r.Zv({data:{series:e.map((e,t)=>{const n=e.dataFrame;return n.fields[1].config.color=function(e){return{fixedColor:ae[e],mode:"fixed"}}(t),n.fields[1].name="",n}),state:p.LoadingState.Done,timeRange:t}})}constructor(e){super(re(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ne(e,t,n[t])})}return e}({loading:!0},e),{legendSyncPatterns:new Set})),ne(this,"filterPatternFramesByLevel",e=>{const t=(0,S.iw)(this).state.filters;if(t.length&&e.some(e=>e.levels.length>0)){const n=new Set;t.forEach(e=>{(0,y.BG)(e.operator)&&n.add(e.value)}),e=e.filter(e=>e.levels.some(e=>n.has(e)))}return e}),this.addActivationHandler(this.onActivate.bind(this))}}ne(se,"Component",({model:e})=>{var t;const{body:n,loading:a}=e.useState(),s=r.jh.getAncestor(e,v.Mn),{$patternsData:i}=s.useState(),o=null==i||null===(t=i.state.data)||void 0===t?void 0:t.series;return u().createElement("div",{className:ie.container},!a&&o&&o.length>0&&u().createElement(u().Fragment,null,n&&u().createElement(n.Component,{model:n})))});const ie={container:(0,d.css)({".show-on-hover":{display:"none"},width:"100%"})};var oe=n(47191);function le(){return u().createElement(oe.R,null,u().createElement("div",null,u().createElement("p",null,u().createElement("strong",null,"Sorry, we could not detect any patterns.")),u().createElement("p",null,"Check back later or reach out to the team in the"," ",u().createElement(g.TextLink,{href:"https://slack.grafana.com/",external:!0},"Grafana Labs community Slack channel")),u().createElement("p",null,"Patterns let you detect similar log lines to include or exclude from your search.")))}function ce(){return u().createElement(oe.R,null,u().createElement("div",null,u().createElement("p",null,u().createElement("strong",null,"Patterns are only available for the most recent ",me," hours of data.")),u().createElement("p",null,"See the"," ",u().createElement(g.TextLink,{href:"https://grafana.com/docs/grafana/latest/explore/simplified-exploration/logs/patterns/",external:!0},"patterns docs")," ","for more info.")))}var ue=n(49193),de=n(79284);function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ge extends r.Bs{onActivate(){const e=r.jh.getAncestor(this,be);this._subs.add(e.subscribeToState((e,t)=>{if(e.patternFilter!==t.patternFilter){const e=r.jh.getAncestor(this,be);e.state.patternFrames&&(0,ue.E)(e.state.patternFrames.map(e=>e.pattern),e.state.patternFilter,this.onSearchResult)}})),this._subs.add(e.subscribeToState((e,t)=>{e.patternFilter&&!e.filteredPatterns&&e.patternFrames&&!(0,h.B)(e.filteredPatterns,t.filteredPatterns)&&(0,ue.X)(e.patternFrames.map(e=>e.pattern),e.patternFilter,this.onSearchResult)}))}setFilteredPatterns(e,t){const n=r.jh.getAncestor(this,be),a=null!=t?t:n.state.patternFrames;if(a){const t=a.filter(t=>!(!n.state.patternFilter||!(null==a?void 0:a.length))&&e.find(e=>e===t.pattern));n.setState({filteredPatterns:t})}}setEmptySearch(){r.jh.getAncestor(this,be).setState({filteredPatterns:void 0})}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){pe(e,t,n[t])})}return e}({},e)),pe(this,"clearSearch",()=>{r.jh.getAncestor(this,be).setState({patternFilter:""})}),pe(this,"handleSearchChange",e=>{r.jh.getAncestor(this,be).setState({patternFilter:e.target.value})}),pe(this,"onSearchResult",e=>{const t=r.jh.getAncestor(this,be);t.state.patternFilter?this.setFilteredPatterns(e[0]):t.state.filteredPatterns&&!t.state.patternFilter&&this.setEmptySearch()}),this.addActivationHandler(this.onActivate.bind(this))}}pe(ge,"Component",function({model:e}){const t=r.jh.getAncestor(e,be),{patternFilter:n}=t.useState();return u().createElement(g.Field,{className:he.field},u().createElement(de.D,{onChange:e.handleSearchChange,onClear:e.clearSearch,value:n,placeholder:"Search patterns"}))});const he={field:(0,d.css)({label:"field",marginBottom:0}),icon:(0,d.css)({cursor:"pointer"})};var fe=n(95659);function ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const me=3;class be extends r.Bs{onActivate(){var e,t;const n=r.jh.getAncestor(this,v.Mn);var a;(this.setBody(),null===(e=n.state.$patternsData)||void 0===e?void 0:e.state)&&this.onDataChange(null===(a=n.state.$patternsData)||void 0===a?void 0:a.state);this._subs.add(null===(t=n.state.$patternsData)||void 0===t?void 0:t.subscribeToState(this.onDataChange))}setBody(){this.setState({body:new r.G1({children:[new r.vA({body:new ge,ySizing:"content"}),new r.vA({body:new se})],direction:"column"})})}updatePatternFrames(e){if(!e)return;const t=this.dataFrameToPatternFrame(e);this.setState({patternFrames:t})}dataFrameToPatternFrame(e){const t=r.jh.getAncestor(this,v.Mn),n=r.jh.getAncestor(t,f.P).state.patterns;return e.map(e=>{var t,r,a,s;const i=null==n?void 0:n.find(t=>t.pattern===e.name),o=null===(r=e.meta)||void 0===r||null===(t=r.custom)||void 0===t?void 0:t.sum,l=null===(s=e.meta)||void 0===s||null===(a=s.custom)||void 0===a?void 0:a.level;var c;return{dataFrame:e,pattern:null!==(c=e.name)&&void 0!==c?c:"",status:null==i?void 0:i.type,sum:o,levels:l}})}constructor(e){var t;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ve(e,t,n[t])})}return e}({$variables:null!==(t=e.$variables)&&void 0!==t?t:new r.Pj({variables:[new r.yP({defaultToAll:!0,includeAll:!0,name:C.Jg})]}),loading:!0,patternFilter:""},e)),ve(this,"onDataChange",(e,t)=>{var n,r,a,s,i;const o=null===(n=e.data)||void 0===n?void 0:n.series,l=null==t||null===(r=t.data)||void 0===r?void 0:r.series;(null===(a=e.data)||void 0===a?void 0:a.state)===p.LoadingState.Done?(this.setState({error:!1,loading:!1}),(0,h.B)(o,l)||this.updatePatternFrames(o)):(null===(s=e.data)||void 0===s?void 0:s.state)===p.LoadingState.Loading?this.setState({error:!1,loading:!0}):(null===(i=e.data)||void 0===i?void 0:i.state)===p.LoadingState.Error&&this.setState({error:!0,loading:!1})}),this.addActivationHandler(this.onActivate.bind(this))}}function ye(e){return{container:(0,d.css)({display:"flex",flexDirection:"column",flexGrow:1,minHeight:"100%"}),content:(0,d.css)({display:"flex",flexGrow:1,paddingTop:e.spacing(0)}),controls:(0,d.css)({alignItems:"top",display:"flex",flexGrow:0,gap:e.spacing(2)}),controlsLeft:(0,d.css)({display:"flex",flexDirection:"column",justifyContent:"flex-left",justifyItems:"left",width:"100%"}),controlsRight:(0,d.css)({display:"flex",flexGrow:0,justifyContent:"flex-end"}),patternMissingText:(0,d.css)({padding:e.spacing(2)})}}ve(be,"Component",({model:e})=>{const{blockingMessage:t,body:n,error:a,loading:s,patternFrames:i}=e.useState(),{value:o}=r.jh.getTimeRange(e).useState(),l=(0,g.useStyles2)(ye),c=(0,p.dateTime)().diff(o.to,"hours")>=me;return u().createElement("div",{className:l.container},u().createElement(fe.O,{blockingMessage:t,isLoading:s},!s&&a&&u().createElement("div",{className:l.patternMissingText},u().createElement(g.Text,{textAlignment:"center",color:"primary"},u().createElement("p",null,"There are no pattern matches."),u().createElement("p",null,"Pattern matching has not been configured."),u().createElement("p",null,"Patterns let you detect similar log lines and add or exclude them from your search."),u().createElement("p",null,"To see them in action, add the following to your Loki configuration"),u().createElement("p",null,u().createElement("code",null,"--pattern-ingester.enabled=true")))),!a&&!s&&0===(null==i?void 0:i.length)&&c&&u().createElement(ce,null),!a&&!s&&!i&&!c&&u().createElement(le,null),!a&&!s&&i&&i.length>0&&u().createElement("div",{className:l.content},n&&u().createElement(n.Component,{model:n}))))});var Se=n(71014);function we({serviceName:e,model:t}){const{isLoading:n,component:a}=(0,m.usePluginComponent)("grafana-asserts-app/insights-timeline-widget/v1"),s=(0,g.useStyles2)(Oe),i=r.jh.getTimeRange(t).useState();return!n&&a&&i&&e?u().createElement("div",{className:s.container},u().createElement(a,{serviceName:e,start:i.from.valueOf(),end:i.to.valueOf()})):null}function Oe(){return{container:(0,d.css)({"&:not(:empty)":{marginTop:"10px"},label:"insights-timeline-widget",marginLeft:"40px"})}}var Ee=n(395);function xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _e(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}class Ce extends r.Bs{onActivate(){const e=r.jh.getAncestor(this,Pe),t=r.jh.findAllObjects(e,e=>e instanceof Ee._)[0];var n,a;t instanceof Ee._&&(this.setState({collapsed:null===(n=t.state.panel)||void 0===n?void 0:n.state.collapsed}),this._subs.add(null===(a=t.state.panel)||void 0===a?void 0:a.subscribeToState(e=>{e.collapsed!==this.state.collapsed&&this.setState({collapsed:e.collapsed})})))}constructor(e){super(_e(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){xe(e,t,n[t])})}return e}({},e),{collapsed:!1})),this.addActivationHandler(this.onActivate.bind(this))}}xe(Ce,"Component",({model:e})=>{const{collapsed:t}=e.useState(),n=(0,S.cR)(e),{filters:r}=n.useState(),a=r.find(e=>(0,y.BG)(e.operator)&&e.key===C.OX),s=null==a?void 0:a.value;return s&&!t?u().createElement(we,{serviceName:s,model:e}):null});class Pe extends r.Bs{onActivate(){this.setState({body:new r.G1({direction:"column",children:[new r.vA({body:new Ee._({})}),new r.vA({body:new Ce({}),height:"auto",minHeight:"auto"})]})})}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Pe,"Component",({model:e})=>{const{body:t}=e.useState(),n=(0,g.useStyles2)(ke);return t?u().createElement("div",{className:n.container},t&&u().createElement(t.Component,{model:t})):null});const ke=e=>({container:(0,d.css)({"> div":{gap:0},section:{borderColor:"transparent"},label:"logs-volume-container",background:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`,borderRadius:e.shape.radius.default})}),Le=[{displayName:s.ob.logs,getScene:()=>new r.G1({height:"auto",maxHeight:"auto",minHeight:"auto",children:[new r.vA({body:new Pe({})}),new r.vA({body:new Se.i({}),height:"calc(100vh - 500px)",minHeight:"470px"})],direction:"column"}),testId:i.b.exploreServiceDetails.tabLogs,value:s.G3.logs},{displayName:s.ob.labels,getScene:()=>new r.G1({$behaviors:[new r.Gg.K2({key:"sync",sync:a.yV.Crosshair})],children:[new r.vA({body:new l.O({})})]}),testId:i.b.exploreServiceDetails.tabLabels,value:s.G3.labels},{displayName:s.ob.fields,getScene:e=>{return t=e,new r.G1({$behaviors:[new r.Gg.K2({key:"sync",sync:a.yV.Crosshair})],children:[new r.vA({body:new o.J6({changeFieldCount:t})})]});var t},testId:i.b.exploreServiceDetails.tabFields,value:s.G3.fields},{displayName:s.ob.patterns,getScene:()=>new r.G1({children:[new r.vA({body:new be({})})]}),testId:i.b.exploreServiceDetails.tabPatterns,value:s.G3.patterns}],je=[{displayName:"Label",getScene:e=>function(e){return new r.G1({$behaviors:[new r.Gg.K2({key:"sync",sync:a.yV.Crosshair})],children:[new r.vA({body:new l.O({value:e})})]})}(e),testId:i.b.exploreServiceDetails.tabLabels,value:s._J.label},{displayName:"Field",getScene:e=>function(e){return new r.G1({$behaviors:[new r.Gg.K2({key:"sync",sync:a.yV.Crosshair})],children:[new r.vA({body:new o.J6({value:e})})]})}(e),testId:i.b.exploreServiceDetails.tabFields,value:s._J.field}]},79405:(e,t,n)=>{n.d(t,{Of:()=>w,Qt:()=>k,XI:()=>E,hi:()=>x,oR:()=>F,ts:()=>L,u7:()=>C,vn:()=>P});var r=n(85959),a=n.n(r),s=n(87781),i=n(76644),o=n(21532),l=n(40696),c=n(20376),u=n(48502),d=n(66854),p=n(5570),g=n(25953),h=n(67478),f=n(45553),v=n(61402),m=n(47709),b=n(34509),y=n(90020);function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class w extends s.BusEventBase{constructor(e,t,n,r){super(),S(this,"source",void 0),S(this,"operator",void 0),S(this,"key",void 0),S(this,"value",void 0),this.source=e,this.operator=t,this.key=n,this.value=r}}S(w,"type","add-filter");class O extends s.BusEventBase{constructor(e,t,n){super(),S(this,"key",void 0),S(this,"value",void 0),S(this,"operator",void 0),this.key=e,this.value=t,this.operator=n}}function E(e,t,n){const r="="===e.operator?"toggle":"exclude";k(e.key,e.value,r,t,n)}function x(e,t,n,r,a){const s=D(n,e,t);let i=s.state.filters.filter(t=>{const s=(0,f.z2)(n,t);return r&&a?!(t.key===e&&s.value===r&&t.operator===a):r?!(t.key===e&&s.value===r):a?!(t.key===e&&t.operator===a):!(t.key===e)});t.publishEvent(new O(e,r,a),!0),s.setState({filters:i})}S(O,"type","add-filter");const _=e=>e===d.w7.gt||e===d.w7.gte?"greater":e===d.w7.lt||e===d.w7.lte?"lesser":void 0;function C(e,t,n,r){r||(r=j(e,t));const a=D(r,e,t),s=n?_(n):void 0;let i=a.state.filters.filter(t=>!(t.key===e&&(_(t.operator)===s||t.operator===d.w7.NotEqual)));a.setState({filters:i})}function P(e,t,n,r,a){const s=_(n);a||(a=j(e,r));const i=D(a,e,r);let o;a===y.mB&&(o=JSON.stringify({parser:(0,c.Ri)(e,r),value:t}));let l=i.state.filters.filter(t=>!(t.key===e&&(_(t.operator)===s||t.operator===d.w7.NotEqual)));l=[...l,{key:e,operator:n,value:o||t,valueLabels:[t]}],i.setState({filters:l}),r.publishEvent(new w("filterButton",n,e,t),!0)}function k(e,t,n,r,a,s=!0,i=!1){s&&(0,h.bN)(),a===y.MB&&(0,l._J)(e,t,r);const o=D(a,e,r);let u,g=a===y._Y?(0,p.Bi)(t):t;a===y.mB?u=JSON.stringify({parser:i?"json":(0,c.Ri)(e,r),value:t}):a===y._Y&&"exclude"===n&&(g=`!${t}`);let v=o.state.filters.filter(r=>{const s=(0,f.z2)(a,r);return"include"===n?!(r.key===e&&r.operator===d.w7.NotEqual):"exclude"===n?!(r.key===e&&r.operator===d.w7.Equal):!(r.key===e&&s.value===t)});const m=v.length!==o.state.filters.length;("include"===n||"exclude"===n||!m&&"toggle"===n)&&(v=[...v,{key:e,operator:"exclude"===n?d.w7.NotEqual:d.w7.Equal,value:u||t,valueLabels:[g]}]),o.setState({filters:v}),r.publishEvent(new w("filterButton",n,e,t),!0)}function L(e,t){return e===y.e4?y._Y:t}function j(e,t){var n,r;return(null===(r=(0,v.TG)(t))||void 0===r||null===(n=r.fields)||void 0===n?void 0:n.find(t=>t.name===e))?y.MB:y.mB}class F extends i.Bs{onActivate(){const e=T(this.state.frame);if(e){const t=D(this.state.variableName,e.name,this);this.setFilterState(t),this._subs.add(t.subscribeToState((e,n)=>{(0,o.B)(e.filters,n.filters)||this.setFilterState(t)}))}}setFilterState(e){const t=T(this.state.frame);if(!t)return void this.setState({isExcluded:!1,isIncluded:!1});const n=e.state.filters.find(n=>{if(e.state.name===y.MB)return n.key===t.name&&n.value===t.value;const r=(0,u.OH)(t),a=(0,f.z2)(r?y._P:y.mB,n);return n.key===t.name&&a.value===t.value});n?this.setState({isExcluded:n.operator===d.w7.NotEqual,isIncluded:n.operator===d.w7.Equal}):this.setState({isExcluded:!1,isIncluded:!1})}constructor(e){super(e),S(this,"onClick",e=>{const t=T(this.state.frame);if(!t)return;k(t.name,t.value,e,this,this.state.variableName);const n=D(this.state.variableName,t.name,this);(0,b.EE)(b.NO.service_details,b.ir.service_details.add_to_filters_in_breakdown_clicked,{action:e,filtersLength:(null==n?void 0:n.state.filters.length)||0,filterType:this.state.variableName,key:t.name})}),this.addActivationHandler(this.onActivate.bind(this))}}S(F,"Component",({model:e})=>{const{hideExclude:t,isExcluded:n,isIncluded:r}=e.useState();return a().createElement(m.F,{buttonFill:"outline",isIncluded:null!=r&&r,isExcluded:null!=n&&n,onInclude:()=>e.onClick("include"),onClear:()=>e.onClick("clear"),onExclude:()=>e.onClick("exclude"),hideExclude:t})});const T=e=>{var t,n;const r=null!==(n=null===(t=e.fields[1])||void 0===t?void 0:t.labels)&&void 0!==n?n:{};if(1!==Object.keys(r).length)return void g.v.warn("getFilter: unexpected empty labels");const a=Object.keys(r)[0];return{name:a,value:r[a]}},D=(e,t,n)=>e===y.mB||e===y._P?(0,f.YS)(n):(0,f.bY)(L(t,e),n)},18313:(e,t,n)=>{n.d(t,{G:()=>f,x:()=>g});var r=n(85959),a=n.n(r),s=n(87781),i=n(76644),o=n(25953),l=n(158),c=n(76830),u=n(58072),d=n(79284);function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g extends s.BusEventBase{}p(g,"type","breakdown-search-reset");const h={};class f extends i.Bs{filterValues(e){const t=i.jh.findObject(this,e=>e instanceof u.O||e instanceof c.J6);if(t instanceof u.O||t instanceof c.J6){h[this.cacheKey]=e;const n=i.jh.findDescendents(t,l.h);null==n||n.forEach(t=>{t.state.body.isActive&&t.filterByString(e)})}else o.v.warn("unable to find Breakdown scene",{filter:e,typeofBody:typeof t})}constructor(e){var t;super({filter:null!==(t=h[e])&&void 0!==t?t:""}),p(this,"cacheKey",void 0),p(this,"onValueFilterChange",e=>{this.setState({filter:e.target.value}),this.filterValues(e.target.value)}),p(this,"clearValueFilter",()=>{this.setState({filter:""}),this.filterValues("")}),p(this,"reset",()=>{this.setState({filter:""}),h[this.cacheKey]=""}),this.cacheKey=e}}p(f,"Component",({model:e})=>{const{filter:t}=e.useState();return a().createElement(d.D,{value:t,onChange:e.onValueFilterChange,onClear:e.clearValueFilter,placeholder:"Search for value"})})},158:(e,t,n)=>{n.d(t,{h:()=>y});var r=n(85959),a=n.n(r),s=n(46089),i=n(31269),o=n(87781),l=n(76644),c=n(82007),u=n(25953),d=n(49193),p=n(18313),g=n(76081),h=n(45865),f=n(11049),v=n(52601);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}class y extends l.Bs{performRepeat(e){const t=[],n=(0,v.sortSeries)(e.series,this.sortBy,this.direction);for(let e=0;e<n.length;e++){const r=this.state.getLayoutChild(n[e],e);t.push(r)}this.sortedSeries=n,this.unfilteredChildren=t,this.getFilter()?(this.state.body.setState({children:[]}),this.filterByString(this.getFilter())):this.state.body.setState({children:t})}filterSummaryChart(e){const t=l.jh.getAncestor(this,g.U);if(t){const n=l.jh.findAllObjects(t,e=>e.isActive&&e.state.key===h.s$);if(n[0]instanceof l.G1){const t=l.jh.findDescendents(n[0],l.Eb)[0];t instanceof l.Eb?t.setState({$data:new l.Es({transformations:[()=>{return t=e[0],e=>e.pipe((0,i.map)(e=>{if(!t||!t.length)return e;let n=[];return e.forEach(e=>{const r=(0,f.ee)(e);t.includes(r)&&n.push(e)}),n}));var t}]})}):u.v.warn("filterSummaryChart: VizPanel not found",{typeofPanel:typeof t})}else u.v.warn("filterSummaryChart: SceneFlexItem not found",{typeofGraphParent:typeof n})}}constructor(e){var{direction:t,getFilter:n,sortBy:r}=e;super(b(e,["direction","getFilter","sortBy"])),m(this,"unfilteredChildren",[]),m(this,"sortBy",void 0),m(this,"direction",void 0),m(this,"sortedSeries",[]),m(this,"getFilter",void 0),m(this,"sort",(e,t)=>{const n=l.jh.getData(this);this.sortBy=e,this.direction=t,n.state.data&&this.performRepeat(n.state.data)}),m(this,"iterateFrames",e=>{if(l.jh.getData(this).state.data)for(let t=0;t<this.sortedSeries.length;t++)e(this.sortedSeries,t)}),m(this,"filterByString",e=>{let t=[];this.iterateFrames((e,n)=>{const r=(0,f.ee)(e[n]);t.push(r)}),(0,d.X)(t,e,e=>{e&&e[0]?this.filterFrames(t=>{const n=(0,f.ee)(t);return e[0].includes(n)}):this.filterFrames(()=>!0),this.filterSummaryChart(e)})}),m(this,"filterFrames",e=>{const t=[];if(this.iterateFrames((n,r)=>{e(n[r])&&t.push(this.unfilteredChildren[r])}),0===t.length){const e=this.getFilter();this.state.body.setState({children:[S(e,this.clearFilter)]})}else this.state.body.setState({children:t})}),m(this,"clearFilter",()=>{this.publishEvent(new p.x,!0)}),this.sortBy=r,this.direction=t,this.getFilter=n,this.addActivationHandler(()=>{const e=l.jh.getData(this);this._subs.add(e.subscribeToState((e,t)=>{var n,r,a,s;((null===(n=e.data)||void 0===n?void 0:n.state)===o.LoadingState.Done||(null===(r=e.data)||void 0===r?void 0:r.state)===o.LoadingState.Streaming&&e.data.series.length>(null!==(s=null===(a=t.data)||void 0===a?void 0:a.series.length)&&void 0!==s?s:0))&&this.performRepeat(e.data)})),e.state.data&&this.performRepeat(e.state.data)})}}function S(e,t){return new l.G1({children:[new l.vA({body:new l.dM({reactNode:a().createElement("div",{className:w.alertContainer},a().createElement(c.Alert,{title:"",severity:"info",className:w.noResultsAlert},"No values found matching â€œ",e,"â€",a().createElement(c.Button,{className:w.clearButton,onClick:t},"Clear filter")))})})],direction:"row"})}m(y,"Component",({model:e})=>{const{body:t}=e.useState();return a().createElement(t.Component,{model:t})});const w={alertContainer:(0,s.css)({alignItems:"center",display:"flex",flexGrow:1,justifyContent:"center"}),clearButton:(0,s.css)({marginLeft:"1.5rem"}),noResultsAlert:(0,s.css)({flexGrow:0,minWidth:"30vw"})}},50713:(e,t,n)=>{n.d(t,{a:()=>h});var r,a,s,i=n(85959),o=n.n(i),l=n(90219),c=n(76644),u=n(82007),d=n(47191),p=n(76830),g=n(3657);class h extends c.Bs{}s=function({model:e}){const[t,n]=(0,i.useState)(void 0),{type:r}=e.useState();(0,i.useEffect)(()=>{(0,l.isAssistantAvailable)().subscribe(e=>{n(e)})},[]);const a=(0,g.b)(r,e);var s;return o().createElement(d.R,null,o().createElement(u.Alert,{title:"",severity:"warning"},"We did not find any ",r," for the given timerange. Please"," ",o().createElement("a",{className:p.ZI.link,href:"https://forms.gle/1sYWCTPvD72T1dPH9",target:"_blank",rel:"noopener noreferrer"},"let us know")," ","if you think this is a mistake."),o().createElement(u.Box,{marginTop:1,justifyContent:"center"},t&&o().createElement(u.Button,{variant:"secondary",onClick:()=>function(e,t=`Investigate why there are no ${e} to display with the current filters and time range.`){(0,l.openAssistant)({origin:"logs-drilldown-empty-results",prompt:t})}(r,null==a?void 0:a.customPrompt),icon:"ai-sparkle"},null!==(s=null==a?void 0:a.promptCTA)&&void 0!==s?s:"Ask Grafana Assistant")))},(a="Component")in(r=h)?Object.defineProperty(r,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[a]=s},7243:(e,t,n)=>{n.d(t,{f:()=>p,u:()=>d});var r=n(85959),a=n.n(r),s=n(46089),i=n(82007),o=n(57985),l=n(53571);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function d({label:e,onChange:t,options:n,value:s}){const o=(0,i.useStyles2)(g),[l,c]=(0,r.useState)(!1),u=n.map(e=>({label:e.label,value:e.value}));return a().createElement(i.InlineField,{className:o.selectWrapper,label:e},a().createElement(i.Select,{options:u,value:s,onOpenMenu:()=>c(!0),onCloseMenu:()=>c(!1),onChange:e=>t(e.value),className:o.select,prefix:l?void 0:a().createElement(i.Icon,{name:"search"})}))}function p({initialFilter:e,isLoading:t,label:n,onChange:s,options:d,selectOption:p,value:h}){var f;const v=(0,i.useStyles2)(g),[m,b]=(0,r.useState)(!1),[y,S]=(0,r.useState)(e),w=d.map(e=>({label:e.label,value:e.value})),O=y&&h&&(null===(f=y.value)||void 0===f?void 0:f.includes(h))?[y,...w]:w,E=null==O?void 0:O.find(e=>e.value===h);return a().createElement(i.InlineField,{className:v.serviceSceneSelectWrapper,label:n},a().createElement(i.Select,{isLoading:t,"data-testid":l.b.exploreServiceSearch.search,placeholder:"Search values",options:O,isClearable:!0,value:h,onOpenMenu:()=>b(!0),onCloseMenu:()=>b(!1),allowCustomValue:!0,prefix:m||(null==E?void 0:E.__isNew__)?void 0:a().createElement(i.Icon,{name:"search"}),onChange:(e,t)=>(null==e?void 0:e.__isNew__)||(null==e?void 0:e.icon)?(S(u(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}({},e),{icon:"filter"})),s(e.value)):"clear"===t.action?s(""):void("select-option"===t.action&&e.value&&!e.__isNew__&&p(e.value)),onInputChange:(e,t)=>{const n=t;return"input-change"===n.action?s(e):"menu-close"===n.action&&n.prevInputValue?(S({__isNew__:!0,icon:"filter",label:n.prevInputValue,value:(0,o.vC)(n.prevInputValue)}),s(n.prevInputValue)):void 0}}))}function g(e){return{input:(0,s.css)({marginBottom:0}),select:(0,s.css)({maxWidth:e.spacing(64),minWidth:e.spacing(20)}),selectWrapper:(0,s.css)({label:"field-selector-select-wrapper",marginBottom:0,maxWidth:e.spacing(62.5),minWidth:e.spacing(20)}),serviceSceneSelectWrapper:(0,s.css)({label:"service-select-wrapper",marginBottom:0,marginRight:e.spacing.x1,maxWidth:e.spacing(62.5),minWidth:e.spacing(20)})}}},42969:(e,t,n)=>{n.d(t,{u:()=>j});var r,a,s,i=n(85959),o=n.n(i),l=n(87781),c=n(76644),u=n(82007),d=n(21532),p=n(20376),g=n(25953),h=n(34907),f=n(57985),v=n(52601),m=n(66732),b=n(45553),y=n(90020),S=n(89924),w=n(61402),O=n(158),E=n(76830),x=n(76081),_=n(45865),C=n(42524),P=n(11049);function k(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function L(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var s=e.apply(t,n);function i(e){k(s,r,a,i,o,"next",e)}function o(e){k(s,r,a,i,o,"throw",e)}i(void 0)})}}class j extends c.Bs{static Selector({model:e}){const{body:t}=e.useState();return t instanceof x.U?o().createElement(o().Fragment,null,t&&o().createElement(x.U.Selector,{model:t})):o().createElement(o().Fragment,null)}getTagKey(){const e=(0,b.Hj)(this);return String(e.state.value)}onActivate(){var e;const t=this.buildQuery();this.setState({$data:this.buildQueryRunner(),body:this.buildBody(t)}),this._subs.add(null===(e=this.state.$data)||void 0===e?void 0:e.subscribeToState(e=>{this.onValuesDataQueryChange(e,t)})),this.runQuery(),this.setSubscriptions()}buildQueryRunner(){const e=this.buildQuery();return(0,h.rS)([e],{runQueriesMode:"manual"})}buildQuery(){const e=this.getTagKey(),t=(0,b.ir)(this),n=(0,w.rD)(this),r=(0,b.Gc)(this),a=(0,p.Jl)(e,t,n,r),{filterExpression:s,variableName:i}=this.removeFieldLabelFromVariableInterpolation(),o=c.jh.interpolate(this,a.replace(`\${${i}}`,s));return(0,f.l)(o,{legendFormat:`{{${e}}}`,refId:e})}setSubscriptions(){this._subs.add(c.jh.getTimeRange(this).subscribeToState(()=>{this.runQuery()})),this._subs.add((0,b.Gk)(this).subscribeToState((e,t)=>{(0,d.B)(e.filters,t.filters)||this.runQuery()})),this._subs.add((0,b.Ku)(this).subscribeToState((e,t)=>{e.value!==t.value&&this.runQuery()})),this._subs.add((0,b.cR)(this).subscribeToState((e,t)=>{(0,d.B)(e.filters,t.filters)||this.runQuery()})),this._subs.add((0,b.iw)(this).subscribeToState((e,t)=>{(0,d.B)(e.filters,t.filters)||this.runQuery()}));const{parser:e}=this.getParserForThisField();"structuredMetadata"!==e?this.setFieldParserSubscriptions():this.setMetadataParserSubscriptions()}setMetadataParserSubscriptions(){const e=this.getTagKey();this._subs.add((0,b.ir)(this).subscribeToState((e,t)=>L(function*(){(0,d.B)(e.filters,t.filters)||this.runQuery()}).call(this))),this._subs.add((0,b.oY)(this).subscribeToState((t,n)=>L(function*(){(0,d.B)(t.filters.filter(t=>t.key!==e),n.filters.filter(t=>t.key!==e))||this.runQuery()}).call(this)))}setFieldParserSubscriptions(){const e=this.getTagKey();this._subs.add((0,b.oY)(this).subscribeToState((e,t)=>L(function*(){(0,d.B)(e.filters,t.filters)||this.runQuery()}).call(this))),this._subs.add((0,b.ir)(this).subscribeToState((t,n)=>L(function*(){(0,d.B)(t.filters.filter(t=>t.key!==e),n.filters.filter(t=>t.key!==e))||this.runQuery()}).call(this)))}rebuildQuery(){var e;const t=this.buildQuery();null===(e=this.getSceneQueryRunner())||void 0===e||e.setState({queries:[t]})}runQuery(){this.rebuildQuery();const e=this.getSceneQueryRunner();null==e||e.runQueries()}getSceneQueryRunner(){if(this.state.$data){const e=c.jh.findDescendents(this.state.$data,c.dt);if(1!==e.length){const e=new Error("Unable to find query runner in value breakdown!");throw g.v.error(e,{msg:"FieldValuesBreakdownScene: Unable to find query runner in value breakdown!"}),e}return e[0]}g.v.warn("FieldValuesBreakdownScene: Query is attempting to execute, but query runner is undefined!")}removeFieldLabelFromVariableInterpolation(){const e=this.getTagKey();let t,n;if("structuredMetadata"===this.getQueryParser()){const r=(0,b.oY)(this);n=y._P,t=(0,f.E3)(r.state.filters,[e])}else{n=y.mB;const r=(0,b.ir)(this);t=(0,f.ZX)(r.state.filters,[e])}return{filterExpression:t,variableName:n}}onValuesDataQueryChange(e,t){var n,r;(null===(n=e.data)||void 0===n?void 0:n.state)===l.LoadingState.Done&&this.state.body instanceof c.dM&&this.setState({body:this.buildBody(t)}),(null===(r=e.data)||void 0===r?void 0:r.state)===l.LoadingState.Error&&0===e.data.series.length&&this.setErrorState(e.data.errors,e.data.series.length>0)}buildErrorState(e,t){const n=c.jh.getAncestor(this,w.Mn);return new c.G1({children:[new c.vA({body:new c.dM({reactNode:o().createElement(C.xX,{errors:e,tagKey:this.getTagKey(),isPartial:t,serviceScene:n})})})],direction:"column"})}setErrorState(e,t){this.setState({errorBody:this.buildErrorState(e,t)})}buildBody(e){const{optionValue:t,parser:n}=this.getParserForThisField(),{direction:r,sortBy:a}=(0,m.vs)("fields",v.DEFAULT_SORT_BY,"desc"),s=c.jh.getAncestor(this,E.J6),i=()=>{var e;return null!==(e=s.state.search.state.filter)&&void 0!==e?e:""};return new x.U({active:"grid",layouts:[new c.G1({children:[new c.N0,new _.s7({tagKey:this.getTagKey(),title:t,type:"field"}),new c.dM({reactNode:o().createElement(E.J6.ValuesMenu,{model:s})}),new O.h({body:new c.gF({autoRows:"200px",children:[new c.vA({body:new c.dM({reactNode:null})})],isLazy:!0,templateColumns:E.OK}),direction:r,getFilter:i,getLayoutChild:(0,p.Zp)(P.ee,(null==e?void 0:e.expr.includes("count_over_time"))?u.DrawStyle.Bars:u.DrawStyle.Line,"structuredMetadata"===n?y._P:y.mB,c.jh.getAncestor(this,E.J6).state.sort,t),sortBy:a})],direction:"column"}),new c.G1({children:[new c.N0,new _.s7({tagKey:this.getTagKey(),title:t,type:"field"}),new c.dM({reactNode:o().createElement(E.J6.ValuesMenu,{model:s})}),new O.h({body:new c.gF({autoRows:"200px",children:[new c.vA({body:new c.dM({reactNode:null})})],isLazy:!0,templateColumns:"1fr"}),direction:r,getFilter:i,getLayoutChild:(0,p.Zp)(P.ee,(null==e?void 0:e.expr.includes("count_over_time"))?u.DrawStyle.Bars:u.DrawStyle.Line,"structuredMetadata"===n?y._P:y.mB,c.jh.getAncestor(this,E.J6).state.sort,t),sortBy:a})],direction:"column"})],options:[{label:"Grid",value:"grid"},{label:"Rows",value:"rows"}]})}getParserForThisField(){const e=(0,b.Hj)(this),t=String(e.state.value);return{optionValue:t,parser:(0,p.Ri)(t,this)}}getParserForFields(){return(0,p.k$)((0,b.ir)(this))}getQueryParser(){const{parser:e}=this.getParserForThisField(),t=this.getParserForFields();return e===t?t:void 0===e?"mixed":"structuredMetadata"===e?t:"structuredMetadata"===t?e:"mixed"}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}s=({model:e})=>{var t;const{body:n,errorBody:r}=e.useState(),a=(0,u.useStyles2)(S.K_),s=c.jh.getAncestor(e,E.J6),i=c.jh.getData(e),{data:l}=i.useState();var d;const p=(null!==(d=null==l?void 0:l.series.length)&&void 0!==d?d:0)>0;var g;const h=(null!==(g=null==l||null===(t=l.errors)||void 0===t?void 0:t.length)&&void 0!==g?g:0)>0;return n?o().createElement("span",{className:a.panelWrapper},o().createElement(E.J6.LabelsMenu,{model:s}),h&&r&&o().createElement("div",null,o().createElement(r.Component,{model:r})),(p||!r)&&o().createElement("div",null,n instanceof x.U&&o().createElement(n.Component,{model:n}),!(n instanceof x.U)&&n&&o().createElement(n.Component,{model:n}))):o().createElement(u.LoadingPlaceholder,{text:"Loading..."})},(a="Component")in(r=j)?Object.defineProperty(r,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[a]=s},88351:(e,t,n)=>{n.d(t,{E:()=>L});var r=n(85959),a=n.n(r),s=n(87781),i=n(76644),o=n(82007),l=n(34509),c=n(77839),u=n(20376),d=n(25953),p=n(34907),g=n(57985),h=n(16979),f=n(66732),v=n(45553),m=n(90020),b=n(89924),y=n(61402),S=n(76830),w=n(59857),O=n(76081),E=n(42606),x=n(46089);const _=e=>({toggleIcon:(0,x.css)({color:e.colors.error.main,marginRight:e.spacing(1)}),toggleLabel:(0,x.css)({display:"flex",marginRight:e.spacing(2)}),toggleLabelText:(0,x.css)({marginRight:e.spacing(1)})});const C=e=>({radioGroup:(0,x.css)({[e.breakpoints.up(e.breakpoints.values.md)]:{flexDirection:"row"},"> div > label":{height:"100%"},flexDirection:"column"})});var P=n(24059);function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class L extends i.Bs{updateChildren(e,t=void 0){var n;const r=(0,y.UO)(e),a=(0,y.nU)(e),s=(0,y.dB)(e),o=this.calculateCardinalityMap(e);null===(n=this.state.body)||void 0===n||n.state.layouts.forEach(e=>{if(e instanceof i.gF){const n=new Set(null==a?void 0:a.values),l=e.state.children;for(let o=0;o<l.length;o++){const c=e.state.children[o];if(c instanceof i.xK){const e=c.state.body;if(e instanceof w.O){const i=e.state.viz;if(t){const n=null==a?void 0:a.values.indexOf(i.state.title),o=n&&-1!==n?null==s?void 0:s.values[n]:void 0;if("timeseries"===this.state.fieldsPanelsType&&o!==t){const t=this.getTimeSeriesQueryRunnerForPanel(i.state.title,r,e.state.queryType);i.setState({$data:t})}}n.has(i.state.title)?n.delete(i.state.title):(l.splice(o,1),o--)}else d.v.warn("panel wrap is not FieldsVizPanelWrapper")}else d.v.warn("gridItem is not SceneCSSGridItem")}const c=Array.from(n).map(e=>e);l.push(...this.buildChildren(c)),l.sort(this.sortChildren(o)),l.map(e=>{this.subscribeToPanel(e)}),e.setState({children:l})}else d.v.warn("Layout is not SceneCSSGridLayout")})}sortChildren(e){return(t,n)=>{const r=t.state.body,a=n.state.body;var s;const i=null!==(s=e.get(r.state.viz.state.title))&&void 0!==s?s:0;var o;return(null!==(o=e.get(a.state.viz.state.title))&&void 0!==o?o:0)-i}}calculateCardinalityMap(e){const t=(0,y.UO)(e),n=new Map;if(null==t?void 0:t.length)for(let e=0;e<(null==t?void 0:t.length);e++){const r=t.fields[0].values[e],a=t.fields[1].values[e];n.set(r,a)}return n}onActivate(){var e;this.setState({body:this.build()});const t=i.jh.getAncestor(this,y.Mn);void 0===t.state.fieldsCount&&this.updateFieldCount(),this._subs.add(null===(e=t.state.$detectedFieldsData)||void 0===e?void 0:e.subscribeToState(this.onDetectedFieldsChange)),this._subs.add(this.subscribeToFieldsVar()),this._subs.add(this.subscribeToState((e,t)=>{e.fieldsPanelsType!==t.fieldsPanelsType&&this.setState({body:this.build()})}))}subscribeToFieldsVar(){return(0,v.ir)(this).subscribeToState((e,t)=>{const n=i.jh.getAncestor(this,y.Mn),r=e.filters.map(e=>(0,v.bu)(e).parser),a=t.filters.map(e=>(0,v.bu)(e).parser),s=(0,u.Qg)(r);if(s!==(0,u.Qg)(a)){var o;const e=null===(o=n.state.$detectedFieldsData)||void 0===o?void 0:o.state;e&&this.updateChildren(e,s)}})}build(){var e;const t=(0,v.Hj)(this).state.options.map(e=>String(e.value));i.jh.getAncestor(this,S.J6).state.search.reset();const n=this.buildChildren(t),r=i.jh.getAncestor(this,y.Mn),a=this.calculateCardinalityMap(null===(e=r.state.$detectedFieldsData)||void 0===e?void 0:e.state);n.sort(this.sortChildren(a));const s=n.map(e=>e.clone());return[...n,...s].map(e=>{this.subscribeToPanel(e)}),new O.U({active:"grid",layouts:[new i.gF({autoRows:"timeseries"===this.state.fieldsPanelsType?"200px":"35px",children:n,isLazy:!0,templateColumns:S.OK}),new i.gF({autoRows:"timeseries"===this.state.fieldsPanelsType?"200px":"35px",children:s,isLazy:!0,templateColumns:"1fr"})],options:[{label:"Grid",value:"grid"},{label:"Rows",value:"rows"}]})}subscribeToPanel(e){const t=e.state.body;if(t instanceof w.O){const r=null==t?void 0:t.state.viz;var n;if(r)this._subs.add(null==r||null===(n=r.state.$data)||void 0===n?void 0:n.getResultsStream().subscribe(t=>{t.data.errors&&t.data.errors.length>0?(this.state.showErrorPanels?e.setState({isHidden:!1}):e.setState({isHidden:!0}),this.state.showErrorPanelToggle||this.setState({showErrorPanelToggle:!0}),this.updateFieldCount()):(0,p.qi)(t,r)}))}else d.v.warn("panel wrap is not FieldsVizPanelWrapper")}rebuildChangedPanels(e){const t=(0,y.rD)(this),n=this.getActiveGridLayouts(),r=[];var a;const s=null!==(a=(0,f.ex)("panelType",[b.Ze.histogram,b.Ze.timeseries]))&&void 0!==a?a:b.Ze.timeseries;null==n||n.state.children.forEach(n=>{if(n instanceof i.xK&&this.state.showErrorPanels||n instanceof i.xK&&!n.state.isHidden){const a=i.jh.findDescendents(n,w.O);a.length&&("panelType"===e?r.push(this.rebuildPanelOnPanelTypeChange(a,s,t,n)):r.push(this.rebuildPanelOnQueryTypeChange(a,t,s,n)))}}),r.length&&(null==n||n.setState({children:r}))}buildChildren(e){const t=[],n=(0,y.rD)(this);var r;const a=null!==(r=(0,f.ex)("panelType",[b.Ze.timeseries,b.Ze.histogram]))&&void 0!==r?r:b.Ze.timeseries;for(const r of e){if(r===m.To||!r)continue;const e=(0,u.ph)(r,n),s=this.buildChild(r,n,a,(0,u.JI)(e)?b.BR.avg:b.BR.count);s&&t.push(s)}return t}buildChild(e,t,n,r){if(e===m.To||!e)return;const a=(0,u.ph)(e,t);let s;if("text"===this.state.fieldsPanelsType){const t=this.getEstimatedCardinalityQueryRunnerForPanel(e);s=this.buildText(e,a,t)}else{const i=this.getTimeSeriesQueryRunnerForPanel(e,t,r);s=this.buildTimeSeries(a,e,i,n,r)}s.setShowMenuAlways(!0);const o=s.build();return new i.xK({body:new w.O({viz:o,queryType:r,supportsHistogram:(0,u.JI)(a)||"int"===a})})}getTimeSeriesQueryRunnerForPanel(e,t,n){const r=(0,v.ir)(this),a=(0,v.Gc)(this),s=(0,u.Jl)(e,r,t,a,n),i=(0,g.l)(s,{legendFormat:n===b.BR.avg?e:`{{${e}}}`,refId:e});return(0,p.rS)([i])}getEstimatedCardinalityQueryRunnerForPanel(e){return new i.Es({transformations:[]})}getActiveGridLayouts(){var e,t,n;return null!==(n=null===(e=this.state.body)||void 0===e?void 0:e.state.layouts.find(e=>e.isActive))&&void 0!==n?n:null===(t=this.state.body)||void 0===t?void 0:t.state.layouts[0]}updateFieldCount(){var e,t;const n=this.getActiveGridLayouts(),r=null==n?void 0:n.state.children,a=null==r?void 0:r.filter(e=>this.state.showErrorPanels||!e.state.isHidden);var s;null===(e=(t=i.jh.getAncestor(this,S.J6).state).changeFieldCount)||void 0===e||e.call(t,null!==(s=null==a?void 0:a.length)&&void 0!==s?s:0)}toggleErrorPanels(e){const t=e.target.checked;this.setState({showErrorPanels:t}),(0,f.rg)(t);const n=i.jh.getAncestor(this,y.Mn);var r,a;((0,l.EE)(l.NO.service_details,l.ir.service_details.toggle_error_panels,{checked:t}),t)?this.setState({body:this.build()}):(null===(r=n.state.$detectedFieldsData)||void 0===r?void 0:r.state)?this.updateChildren(null===(a=n.state.$detectedFieldsData)||void 0===a?void 0:a.state):this.setState({body:this.build()})}static Selector({model:e}){const{body:t}=e.useState();return a().createElement(a().Fragment,null,t&&a().createElement(O.U.Selector,{model:t}))}constructor(e){var t;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){k(e,t,n[t])})}return e}({fieldsPanelsType:null!==(t=(0,f.JA)())&&void 0!==t?t:"timeseries",showErrorPanels:(0,f.Vt)(),showErrorPanelToggle:!1},e)),k(this,"onDetectedFieldsChange",e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.state)===s.LoadingState.Done&&this.updateChildren(e)}),k(this,"rebuildPanelOnPanelTypeChange",(e,t,n,r)=>{const a=e[0],s=a.state.viz,i=s.state.title;if(a.state.supportsHistogram&&t!==s.state.pluginId&&a.state.queryType===b.BR.avg){const e=this.buildChild(i,n,t,a.state.queryType);if(e)return e}return r}),k(this,"rebuildPanelOnQueryTypeChange",(e,t,n,r)=>{const a=e[0],s=a.state.viz,i=s.state.title,o=(0,h.B)(s),l=(0,g.lg)(o)?b.BR.avg:b.BR.count;if(a.state.queryType!==l){const e=this.buildChild(i,t,"timeseries"===s.state.pluginId?n:b.Ze.timeseries,a.state.queryType);if(e)return e}return r}),k(this,"buildText",(e,t,n)=>{const r=i.d0.text().setTitle(e).setData(n).setHeaderActions(new E.X({fieldType:c._J.field,hasNumericFilters:"int"===t||"float"===t||"bytes"===t||"duration"===t,labelName:String(e)}));return r.setOption("content",""),r}),k(this,"buildTimeSeries",(e,t,n,r,a)=>{let s,l=[];return a===b.BR.count?(s=i.d0.timeseries().setTitle(t).setData(n).setMenu(new b.GD({fieldType:e,panelType:"int"===e?r:void 0})).setCustomFieldConfig("stacking",{mode:o.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",o.DrawStyle.Bars).setOverrides(p.jC),l.push(new E.X({fieldType:c._J.field,hasNumericFilters:"int"===e,labelName:String(t)}))):(s=r===b.Ze.histogram?i.d0.histogram():i.d0.timeseries(),s.setTitle(t).setData(n).setUnit("short").setMenu(new b.GD({panelType:r,fieldType:e})),l.push(new E.X({fieldType:c._J.field,hideValueDrilldown:!0,labelName:String(t)}))),s.setSeriesLimit(P.l),s.setHeaderActions(l),s}),this.addActivationHandler(this.onActivate.bind(this))}}k(L,"ShowErrorPanelToggle",function({model:e}){const{showErrorPanels:t,showErrorPanelToggle:n}=e.useState(),r=(0,o.useStyles2)(_);return n?a().createElement(o.Label,{className:r.toggleLabel},a().createElement(o.IconButton,{className:r.toggleIcon,tooltip:"One or more requests could not be processed",name:"exclamation-triangle",variant:"secondary"}),a().createElement("span",{className:r.toggleLabelText},"Show panels with errors"),a().createElement(o.InlineSwitch,{onChange:t=>e.toggleErrorPanels(t),value:t})):null}),k(L,"ShowFieldDisplayToggle",function({model:e}){const{fieldsPanelsType:t}=e.useState(),n=(0,o.useStyles2)(C);return a().createElement(o.RadioButtonGroup,{className:n.radioGroup,options:[{label:"Volume",value:"timeseries"},{label:"Names",value:"text"}],value:t,onChange:t=>{e.setState({fieldsPanelsType:t}),(0,f.NM)(t),(0,l.EE)(l.NO.service_details,l.ir.service_details.fields_panel_type_toggle,{fieldsPanelType:t})}})}),k(L,"Component",({model:e})=>{const{body:t}=e.useState(),n=(0,o.useStyles2)(b.K_);return t?a().createElement("span",{className:n.panelWrapper},t&&a().createElement(t.Component,{model:t})):a().createElement(o.LoadingPlaceholder,{text:"Loading..."})})},76830:(e,t,n)=>{n.d(t,{J6:()=>N,OK:()=>$,ZI:()=>A});var r=n(85959),a=n.n(r),s=n(46089),i=n(87781),o=n(76644),l=n(82007),c=n(21532),u=n(34702),d=n(77839),p=n(67478),g=n(69683),h=n(52601),f=n(45553),v=n(75548),m=n(41745),b=n(61402),y=n(18313),S=n(158),w=n(50713),O=n(88351),E=n(7243),x=n(42969),_=n(76081),C=n(36779),P=n(11049),k=n(95659),L=n(34509),j=n(48502),F=n(66732),T=n(90020);function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const $="repeat(auto-fit, minmax(400px, 1fr))";class N extends o.Bs{onActivate(){var e,t,n;const r=(0,f.Hj)(this),a=o.jh.getAncestor(this,b.Mn);this.setState({loading:(null===(t=a.state.$detectedLabelsData)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.state)===i.LoadingState.Loading}),this._subs.add(this.subscribeToEvent(y.x,()=>{this.state.search.clearValueFilter()})),this._subs.add(this.subscribeToEvent(P.gf,this.handleSortByChange)),this._subs.add(r.subscribeToState(this.variableChanged)),this._subs.add((0,f.cR)(this).subscribeToState((e,t)=>{const n=(0,f.Hj)(this);let{labelName:r}=this.getPrimaryLabel();const a=e.filters.find(e=>e.key===r),s=t.filters.find(e=>e.key===r);n.state.value===T.To&&a!==s&&this.setState({body:void 0,loading:!0})})),this._subs.add(null===(n=a.state.$detectedFieldsData)||void 0===n?void 0:n.subscribeToState((e,t)=>{var n,r,a,s;(null===(n=e.data)||void 0===n?void 0:n.state)!==i.LoadingState.Done&&(null===(r=e.data)||void 0===r?void 0:r.state)!==i.LoadingState.Error||(null===(a=e.data.series)||void 0===a?void 0:a[0])&&this.updateOptions(null===(s=e.data.series)||void 0===s?void 0:s[0])}));const s=(0,b.rD)(this);s&&this.updateOptions(s)}getPrimaryLabel(){let{breakdownLabel:e,labelName:t,labelValue:n}=(0,g.MC)(this);if(!t||!n){const e=(0,f.cR)(this);return t=e.state.filters[0].key,n=e.state.filters[0].value,{labelName:(0,g.UU)(t),labelValue:n}}return{breakdownLabel:e,labelName:t,labelValue:n}}updateOptions(e){if(!e||!e.length){const e=o.jh.getAncestor(this,m.P);let r;var t,n;if((0,v.mE)(e,T.mB).length>0)null===(t=(n=this.state).changeFieldCount)||void 0===t||t.call(n,0),r=new C.W({clearCallback:()=>(0,v.rA)(this),type:"fields"});else r=new w.a({type:"fields"});return void this.setState({body:r,loading:!1})}const r=o.jh.getAncestor(this,b.Mn);var a;(0,f.Hj)(this).setState({loading:!1,options:(0,j.rd)(e.fields[0].values.map(e=>String(e))),value:null!==(a=r.state.drillDownLabel)&&void 0!==a?a:T.To}),this.setState({loading:!1})}updateBody(e){const t=(0,f.Hj)(this);if(!t.state.options||!t.state.options.length)return;const n={};if(t.state.options&&t.state.options.length<=1){const e=o.jh.getAncestor(this,m.P);var r,a;if((0,v.mE)(e,T.mB).length>0)null===(r=(a=this.state).changeFieldCount)||void 0===r||r.call(a,0),n.body=new C.W({clearCallback:()=>(0,v.rA)(this),type:"fields"});else n.body=new w.a({type:"fields"})}else e.value===T.To&&this.state.body instanceof x.u?n.body=new O.E({}):e.value!==T.To&&this.state.body instanceof O.E?n.body=new x.u({}):(void 0===this.state.body||this.state.body instanceof w.a||this.state.body instanceof C.W)&&(n.body=e.value===T.To?new O.E({}):new x.u({}));this.setState(n)}constructor(e){var t,n,r,a;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){D(e,t,n[t])})}return e}({$variables:null!==(r=e.$variables)&&void 0!==r?r:new o.Pj({variables:[new u.m({defaultToAll:!1,includeAll:!0,name:T.LI,options:null!==(t=e.options)&&void 0!==t?t:[],value:null!==(n=e.value)&&void 0!==n?n:T.To})]}),loading:!0,search:new y.G("fields"),sort:new P.wd({target:"fields"}),value:null!==(a=e.value)&&void 0!==a?a:T.To},e)),D(this,"_variableDependency",new o.Sh(this,{variableNames:[T.MB]})),D(this,"variableChanged",(e,t)=>{(e.value!==t.value||!(0,c.B)(e.options,t.options)||void 0===this.state.body||this.state.body instanceof w.a||this.state.body instanceof C.W)&&this.updateBody(e)}),D(this,"handleSortByChange",e=>{if("fields"!==e.target)return;const t=this.state.body;var n;t instanceof x.u&&t.state.body instanceof _.U&&(null===(n=t.state.body)||void 0===n||n.state.layouts.forEach(n=>{o.jh.findDescendents(t,S.h).forEach(t=>t.sort(e.sortBy,e.direction))}));(0,L.EE)(L.NO.service_details,L.ir.service_details.value_breakdown_sort_change,{criteria:e.sortBy,direction:e.direction,target:"fields"})}),D(this,"onFieldSelectorChange",e=>{if(!e)return;const t=(0,f.Hj)(this),{direction:n,sortBy:r}=(0,F.vs)("fields",h.DEFAULT_SORT_BY,"desc");(0,L.EE)(L.NO.service_details,L.ir.service_details.select_field_in_breakdown_clicked,{field:e,previousField:t.getValueText(),sortBy:r,sortByDirection:n,view:"fields"});const a=o.jh.getAncestor(this,b.Mn);(0,p.fg)(d._J.field,e,a)}),this.addActivationHandler(this.onActivate.bind(this))}}D(N,"LabelsMenu",({hideSearch:e,model:t})=>{const{body:n,loading:r,search:i}=t.useState(),o=(0,l.useStyles2)(B),c=(0,f.Hj)(t),{options:u,value:d}=c.useState();return null==n||n.useState(),a().createElement("div",{className:(0,s.cx)(o.labelsMenuWrapper,e?o.labelsMenuWrapperNoSearch:void 0)},n instanceof O.E&&a().createElement(a().Fragment,null,a().createElement("span",{className:o.toggleWrapper},"text"!==n.state.fieldsPanelsType&&a().createElement(O.E.ShowErrorPanelToggle,{model:n}),a().createElement(O.E.Selector,{model:n})),a().createElement(O.E.ShowFieldDisplayToggle,{model:n})),n instanceof x.u&&a().createElement(x.u.Selector,{model:n}),!0!==e&&n instanceof x.u&&a().createElement(i.Component,{model:i}),!r&&u.length>1&&a().createElement(E.u,{label:"Field",options:u,value:String(d),onChange:t.onFieldSelectorChange}))}),D(N,"ValuesMenu",({model:e})=>{const{loading:t,sort:n}=e.useState(),r=(0,l.useStyles2)(B),s=(0,f.Hj)(e),{value:i}=s.useState();return a().createElement("div",{className:r.valuesMenuWrapper},!t&&i!==T.To&&a().createElement(a().Fragment,null,a().createElement(n.Component,{model:n})))}),D(N,"Component",({model:e})=>{const{blockingMessage:t,body:n,loading:r}=e.useState(),s=(0,l.useStyles2)(B);return a().createElement("div",{className:s.container},a().createElement(k.O,{blockingMessage:t,isLoading:r},n instanceof O.E&&e&&a().createElement(N.LabelsMenu,{model:e}),a().createElement("div",{className:s.content},n&&a().createElement(n.Component,{model:n}))))});const A={button:(0,s.css)({marginLeft:"1.5rem"}),link:(0,s.css)({textDecoration:"underline"})};function B(e){return{container:(0,s.css)({display:"flex",flexDirection:"column",flexGrow:1,gap:e.spacing(1),minHeight:"100%"}),content:(0,s.css)({display:"flex",flexGrow:1,paddingTop:e.spacing(0)}),labelsMenuWrapper:(0,s.css)({alignItems:"top",display:"flex",flexDirection:"row-reverse",flexGrow:0,gap:e.spacing(2),justifyContent:"space-between"}),labelsMenuWrapperNoSearch:(0,s.css)({flexDirection:"row"}),toggleWrapper:(0,s.css)({display:"flex",flexDirection:"row"}),valuesMenuWrapper:(0,s.css)({alignItems:"top",display:"flex",flexDirection:"row",flexGrow:0,gap:e.spacing(2)})}}},59857:(e,t,n)=>{n.d(t,{O:()=>c});var r,a,s,i=n(85959),o=n.n(i),l=n(76644);class c extends l.Bs{constructor(e){super(e)}}s=({model:e})=>{const{viz:t}=e.useState();return o().createElement(t.Component,{model:t})},(a="Component")in(r=c)?Object.defineProperty(r,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[a]=s},58072:(e,t,n)=>{n.d(t,{O:()=>z});var r=n(85959),a=n.n(r),s=n(46089),i=n(87781),o=n(76644),l=n(82007),c=n(21532),u=n(34702),d=n(77839),p=n(67478),g=n(52601),h=n(45553),f=n(75548),v=n(41745),m=n(61402),b=n(18313),y=n(158),S=n(50713),w=n(7243),O=n(80042),E=n(34907),x=n(90020),_=n(89924),C=n(76081),P=n(42606),k=n(24059);function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class j extends o.Bs{onActivate(){var e;const t=(0,h.ir)(this),n=o.jh.getAncestor(this,m.Mn).state.$detectedLabelsData;this.state.body?(null==n||null===(e=n.state.data)||void 0===e?void 0:e.state)===i.LoadingState.Done&&this.update(null==n?void 0:n.state.data.series[0]):this.setState({body:this.build()}),this._subs.add(null==n?void 0:n.subscribeToState((e,t)=>{var n;(null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Done&&this.update(e.data.series[0])})),this._subs.add(t.subscribeToState(()=>{this.updateQueriesOnFieldsVariableChange()}))}getPanelByIndex(e,t){const n=e.state.children[t].state.body;return{panel:n,title:n.state.title}}update(e){var t;const n=(0,h.P4)(this).state.options.filter(e=>e.value!==x.To).map(e=>e.label);null===(t=this.state.body)||void 0===t||t.state.layouts.forEach(t=>{let r=[];const a=t,s=new Set(n),i=a.state.children;for(let e=0;e<i.length;e++){const{title:t}=this.getPanelByIndex(a,e);s.has(t)?s.delete(t):(i.splice(e,1),e--),r.push(t)}const o=Array.from(s).map(e=>({label:e,value:e}));i.push(...this.buildChildren(o));const l=this.calculateCardinalityMap(e);i.sort(this.sortChildren(l)),a.setState({children:i})})}calculateCardinalityMap(e){const t=new Map;if(null==e?void 0:e.length)for(let n=0;n<(null==e?void 0:e.fields.length);n++){const r=e.fields[n].name,a=e.fields[n].values[0];t.set(r,a)}return t}build(){var e;const t=(0,h.P4)(this);o.jh.getAncestor(this,z).state.search.reset();const n=this.buildChildren(t.state.options),r=o.jh.getAncestor(this,m.Mn).state.$detectedLabelsData;if((null==r||null===(e=r.state.data)||void 0===e?void 0:e.state)===i.LoadingState.Done){const e=this.calculateCardinalityMap(null==r?void 0:r.state.data.series[0]);n.sort(this.sortChildren(e))}const a=n.map(e=>e.clone());return new C.U({active:"grid",layouts:[new o.gF({autoRows:"200px",children:n,isLazy:!0,templateColumns:O.di}),new o.gF({autoRows:"200px",children:a,isLazy:!0,templateColumns:"1fr"})],options:[{label:"Grid",value:"grid"},{label:"Rows",value:"rows"}]})}buildChildren(e){const t=[];for(const n of e){const{value:e}=n,r=String(e);if(e===x.To||!e)continue;const a=(0,O.oj)(this,String(n.value),String(n.value)),s=(0,E.rS)([a]);t.push(new o.xK({body:o.d0.timeseries().setTitle(r).setData(s).setHeaderActions([new P.X({fieldType:d._J.label,labelName:r})]).setCustomFieldConfig("stacking",{mode:l.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",l.DrawStyle.Bars).setHoverHeader(!1).setShowMenuAlways(!0).setOverrides(E.jC).setMenu(new _.GD({})).setSeriesLimit(k.l).build()}))}return t}sortChildren(e){return(t,n)=>{const r=t.state.body,a=n.state.body;if(r.state.title===x.e4)return-1;if(a.state.title===x.e4)return 1;var s;const i=null!==(s=e.get(r.state.title))&&void 0!==s?s:0;var o;return(null!==(o=e.get(a.state.title))&&void 0!==o?o:0)-i}}static Selector({model:e}){const{body:t}=e.useState();return a().createElement(a().Fragment,null,t&&a().createElement(C.U.Selector,{model:t}))}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){L(e,t,n[t])})}return e}({},e)),L(this,"updateQueriesOnFieldsVariableChange",()=>{var e;null===(e=this.state.body)||void 0===e||e.state.layouts.forEach(e=>{const t=e;for(let e=0;e<t.state.children.length;e++){const{panel:a,title:s}=this.getPanelByIndex(t,e),i=a.state.$data,l=(0,O.oj)(this,s,s);var n,r;if(i instanceof o.dt)if(l.expr===(null==i||null===(r=i.state.queries)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.expr))break;a.setState({$data:(0,E.rS)([l])})}})}),this.addActivationHandler(this.onActivate.bind(this))}}L(j,"Component",({model:e})=>{const{body:t}=e.useState(),n=(0,l.useStyles2)(_.K_);return t?a().createElement("span",{className:n.panelWrapper},t&&a().createElement(t.Component,{model:t})):a().createElement(l.LoadingPlaceholder,{text:"Loading..."})});var F=n(6887),T=n(36779),D=n(11049),$=n(95659),N=n(34509),A=n(48502),B=n(69683),M=n(66732);function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){I(e,t,n[t])})}return e}function V(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}class z extends o.Bs{onActivate(){var e,t,n,r,a;const s=o.jh.getAncestor(this,m.Mn),l=(0,h.P4)(this);this.setState({error:(null===(t=s.state.$detectedLabelsData)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.state)===i.LoadingState.Error,loading:(null===(r=s.state.$detectedLabelsData)||void 0===r||null===(n=r.state.data)||void 0===n?void 0:n.state)!==i.LoadingState.Done}),this._subs.add(this.subscribeToEvent(b.x,()=>{this.state.search.clearValueFilter()})),this._subs.add(this.subscribeToEvent(D.gf,this.handleSortByChange)),this._subs.add(null===(a=s.state.$detectedLabelsData)||void 0===a?void 0:a.subscribeToState(this.onDetectedLabelsDataChange)),this._subs.add((0,h.cR)(this).subscribeToState((e,t)=>{this.onLabelsVariableChange(e,t)})),this._subs.add(l.subscribeToState((e,t)=>{this.onGroupByVariableChange(e,t)}));const c=(0,m.TG)(this);c&&this.updateOptions(c)}onGroupByVariableChange(e,t){(e.value!==t.value||!(0,c.B)(e.options,t.options)||void 0===this.state.body||this.state.body instanceof S.a||this.state.body instanceof T.W)&&this.updateBody()}onLabelsVariableChange(e,t){let{labelName:n}=(0,B.MC)(this);n===x.ky&&(n=x.OX);const r=(0,h.P4)(this),a=e.filters.find(e=>e.key===n),s=t.filters.find(e=>e.key===n);r.state.value===x.To&&a!==s&&this.setState({body:void 0,error:void 0,loading:!0})}updateOptions(e){if(e&&e.length){const n=(0,h.P4)(this),r=(0,A.dD)(e.fields.map(e=>e.name));var t;n.setState({loading:!1,options:r,value:null!==(t=this.state.value)&&void 0!==t?t:x.To})}}updateBody(){const e=(0,h.P4)(this);if(!e.state.options||!e.state.options.length)return;const t={blockingMessage:void 0,error:!1,loading:!1};e.hasAllValue()&&this.state.body instanceof F.u?t.body=new j({}):!e.hasAllValue()&&this.state.body instanceof j?t.body=new F.u({}):void 0===this.state.body?e.state.options.length>0?t.body=e.hasAllValue()?new j({}):new F.u({}):t.body=new S.a({type:"labels"}):(this.state.body instanceof S.a||this.state.body instanceof T.W)&&e.state.options.length>0&&(t.body=e.hasAllValue()?new j({}):new F.u({})),this.setState(R({},t))}constructor(e){var t,n,r;super(V(R({},e),{$variables:null!==(r=e.$variables)&&void 0!==r?r:new o.Pj({variables:[new u.m({defaultToAll:!1,includeAll:!0,name:x.Jg,options:null!==(t=e.options)&&void 0!==t?t:[],value:null!==(n=e.value)&&void 0!==n?n:x.To})]}),loading:!0,search:new b.G("labels"),sort:new D.wd({target:"labels"}),value:e.value})),I(this,"_variableDependency",new o.Sh(this,{variableNames:[x.MB]})),I(this,"onDetectedLabelsDataChange",(e,t)=>{var n;if((null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Done){var r,a;(0,h.P4)(this).setState({loading:!1}),this.setEmptyStates(null===(r=e.data)||void 0===r?void 0:r.series[0]),this.updateOptions(null===(a=e.data.series)||void 0===a?void 0:a[0])}}),I(this,"handleSortByChange",e=>{if("labels"!==e.target)return;const t=this.state.body;if(t instanceof F.u){o.jh.findDescendents(t,y.h).forEach(t=>{t.sort(e.sortBy,e.direction)})}(0,N.EE)(N.NO.service_details,N.ir.service_details.value_breakdown_sort_change,{criteria:e.sortBy,direction:e.direction,target:"labels"})}),I(this,"setEmptyStates",e=>{if(!e||!e.length){const e=o.jh.getAncestor(this,v.P);let t;t=(0,f.mE)(e).length>0?new T.W({clearCallback:()=>{(0,f.rA)(this),this.updateBody()}}):new S.a({type:"labels"}),this.setState({body:t,loading:!1})}}),I(this,"onChange",e=>{if(!e)return;const t=(0,h.P4)(this);t.changeValueTo(e);const{direction:n,sortBy:r}=(0,M.vs)("labels",g.DEFAULT_SORT_BY,"desc");(0,N.EE)(N.NO.service_details,N.ir.service_details.select_field_in_breakdown_clicked,{label:e,previousLabel:t.getValueText(),sortBy:r,sortByDirection:n,view:"labels"});const a=o.jh.getAncestor(this,m.Mn);(0,p.fg)(d._J.label,e,a)}),this.addActivationHandler(this.onActivate.bind(this))}}function q(e){return{container:(0,s.css)({display:"flex",flexDirection:"column",flexGrow:1,gap:e.spacing(1),minHeight:"100%"}),content:(0,s.css)({display:"flex",flexGrow:1,paddingTop:e.spacing(0)}),labelsMenuWrapper:(0,s.css)({alignItems:"top",display:"flex",flexDirection:"row-reverse",flexGrow:0,gap:e.spacing(2),justifyContent:"space-between"}),valuesMenuWrapper:(0,s.css)({alignItems:"top",display:"flex",flexDirection:"row",flexGrow:0,gap:e.spacing(2)})}}I(z,"LabelsMenu",({model:e})=>{const{body:t,loading:n,search:r}=e.useState(),s=(0,h.P4)(e),{options:i,value:o}=s.useState(),c=(0,l.useStyles2)(q);return a().createElement("div",{className:c.labelsMenuWrapper},t instanceof F.u&&a().createElement(F.u.Selector,{model:t}),t instanceof j&&a().createElement(j.Selector,{model:t}),t instanceof F.u&&a().createElement(r.Component,{model:r}),!n&&i.length>0&&a().createElement(w.u,{label:"Label",options:i,value:String(o),onChange:e.onChange}))}),I(z,"ValuesMenu",({model:e})=>{const{loading:t,sort:n}=e.useState(),r=(0,h.P4)(e),{value:s}=r.useState(),i=(0,l.useStyles2)(q);return a().createElement("div",{className:i.valuesMenuWrapper},!t&&s!==x.To&&a().createElement(a().Fragment,null,a().createElement(n.Component,{model:n})))}),I(z,"Component",({model:e})=>{const{blockingMessage:t,body:n,error:r,loading:s}=e.useState(),i=(0,l.useStyles2)(q);return a().createElement("div",{className:i.container},a().createElement($.O,{blockingMessage:t,isLoading:s},r&&a().createElement(l.Alert,{title:"",severity:"warning"},"The labels are not available at this moment. Try using a different time range or check again later."),n instanceof j&&e&&a().createElement(z.LabelsMenu,{model:e}),a().createElement("div",{className:i.content},n&&a().createElement(n.Component,{model:n}))))})},6887:(e,t,n)=>{n.d(t,{u:()=>$});var r=n(85959),a=n.n(r),s=n(87781),i=n(18531),o=n(76644),l=n(82007),c=n(21532),u=n(20376),d=n(80042),p=n(25953),g=n(34907),h=n(57985),f=n(52601),v=n(66732),m=n(45553),b=n(75548),y=n(90020),S=n(41745),w=n(89924),O=n(158),E=n(50713),x=n(58072),_=n(76081),C=n(36779),P=n(45865),k=n(11049);function L(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function j(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var s=e.apply(t,n);function i(e){L(s,r,a,i,o,"next",e)}function o(e){L(s,r,a,i,o,"throw",e)}i(void 0)})}}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){F(e,t,n[t])})}return e}function D(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}class $ extends o.Bs{onActivate(){this.setState({$data:this.buildQueryRunner(),body:this.build()}),this.runQuery(),this.setSubscriptions()}buildQueryRunner(){const e=this.buildQuery();return(0,g.rS)([e],{runQueriesMode:"manual"})}buildQuery(){const e=(0,d.oj)(this,y.zp,String((0,m.P4)(this).state.value)),{filterExpression:t,variableName:n}=this.removeValueLabelFromVariableInterpolation();return e.expr=e.expr.replace(`\${${n}}`,t),e}setSubscriptions(){var e;this._subs.add(null===(e=this.state.$data)||void 0===e?void 0:e.subscribeToState((e,t)=>{this.onValuesDataQueryChange(e)})),this._subs.add((0,m.P4)(this).subscribeToState(e=>{e.value===y.To&&this.setState({$data:void 0,body:void 0})})),this._subs.add(o.jh.getTimeRange(this).subscribeToState(()=>{this.runQuery()})),this._subs.add((0,m.ir)(this).subscribeToState((e,t)=>{(0,c.B)(e.filters,t.filters)||this.runQuery()})),this._subs.add((0,m.oY)(this).subscribeToState((e,t)=>{(0,c.B)(e.filters,t.filters)||this.runQuery()})),this._subs.add((0,m.Gk)(this).subscribeToState((e,t)=>{(0,c.B)(e.filters,t.filters)||this.runQuery()})),this._subs.add((0,m.Ku)(this).subscribeToState((e,t)=>{e.value!==t.value&&this.runQuery()}));const t=this.getTagKey();this._subs.add((0,m.cR)(this).subscribeToState((e,n)=>j(function*(){(0,c.B)(e.filters.filter(e=>t===y.e4&&e.key!==t),n.filters.filter(e=>t===y.e4&&e.key!==t))||this.runQuery()}).call(this))),this._subs.add((0,m.iw)(this).subscribeToState((e,n)=>j(function*(){(0,c.B)(e.filters.filter(e=>t!==y.e4&&e.key!==t),n.filters.filter(e=>t!==y.e4&&e.key!==t))||this.runQuery()}).call(this)))}rebuildQuery(){var e;null===(e=this.getSceneQueryRunner())||void 0===e||e.setState({queries:[this.buildQuery()]})}runQuery(){this.rebuildQuery();const e=this.getSceneQueryRunner();null==e||e.runQueries()}getSceneQueryRunner(){if(this.state.$data){const e=o.jh.findDescendents(this.state.$data,o.dt);if(1!==e.length){const e=new Error("Unable to find query runner in value breakdown!");throw p.v.error(e,{msg:"LabelValuesBreakdownScene: Unable to find query runner in value breakdown!"}),e}return e[0]}p.v.warn("LabelValuesBreakdownScene: Query is attempting to execute, but query runner is undefined!")}removeValueLabelFromVariableInterpolation(){const e=this.getTagKey();let t,n;if(e===y.e4){const r=(0,m.iw)(this);n=y._Y,t=(0,h._q)(r.state.filters,[e])}else{const r=(0,m.cR)(this);n=y.MB,t=(0,h.VW)(r.state.filters,[e])}return{filterExpression:t,variableName:n}}getTagKey(){const e=(0,m.P4)(this);return String(e.state.value)}onValuesDataQueryChange(e){this.setEmptyStates(e),this.setErrorStates(e)}setErrorStates(e){var t,n;if((null==e||null===(t=e.data)||void 0===t?void 0:t.errors)&&(null===(n=e.data)||void 0===n?void 0:n.state)!==s.LoadingState.Done){var r;const t=this.state.errors;null==e||null===(r=e.data)||void 0===r||r.errors.forEach(e=>{const n=`${e.status}_${e.traceId}_${e.message}`;void 0===t[n]&&(t[n]=D(T({},e),{displayed:!1}))}),this.setState({errors:t}),this.showErrorToast(this.state.errors)}}setEmptyStates(e){var t;if((null===(t=e.data)||void 0===t?void 0:t.state)===s.LoadingState.Done)if(e.data.series.length>0&&!(this.state.body instanceof _.U))this.setState({body:this.build()});else if(0===e.data.series.length){const e=o.jh.getAncestor(this,S.P);(0,b.mE)(e).length>0?this.setState({body:new C.W({clearCallback:()=>(0,b.rA)(this)})}):this.setState({body:new E.a({type:"fields"})})}}getActiveLayout(){const e=this.state.body;if(e instanceof _.U){const t=null==e?void 0:e.state.layouts.find(e=>e.isActive);if(t instanceof o.G1)return t}}activeLayoutContainsNoPanels(){const e=this.getActiveLayout();if(e){return o.jh.findDescendents(e,O.h).some(e=>{const t=e.state.body.state.children[0];return t instanceof o.vA||t instanceof o.dM})}return!1}build(){const e=(0,m.P4)(this).state,t=String(null==e?void 0:e.value),n=o.jh.getAncestor(this,x.O);let r=o.d0.timeseries();r=r.setCustomFieldConfig("stacking",{mode:l.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",l.DrawStyle.Bars).setShowMenuAlways(!0).setOverrides(g.jC).setMenu(new w.GD({})).setTitle(t);const{direction:s,sortBy:i}=(0,v.vs)("labels",f.DEFAULT_SORT_BY,"desc"),c=()=>{var e;return null!==(e=n.state.search.state.filter)&&void 0!==e?e:""};return new _.U({active:"grid",layouts:[new o.G1({children:[new o.dM({reactNode:a().createElement(x.O.LabelsMenu,{model:n})}),new P.s7({levelColor:!0,tagKey:this.getTagKey(),title:t,type:"label"}),new o.dM({reactNode:a().createElement(x.O.ValuesMenu,{model:n})}),new O.h({body:new o.gF({autoRows:"200px",children:[new o.vA({body:new o.dM({reactNode:a().createElement(l.LoadingPlaceholder,{text:"Loading..."})})})],isLazy:!0,templateColumns:d.di}),direction:s,getFilter:c,getLayoutChild:(0,u.Zp)(k.ee,l.DrawStyle.Bars,y.MB,o.jh.getAncestor(this,x.O).state.sort,t),sortBy:i})],direction:"column"}),new o.G1({children:[new o.dM({reactNode:a().createElement(x.O.LabelsMenu,{model:n})}),new P.s7({levelColor:!0,tagKey:this.getTagKey(),title:t,type:"label"}),new o.dM({reactNode:a().createElement(x.O.ValuesMenu,{model:n})}),new O.h({body:new o.gF({autoRows:"200px",children:[new o.vA({body:new o.dM({reactNode:a().createElement(l.LoadingPlaceholder,{text:"Loading..."})})})],templateColumns:"1fr"}),direction:s,getFilter:c,getLayoutChild:(0,u.Zp)(k.ee,l.DrawStyle.Bars,y.MB,o.jh.getAncestor(this,x.O).state.sort,t),sortBy:i})],direction:"column"})],options:[{label:"Grid",value:"grid"},{label:"Rows",value:"rows"}]})}showErrorToast(e){const t=(0,i.getAppEvents)();let n=[];for(const t in e){const r=e[t];r.displayed||(n.push(r),r.displayed=!0)}n.length&&(this.activeLayoutContainsNoPanels()||t.publish({payload:null==n?void 0:n.map((e,t)=>this.renderError(t,e)),type:s.AppEvents.alertError.name}),this.setState({errors:e}))}renderError(e,t){return a().createElement("div",{key:e},t.status&&a().createElement(a().Fragment,null,a().createElement("strong",null,"Status"),": ",t.status," ",a().createElement("br",null)),t.message&&a().createElement(a().Fragment,null,a().createElement("strong",null,"Message"),": ",t.message," ",a().createElement("br",null)),t.traceId&&a().createElement(a().Fragment,null,a().createElement("strong",null,"TraceId"),": ",t.traceId))}static Selector({model:e}){const{body:t}=e.useState();return a().createElement(a().Fragment,null,t&&t instanceof _.U&&a().createElement(_.U.Selector,{model:t}))}constructor(e){super(D(T({},e),{errors:{}})),this.addActivationHandler(this.onActivate.bind(this))}}F($,"Component",({model:e})=>{const{body:t}=e.useState(),n=(0,l.useStyles2)(w.K_);return t?a().createElement("span",{className:n.panelWrapper},t&&a().createElement(t.Component,{model:t})):a().createElement(l.LoadingPlaceholder,{text:"Loading..."})})},76081:(e,t,n)=>{n.d(t,{U:()=>g});var r=n(85959),a=n.n(r),s=n(46089),i=n(76644),o=n(82007),l=n(69683),c=n(34509),u=n(66732);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}class g extends i.Bs{constructor(e){var t;super(p(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){d(e,t,n[t])})}return e}({},e),{active:null!==(t=e.active)&&void 0!==t?t:"grid"})),d(this,"updateLayout",()=>{const e=(0,u.Dy)();e&&this.setState({active:"grid"===e||"rows"===e?e:"grid"})}),d(this,"onLayoutChange",e=>{(0,c.EE)(c.NO.service_details,c.ir.service_details.layout_type_changed,{layout:e,view:(0,l.FT)()}),(0,u.zu)(e),this.setState({active:e})}),d(this,"onActivate",()=>{this.updateLayout()}),this.addActivationHandler(this.onActivate.bind(this))}}d(g,"Selector",function({model:e}){const{active:t,options:n}=e.useState(),r=(0,o.useStyles2)(h);return a().createElement(o.Field,{className:r.field},a().createElement(o.RadioButtonGroup,{options:n,value:t,onChange:e.onLayoutChange}))}),d(g,"Component",({model:e})=>{const{active:t,layouts:n,options:r}=e.useState(),s=r.findIndex(e=>e.value===t);if(-1===s)return null;const i=n[s];return a().createElement(i.Component,{model:i})});const h=e=>({field:(0,s.css)({marginBottom:0})})},36779:(e,t,n)=>{n.d(t,{W:()=>h});var r,a,s,i=n(85959),o=n.n(i),l=n(90219),c=n(76644),u=n(82007),d=n(47191),p=n(76830),g=n(3657);class h extends c.Bs{}s=function({model:e}){const[t,n]=(0,i.useState)(void 0),{clearCallback:r,type:a="labels"}=e.useState();(0,i.useEffect)(()=>{(0,l.isAssistantAvailable)().subscribe(e=>{n(e)})},[]);const s=(0,g.b)(a,e);var c;return o().createElement(d.R,null,o().createElement("p",null,"No ",a," match these filters."),o().createElement(u.Stack,{justifyContent:"center"},o().createElement(u.Button,{className:p.ZI.button,onClick:()=>r()},"Clear filters"),t&&o().createElement(u.Button,{variant:"secondary",onClick:()=>function(e,t=`Investigate why there are no ${e} to display with the current filters and time range.`){(0,l.openAssistant)({origin:"logs-drilldown-empty-results",prompt:t})}(a,null==s?void 0:s.customPrompt),icon:"ai-sparkle"},null!==(c=null==s?void 0:s.promptCTA)&&void 0!==c?c:"Ask Grafana Assistant")))},(a="Component")in(r=h)?Object.defineProperty(r,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[a]=s},45865:(e,t,n)=>{n.d(t,{Zb:()=>y,s$:()=>w,s7:()=>b});var r=n(85959),a=n.n(r),s=n(87781),i=n(76644),o=n(82007),l=n(34509),c=n(80042),u=n(5570),d=n(25953),p=n(34907),g=n(66732),h=n(45553),f=n(90020),v=n(89924);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class b extends i.Bs{onActivate(){var e;const t=null!==(e=(0,g.ex)("collapsed",[v.Ci.collapsed,v.Ci.expanded]))&&void 0!==e?e:v.Ci.expanded,n=function(e,t){var n;const r=null!==(n=(0,g.ex)("collapsed",[v.Ci.collapsed,v.Ci.expanded]))&&void 0!==n?n:v.Ci.expanded,a=i.d0.timeseries().setTitle(e).setMenu(new v.GD({})).setCollapsible(!0).setCollapsed(r===v.Ci.collapsed).setCustomFieldConfig("stacking",{mode:o.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",o.DrawStyle.Bars).setShowMenuAlways(!0).setSeriesLimit(100);(null==t?void 0:t.levelColor)&&a.setOverrides(p.jC);return a.build()}(this.state.title,{levelColor:this.state.levelColor}),r=S(t);n.setState({extendPanelContext:(e,t)=>this.extendTimeSeriesLegendBus(t)}),n.addActivationHandler(()=>{const e=i.jh.getData(this);this._subs.add(e.getResultsStream().subscribe(e=>{e.data.errors&&e.data.errors.length||(0,p.qi)(e,n)}))}),this.setState({body:new i.G1({children:[new i.vA({body:n})],height:r,key:w,maxHeight:r,minHeight:r,wrap:"nowrap"})}),this._subs.add(n.subscribeToState((e,t)=>{if(e.collapsed!==t.collapsed){y(i.jh.getAncestor(n,i.G1),e.collapsed?v.Ci.collapsed:v.Ci.expanded),(0,g.IW)("collapsed",e.collapsed?v.Ci.collapsed:v.Ci.expanded)}}))}initLegendOptions(e,t,n){e&&("label"===this.state.type?t===f.e4?(0,p.C6)(n,e,this):(0,p.dO)(t,n,e,this):(0,p.Nr)(t,n,e,this))}getQuerySubscription(e,t,n){return t.subscribeToState((t,r)=>{var a;(null===(a=t.data)||void 0===a?void 0:a.state)===s.LoadingState.Done&&("label"===this.state.type?e===f.e4?(0,p.C6)(n,t.data.series,this):(0,p.dO)(e,n,t.data.series,this):(0,p.Nr)(e,n,t.data.series,this))})}getFieldsVariableLegendSyncSubscription(e,t){return null==t?void 0:t.subscribeToState(()=>{var t,n;const r=null===(t=this.state.body)||void 0===t?void 0:t.state.children[0];if(!(r instanceof i.vA))throw new Error("Cannot find sceneFlexItem");const a=r.state.body;if(!(a instanceof i.Eb))throw new Error("ValueSummary - getFieldsVariableLegendSyncSubscription: Cannot find VizPanel");const s=null===(n=i.jh.getData(this).state.data)||void 0===n?void 0:n.series;s?(0,p.Nr)(e,a,s,this):d.v.warn("ValueSummary - getFieldsVariableLegendSyncSubscription: missing dataframe!")})}getLabelsVariableLegendSyncSubscription(e){const t=e===f.e4,n=t?(0,h.iw)(this):(0,h.cR)(this);return null==n?void 0:n.subscribeToState(()=>{var n,r;const a=null===(n=this.state.body)||void 0===n?void 0:n.state.children[0];if(!(a instanceof i.vA))throw new Error("Cannot find sceneFlexItem");const s=a.state.body;if(!(s instanceof i.Eb))throw new Error("ValueSummary - getLabelsVariableLegendSyncSubscription: Cannot find VizPanel");const o=null===(r=i.jh.getData(this).state.data)||void 0===r?void 0:r.series;o?t?(0,p.C6)(s,o,this):(0,p.dO)(e,s,o,this):d.v.warn("ValueSummary - getLabelsVariableLegendSyncSubscription: missing dataframe!")})}constructor(e){super(e),m(this,"extendTimeSeriesLegendBus",e=>{var t,n;const r=i.jh.getData(this),a=null===(t=r.state.data)||void 0===t?void 0:t.series,s=this.state.tagKey,o=null===(n=this.state.body)||void 0===n?void 0:n.state.children[0];if(!(o instanceof i.vA))throw new Error("Cannot find sceneFlexItem");const d=o.state.body;if(!(d instanceof i.Eb))throw new Error("Cannot find VizPanel");this.initLegendOptions(a,s,d),"label"===this.state.type?this._subs.add(this.getLabelsVariableLegendSyncSubscription(s)):(this._subs.add(this.getFieldsVariableLegendSyncSubscription(s,(0,h.ir)(this))),this._subs.add(this.getFieldsVariableLegendSyncSubscription(s,(0,h.oY)(this)))),this._subs.add(this.getQuerySubscription(s,r,d)),e.onToggleSeriesVisibility=(e,t)=>{let n;n="label"===this.state.type?s===f.e4?(0,u.PE)(e,this):(0,c.R7)(s,e,this):(0,c.zr)(s,e,this),(0,l.EE)(l.NO.service_details,l.ir.service_details.label_in_panel_summary_clicked,{action:n,label:e})}}),this.addActivationHandler(this.onActivate.bind(this))}}function y(e,t){const n=S(t);e.setState({height:n,maxHeight:n,minHeight:n})}function S(e){return e===v.Ci.collapsed?35:300}m(b,"Component",({model:e})=>{const{body:t}=e.useState();return t?a().createElement("div",null,a().createElement(t.Component,{model:t})):null});const w="value_summary_panel"},42524:(e,t,n)=>{n.d(t,{j4:()=>u,xX:()=>d});var r=n(85959),a=n.n(r),s=n(46089),i=n(82007),o=n(77839),l=n(67478),c=n(47191);const u=/maximum of series \(\d+\) reached for a single query/;function d(e){var t;const n=(0,i.useStyles2)(h),r=new Set,s=new Set,u=null===(t=e.errors)||void 0===t?void 0:t.filter(e=>{if(e.traceId&&s.add(e.traceId),e.message){if(r.has(e.message))return!1;r.add(e.message)}return!0}),d=e.isPartial?`Showing partial results for ${e.tagKey}`:`Error fetching results for ${e.tagKey}`;return a().createElement(c.R,null,a().createElement("div",{className:n.queryError},a().createElement(i.Alert,{title:d,severity:"error"},null==u?void 0:u.map((t,n)=>a().createElement(p,{traces:s,key:n,err:t,label:e.tagKey})),a().createElement("div",{className:n.buttonWrap},a().createElement(i.LinkButton,{variant:"secondary",href:(0,l.rs)(o.G3.fields,e.serviceScene)},"Return to all fields")))))}function p(e){const t=[...e.traces];return a().createElement("div",null,t.length&&a().createElement("div",null,1===t.length&&a().createElement(a().Fragment,null,a().createElement("strong",null,"TraceId"),": ",t[0]),t.length>1&&a().createElement(a().Fragment,null,a().createElement("strong",null,"TraceIds"),": ",t.join(", "))),a().createElement(g,{err:e.err,label:e.label}))}function g(e){var t;return(null===(t=e.err.message)||void 0===t?void 0:t.match(u))?a().createElement(a().Fragment,null,e.err.message&&a().createElement(a().Fragment,null,a().createElement("p",null,a().createElement("strong",null,"Max series limit exceeded"),": ",e.err.message,"."),a().createElement("p",null,"To increase this limit, adjust the"," ",a().createElement("a",{target:"_blank",href:"https://grafana.com/docs/loki/latest/configure/#limits_config",className:"external-link",rel:"noreferrer"},"max_query_series")," ","in your Loki configuration."),a().createElement("p",null,a().createElement("strong",null,"Tip:")," Reduce the time range, or add additional filters to reduce the number of unique values in the ",e.label," field."))):a().createElement(a().Fragment,null,e.err.message&&a().createElement("div",null,a().createElement("strong",null,"Message"),": ",e.err.message))}const h=e=>({buttonWrap:(0,s.css)({display:"flex",justifyContent:"flex-end"}),queryError:(0,s.css)({textAlign:"left"})})},79284:(e,t,n)=>{n.d(t,{D:()=>c});var r=n(85959),a=n.n(r),s=n(46089),i=n(82007);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const c=e=>{var{onChange:t,onClear:n,placeholder:r,suffix:s,value:c}=e,d=l(e,["onChange","onClear","placeholder","suffix","value"]);const p=(0,i.useStyles2)(u);return a().createElement(i.Input,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}({value:c,onChange:t,suffix:a().createElement("span",{className:p.suffixWrapper},n&&c?a().createElement(i.IconButton,{"aria-label":"Clear search",tooltip:"Clear search",onClick:n,name:"times",className:p.clearIcon}):void 0,s&&s),prefix:a().createElement(i.Icon,{name:"search"}),placeholder:r},d))},u=e=>({clearIcon:(0,s.css)({cursor:"pointer"}),suffixWrapper:(0,s.css)({display:"inline-flex",gap:e.spacing(.5)})})},42606:(e,t,n)=>{n.d(t,{X:()=>B});var r=n(85959),a=n.n(r),s=n(46089),i=n(93241),o=n(87781),l=n(76644),c=n(82007),u=n(77839),d=n(20376),p=n(66854),g=n(25953),h=n(67478),f=n(57985),v=n(69683),m=n(88100),b=n(53571),y=n(45553),S=n(90020),w=n(32085),O=n(61402),E=n(79405);function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _=function(e){return e.ns="ns",e.us="Âµs",e.ms="ms",e.s="s",e.m="m",e.h="h",e}(_||{});var C=function(e){return e.B="B",e.KB="KB",e.MB="MB",e.GB="GB",e.TB="TB",e}(C||{});class P extends l.Bs{onActivate(){const e=(0,y.bY)((0,E.ts)(this.state.labelName,this.state.variableType),this).state.filters.filter(e=>e.key===this.state.labelName),t=e.find(e=>e.operator===p.w7.gte||e.operator===p.w7.gt),n=e.find(e=>e.operator===p.w7.lte||e.operator===p.w7.lt);let r={};if("duration"===this.state.fieldType||"bytes"===this.state.fieldType){if(t){const e=k((0,y.bu)(t).value,this.state.fieldType);e&&(r.gt=e.value,r.gtu=e.unit,r.gte=t.operator===p.w7.gte)}if(n){const e=k((0,y.bu)(n).value,this.state.fieldType);e&&(r.lt=e.value,r.ltu=e.unit,r.lte=n.operator===p.w7.lte)}}else{if(t){const e=(0,y.bu)(t).value;r.gt=Number(e),r.gtu="",r.gte=t.operator===p.w7.gte}if(n){const e=(0,y.bu)(n).value;r.lt=Number(e),r.ltu="",r.lte=n.operator===p.w7.lte}}0!==Object.keys(r).length&&(r.hasExistingFilter=!0),this.setState(r)}onSubmit(){this.state.gt?(0,E.vn)(this.state.labelName,this.state.gt.toString()+this.state.gtu,this.state.gte?p.w7.gte:p.w7.gt,this,this.state.variableType):(0,E.u7)(this.state.labelName,this,this.state.gte?p.w7.gte:p.w7.gt,this.state.variableType),this.state.lt?(0,E.vn)(this.state.labelName,this.state.lt.toString()+this.state.ltu,this.state.lte?p.w7.lte:p.w7.lt,this,this.state.variableType):(0,E.u7)(this.state.labelName,this,this.state.lte?p.w7.lte:p.w7.lt,this.state.variableType);l.jh.getAncestor(this,B).togglePopover()}constructor(e){let t;const n=e.fieldType;if("bytes"===n)t={gtu:"B",ltu:"B"};else if("duration"===n)t={gtu:"s",ltu:"s"};else{if("float"!==n&&"int"!==n)throw new Error(`field type incorrectly defined: ${n}`);t={gtu:"",ltu:""}}super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){x(e,t,n[t])})}return e}({},e,t)),x(this,"onInputKeydown",e=>{const t=void 0===this.state.gt&&void 0===this.state.lt;"Enter"!==e.key||t||this.onSubmit()}),this.addActivationHandler(this.onActivate.bind(this))}}function k(e,t){if("duration"===t){const t=Object.values(_).find(t=>{const n=t.length;return e.slice(-1*n)===t});if(t){const n=Number(e.replace(t,""));if(!isNaN(n))return{unit:t,value:n}}}if("bytes"===t){const t=Object.values(C).sort((e,t)=>t.length-e.length).find(t=>{const n=t.length;return e.slice(-1*n)===t});if(t){const n=Number(e.replace(t,""));if(!isNaN(n))return{unit:t,value:n}}}}function L(e){if("duration"===e){return Object.keys(_).map(e=>({label:e,text:e,value:_[e]}))}if("bytes"===e){return Object.keys(C).map(e=>({label:e,text:e,value:C[e]}))}const t=new Error(`invalid field type: ${e}`);throw g.v.error(t,{msg:"getUnitOptions, invalid field type"}),t}x(P,"Component",({model:e})=>{const t=(0,c.useStyles2)(j),{fieldType:n,gt:r,gte:i,gtu:o,hasExistingFilter:u,labelName:d,lt:p,lte:g,ltu:h}=e.useState(),f="float"!==n&&"int"!==n&&n!==d?`(${n})`:void 0,v=l.jh.getAncestor(e,B),m=void 0===r&&void 0===p;return a().createElement(c.ClickOutsideWrapper,{useCapture:!0,onClick:()=>v.togglePopover()},a().createElement(c.Stack,{direction:"column",gap:0,role:"tooltip"},a().createElement("div",{className:t.card.body},a().createElement("div",{className:t.card.title},d," ",f),a().createElement("div",{className:t.card.fieldWrap},a().createElement(c.FieldSet,{className:t.card.fieldset},a().createElement(c.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputGreaterThanInclusive,horizontal:!0,className:(0,s.cx)(t.card.field,t.card.inclusiveField)},a().createElement(c.Select,{className:t.card.inclusiveInput,menuShouldPortal:!1,menuPosition:"absolute",value:void 0!==i?i.toString():"false",options:[{label:"Greater than",value:"false"},{label:"Greater than or equal",value:"true"}],onChange:t=>e.setState({gte:"true"===t.value})})),a().createElement(c.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputGreaterThan,horizontal:!0,className:t.card.field},a().createElement(c.Input,{onKeyDownCapture:e.onInputKeydown,autoFocus:!0,onChange:t=>{e.setState({gt:""!==t.currentTarget.value?Number(t.currentTarget.value):void 0})},className:t.card.numberInput,value:r,type:"number"})),"float"!==n&&"int"!==n&&a().createElement(c.Label,null,a().createElement(c.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputGreaterThanUnit,horizontal:!0,className:t.card.field,label:a().createElement("span",{className:t.card.unitFieldLabel},"Unit")},a().createElement(c.Select,{onChange:t=>{e.setState({gtu:t.value})},menuShouldPortal:!1,menuPosition:"absolute",options:L(n),className:t.card.selectInput,value:o})))),a().createElement(c.FieldSet,{className:t.card.fieldset},a().createElement(c.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputLessThanInclusive,horizontal:!0,className:(0,s.cx)(t.card.field,t.card.inclusiveField)},a().createElement(c.Select,{className:t.card.inclusiveInput,menuShouldPortal:!1,menuPosition:"absolute",value:void 0!==g?g.toString():"false",options:[{label:"Less than",value:"false"},{label:"Less than or equal",value:"true"}],onChange:t=>e.setState({lte:"true"===t.value})})),a().createElement(c.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputLessThan,horizontal:!0,className:t.card.field},a().createElement(c.Input,{onKeyDownCapture:e.onInputKeydown,onChange:t=>e.setState({lt:""!==t.currentTarget.value?Number(t.currentTarget.value):void 0}),className:t.card.numberInput,value:p,type:"number"})),"float"!==n&&"int"!==n&&a().createElement(c.Label,null,a().createElement(c.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputLessThanUnit,horizontal:!0,className:t.card.field,label:a().createElement("span",{className:t.card.unitFieldLabel},"Unit")},a().createElement(c.Select,{onChange:t=>{e.setState({ltu:t.value})},menuShouldPortal:!1,menuPosition:"absolute",options:L(n),className:t.card.selectInput,value:h}))))),a().createElement("div",{className:t.card.buttons},u&&a().createElement(c.Button,{"data-testid":b.b.breakdowns.common.filterNumericPopover.removeButton,disabled:!u,onClick:()=>{e.setState({gt:void 0,lt:void 0}),e.onSubmit()},size:"sm",variant:"destructive",fill:"outline"},"Remove"),a().createElement(c.Button,{"data-testid":b.b.breakdowns.common.filterNumericPopover.submitButton,disabled:m,onClick:()=>e.onSubmit(),size:"sm",variant:"primary",fill:"outline",type:"submit"},"Add"),a().createElement(c.Button,{"data-testid":b.b.breakdowns.common.filterNumericPopover.cancelButton,onClick:()=>v.togglePopover(),size:"sm",variant:"secondary",fill:"outline"},"Cancel")))))});const j=e=>({card:{body:(0,s.css)({padding:e.spacing(2)}),buttons:(0,s.css)({display:"flex",flexWrap:"wrap",gap:e.spacing(1.5),justifyContent:"flex-end",marginTop:e.spacing(1)}),field:(0,s.css)({alignItems:"center",display:"flex",marginBottom:e.spacing(1)}),fieldset:(0,s.css)({alignItems:"center",display:"flex",justifyContent:"space-between",marginBottom:0,width:"100%"}),fieldWrap:(0,s.css)({display:"flex",flexDirection:"column",paddingBottom:0,paddingTop:e.spacing(2)}),inclusiveField:(0,s.css)({marginRight:e.spacing(1)}),inclusiveInput:(0,s.css)({minWidth:"185px"}),numberFieldLabel:(0,s.css)({width:"100px"}),numberInput:(0,s.css)({width:"75px"}),p:(0,s.css)({maxWidth:300}),selectInput:(0,s.css)({minWidth:"65px"}),switchFieldLabel:(0,s.css)({marginLeft:e.spacing(2),marginRight:e.spacing(1)}),title:(0,s.css)({}),unitFieldLabel:(0,s.css)({marginLeft:e.spacing(2),marginRight:e.spacing(1.5)})}});function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){F(e,t,n[t])})}return e}function D(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const $="Include",N="Exclude",A="Add to filter";class B extends l.Bs{onChange(e){const t=this.getVariable(),n=t.state.name,r=this.getExistingFilter(t),a=(0,y.z2)(n,r);(null==r?void 0:r.operator)===p.w7.NotEqual&&a.value===S.ZO&&e.value===$?this.clearFilter(n):e.value===$?this.onClickExcludeEmpty(n):e.value===N?this.onClickIncludeEmpty(n):e.value===A&&this.onClickNumericFilter(n),this.setState({selectedValue:e})}getExistingFilter(e){let{labelName:t}=(0,v.MC)(this);if(this.state.labelName!==t)return null==e?void 0:e.state.filters.find(e=>e.key===this.state.labelName)}onActivate(){var e,t,n,r;const a=l.jh.getAncestor(this,O.Mn);(null===(t=a.state.$data)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.state)!==o.LoadingState.Done&&(null===(r=a.state.$data)||void 0===r||null===(n=r.state.data)||void 0===n?void 0:n.state)!==o.LoadingState.Error||this.calculateSparsity(),this._subs.add(l.jh.getData(this).subscribeToState(e=>{var t,n,r,s,i,l;(null===(t=e.data)||void 0===t?void 0:t.state)===o.LoadingState.Done&&((null===(r=a.state.$data)||void 0===r||null===(n=r.state.data)||void 0===n?void 0:n.state)!==o.LoadingState.Done&&(null===(i=a.state.$data)||void 0===i||null===(s=i.state.data)||void 0===s?void 0:s.state)!==o.LoadingState.Error||this.calculateSparsity(),this._subs.add(null===(l=a.state.$data)||void 0===l?void 0:l.subscribeToState(e=>{var t,n,r,s;(null===(n=a.state.$data)||void 0===n||null===(t=n.state.data)||void 0===t?void 0:t.state)!==o.LoadingState.Done&&(null===(s=a.state.$data)||void 0===s||null===(r=s.state.data)||void 0===r?void 0:r.state)!==o.LoadingState.Error||this.calculateSparsity()})))}))}togglePopover(){this.setState({showPopover:!this.state.showPopover})}calculateSparsity(){var e;const t=l.jh.getAncestor(this,O.Mn),n=(0,O.tn)(null===(e=t.state.$data)||void 0===e?void 0:e.state.data),r=null==n?void 0:n.fields.find(e=>"labels"===e.name),a=l.jh.getData(this),s=(0,m.UX)(a,e=>e instanceof l.dt,l.dt);if(s){const e=s.state.queries[0];var i;(0,f.lg)(null!==(i=null==e?void 0:e.expr)&&void 0!==i?i:"")&&this.setState({hasNumericFilters:!0})}if(!r||!n)return void this.setState({hasSparseFilters:!1});const o=this.getVariable(),c=r.values.reduce((e,t)=>((null==t?void 0:t[this.state.labelName])&&e++,e),0),u=l.jh.getAncestor(this,l.Eb);if(void 0!==c&&n.length>0){let e=this.state.description;void 0===this.state.description&&(e=(0,d.kz)(this,this.state.labelName).description),u.setState({description:e})}else u.setState({description:void 0});const p=this.getExistingFilter(o),g=p&&o.state.name===S.mB?(0,y.bu)(p):void 0;c<n.length||(null==g?void 0:g.value)===S.ZO?this.setState({hasSparseFilters:!0}):this.setState({hasSparseFilters:!1})}getVariable(){return this.state.fieldType===u._J.field?(0,y.ir)(this):this.state.labelName===S.e4?(0,y.iw)(this):(0,y.cR)(this)}constructor(e){super(D(T({},e),{showPopover:!1})),F(this,"onClickNumericFilter",e=>{const t=(0,O.rD)(this),n=(0,d.ph)(this.state.labelName,t);if(!n||"string"===n||"boolean"===n){const e=new Error(`Incorrect field type: ${n}`);throw g.v.error(e,{msg:`onClickNumericFilter invalid field type ${n}`}),e}this.setState({popover:new P({fieldType:n,labelName:this.state.labelName,variableType:e})}),this.togglePopover()}),F(this,"getViewValuesLink",()=>{const e=l.jh.getAncestor(this,O.Mn);return(0,h.FB)(this.state.fieldType,this.state.labelName,e)}),F(this,"onClickExcludeEmpty",e=>{(0,E.Qt)(this.state.labelName,S.ZO,"exclude",this,e)}),F(this,"onClickIncludeEmpty",e=>{(0,E.Qt)(this.state.labelName,S.ZO,"include",this,e)}),F(this,"clearFilter",e=>{(0,E.Qt)(this.state.labelName,S.ZO,"clear",this,e)}),F(this,"clearFilters",e=>{(0,E.hi)(this.state.labelName,this,e),this.state.labelName===S.e4&&(0,w.dm)(this)}),this.addActivationHandler(this.onActivate.bind(this))}}function M(e){const t=(0,c.useStyles2)(I);return a().createElement("span",{className:t.description},e.selected&&a().createElement("span",{className:t.selected}),e.text)}F(B,"Component",({model:e})=>{var t;const{fieldType:n,hasNumericFilters:s,hasSparseFilters:o,hideValueDrilldown:d,labelName:g,popover:h,selectedValue:f,showPopover:v}=e.useState(),m=e.getVariable(),w=m.useState().name,O=e.getExistingFilter(m),E=(0,y.z2)(w,O),x=(0,c.useStyles2)(R),_=(0,r.useRef)(null),C=n===u._J.label&&m.state.name===S.mB&&0===m.state.filters.filter(e=>e.key!==g&&e.operator===p.w7.Equal).length,P=(null==O?void 0:O.operator)===p.w7.NotEqual&&E.value===S.ZO,k=!!O;var L;const j=null!==(L=null==f?void 0:f.value)&&void 0!==L?L:P?$:s?A:$,F=!!(null==O?void 0:O.operator)&&[p.w7.gte,p.w7.gt,p.w7.lte,p.w7.lt].includes(O.operator),B=j===A||F,I=j===$&&!B,V={component:()=>a().createElement(M,{selected:I,text:`Include all log lines with ${g}`}),value:$},z={component:()=>a().createElement(M,{selected:!1,text:`Exclude all log lines with ${g}`}),value:N},q={component:()=>a().createElement(M,{selected:B,text:`Add an expression, i.e. ${g} > 30`}),value:A},G=[];s&&G.push(q),o&&(F||G.push(V),G.push(z));const U=P?V:s?q:V,W=l.jh.getAncestor(e,l.Eb),Q=l.jh.getData(W),{data:K}=Q.useState();var H;const J=(null!==(H=null==K?void 0:K.series.length)&&void 0!==H?H:0)>0;var Y;const X=(null!==(Y=null==K||null===(t=K.errors)||void 0===t?void 0:t.length)&&void 0!==Y?Y:0)>0,Z=!J&&X;var ee;return a().createElement(a().Fragment,null,k&&a().createElement(c.IconButton,{disabled:C,name:"filter",tooltip:`Clear ${g} filters`,onClick:()=>e.clearFilters(w)}),(s||o)&&a().createElement(a().Fragment,null,a().createElement(c.ButtonGroup,{"data-testid":b.b.breakdowns.common.filterButtonGroup},a().createElement(c.Button,{"data-testid":b.b.breakdowns.common.filterButton,ref:_,className:x.button,onClick:()=>e.onChange(null!=f?f:U),size:"sm",fill:"outline",variant:"secondary"},null!==(ee=null==f?void 0:f.value)&&void 0!==ee?ee:U.value),a().createElement(c.ButtonSelect,{"data-testid":b.b.breakdowns.common.filterSelect,className:x.buttonSelect,variant:"default",options:G,onChange:t=>{e.onChange(t)}}))),!0!==d&&a().createElement(c.LinkButton,{disabled:Z,title:`View breakdown of values for ${g}`,variant:"primary",fill:"outline",size:"sm","aria-label":`Select ${g}`,href:e.getViewValuesLink()},"Select"),h&&a().createElement(c.PopoverController,{content:a().createElement(h.Component,{model:h})},(e,t,n)=>{const r={onBlur:t,onFocus:e};return a().createElement(a().Fragment,null,_.current&&a().createElement(a().Fragment,null,a().createElement(c.Popover,T(D(T({},n,i.rest),{show:v,wrapperClassName:x.popover,referenceElement:_.current,renderArrow:!0}),r))))}))});const I=e=>({description:(0,s.css)({fontSize:e.typography.pxToRem(12),textAlign:"left"}),selected:(0,s.css)({"&:before":{backgroundColor:e.colors.warning.main,content:'""',height:"calc(100% - 8px)",left:0,position:"absolute",top:"4px",width:"2px"},label:"selectable-value-selected"})}),R=e=>({button:(0,s.css)({borderRight:"1px solid red"}),buttonSelect:(0,s.css)({border:`1px solid ${e.colors.border.strong}`,borderBottomLeftRadius:0,borderLeft:"none",borderTopLeftRadius:0,height:"24px",padding:1}),description:(0,s.css)({fontSize:e.typography.pxToRem(12),textAlign:"left"}),popover:(0,s.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`,borderRadius:e.shape.radius.default,boxShadow:e.shadows.z3})})},11049:(e,t,n)=>{n.d(t,{ee:()=>m,gf:()=>g,wd:()=>h});var r=n(85959),a=n.n(r),s=n(87781),i=n(76644),o=n(82007),l=n(52601),c=n(53571),u=n(5570),d=n(66732);function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g extends s.BusEventBase{constructor(e,t,n){super(),p(this,"target",void 0),p(this,"sortBy",void 0),p(this,"direction",void 0),this.target=e,this.sortBy=t,this.direction=n}}p(g,"type","sort-criteria-changed");class h extends i.Bs{constructor(e){const{direction:t,sortBy:n}=(0,d.vs)(e.target,l.DEFAULT_SORT_BY,"desc");super({direction:t,sortBy:n,target:e.target}),p(this,"sortingOptions",[{label:"",options:[{description:"Smart ordering of graphs based on the most significant spikes in the data",label:"Most relevant",value:"changepoint"},{description:"Order by the amount of outlying values in the data",label:"Outlying values",value:"outliers"},{description:"Sort graphs by deviation from the average value",label:"Widest spread",value:s.ReducerID.stdDev},{description:"Alphabetical order",label:"Name",value:"alphabetical"},{description:"Sort graphs by total number of logs",label:"Count",value:s.ReducerID.sum},{description:"Sort graphs by the highest values (max)",label:"Highest spike",value:s.ReducerID.max},{description:"Sort graphs by the smallest values (min)",label:"Lowest dip",value:s.ReducerID.min}]},{label:"Percentiles",options:[...s.fieldReducers.selectOptions([],v).options]}]),p(this,"onCriteriaChange",e=>{e.value&&(this.setState({sortBy:e.value}),(0,d.fq)(this.state.target,e.value,this.state.direction),this.publishEvent(new g(this.state.target,e.value,this.state.direction),!0))}),p(this,"onDirectionChange",e=>{e.value&&(this.setState({direction:e.value}),(0,d.fq)(this.state.target,this.state.sortBy,e.value),this.publishEvent(new g(this.state.target,this.state.sortBy,e.value),!0))})}}p(h,"Component",({model:e})=>{const{direction:t,sortBy:n}=e.useState(),r=e.sortingOptions.find(e=>e.options.find(e=>e.value===n)),s=null==r?void 0:r.options.find(e=>e.value===n);return a().createElement(a().Fragment,null,a().createElement(o.InlineField,{label:"Sort by",htmlFor:"sort-by-criteria",tooltip:"Calculate a derived quantity from the values in your time series and sort by this criteria. Defaults to standard deviation."},a().createElement(o.Select,{"data-testid":c.b.breakdowns.common.sortByFunction,value:s,width:20,isSearchable:!0,options:e.sortingOptions,placeholder:"Choose criteria",onChange:e.onCriteriaChange,inputId:"sort-by-criteria"})),a().createElement(o.InlineField,null,a().createElement(o.Select,{"data-testid":c.b.breakdowns.common.sortByDirection,onChange:e.onDirectionChange,"aria-label":"Sort direction",placeholder:"",value:t,options:[{label:"Asc",value:"asc"},{label:"Desc",value:"desc"}]})))});const f=["p10","p25","p75","p90","p99"];function v(e){return e.id>="p1"&&e.id<="p99"&&f.includes(e.id)}function m(e){var t;return null!==(t=(0,u.H7)(e))&&void 0!==t?t:"No labels"}},95659:(e,t,n)=>{n.d(t,{O:()=>o});var r=n(85959),a=n.n(r),s=n(46089),i=n(82007);function o({blockingMessage:e,children:t,isLoading:n}){const r=(0,i.useStyles2)(l);return n&&!e&&(e="Loading..."),n?a().createElement(i.LoadingPlaceholder,{className:r.statusMessage,text:e}):e?a().createElement("div",{className:r.statusMessage},e):a().createElement(a().Fragment,null,t)}function l(e){return{statusMessage:(0,s.css)({fontStyle:"italic",marginTop:e.spacing(7),textAlign:"center"})}}},24059:(e,t,n)=>{n.d(t,{l:()=>r});const r=20},61111:(e,t,n)=>{n.d(t,{iU:()=>B,Z:()=>F,mF:()=>N,jf:()=>$,EK:()=>j,fN:()=>D,vP:()=>A,sP:()=>I,eJ:()=>T,FN:()=>M,y:()=>R});var r=n(85959),a=n(87781),s=n(18531),i=n(76644),o=n(34509),l=n(20376),c=n(61402);var u=n(74247),d=n(48502),p=n(84586),g=n(45553);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){h(e,t,n[t])})}return e}function v(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function m(e,t){const n=(0,c.tn)(e),r=n?(0,a.sortDataFrame)(n,1,t.state.sortOrder===a.LogsSortOrder.Descending):void 0,i=null==r?void 0:r.fields.find(e=>e.type===a.FieldType.time),o=null==r?void 0:r.fields.find(e=>e.type===a.FieldType.other&&(0,l.gE)(e.name)),h=null==r?void 0:r.fields.find(e=>e.type===a.FieldType.other&&(0,l.at)(e.name)),m=(0,s.getTemplateSrv)(),b=m.replace.bind(m),y=(0,a.getTimeZone)();if(!r)return{data:void 0,rawFrame:void 0};const S=(0,g.U2)(t).state.filters.length>0;var w;const O=null!==(w=null==r?void 0:r.fields.filter(e=>e.config.links).map(e=>v(f({},e),{getLinks:(0,a.getLinksSupplier)(r,e,{},b)})))&&void 0!==w?w:[],E=v(f({},e),{series:[r].map(e=>v(f({},e),{fields:e.fields.map((e,n)=>(0,l.Z6)(e.name)?v(f({},e),{values:e.values.map((e,n)=>{var r,a,s;let l;try{l=JSON.parse(e)}catch(t){l=e}const c=null==o||null===(r=o.values)||void 0===r?void 0:r[n],g=null==h||null===(a=h.values)||void 0===a?void 0:a[n];let f={},v={};if(!S&&c&&g){Object.keys(c).forEach(e=>{d.rm.includes(e)||(g[e]===u.H.StructuredMetadata?f[e]=c[e]:g[e]===u.H.Indexed&&(v[e]=c[e]))})}const m={[F]:l,[j]:(0,p.yC)(null==i||null===(s=i.values)||void 0===s?void 0:s[n],y)};if(t.state.hasLabels&&Object.keys(v).length>0&&(m[B]=v),t.state.hasMetadata&&Object.keys(f).length>0&&(m[$]=f),void 0!==O){let e=function(e,t){let n={};return e.forEach(e=>{var r;const a=null==e||null===(r=e.getLinks)||void 0===r?void 0:r.call(e,{valueRowIndex:t});null==a||a.forEach(e=>{if(e.href){let r=e.title,a=e.origin.name,s=1;if(n[r]&&(r=r+" "+(s++).toString()),e.origin.values[t]){const t={href:e.href,name:a};n[r]=JSON.stringify(t)}}})}),n}(O,n);Object.keys(e).length&&(m[N]=e)}return m}).filter(e=>e)}):e)}))});return{data:E,rawFrame:r}}var b=n(88428),y=n(88100),S=n(75548),w=n(89924),O=n(36779),E=n(71014),x=n(25953),_=n(57985),C=n(66732);function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const L=(0,r.lazy)(()=>n.e(7).then(n.bind(n,7905))),j="Time",F="Line",T="Metadata",D="Labels",$="__Metadata",N="__Links",A="Links",B="__Labels",M="root";class I extends i.Bs{getUrlState(){return{sortOrder:JSON.stringify(this.state.sortOrder),wrapLogMessage:JSON.stringify(this.state.wrapLogMessage)}}updateFromUrl(e){try{let t={};if("string"==typeof e.sortOrder&&e.sortOrder){const n=(0,b.FH)(JSON.parse(e.sortOrder));n&&(t.sortOrder=n)}if("string"==typeof e.wrapLogMessage&&e.wrapLogMessage){const n=!!JSON.parse(e.wrapLogMessage);n&&(t.wrapLogMessage=n)}Object.keys(t).length&&this.setState(t)}catch(e){x.v.error(e,{msg:"JSONLogsScene: updateFromUrl unexpected error"})}}onActivate(){var e,t,n,r,s,u,d,p;this.setStateFromUrl();const g=i.jh.getAncestor(this,c.Mn);this.setState({emptyScene:new O.W({clearCallback:()=>(0,S.rA)(this)}),menu:new w.GD({})}),(0,y.nb)(i.jh.getAncestor(this,E.i));const h=i.jh.getData(this);(null===(e=h.state.data)||void 0===e?void 0:e.state)===a.LoadingState.Done&&this.updateJSONDataFrame(h.state.data),this._subs.add(h.subscribeToState(e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.state)===a.LoadingState.Done&&this.updateJSONDataFrame(e.data)})),(0,l.Ak)(this);const f=(0,c.UO)(null===(n=g.state)||void 0===n||null===(t=n.$detectedFieldsData)||void 0===t?void 0:t.state);var v,m;if(f&&f.length)void 0===!g.state.fieldsCount||g.state.fieldsCount!==(null==f?void 0:f.length)?null===(m=g.state)||void 0===m||null===(v=m.$detectedFieldsData)||void 0===v||v.runQueries():this.setVizFlags(f);else if(void 0===(null===(u=g.state)||void 0===u||null===(s=u.$detectedFieldsData)||void 0===s||null===(r=s.state.data)||void 0===r?void 0:r.state)){var b,x;null===(x=g.state)||void 0===x||null===(b=x.$detectedFieldsData)||void 0===b||b.runQueries()}this._subs.add(null===(p=g.state)||void 0===p||null===(d=p.$detectedFieldsData)||void 0===d?void 0:d.subscribeToState(e=>{var t,n;(null===(t=e.data)||void 0===t?void 0:t.state)===a.LoadingState.Done&&(null===(n=e.data)||void 0===n?void 0:n.series.length)&&this.setVizFlags(e.data.series[0])})),this._subs.add(this.subscribeToState((e,t)=>{!h.state.data||e.hasMetadata===t.hasMetadata&&e.hasLabels===t.hasLabels||this.updateJSONDataFrame(h.state.data)})),(0,o.EE)(o.NO.service_details,o.ir.service_details.visualization_init,{viz:"json"},!0)}updateJSONDataFrame(e){this.setState(m(e,this))}setStateFromUrl(){const e=new URLSearchParams(s.locationService.getLocation().search);this.updateFromUrl({sortOrder:e.get("sortOrder"),wrapLogMessage:e.get("wrapLogMessage")})}setVizFlags(e){var t,n,r;(null===(t=(0,l.$1)(e))||void 0===t?void 0:t.values.some(e=>"json"===e||"mixed"===e))?this.setState({hasJSONFields:!0,JSONFiltersSupported:null!==(r=null===(n=(0,l.VN)(e))||void 0===n?void 0:n.values.some(e=>void 0!==e))&&void 0!==r?r:null}):this.setState({hasJSONFields:!1})}constructor(e){super(k(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){P(e,t,n[t])})}return e}({},e),{hasHighlight:(0,C.MZ)(),hasLabels:(0,C.vC)(),hasMetadata:(0,C.Hn)(),sortOrder:(0,C.YM)("sortOrder",a.LogsSortOrder.Descending),wrapLogMessage:(0,C.IL)("wrapLogMessage",!0),JSONFiltersSupported:null})),P(this,"_urlSync",new i.So(this,{keys:["sortOrder","wrapLogMessage"]})),P(this,"handleSortChange",e=>{e!==this.state.sortOrder&&((0,C.YK)("sortOrder",e),(0,_.qp)(this),this.setState({sortOrder:e}))}),this.addActivationHandler(this.onActivate.bind(this))}}function R(e,t=":"){return e[0]!==j?e[0]+t:e[0]}P(I,"Component",L)},90072:(e,t,n)=>{n.d(t,{_:()=>T});var r=n(85959),a=n.n(r),s=n(46089),i=n(82007),o=n(53571),l=n(88428);function c(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}let p;const g=e=>{var{onChange:t,onClear:n,placeholder:s,regex:o,suffix:c,value:g,width:v}=e,m=d(e,["onChange","onClear","placeholder","regex","suffix","value","width"]);const b=(0,i.useStyles2)(f),[y,S]=(0,r.useState)(!1),[w,O]=(0,r.useState)(""),E=(0,r.useCallback)(e=>{if(!e||!o)return O(""),void S(!1);if(void 0!==p)try{null==p||p.compile(e),S(!1),O("")}catch(e){const t=(0,l.DU)(e);S(!0),t&&O(t)}else h().then(()=>E(e))},[o]);return(0,r.useEffect)(()=>{E(g)},[E,g]),a().createElement(i.Tooltip,{placement:"auto-start",show:!!w&&y,content:w},a().createElement(i.Input,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){u(e,t,n[t])})}return e}({invalid:y,"aria-invalid":y,rows:2,width:v,onFocusCapture:e=>{m.onFocus&&m.onFocus(e)},value:g,onChange:t,suffix:a().createElement("span",{className:b.suffixWrapper},n&&g?a().createElement(i.IconButton,{"aria-label":"Clear line filter",tooltip:"Clear line filter",onClick:n,name:"times",className:b.clearIcon}):void 0,c&&c),prefix:a().createElement(i.Icon,{name:"search"}),placeholder:s},m)))},h=()=>{return(e=function*(){p=null,p=(yield n.e(470).then(n.bind(n,44470))).RE2JS},function(){var t=this,n=arguments;return new Promise(function(r,a){var s=e.apply(t,n);function i(e){c(s,r,a,i,o,"next",e)}function o(e){c(s,r,a,i,o,"throw",e)}i(void 0)})})();var e},f=e=>({clearIcon:(0,s.css)({cursor:"pointer"}),suffixWrapper:(0,s.css)({display:"inline-flex",gap:e.spacing(.5)})});var v=n(87781),m=n(66854);function b(e){return{boxShadow:`0 0 0 2px ${e.colors.background.canvas}, 0 0 0px 4px ${e.colors.primary.main}`,outline:"2px dotted transparent",outlineOffset:"2px",transitionDuration:"0.2s",transitionProperty:"outline, outline-offset, box-shadow",transitionTimingFunction:"cubic-bezier(0.19, 1, 0.22, 1)"}}function y(e,t){return{[t.transitions.handleMotion("no-preference","reduce")]:{transitionDuration:"0.2s",transitionProperty:"opacity",transitionTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)"},borderRadius:t.shape.radius.default,content:'""',height:`${e}px`,opacity:"0",position:"absolute",width:`${e}px`,zIndex:"-1"}}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){S(e,t,n[t])})}return e}function O(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const E=e=>{const t=(0,i.useTheme2)(),n=e.caseSensitive?t.colors.text.maxContrast:t.colors.text.disabled,r=x(t),o=(e.caseSensitive?"Disable":"Enable")+" case match";return a().createElement(i.Tooltip,{content:o},a().createElement("button",{onClick:()=>e.onCaseSensitiveToggle(e.caseSensitive?m.ld.caseInsensitive:m.ld.caseSensitive),className:(0,s.cx)(r.button,e.caseSensitive?r.active:null),"aria-label":o},a().createElement("svg",{fill:n,width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},a().createElement("text",{fontSize:"13",width:"16",height:"16",x:"50%",y:"50%",dominantBaseline:"central",textAnchor:"middle"},"Aa"))))},x=(e,t="secondary")=>{const n=16+e.spacing.gridSize;return{active:(0,s.css)({"&:before":{backgroundColor:"secondary"===t?e.colors.action.hover:v.colorManipulator.alpha(e.colors.text.primary,.12),opacity:1},"&:hover":{"&:before":{backgroundColor:"none",opacity:0}}}),button:(0,s.css)({"&:before":O(w({},y(n,e)),{position:"absolute"}),"&:focus, &:focus-visible":b(e),"&:focus:not(:focus-visible)":{boxShadow:"none",outline:"none"},"&:hover":{"&:before":{backgroundColor:"secondary"===t?e.colors.action.hover:v.colorManipulator.alpha(e.colors.text.primary,.12),opacity:1}},alignItems:"center",background:"transparent",border:"none",boxShadow:"none",color:e.colors.text.primary,display:"inline-flex",justifyContent:"center",margin:`0 ${e.spacing.x0_5} 0 ${e.spacing.x0_5}`,padding:0,position:"relative",zIndex:0})}};function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){_(e,t,n[t])})}return e}function P(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const k=e=>{const t=(0,i.useTheme2)(),n=e.regex?t.colors.text.maxContrast:t.colors.text.disabled,r=L(t),o=(e.regex?"Disable":"Enable")+" regex";return a().createElement(i.Tooltip,{content:o},a().createElement("button",{onClick:()=>e.onRegexToggle(e.regex?"match":"regex"),className:(0,s.cx)(r.button,e.regex?r.active:null),"aria-label":o},a().createElement("svg",{fill:n,width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},a().createElement("text",{fontSize:"13",width:"16",height:"16",x:"50%",y:"50%",dominantBaseline:"central",textAnchor:"middle"},".*"))))},L=(e,t="secondary")=>{const n=16+e.spacing.gridSize;return{active:(0,s.css)({"&:before":{backgroundColor:"secondary"===t?e.colors.action.hover:v.colorManipulator.alpha(e.colors.text.primary,.12),opacity:1},"&:hover":{"&:before":{backgroundColor:"none",opacity:0}}}),button:(0,s.css)({"&:before":P(C({},y(n,e)),{position:"absolute"}),"&:focus, &:focus-visible":b(e),"&:focus:not(:focus-visible)":{boxShadow:"none",outline:"none"},"&:hover":{"&:before":{backgroundColor:"secondary"===t?e.colors.action.hover:v.colorManipulator.alpha(e.colors.text.primary,.12),opacity:1}},alignItems:"center",background:"transparent",border:"none",boxShadow:"none",color:e.colors.text.primary,display:"inline-flex",justifyContent:"center",margin:`0 ${e.spacing.x0_5} 0 ${e.spacing.x0_5}`,padding:0,position:"relative",zIndex:0})}},j=30,F=29;function T({caseSensitive:e,exclusive:t,focus:n,handleEnter:l,lineFilter:c,onCaseSensitiveToggle:u,onClearLineFilter:d,onInputChange:p,onRegexToggle:h,onSubmitLineFilter:f,regex:v,setExclusive:m,setFocus:b,type:y}){const S=(0,i.useStyles2)(e=>D(e,y)),[w,O]=(0,r.useState)(j);function x(e){var t;const n=Math.max(null!==(t=null==e?void 0:e.length)&&void 0!==t?t:0,j);O(n+9)}return(0,r.useEffect)(()=>{x(c)},[c,n]),a().createElement("div",{className:S.wrapper},!f&&a().createElement(i.Select,{prefix:null,className:S.select,value:t?"exclusive":"inclusive",options:[{label:"Exclude",value:"exclusive"},{label:"Include",value:"inclusive"}],onChange:()=>m(!t)}),a().createElement(i.Field,{className:S.field},a().createElement(g,{regex:v,width:n?w:F,onFocus:()=>b(!0),"data-testid":o.b.exploreServiceDetails.searchLogs,value:null!=c?c:"",className:(0,s.cx)(f?S.inputNoBorderRight:void 0,S.input),onChange:p,suffix:a().createElement("span",{className:`${S.suffix} input-suffix`},a().createElement(E,{caseSensitive:e,onCaseSensitiveToggle:u}),a().createElement(k,{regex:v,onRegexToggle:h})),prefix:null,placeholder:"Filter logs by string",onClear:d,onKeyUp:e=>{l(e,c),x(c)}})),f&&a().createElement("span",{className:S.buttonWrap},a().createElement(i.Button,{onClick:()=>{m(!1),f()},className:S.includeButton,variant:"secondary",fill:"outline",disabled:!c},"Include"),a().createElement(i.Button,{onClick:()=>{m(!0),f()},className:S.excludeButton,variant:"secondary",fill:"outline",disabled:!c},"Exclude")))}const D=(e,t)=>({buttonWrap:(0,s.css)({display:"flex",justifyContent:"center"}),excludeButton:(0,s.css)({"&[disabled]":{borderLeft:"none"},borderLeft:"none",borderRadius:"0"}),exclusiveBtn:(0,s.css)({marginRight:"1rem"}),field:(0,s.css)({flex:"0 1 auto",label:"field",marginBottom:0}),includeButton:(0,s.css)({"&[disabled]":{borderRight:"none"},borderLeft:"none",borderRadius:0,borderRight:"none"}),input:(0,s.css)({input:{borderBottomLeftRadius:0,borderTopLeftRadius:0,fontFamily:"monospace",fontSize:e.typography.bodySmall.fontSize,width:"100%"},label:"line-filter-input-wrapper",maxWidth:"editor"===t?"calc(100vw - 198px)":"calc(100vw - 288px)",minWidth:"200px"}),inputNoBorderRight:(0,s.css)({input:{borderBottomRightRadius:0,borderTopRightRadius:0}}),removeBtn:(0,s.css)({borderBottomLeftRadius:0,borderTopLeftRadius:0}),select:(0,s.css)({borderBottomRightRadius:"0",borderRight:"none",borderTopRightRadius:"0",height:"auto",label:"line-filter-exclusion",marginLeft:0,maxWidth:"95px",minHeight:"30px",minWidth:"95px",outline:"none",paddingLeft:0}),submit:(0,s.css)({borderBottomLeftRadius:0,borderTopLeftRadius:0}),suffix:(0,s.css)({display:"inline-flex",gap:e.spacing(.5)}),wrapper:(0,s.css)({display:"flex",width:"100%"})})},75108:(e,t,n)=>{n.d(t,{Vn:()=>h});var r=n(85959),a=n.n(r),s=n(46089),i=n(87781),o=n(35591),l=n(82007);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const d=a().forwardRef((e,t)=>{var{stickToBottom:n,expanded:r,label:s,tooltip:i,className:o,name:d}=e,g=u(e,["stickToBottom","expanded","label","tooltip","className","name"]);const h=(0,l.useStyles2)(p,r);return a().createElement("div",{className:`${h.container} ${n?h.marginTopAuto:""}`},a().createElement("label",{className:h.label},a().createElement("span",{className:h.labelText},null!=s?s:i),a().createElement("span",{className:h.iconContainer},a().createElement(l.IconButton,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}({name:d,tooltip:i,className:o,ref:t},g)))))}),p=(e,t)=>({marginTopAuto:(0,s.css)({marginTop:"auto",marginBottom:e.spacing(1)}),labelText:(0,s.css)({display:t?"block":"none"}),iconContainer:(0,s.css)({display:"flex",alignItems:"center",height:"16px"}),container:(0,s.css)({fontSize:e.typography.pxToRem(12),height:e.spacing(2),width:"auto"}),label:(0,s.css)({display:"flex",justifyContent:t?"space-between":"center",marginRight:t?"2.5px":0})});d.displayName="LogListControlsOption";var g=n(28544);const h=({disabledLineState:e,lineState:t,onLineStateClick:n,onScrollToBottomClick:c,onScrollToTopClick:u,onSortOrderChange:p,onToggleHighlightClick:h,onToggleLabelsClick:v,onToggleStructuredMetadataClick:m,onWrapLogMessageClick:b,showHighlight:y,showLabels:S,showMetadata:w,sortOrder:O,wrapLogMessage:E,controlsExpanded:x,onExpandControlsClick:_})=>{const C=(0,l.useStyles2)(f,x),P=(0,r.useCallback)(()=>{p(O===i.LogsSortOrder.Ascending?i.LogsSortOrder.Descending:i.LogsSortOrder.Ascending)},[p,O]);return a().createElement("div",{className:C.navContainer},a().createElement(d,{expanded:x,name:"arrow-from-right",className:(0,s.cx)(C.controlButton,C.controlsExpandedButton),variant:"secondary",onClick:_,label:x?(0,o.t)("logs.logs-controls.label.collapse","Expanded"):(0,o.t)("logs.logs-controls.label.expand","Collapsed"),tooltip:x?(0,o.t)("logs.logs-controls.collapse","Collapse"):(0,o.t)("logs.logs-controls.expand","Expand"),size:"lg"}),c&&a().createElement(d,{expanded:x,name:"arrow-down",className:C.controlButton,variant:"secondary",onClick:c,tooltip:(0,o.t)("logs.logs-controls.scrollToBottom","Scroll to bottom"),size:"lg"}),a().createElement(d,{expanded:x,name:O===i.LogsSortOrder.Descending?"sort-amount-up":"sort-amount-down",className:C.controlButton,onClick:P,tooltip:O===i.LogsSortOrder.Descending?(0,o.t)("logs.logs-controls.tooltip.sort.oldest-first","Set oldest logs first"):(0,o.t)("logs.logs-controls.tooltip.sort.newest-first","Set newest logs first"),label:O===i.LogsSortOrder.Descending?(0,o.t)("logs.logs-controls.labels.sort.oldest-first","Newest logs first"):(0,o.t)("logs.logs-controls.labels.sort.newest-first","Oldest logs first"),size:"lg"}),void 0!==E&&b&&a().createElement(d,{expanded:x,name:"wrap-text",className:E?C.controlButtonActive:C.controlButton,"aria-pressed":E,onClick:()=>b(!E),label:E?(0,o.t)("logs.logs-controls.label.unwrap-lines","Wrap lines"):(0,o.t)("logs.logs-controls.label.wrap-lines","Unwrap lines"),tooltip:E?(0,o.t)("logs.logs-controls.unwrap-lines","Unwrap lines"):(0,o.t)("logs.logs-controls.wrap-lines","Wrap lines"),size:"lg"}),void 0!==w&&m&&a().createElement(d,{expanded:x,name:"document-info","aria-pressed":w,className:w?C.controlButtonActive:C.controlButton,onClick:()=>m(!w),tooltip:w?(0,o.t)("logs.logs-controls.json.tooltip.metadata.disable","Hide structured metadata"):(0,o.t)("logs.logs-controls.json.tooltip.metadata.enable","Show structured metadata"),label:w?(0,o.t)("logs.logs-controls.json.label.metadata.disable","Show metadata"):(0,o.t)("logs.logs-controls.json.label.metadata.enable","Hide metadata"),size:"lg"}),void 0!==S&&v&&a().createElement(d,{expanded:x,name:"tag-alt","aria-pressed":S,className:S?C.controlButtonActive:C.controlButton,onClick:()=>v(!S),tooltip:S?(0,o.t)("logs.logs-controls.json.tooltip.labels.disable","Hide Labels"):(0,o.t)("logs.logs-controls.json.tooltip.labels.enable","Show labels"),label:S?(0,o.t)("logs.logs-controls.json.tooltip.labels.enable","Show labels"):(0,o.t)("logs.logs-controls.json.tooltip.labels.disable","Hide Labels"),size:"lg"}),void 0!==y&&h&&a().createElement(d,{expanded:x,name:"brackets-curly","aria-pressed":y,className:y?C.controlButtonActive:C.controlButton,onClick:()=>h(!y),tooltip:y?(0,o.t)("logs.logs-controls.tooltip.highlight.disable","Disable highlighting"):(0,o.t)("logs.logs-controls.tooltip.highlight.enable","Enable highlighting"),label:y?(0,o.t)("logs.logs-controls.label.highlight.enable","Highlight enabled"):(0,o.t)("logs.logs-controls.label.highlight.disable","Highlight disabled"),size:"lg"}),n&&t&&a().createElement(d,{expanded:x,disabled:e,name:t===g.Wg.text?"tag-alt":"text-fields",className:C.controlButton,onClick:n,tooltip:t===g.Wg.text?(0,o.t)("logs.logs-controls.table.tooltip.show-labels","Show labels"):(0,o.t)("logs.logs-controls.table.tooltip.show-text","Show log text"),label:t===g.Wg.text?(0,o.t)("logs.logs-controls.table.label.show-labels","Log text"):(0,o.t)("logs.logs-controls.table.label.show-text","Log labels"),size:"lg"}),u&&a().createElement(d,{stickToBottom:!0,expanded:x,name:"arrow-up","data-testid":"scrollToTop",variant:"secondary",onClick:u,tooltip:(0,o.t)("logs.logs-controls.scrollToTop","Scroll to top"),size:"lg"}))},f=(e,t)=>({controlsExpandedButton:(0,s.css)({transform:t?"":"rotate(180deg)"}),controlButton:(0,s.css)({color:e.colors.text.secondary,height:e.spacing(2),margin:0}),controlButtonActive:(0,s.css)({"&:after":{backgroundImage:e.colors.gradients.brandHorizontal,borderRadius:e.shape.radius.default,bottom:e.spacing(-1),content:'" "',display:"block",height:2,opacity:1,position:"absolute",width:"95%"},color:e.colors.text.secondary,height:e.spacing(2),margin:0}),divider:(0,s.css)({borderTop:`solid 1px ${e.colors.border.medium}`,height:1,marginBottom:e.spacing(-1.75),marginTop:e.spacing(-.25)}),navContainer:(0,s.css)({borderLeft:`solid 1px ${e.colors.border.medium}`,display:"flex",flexDirection:"column",gap:e.spacing(3),justifyContent:"flex-start",maxHeight:"100%",overflow:"hidden",paddingLeft:e.spacing(1),paddingTop:e.spacing(.75),width:t?176:35}),scrollToTopButton:(0,s.css)({color:e.colors.text.secondary,height:e.spacing(2),margin:0,marginTop:"auto"})})},91603:(e,t,n)=>{n.d(t,{IJ:()=>P,ZB:()=>E,Q8:()=>C,PY:()=>x,hC:()=>k});var r=n(85959),a=n.n(r),s=n(46089),i=n(87781),o=n(35591),l=n(18531),c=n(76644),u=n(82007),d=n(25953),p=n(88428),g=n(9641),h=n(34509),f=n(71014),v=n(61402);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class b extends c.Bs{constructor(...e){super(...e),m(this,"getLogsListScene",()=>c.jh.getAncestor(this,f.i)),m(this,"showBackendFields",()=>{this.getLogsListScene().showBackendFields(),(0,h.EE)(h.NO.service_details,h.ir.service_details.logs_show_backend_fields)}),m(this,"clearDisplayedFields",()=>{this.getLogsListScene().clearDisplayedFields(),(0,h.EE)(h.NO.service_details,h.ir.service_details.logs_clear_displayed_fields)})}}m(b,"Component",function({model:e}){const t=c.jh.getAncestor(e,v.Mn),{backendDisplayedFields:n}=t.useState(),{displayedFields:s,otelDisplayedFields:o}=e.getLogsListScene().useState(),l=(0,r.useMemo)(()=>s.map(k).join(", "),[s]),d=(0,r.useMemo)(()=>null==n?void 0:n.map(k).join(", "),[n]),p=s.length>0,g=n&&(null==n?void 0:n.length)>0,h=!p||1===s.length&&s[0]===P;return a().createElement(a().Fragment,null,!h&&p&&!(0,i.shallowCompare)(s,o)&&a().createElement(u.Tooltip,{content:`Clear displayed fields: ${l}`},a().createElement(u.Button,{size:"sm",variant:"secondary",fill:"outline",onClick:e.clearDisplayedFields},"Show original log line")),g&&!(0,i.shallowCompare)(s,n)&&a().createElement(u.Tooltip,{content:`Show default fields: ${d}`},a().createElement(u.Button,{size:"sm",variant:"secondary",fill:"outline",onClick:e.showBackendFields},"Show default fields")))});var y=n(51712),S=n(34907),w=n(66732);function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class E extends c.Bs{onActivate(){this.setState({buttonRendererScene:new b({})})}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){O(e,t,n[t])})}return e}({},e)),O(this,"handleWrapLinesChange",e=>{this.getLogsPanelScene().setState({prettifyLogMessage:e,wrapLogMessage:e}),(0,w.YK)("wrapLogMessage",e),(0,w.YK)("prettifyLogMessage",e),this.getLogsListScene().setLogsVizOption({prettifyLogMessage:e,wrapLogMessage:e})}),O(this,"onChangeLogsSortOrder",e=>{this.getLogsPanelScene().setState({sortOrder:e}),(0,w.YK)("sortOrder",e),this.getLogsListScene().setLogsVizOption({sortOrder:e})}),O(this,"getLogsListScene",()=>c.jh.getAncestor(this,f.i)),O(this,"getLogsPanelScene",()=>c.jh.getAncestor(this,y.o)),this.addActivationHandler(this.onActivate.bind(this))}}function x(){const e=l.locationService.getLocation(),t=new URLSearchParams(e.search).get("sortOrder");try{if("string"==typeof t){const e=(0,p.FH)(JSON.parse(t));if(e)return e}}catch(e){d.v.error(e,{msg:"LogOptionsScene(getLogsPanelSortOrderFromURL): unable to parse sortOrder"})}return!1}O(E,"Component",function({model:e}){const{onChangeVisualizationType:t,visualizationType:n,buttonRendererScene:r}=e.useState(),{sortOrder:s,wrapLogMessage:o}=e.getLogsPanelScene().useState(),l=(0,u.useStyles2)(_),c=null!=o&&o;return a().createElement("div",{className:l.container},r&&a().createElement(r.Component,{model:r}),!S.CT&&a().createElement(a().Fragment,null,a().createElement(u.InlineField,{className:l.buttonGroupWrapper,transparent:!0},a().createElement(u.RadioButtonGroup,{size:"sm",options:[{description:"Show results newest to oldest",label:"Newest first",value:i.LogsSortOrder.Descending},{description:"Show results oldest to newest",label:"Oldest first",value:i.LogsSortOrder.Ascending}],value:s,onChange:e.onChangeLogsSortOrder})),a().createElement(u.InlineField,{className:l.buttonGroupWrapper,transparent:!0},a().createElement(u.RadioButtonGroup,{size:"sm",value:c,onChange:e.handleWrapLinesChange,options:[{description:"Enable wrapping of long log lines",label:"Wrap",value:!0},{description:"Disable wrapping of long log lines",label:"No wrap",value:!1}]}))),a().createElement(g.C,{vizType:n,onChange:t}))});const _=e=>({buttonGroupWrapper:(0,s.css)({alignItems:"center",margin:0}),container:(0,s.css)({alignItems:"center",display:"flex",gap:e.spacing(1)})}),C="___OTEL_LOG_ATTRIBUTES___",P="___LOG_LINE_BODY___";function k(e){return e===P?(0,o.t)("logs.logs-drilldown.fields.log-line-field","Log line"):e===C?(0,o.t)("logs.logs-drilldown.fields.log-attributes-field","Log attributes"):e}},71014:(e,t,n)=>{n.d(t,{i:()=>ie});var r=n(85959),a=n.n(r),s=n(46089),i=n(87781),o=n(18531),l=n(76644),c=n(34509),u=n(21532),d=n(25953),p=n(88428),g=n(69683),h=n(45553),f=n(75548),v=n(41745),m=n(28544),b=n(5378),y=n(61111),S=n(46177),w=n.n(S),O=n(66854),E=n(67478),x=n(66732),_=n(90072);function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class P extends l.Bs{clearVariable(){(0,h.Rr)(this).updateFilters([],{skipPublish:!0}),this.setState({lineFilter:""})}getOperator(){if(this.state.regex&&this.state.exclusive)return O.cK.negativeRegex;if(this.state.regex&&!this.state.exclusive)return O.cK.regex;if(!this.state.regex&&this.state.exclusive)return O.cK.negativeMatch;if(!this.state.regex&&!this.state.exclusive)return O.cK.match;throw new Error("getOperator: failed to determine operation")}getFilterKey(){return this.state.caseSensitive?O.ld.caseSensitive:O.ld.caseInsensitive}getFilter(){return(0,h.Rr)(this).state.filters[0]}updateFilter(e,t=!0){this.updateInputState(e),t?this.updateVariableDebounced(e):this.updateVariable(e)}updateInputState(e){this.setState({lineFilter:e})}constructor(e){var t,n,r,a;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){C(e,t,n[t])})}return e}({caseSensitive:null!==(t=null==e?void 0:e.caseSensitive)&&void 0!==t?t:(0,x.hp)(!1),exclusive:null!==(n=null==e?void 0:e.exclusive)&&void 0!==n?n:(0,x.Zs)(!1),lineFilter:null!==(r=null==e?void 0:e.lineFilter)&&void 0!==r?r:"",regex:null!==(a=null==e?void 0:e.regex)&&void 0!==a?a:(0,x.og)(!1)},e)),C(this,"onActivate",()=>{const e=this.getFilter();if(e)return this.setState({caseSensitive:e.key===O.ld.caseSensitive,exclusive:e.operator===O.cK.negativeMatch||e.operator===O.cK.negativeRegex,lineFilter:e.value,regex:e.operator===O.cK.regex||e.operator===O.cK.negativeRegex}),()=>{this.clearFilter()}}),C(this,"clearFilter",()=>{this.updateVariableDebounced.cancel(),this.updateFilter("",!1)}),C(this,"onToggleExclusive",e=>{(0,x.Bq)(e),this.setState({exclusive:e}),this.updateFilter(this.state.lineFilter,!1)}),C(this,"onSubmitLineFilter",()=>{(0,E.bN)(),this.updateFilter(this.state.lineFilter,!1),this.updateVariableDebounced.flush();const e=(0,h.Gk)(this),t=e.state.filters,n=this.getFilter();e.updateFilters([...t,n]),this.clearVariable()}),C(this,"handleChange",e=>{this.updateInputState(e.target.value)}),C(this,"handleEnter",e=>{"Enter"===e.key&&this.state.lineFilter&&this.onSubmitLineFilter()}),C(this,"onCaseSensitiveToggle",e=>{const t=e===O.ld.caseSensitive;this.setState({caseSensitive:t}),(0,x.Xo)(t),this.updateFilter(this.state.lineFilter,!1)}),C(this,"onRegexToggle",e=>{const t="regex"===e;this.setState({regex:t}),(0,x.GL)(t),this.updateFilter(this.state.lineFilter,!1)}),C(this,"updateVariableDebounced",w()(e=>{this.updateVariable(e)},1e3)),C(this,"updateVariable",e=>{this.updateVariableDebounced.flush();const t=(0,h.Rr)(this),n=(0,h.Gk)(this),r={key:this.getFilterKey(),keyLabel:n.state.filters.length.toString(),operator:this.getOperator(),value:null!=e?e:""};t.updateFilters([r]),(0,c.EE)(c.NO.service_details,c.ir.service_details.search_string_in_logs_changed,{caseSensitive:r.key,containsLevel:null==e?void 0:e.toLowerCase().includes("level"),operator:r.operator,searchQueryLength:null==e?void 0:e.length})}),this.addActivationHandler(this.onActivate)}}C(P,"Component",function({model:e}){const{caseSensitive:t,exclusive:n,lineFilter:a,regex:s}=e.useState(),[i,o]=(0,r.useState)(!1);return(0,_._)({caseSensitive:t,exclusive:n,focus:i,handleEnter:e.handleEnter,lineFilter:a,onCaseSensitiveToggle:e.onCaseSensitiveToggle,onClearLineFilter:e.clearFilter,onInputChange:e.handleChange,onRegexToggle:e.onRegexToggle,onSubmitLineFilter:e.onSubmitLineFilter,regex:s,setExclusive:e.onToggleExclusive,setFocus:o,type:"editor",updateFilter:e.updateFilter})});var k=n(35591),L=n(82007),j=n(57985);function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}class D extends l.Bs{constructor(e={}){super(T(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){F(e,t,n[t])})}return e}({},e),{maxLinesOptions:[],isInvalid:!1})),F(this,"onActivate",()=>{const e=(0,x.w0)(this);this.setState({maxLines:e,maxLinesOptions:N(e),isInvalid:!1})}),F(this,"validateMaxLines",e=>{if(!e)return!1;const t="string"==typeof e?Number(e):e;return!(isNaN(t)||t<=0||!Number.isInteger(t))}),F(this,"onChangeMaxLines",e=>{this.validateMaxLines(e.value)?this.setState({isInvalid:!1}):this.setState({isInvalid:!0});const t=e.value;(0,x.wQ)(this,t),this.setState({maxLines:t}),(0,j.qp)(this),(0,o.reportInteraction)("grafana_logs_app_line_limit_changed",{maxLines:t})}),this.addActivationHandler(this.onActivate)}}F(D,"Component",function({model:e}){const{error:t,maxLines:n,maxLinesOptions:r,isInvalid:s}=e.useState(),i=(0,L.useStyles2)($),o=null==t?void 0:t.toLowerCase().includes("max entries limit");return a().createElement("div",{className:i.container},n&&r.length>0&&a().createElement(L.InlineField,{className:i.label,label:(0,k.t)("logs.log-options.max-lines-label","Line limit"),tooltip:(0,k.t)("logs.log-options.max-lines-tooltip","Number of log lines to request. Depends on the Loki configuration value for max_entries_limit."),invalid:s||o},a().createElement(L.Combobox,{options:r,value:n,width:"auto",minWidth:8,onChange:e.onChangeMaxLines,placeholder:(0,k.t)("logs.log-options.max-lines-label","{{logs}} logs",{logs:n}),createCustomValue:!0})))});const $=e=>({container:(0,s.css)({display:"flex",flexDirection:"column",gap:e.spacing(.5)}),label:(0,s.css)({marginRight:0})});function N(e){const t=[{value:100,label:"100"},{value:500,label:"500"},{value:1e3,label:"1000"},{value:2e3,label:"2000"},{value:5e3,label:"5000"}];if(t.find(t=>t.value===e))return t;let n=t.findIndex(t=>t.value>e);return n=n<=0?0:n,t.splice(n,0,{value:e,label:e.toString()}),t}var A=n(51712),B=n(20376),M=n(80042),I=n(88100),R=n(89924),V=n(15091),z=n(9641),q=n(79405),G=n(36779),U=n(75108),W=n(91603),Q=n(21736),K=n(61402),H=n(52165),J=n(34907);function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const Z=(0,r.lazy)(()=>Promise.all([n.e(755),n.e(379),n.e(727)]).then(n.bind(n,24727)));class ee extends l.Bs{setStateFromUrl(){const e=new URLSearchParams(o.locationService.getLocation().search);this.updateFromUrl({sortOrder:e.get("sortOrder")})}getUrlState(){return{sortOrder:JSON.stringify(this.state.sortOrder)}}updateFromUrl(e){try{if("string"==typeof e.sortOrder&&e.sortOrder){const t=(0,p.FH)(JSON.parse(e.sortOrder));t&&this.setState({sortOrder:t})}}catch(e){d.v.error(e,{msg:"LogsTableScene: updateFromUrl unexpected error"})}}onActivate(){this.setState({emptyScene:new G.W({clearCallback:()=>(0,f.rA)(this)}),menu:new R.GD({})}),(0,I.nb)(this.getParentScene()),this.setStateFromUrl(),this._subs.add(o.locationService.getHistory().listen(()=>{this.subscribeFromUrl()})),this.onLoadSyncDisplayedFieldsWithUrlColumns(),(0,c.EE)(c.NO.service_details,c.ir.service_details.visualization_init,{viz:"table"},!0)}getParentScene(){return l.jh.getAncestor(this,ie)}constructor(e){super(X(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Y(e,t,n[t])})}return e}({},e),{sortOrder:(0,x.YM)("sortOrder",i.LogsSortOrder.Descending),isDisabledLineState:!1})),Y(this,"_urlSync",new l.So(this,{keys:["sortOrder","urlColumns"]})),Y(this,"subscribeFromUrl",()=>{const e=new URLSearchParams(o.locationService.getLocation().search);let t=[];try{var n;t=(0,p.aJ)(JSON.parse(decodeURIComponent(null!==(n=e.get("urlColumns"))&&void 0!==n?n:""))),t.includes(H.eB)||t.includes(H.wu)?this.setState({isDisabledLineState:!0}):this.setState({isDisabledLineState:!1})}catch(e){console.error("Error parsing urlColumns:",e)}}),Y(this,"onLoadSyncDisplayedFieldsWithUrlColumns",()=>{const e=new URLSearchParams(o.locationService.getLocation().search);let t=[];try{var n;t=(0,p.aJ)(JSON.parse(decodeURIComponent(null!==(n=e.get("urlColumns"))&&void 0!==n?n:""))),(t.includes(H.eB)||t.includes(H.wu))&&this.setState({isDisabledLineState:!0})}catch(e){console.error(e)}const r=this.getParentScene(),a=r.state.displayedFields.filter(e=>e!==W.Q8);t.length>0&&r.state.displayedFields.length>0&&r.setState({urlColumns:Array.from(new Set([...t,...a]))})}),Y(this,"updateDisplayedFields",e=>{const t=this.getParentScene(),n=this.findDefaultUrlColumns(e);n.includes(H.eB)||n.includes(H.wu)?this.setState({isDisabledLineState:!0}):this.setState({isDisabledLineState:!1});const r=this.hasDetectedLevel(),a=[...n];r&&a.push(r);const s=Array.from(new Set([...e||[]])).filter(e=>!a.includes(e));t.setState({displayedFields:s}),(0,x.vt)(this,t.state.displayedFields)}),Y(this,"findDefaultUrlColumns",e=>{let t=V.OG;return t=t.reduce((t,n)=>{if(e.includes(n)){t[e.indexOf(n)]=n}return t},[]),t}),Y(this,"hasDetectedLevel",()=>{var e;const t=l.jh.getData(this).state.data;if(!(null==t||null===(e=t.series)||void 0===e?void 0:e.length))return null;const n=(0,M.uV)(t.series);return n.includes(V.mJ)?V.mJ:n.includes(V.Bk)?V.Bk:null}),Y(this,"handleSortChange",e=>{e!==this.state.sortOrder&&((0,x.YK)("sortOrder",e),(0,j.qp)(this),this.setState({sortOrder:e}))}),Y(this,"onLineStateClick",()=>{const e=l.jh.getAncestor(this,ie),{tableLogLineState:t}=e.state;e.setState({tableLogLineState:t===m.Wg.text?m.Wg.labels:m.Wg.text}),(0,x.bq)(t===m.Wg.text?m.Wg.labels:m.Wg.text)}),this.addActivationHandler(this.onActivate.bind(this))}}Y(ee,"Component",({model:e})=>{const t=(0,L.useStyles2)(te),n=l.jh.getAncestor(e,ie),{error:s,errorType:i,canClearFilters:o}=e.useState(),{data:c}=l.jh.getData(e).useState(),{selectedLine:d,tableLogLineState:p,urlColumns:g,visualizationType:h}=n.useState(),{emptyScene:v,menu:b,sortOrder:y}=e.useState(),S=l.jh.getTimeRange(e),{value:w}=S.useState(),O=(0,K.tn)(c),E=(0,r.useRef)(null),_=n.state.controlsExpanded;var C,P;return a().createElement("div",{className:t.panelWrapper},!s&&a().createElement(a().Fragment,null,a().createElement(L.PanelChrome,{loadingState:null==c?void 0:c.state,title:"Logs",menu:b?a().createElement(b.Component,{model:b}):void 0,showMenuAlways:!0,actions:a().createElement(a().Fragment,null,a().createElement(z.C,{vizType:h,onChange:n.setVisualizationType}))},a().createElement("div",{className:t.container},J.CT&&O&&O.length>0&&a().createElement(U.Vn,{controlsExpanded:_,onExpandControlsClick:()=>{n.setState({controlsExpanded:!_}),(0,x.YK)("controlsExpanded",!_)},sortOrder:y,onSortOrderChange:e.handleSortChange,onLineStateClick:e.onLineStateClick,lineState:null!==(C=null!=p?p:(0,x.D8)())&&void 0!==C?C:m.Wg.text,disabledLineState:!e.state.isDisabledLineState}),a().createElement("div",{className:t.tableContainer,ref:E},O&&a().createElement(Z,{controlsExpanded:_,panelWrap:E,addFilter:t=>{const r=(0,B.OE)(O,t.key,e);(0,q.XI)(t,n,r)},timeRange:w,selectedLine:d,urlColumns:null!=g?g:[],displayFields:n.state.displayedFields,setUrlColumns:t=>{(0,u.n)(t,n.state.urlColumns)||(n.setState({urlColumns:t}),e.updateDisplayedFields(t))},dataFrame:O,clearSelectedLine:()=>{n.state.selectedLine&&n.clearSelectedLine()},setUrlTableBodyState:e=>{n.setState({tableLogLineState:e})},urlTableBodyState:null!==(P=null!=p?p:(0,x.D8)())&&void 0!==P?P:m.Wg.text,logsSortOrder:y})),v&&O&&0===O.length&&a().createElement(G.W.Component,{model:v})))),s&&a().createElement(Q.q,{error:s,errorType:i,clearFilters:o?()=>(0,f.rA)(e):void 0,sceneRef:e}))});const te=e=>({container:(0,s.css)({display:"flex",flexDirection:"row-reverse",justifyContent:"space-between",height:"100%",flex:1}),tableContainer:(0,s.css)({overflow:"hidden",flex:"1 1 auto",minWidth:0}),panelWrapper:(0,s.css)({height:"100%",label:"panel-wrapper-table",width:"100%"})});var ne=n(395);function re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){re(e,t,n[t])})}return e}function se(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}class ie extends l.Bs{getUrlState(){var e;const t=null!==(e=this.state.urlColumns)&&void 0!==e?e:[],n=this.state.selectedLine,r=this.state.visualizationType,a=(0,x.B)(this,!0),s=(0,x.B)(this);var i,o,l;const c=null!==(l=null!==(o=null!==(i=this.state.displayedFields)&&void 0!==i?i:a)&&void 0!==o?o:s)&&void 0!==l?l:[],u=this.state.userDisplayedFields;return{userDisplayedFields:JSON.stringify(u),displayedFields:JSON.stringify(c),selectedLine:JSON.stringify(n),tableLogLineState:JSON.stringify(this.state.tableLogLineState),urlColumns:JSON.stringify(t),visualizationType:JSON.stringify(r)}}updateFromUrl(e){const t={};try{if("string"==typeof e.urlColumns){const n=(0,p.aJ)(JSON.parse(e.urlColumns));n!==this.state.urlColumns&&(t.urlColumns=n)}if("string"==typeof e.selectedLine){const n=(0,p.lb)(JSON.parse(e.selectedLine));if(n){const e=n;e!==this.state.selectedLine&&(t.selectedLine=e)}}if("string"==typeof e.visualizationType){const n=(0,p.v_)(JSON.parse(e.visualizationType));n&&n!==this.state.visualizationType&&(t.visualizationType=n)}if("string"==typeof e.displayedFields){const n=(0,p.aJ)(JSON.parse(e.displayedFields));n&&n.length&&(t.displayedFields=n)}if("string"==typeof e.tableLogLineState){const n=JSON.parse(e.tableLogLineState);n!==m.Wg.labels&&n!==m.Wg.text||(t.tableLogLineState=n)}"string"==typeof e.userDisplayedFields&&(t.userDisplayedFields="true"===e.userDisplayedFields)}catch(e){d.v.error(e,{msg:"LogsListScene: updateFromUrl unexpected error"})}Object.keys(t).length&&this.setState(t)}clearSelectedLine(){this.setState({selectedLine:void 0})}onActivate(){const e=new URLSearchParams(o.locationService.getLocation().search);this.setStateFromUrl(e),this.state.panel||this.updateLogsPanel(),this._subs.add(this.subscribeToState((e,t)=>{if(e.visualizationType!==t.visualizationType){this.updateLogsPanel();const e=l.jh.findObject(this,e=>e instanceof b.g);null==e||e.forceRender()}})),this._subs.add(this.subscribeToLabelsVar((0,h.cR)(this))),this.setDisplayedFieldsFromBackend();const t=l.jh.getAncestor(this,K.Mn);this._subs.add(t.subscribeToState((e,t)=>{(0,u.B)(e.backendDisplayedFields,t.backendDisplayedFields)||this.setDisplayedFieldsFromBackend()}));const n=t.state.$data;n&&this._subs.add(n.subscribeToState((e,t)=>{var n,r;(null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Error?this.handleLogsError(e.data):(null===(r=e.data)||void 0===r?void 0:r.state)===i.LoadingState.Done&&(0,H.y2)(e.data.series)?this.handleNoData():this.state.error&&this.clearLogsError()}))}setDisplayedFieldsFromBackend(){const e=l.jh.getAncestor(this,K.Mn);e.state.backendDisplayedFields&&e.state.backendDisplayedFields.length>0&&(this.state.userDisplayedFields||(0,u.n)(e.state.backendDisplayedFields,this.state.displayedFields)||(this.setState({displayedFields:e.state.backendDisplayedFields}),this.updateLogsPanel()))}handleLogsError(e){var t;const n=(null===(t=e.errors)||void 0===t?void 0:t.length)?e.errors[0]:e.error,r=null==n?void 0:n.message;var a,s;r&&d.v.error(new Error("Logs Panel error"),{msg:r,status:null!==(a=n.statusText)&&void 0!==a?a:"N/A",type:null!==(s=n.type)&&void 0!==s?s:"N/A"});let i="Unexpected error response. Please review your filters or try a different time range.";(null==r?void 0:r.includes("parse error"))?i="Logs could not be retrieved due to invalid filter parameters. Please review your filters and try again.":(null==r?void 0:r.includes("response larger than the max message size"))?i="The response is too large to process. Try narrowing your search or using filters to reduce the data size.":(null==r?void 0:r.toLowerCase().includes("max entries limit"))&&(i='Max entries limit per query exceeded. Please review your "Line limit" setting and try again.'),this.showLogsError(i)}handleNoData(){this.state.canClearFilters?this.showLogsError("No logs match your search. Please review your filters or try a different time range.","no-logs"):this.showLogsError("No logs match your search. Please try a with different labels or an alternative time range.","no-logs")}showLogsError(e,t="other"){var n;const r=null!==(n=this.state.logsVolumeCollapsedByError)&&void 0!==n?n:!(0,x.Rf)("collapsed"),a=l.jh.getAncestor(this,v.P),s=(0,f.mE)(a).length>0;if(this.setState({canClearFilters:s,error:e,errorType:t,logsVolumeCollapsedByError:r}),this.updateLogsPanel(),r){var i;const e=l.jh.findByKeyAndType(this,ne.b,ne._);null==e||null===(i=e.state.panel)||void 0===i||i.setState({collapsed:!0})}}clearLogsError(){if(this.state.logsVolumeCollapsedByError){var e;const t=l.jh.findByKeyAndType(this,ne.b,ne._);null==t||null===(e=t.state.panel)||void 0===e||e.setState({collapsed:!1})}this.setState({error:void 0,errorType:void 0,logsVolumeCollapsedByError:void 0}),this.updateLogsPanel()}setStateFromUrl(e){const t=e.get("selectedLine"),n=e.get("urlColumns"),r=e.get("visualizationType"),a=(0,x.B)(this,!0),s=a?JSON.stringify(a):null,i=(0,x.B)(this),o=i?JSON.stringify(i):null;var l,c;const u=null!==(c=null!==(l=e.get("displayedFields"))&&void 0!==l?l:s)&&void 0!==c?c:o;var d;const p=null!==(d=e.get("userDisplayedFields"))&&void 0!==d?d:a?"true":"false",g=e.get("tableLogLineState");this.updateFromUrl({displayedFields:u,userDisplayedFields:p,selectedLine:t,tableLogLineState:g,urlColumns:n,visualizationType:r})}getVizPanel(){const{error:e,errorType:t,canClearFilters:n}=this.state;this.logsPanelScene=new A.o({error:e,errorType:t,canClearFilters:n});const r="logs"===this.state.visualizationType?[new l.G1({children:[new l.vA({body:new P({lineFilter:this.state.lineFilter}),xSizing:"fill"}),new l.vA({body:new D({error:e}),xSizing:"content"})]}),new l.vA({body:this.logsPanelScene,height:"calc(100vh - 220px)"})]:"json"===this.state.visualizationType?[new l.G1({children:[new l.vA({body:new P({lineFilter:this.state.lineFilter}),xSizing:"fill"}),new l.vA({body:new D({error:e}),xSizing:"content"})]}),new l.vA({body:new y.sP({error:e,canClearFilters:n}),height:"calc(100vh - 220px)"})]:[new l.G1({children:[new l.vA({body:new P({lineFilter:this.state.lineFilter}),xSizing:"fill"}),new l.vA({body:new D({error:e}),xSizing:"content"})]}),new l.vA({body:new ee({error:e,canClearFilters:n}),height:"calc(100vh - 220px)"})];return new l.G1({children:r,direction:"column"})}constructor(e){super(se(ae({},e),{displayedFields:[],userDisplayedFields:!1,otelDisplayedFields:[],visualizationType:(0,x.k5)(),controlsExpanded:(0,x.IL)("controlsExpanded",!1)})),re(this,"_urlSync",new l.So(this,{keys:["urlColumns","selectedLine","visualizationType","displayedFields","tableLogLineState","userDisplayedFields"]})),re(this,"logsPanelScene",void 0),re(this,"clearDisplayedFields",()=>{this.setState({displayedFields:[],userDisplayedFields:!0}),this.logsPanelScene&&this.logsPanelScene.clearDisplayedFields()}),re(this,"showBackendFields",()=>{this.setState({displayedFields:[],userDisplayedFields:!1}),this.logsPanelScene&&this.logsPanelScene.showBackendFields()}),re(this,"subscribeToLabelsVar",e=>e.subscribeToState((e,t)=>{var n,r,a,s,i,o,l,c;if((null===(r=e.filters)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.value)!==(null===(s=t.filters)||void 0===s||null===(a=s[0])||void 0===a?void 0:a.value)||(null===(o=e.filters)||void 0===o||null===(i=o[0])||void 0===i?void 0:i.keyLabel)!==(null===(c=t.filters)||void 0===c||null===(l=c[0])||void 0===l?void 0:l.keyLabel)){const{labelName:e,labelValue:t}=(0,g.MC)(this),n=(0,x.B)(this,!0,{prefix:(0,x.o3)(this,e,t)});n&&this.setState({displayedFields:n,urlColumns:n,userDisplayedFields:!0})}})),re(this,"setLogsVizOption",(e={})=>{this.logsPanelScene&&this.logsPanelScene.setLogsVizOption(e)}),re(this,"updateLogsPanel",()=>{if(this.setState({panel:this.getVizPanel()}),this.state.panel){const e=l.jh.findDescendents(this.state.panel,P);if(e.length){const t=e[0];this._subs.add(t.subscribeToState((e,t)=>{e.lineFilter!==t.lineFilter&&this.setState({lineFilter:e.lineFilter})}))}}}),re(this,"setVisualizationType",e=>{let t={};o.config.featureToggles.otelLogsFormatting&&this.state.displayedFields.length>0&&(0,i.shallowCompare)(this.state.displayedFields,this.state.otelDisplayedFields)&&(t={displayedFields:[],otelDisplayedFields:[]}),this.setState(ae({visualizationType:e},t)),(0,c.EE)(c.NO.service_details,c.ir.service_details.logs_visualization_toggle,{visualisationType:e}),(0,x.o5)(e)}),this.addActivationHandler(this.onActivate.bind(this))}}re(ie,"Component",({model:e})=>{const{panel:t}=e.useState();if(t)return a().createElement("div",{className:oe.panelWrapper},a().createElement(t.Component,{model:t}))});const oe={panelWrapper:(0,s.css)({'section > div[class$="panel-content"]':(0,s.css)({contain:"none",overflow:"auto"})})}},21736:(e,t,n)=>{n.d(t,{q:()=>c});var r=n(85959),a=n.n(r),s=n(90219),i=n(82007),o=n(47191),l=n(3657);const c=({clearFilters:e,error:t,errorType:n,sceneRef:c})=>{const[u,d]=(0,r.useState)(void 0);(0,r.useEffect)(()=>{"no-logs"===n&&(0,s.isAssistantAvailable)().subscribe(e=>{d(e)})},[n]);const p=(0,l.b)("logs",c);var g;return a().createElement(o.R,null,a().createElement("div",null,a().createElement("p",null,t),a().createElement(i.Stack,{justifyContent:"center"},e&&a().createElement(i.Button,{variant:"secondary",onClick:e},"Clear filters"),"no-logs"===n&&u&&a().createElement(i.Button,{variant:"secondary",onClick:()=>function(e="Investigate why there are no logs to display with the current filters and time range."){(0,s.openAssistant)({origin:"logs-drilldown-empty-results",prompt:e})}(null==p?void 0:p.customPrompt),icon:"ai-sparkle"},null!==(g=null==p?void 0:p.promptCTA)&&void 0!==g?g:"Ask Grafana Assistant"))))}},51712:(e,t,n)=>{n.d(t,{o:()=>$});var r=n(85959),a=n.n(r),s=n(87781),i=n(18531),o=n(76644),l=n(11625),c=n(82007),u=n(34509),d=n(20376),p=n(66854),g=n(25953),h=n(88428),f=n(66732),v=n(45553),m=n(90020),b=n(89924),y=n(15091),S=n(79405);const w=({onClick:e})=>{const[t,n]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e;return t&&(e=setTimeout(()=>{n(!1)},2e3)),()=>{clearTimeout(e)}},[t]);const s=(0,r.useCallback)((t,r)=>{e(t,r),n(!0)},[e]);return a().createElement(c.IconButton,{"aria-label":t?"Copied":"Copy link to log line",tooltip:t?"Copied":"Copy link to log line",tooltipPlacement:"top",variant:t?"primary":"secondary",size:"md",name:t?"check":"share-alt",onClick:s})};var O=n(91603),E=n(71014),x=n(21736),_=n(395),C=n(61402),P=n(38839),k=n(34907),L=n(57985),j=n(95002),F=n(75548);function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){T(e,t,n[t])})}return e}class $ extends o.Bs{setStateFromUrl(){const e=new URLSearchParams(i.locationService.getLocation().search);this.updateFromUrl({prettifyLogMessage:e.get("prettifyLogMessage"),sortOrder:e.get("sortOrder"),wrapLogMessage:e.get("wrapLogMessage")})}getUrlState(){return{prettifyLogMessage:JSON.stringify(this.state.prettifyLogMessage),sortOrder:JSON.stringify(this.state.sortOrder),wrapLogMessage:JSON.stringify(this.state.wrapLogMessage)}}updateFromUrl(e){const t={};try{if("string"==typeof e.sortOrder&&e.sortOrder){const n=(0,h.FH)(JSON.parse(e.sortOrder));n&&(t.sortOrder=n)}if("string"==typeof e.prettifyLogMessage&&e.prettifyLogMessage){const n=JSON.parse(e.prettifyLogMessage);"boolean"==typeof n&&(t.prettifyLogMessage=n)}if("string"==typeof e.wrapLogMessage&&e.wrapLogMessage){const n=JSON.parse(e.wrapLogMessage);"boolean"==typeof n&&(t.wrapLogMessage=n,k.CT||(t.prettifyLogMessage=n))}}catch(e){g.v.error(e,{msg:"LogsPanelScene: updateFromUrl unexpected error"})}Object.keys(t).length&&(this.setState(D({},t)),this.setLogsVizOption(D({},t)))}onActivate(){this.setStateFromUrl(),(0,f.sB)(this)&&this.setState({dedupStrategy:(0,f.sB)(this)}),this.state.body||this.setState({body:this.getLogsPanel()});const e=o.jh.getAncestor(this,C.Mn);this._subs.add(e.subscribeToState((e,t)=>{e.logsCount!==t.logsCount&&(this.state.body?this.state.body.setState({title:this.getTitle(e.logsCount)}):this.setState({body:this.getLogsPanel()}))})),(0,u.EE)(u.NO.service_details,u.ir.service_details.visualization_init,{viz:"logs"},!0)}setLogsVizOption(e={}){this.state.body&&("sortOrder"in e&&e.sortOrder!==this.state.body.state.options.sortOrder&&(0,L.qp)(this),this.state.body.onOptionsChange(e))}getParentScene(){return o.jh.getAncestor(this,E.i)}getTitle(e){var t;const n=(0,s.getValueFormat)("short"),r=void 0!==e?n(e,0):void 0;return void 0!==r?`Logs (${r.text}${null===(t=r.suffix)||void 0===t?void 0:t.trim()})`:"Logs"}handleLabelFilter(e,t,n,r){const a=(0,d.OE)(n,e,this);(0,S.Qt)(e,t,r,this,a),(0,u.EE)(u.NO.service_details,u.ir.service_details.logs_detail_filter_applied,{action:r,filterType:a,key:e})}constructor(e){super(D({dedupStrategy:l.fY.none,prettifyLogMessage:(0,f.IL)("prettifyLogMessage",!1),sortOrder:(0,f.YM)("sortOrder",l.uH.Descending),wrapLogMessage:(0,f.IL)("wrapLogMessage",!1),series:[]},e)),T(this,"_urlSync",new o.So(this,{keys:["sortOrder","wrapLogMessage","prettifyLogMessage"]})),T(this,"showBackendFields",()=>{if(!this.state.body)return;var e;const t=null!==(e=o.jh.getAncestor(this,C.Mn).state.backendDisplayedFields)&&void 0!==e?e:[];this.setLogsVizOption({displayedFields:t}),(0,f.vt)(this,t),(0,f.vt)(this,null,!0);const n=this.getParentScene();n.setState({displayedFields:t});const r=null!=t?t:n.state.urlColumns;n.setState({urlColumns:(null==r?void 0:r.filter(e=>y.OG.includes(e)||y.ir.includes(e)))||[]})}),T(this,"setDisplayedFields",e=>{this.setLogsVizOption({displayedFields:e});const t=this.getParentScene();e.length&&(0,s.shallowCompare)(e,t.state.otelDisplayedFields)||((0,f.vt)(this,e),(0,f.vt)(this,e,!0)),t.setState({displayedFields:e,userDisplayedFields:!0})}),T(this,"onClickShowField",e=>{const t=this.getParentScene();if(-1===t.state.displayedFields.indexOf(e)&&this.state.body){const n=[...t.state.displayedFields,e];this.setLogsVizOption({displayedFields:n}),t.setState({displayedFields:n,userDisplayedFields:!0}),(0,f.vt)(this,n),(0,f.vt)(this,n,!0),(0,u.EE)(u.NO.service_details,u.ir.service_details.logs_toggle_displayed_field)}}),T(this,"onClickHideField",e=>{const t=this.getParentScene();if(t.state.displayedFields.indexOf(e)>=0&&this.state.body){var n;const r=t.state.displayedFields.filter(t=>e!==t);this.setLogsVizOption({displayedFields:r}),t.setState({displayedFields:r,userDisplayedFields:!0}),(0,f.vt)(this,r),(0,f.vt)(this,r,!0),t.setState({urlColumns:(null===(n=t.state.urlColumns)||void 0===n?void 0:n.filter(t=>t!==e))||[]}),(0,u.EE)(u.NO.service_details,u.ir.service_details.logs_toggle_displayed_field)}}),T(this,"clearDisplayedFields",()=>{if(!this.state.body)return;this.setLogsVizOption({displayedFields:[]}),(0,f.vt)(this,[]),(0,f.vt)(this,[],!0);const e=this.getParentScene(),t=e.state.urlColumns;e.setState({urlColumns:(null==t?void 0:t.filter(e=>y.OG.includes(e)&&y.ir.includes(e)))||[]})}),T(this,"getLogsPanel",()=>{const e=this.getParentScene(),t=e.state.visualizationType,n=o.jh.getAncestor(this,C.Mn),r=o.d0.logs().setTitle(this.getTitle(n.state.logsCount)).setOption("onClickFilterLabel",this.handleLabelFilterClick).setOption("onClickFilterOutLabel",this.handleLabelFilterOutClick).setOption("isFilterLabelActive",this.handleIsFilterLabelActive).setOption("onClickFilterString",this.handleFilterStringClick).setOption("onClickFilterOutString",this.handleFilterOutStringClick).setOption("onClickShowField",this.onClickShowField).setOption("onClickHideField",this.onClickHideField).setOption("displayedFields",e.state.displayedFields).setMenu(new b.GD({})).setOption("showLogContextToggle",!0).setShowMenuAlways(!0).setOption("enableInfiniteScrolling",!0).setOption("onNewLogsReceived",this.updateVisibleRange).setOption("logRowMenuIconsAfter",[a().createElement(w,{onClick:this.handleShareLogLineClick,key:0})]).setHeaderActions(new O.ZB({onChangeVisualizationType:e.setVisualizationType,visualizationType:t})).setOption("sortOrder",this.state.sortOrder).setOption("wrapLogMessage",this.state.wrapLogMessage).setOption("prettifyLogMessage",this.state.prettifyLogMessage).setOption("dedupStrategy",this.state.dedupStrategy);return k.CT?r.setOption("showTime",(0,f.IL)("showTime",!0)).setOption("showControls",!0).setOption("controlsStorageKey",f.vR).setOption("onLogOptionsChange",this.handleLogOptionsChange).setOption("setDisplayedFields",this.setDisplayedFields).setOption("logLineMenuCustomItems",[{label:"Copy link to log line",onClick:this.handleShareLogLine}]).setOption("showFieldSelector",this.setDisplayedFields):r.setOption("showTime",!0),r.build()}),T(this,"handleLogOptionsChange",(e,t)=>{if("sortOrder"===e&&(0,P.Q)(t))this.setState({sortOrder:t}),this.setLogsVizOption({sortOrder:t});else if("wrapLogMessage"===e&&"boolean"==typeof t)this.setState({wrapLogMessage:t}),this.setLogsVizOption({wrapLogMessage:t});else if("prettifyLogMessage"===e&&"boolean"==typeof t)this.setState({prettifyLogMessage:t}),this.setLogsVizOption({prettifyLogMessage:t});else if("dedupStrategy"===e&&(0,P.K)(t))(0,f.WO)(this,t),this.setState({dedupStrategy:t}),this.setLogsVizOption({dedupStrategy:t});else if("defaultDisplayedFields"===e&&Array.isArray(t)){this.getParentScene().setState({otelDisplayedFields:t})}}),T(this,"updateVisibleRange",e=>{o.jh.getAncestor(this,C.Mn).setState({logsCount:e[0].length}),this.setState({series:e});o.jh.findByKeyAndType(this,_.b,_._).updateVisibleRange(e)}),T(this,"handleShareLogLineClick",(e,t)=>{t&&this.handleShareLogLine(t)}),T(this,"handleShareLogLine",e=>{if(!this.state.body)return;const t=this.getParentScene(),n=(0,j.Ki)(e);(0,j.Dk)((0,j.gW)("panelState",{logs:{displayedFields:t.state.displayedFields,id:e.uid,sortOrder:this.state.sortOrder}},n))}),T(this,"handleLabelFilterClick",(e,t,n)=>{this.handleLabelFilter(e,t,n,"toggle")}),T(this,"handleLabelFilterOutClick",(e,t,n)=>{this.handleLabelFilter(e,t,n,"exclude")}),T(this,"handleIsFilterLabelActive",(e,t)=>{const n=(0,v.bY)(m.MB,this),r=(0,v.bY)(m.mB,this),a=(0,v.bY)(m._Y,this),s=(0,v.bY)(m._P,this),i=n=>n&&n.state.filters.findIndex(n=>"="===n.operator&&n.key===e&&n.value===t)>=0;return i(n)||(n=>{if(n){const r=n.state.filters.find(t=>"="===t.operator&&t.key===e);if(r){return(0,v.bu)(r,e).value===t}}return!1})(r)||i(a)||i(s)}),T(this,"handleFilterOutStringClick",e=>{const t=(0,v.Gk)(this);t&&(t.setState({filters:[...t.state.filters,{key:p.ld.caseSensitive,keyLabel:t.state.filters.length.toString(),operator:p.cK.negativeMatch,value:e}]}),(0,u.EE)(u.NO.service_details,u.ir.service_details.logs_popover_line_filter,{selectionLength:e.length}))}),T(this,"handleFilterStringClick",e=>{const t=(0,v.Gk)(this);t&&(t.setState({filters:[...t.state.filters,{key:p.ld.caseSensitive,keyLabel:t.state.filters.length.toString(),operator:p.cK.match,value:e}]}),(0,u.EE)(u.NO.service_details,u.ir.service_details.logs_popover_line_filter,{selectionLength:e.length}))}),this.addActivationHandler(this.onActivate.bind(this))}}T($,"Component",({model:e})=>{const{body:t,canClearFilters:n,error:r,errorType:s}=e.useState(),i=(0,c.useStyles2)(b.K_);return t?a().createElement("span",{className:i.panelWrapper},!r&&a().createElement(t.Component,{model:t}),r&&a().createElement(x.q,{error:r,errorType:s,clearFilters:n?()=>(0,F.rA)(t):void 0,sceneRef:e})):a().createElement(c.LoadingPlaceholder,{text:"Loading..."})})},395:(e,t,n)=>{n.d(t,{_:()=>D,b:()=>T});var r,a,s,i=n(85959),o=n.n(i),l=n(87781),c=n(76644),u=n(82007),d=n(18531),p=n(88100),g=n(45553),h=n(90020);class f extends c.Bs{}s=function({model:e}){const{component:t,isLoading:n}=(0,d.usePluginComponent)("grafana-adaptivelogs-app/temporary-exemptions/v1"),r=(0,g.bY)(h.MB,e),{filters:a}=r.useState(),s=a.map(({key:e,operator:t,value:n})=>({key:e,operator:t,value:n})),i=(0,p.U4)(e);return n||!t?null:o().createElement(t,{dataSourceUid:i,streamSelector:s,contextHints:["explorelogs","logvolumepanel","headeraction"]})},(a="Component")in(r=f)?Object.defineProperty(r,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[a]=s;var v=n(41745),m=n(32085),b=n(89924),y=n(79405),S=n(61402),w=n(34509),O=n(21532),E=n(36838),x=n(5570),_=n(52165),C=n(34907),P=n(57985),k=n(66732);function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){L(e,t,n[t])})}return e}function F(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const T="logs-volume-panel";class D extends c.Bs{onActivate(){if(!this.state.panel){const e=this.getVizPanel();this.setState({panel:e}),this.updateContainerHeight(e)}const e=(0,g.cR)(this),t=(0,g.ir)(this);this._subs.add(e.subscribeToState((e,t)=>{(0,O.B)(e.filters,t.filters)||this.setState({panel:this.getVizPanel()})})),this._subs.add(t.subscribeToState((e,t)=>{(0,O.B)(e.filters,t.filters)||this.setState({panel:this.getVizPanel()})})),this._subs.add(this.subscribeToEvent(y.Of,e=>{if(e.key===h.e4){const e=c.jh.findObject(this,e=>e instanceof m.qV);if(e instanceof m.qV){const e=(0,g.iw)(this);e.setState({filters:e.state.filters})}}}))}getTitle(e,t){var n,r;var a;const s=null!==(a=null===(n=c.jh.getAncestor(this,v.P).state.ds)||void 0===n?void 0:n.maxLines)&&void 0!==a?a:P.by,i=(0,l.getValueFormat)("short"),o=void 0!==e?i(e,0):void 0;if(void 0===e&&void 0!==t&&t<s){var u;const e=i(t,0);return void 0!==e?`Log volume (${e.text}${null===(u=e.suffix)||void 0===u?void 0:u.trim()})`:"Log volume"}return void 0!==o?`Log volume (${o.text}${null===(r=o.suffix)||void 0===r?void 0:r.trim()})`:"Log volume"}setCollapsed(e,t){e?t.setState({$data:void 0}):(t.setState({$data:(0,C.rS)([(0,P.l)((0,E.m)(this,h.e4,!1),{legendFormat:`{{${h.e4}}}`})])}),this.subscribeToVisibleRange(t)),this.updateContainerHeight(t),(0,k.RN)("collapsed",e?"true":void 0)}getVizPanel(){var e;const t=c.jh.getAncestor(this,S.Mn),n=(0,k.Rf)("collapsed"),r=c.d0.timeseries().setTitle(this.getTitle(t.state.totalLogsCount,t.state.logsCount)).setOption("legend",{calcs:["sum"],displayMode:u.LegendDisplayMode.List,showLegend:!0}).setDisplayMode("default").setUnit("short").setCustomFieldConfig("stacking",{mode:u.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("axisSoftMin",0).setCustomFieldConfig("drawStyle",u.DrawStyle.Bars).setMenu(new b.GD({})).setCollapsible(!0).setCollapsed(n).setHeaderActions(new f({})).setShowMenuAlways(!0).setData(n?void 0:(0,C.rS)([(0,P.l)((0,E.m)(this,h.e4,!1),{legendFormat:`{{${h.e4}}}`})]));(0,C.FY)(r);const a=r.build();return a.setState({extendPanelContext:(e,t)=>this.extendTimeSeriesLegendBus(t)}),this._subs.add(a.subscribeToState((e,t)=>{e.collapsed!==t.collapsed&&this.setCollapsed(e.collapsed,a)})),this.subscribeToVisibleRange(a),this._subs.add(null===(e=t.state.$data)||void 0===e?void 0:e.subscribeToState(e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.state)===l.LoadingState.Done&&this.updateVisibleRange(e.data.series)})),this._subs.add(t.subscribeToState((e,t)=>{e.totalLogsCount===t.totalLogsCount&&void 0===e.logsCount||(this.state.panel?this.state.panel.setState({title:this.getTitle(e.totalLogsCount,e.logsCount)}):this.setState({panel:this.getVizPanel()}))})),a}subscribeToVisibleRange(e){var t;const n=c.jh.getAncestor(this,S.Mn);this._subs.add(null===(t=e.state.$data)||void 0===t?void 0:t.subscribeToState(t=>{var r,a,s,i;if((null===(r=t.data)||void 0===r?void 0:r.state)===l.LoadingState.Done){var o,c;if((null===(s=n.state.$data)||void 0===s||null===(a=s.state.data)||void 0===a?void 0:a.state)!==l.LoadingState.Done||(null===(i=t.data.annotations)||void 0===i?void 0:i.length))this.displayVisibleRange();else this.updateVisibleRange(null===(c=n.state.$data)||void 0===c||null===(o=c.state.data)||void 0===o?void 0:o.series);(0,C.C6)(e,t.data.series,this)}}))}updateContainerHeight(e){const t=c.jh.getAncestor(e,c.G1),n=e.state.collapsed?35:Math.max(Math.round(.2*window.innerHeight),100);t.setState({height:n,maxHeight:n,minHeight:n})}updateVisibleRange(e=[]){this.updatedLogSeries=e,this.displayVisibleRange()}displayVisibleRange(){var e,t;const n=this.state.panel;if(!n||!(null===(e=n.state.$data)||void 0===e?void 0:e.state.data)||(null===(t=n.state.$data)||void 0===t?void 0:t.state.data.state)!==l.LoadingState.Done||!this.updatedLogSeries)return;const r=(0,_.z5)(this.updatedLogSeries);this.updatedLogSeries=null,n.state.$data.setState({data:F(j({},n.state.$data.state.data),{annotations:[(0,_.hy)(r.start,r.end)]})})}constructor(e){super(F(j({},e),{key:T})),L(this,"updatedLogSeries",null),L(this,"extendTimeSeriesLegendBus",e=>{const t=(0,g.iw)(this);this._subs.add(null==t?void 0:t.subscribeToState(()=>{var e,t,n,r;const a=this.state.panel;(null==a||null===(t=a.state.$data)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.series)&&(0,C.C6)(a,null==a||null===(r=a.state.$data)||void 0===r||null===(n=r.state.data)||void 0===n?void 0:n.series,this)})),e.onToggleSeriesVisibility=(e,t)=>{const n=(0,x.PE)(e,this);this.publishEvent(new y.Of("legend","include",h.e4,e),!0),(0,w.EE)(w.NO.service_details,w.ir.service_details.level_in_logs_volume_clicked,{action:n,level:e})}}),this.addActivationHandler(this.onActivate.bind(this))}}L(D,"Component",({model:e})=>{const{panel:t}=e.useState();if(!t)return;const n=(0,u.useStyles2)(b.K_);return o().createElement("span",{className:n.panelWrapper},o().createElement(t.Component,{model:t}))})},61402:(e,t,n)=>{n.d(t,{AA:()=>Y,DS:()=>J,Mn:()=>ae,rD:()=>ee,UO:()=>te,nU:()=>ne,dB:()=>re,TG:()=>Z,tn:()=>X});var r=n(85959),a=n.n(r),s=n(46089),i=n(87781),o=n(76644),l=n(42245),c=n(11625),u=n(82007),d=n(66709),p=n(34509),g=n(21532),h=n(11263),f=n(77839),v=n(47389),m=n(20376),b=n(48502),y=n(25953),S=n(72152),w=n(18531),O=n(41745),E=n(66854),x=n(45553);function _(e,t){const n=["^","$",".","*","+","?","(",")","[","]","{","}","|"];return t||n.push("\\"),e.split("").filter((e,t,r)=>{const a=r[t+1],s=n.includes(a);return!("\\"===e&&s)}).join("")}var C=n(88428),P=n(67478),k=n(90708),L=n(69683),j=n(88100),F=n(32085),T=n(13574),D=n(17796),$=n(5378),N=n(35591);const A=({data:e,onClose:t})=>{const{component:n,isLoading:s}=(0,w.usePluginComponent)("grafana/add-to-dashboard-form/v1");if(!s)return a().createElement(u.Modal,{title:(0,N.t)("logs.logs-drilldown.add-to-dashboard.title","Add to Dashboard"),isOpen:!0,onDismiss:t},(0,r.createElement)(n,{onClose:t,buildPanel:()=>((0,w.reportInteraction)("grafana_logs_app_add_panel_to_dashboard",{type:e.panel.type}),e.panel),timeRange:e.timeRange,options:{useAbsolutePath:!0}}))};var B=n(45395),M=n(91603),I=n(71014),R=n(88469),V=n(89924),z=n(83142),q=n(34907),G=n(57985),U=n(66732),W=n(90020);function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Q(e,t,n[t])})}return e}function H(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const J="logsPanelQuery",Y="logsCountQuery";function X(e){return null==e?void 0:e.series.find(e=>e.refId===J)}function Z(e){var t,n,r;return null===(r=o.jh.getAncestor(e,ae).state.$detectedLabelsData)||void 0===r||null===(n=r.state.data)||void 0===n||null===(t=n.series)||void 0===t?void 0:t[0]}function ee(e){var t;const n=o.jh.getAncestor(e,ae);return te(null===(t=n.state.$detectedFieldsData)||void 0===t?void 0:t.state)}const te=e=>{var t,n;return null==e||null===(n=e.data)||void 0===n||null===(t=n.series)||void 0===t?void 0:t[0]},ne=e=>{var t,n,r,a;return null===(a=e.data)||void 0===a||null===(r=a.series)||void 0===r||null===(n=r[0])||void 0===n||null===(t=n.fields)||void 0===t?void 0:t[0]},re=e=>{var t,n,r,a;return null===(a=e.data)||void 0===a||null===(r=a.series)||void 0===r||null===(n=r[0])||void 0===n||null===(t=n.fields)||void 0===t?void 0:t[2]};class ae extends o.Bs{handleInvalidLabels(e,t){if("empty"===e&&(this.state.embedded||this.redirectToStart()),"primary_label_removed"===e)if(t){let{breakdownLabel:e}=(0,L.MC)(this);this.handlePrimaryLabelChange(t,e)}else this.state.embedded||this.redirectToStart()}getLabelFiltersStatus(e){if(0===(0,x.cR)(this).state.filters.length)return{isValid:!1,reason:"empty"};{let{labelName:t,labelValue:n}=(0,L.MC)(this);const r=t===W.ky&&e.some(e=>e.key===W.OX&&(0,k.BG)(e.operator)&&(0,v.uu)(e.value)===(0,v.uu)(n));if(!e.some(e=>e.key===t&&(0,k.BG)(e.operator)&&(0,v.uu)(e.value)===(0,v.uu)(n))&&!r){const t=e.find(e=>(0,k.BG)(e.operator)&&e.value!==W.ZO);return t?{isValid:!1,reason:"primary_label_removed",newPrimaryLabel:t}:{isValid:!1,reason:"primary_label_removed"}}}return{isValid:!0}}setSubscribeToLabelsVariable(){const e=(0,x.cR)(this),t=this.getLabelFiltersStatus(e.state.filters);t.isValid||this.handleInvalidLabels(t.reason,t.newPrimaryLabel),this._subs.add(e.subscribeToState((e,t)=>{const n=this.getLabelFiltersStatus(e.filters);var r,a,s,i;(n.isValid||this.handleInvalidLabels(n.reason,n.newPrimaryLabel),n.isValid&&!(0,g.B)(e.filters,t.filters))&&(null===(r=this.state.$patternsData)||void 0===r||r.runQueries(),null===(a=this.state.$detectedLabelsData)||void 0===a||a.runQueries(),null===(s=this.state.$detectedFieldsData)||void 0===s||s.runQueries(),null===(i=this.state.$logsCount)||void 0===i||i.runQueries(),this.setDefaultColumns())}))}setDefaultColumns(){const e=o.jh.getAncestor(this,O.P).state.defaultColumnsRecords,t=(0,x.cR)(this).state.filters.filter(e=>(0,k.BG)(e.operator)),n=null==e?void 0:e.filter(e=>e.labels.length<=t.length),r=new Set;t.forEach(e=>r.add(e.key+e.value));const a=null==n?void 0:n.map(e=>{const t=e.labels.reduce((e,t)=>r.has(t.key+t.value)?e+1:e,0);return H(K({},e),{score:t})});let s=0,i=-1;null==a||a.forEach((e,t)=>{e.score>s&&(s=e.score,i=t)});const l=-1!==i?null==a?void 0:a[i]:void 0;this.setState({backendDisplayedFields:null==l?void 0:l.columns})}handlePrimaryLabelChange(e,t){const n=o.jh.getAncestor(this,O.P),r=n.state.routeMatch,a=(0,W.zE)(e.value)?(0,v.uu)((0,W.Dx)(e.value)):(0,v.uu)(e.value);var s,i,l;if(n.setState({routeMatch:H(K({},r),{isExact:null===(s=null==r?void 0:r.isExact)||void 0===s||s,params:H(K({},null==r?void 0:r.params),{labelName:e.key===W.OX?W.ky:e.key,labelValue:a.split("|")[0]}),path:null!==(i=null==r?void 0:r.path)&&void 0!==i?i:"",url:null!==(l=null==r?void 0:r.url)&&void 0!==l?l:""})}),this.resetTabCount(),t){const e=this.getDrilldownValueSlug();if(!e)throw new Error(`Invalid value slug ${e}`);(0,P.fg)(e,t,this)}else{const e=this.getPageSlug();if(!e)throw new Error(`Invalid page slug ${e}`);(0,P.Vt)(e,this)}}getPageSlug(){const e=(0,C.mx)((0,L.FT)());if(e&&e!==f.G3.embed)return e;const t=(0,C.mx)(this.state.pageSlug);return t||void 0}getDrilldownPageSlug(){const e=(0,C.EP)((0,L.er)());return e||this.state.pageSlug}getDrilldownValueSlug(){const e=(0,C.EP)((0,L.er)());if(e)return e}redirectToStart(){this.state.embedded?console.error("Cannot redirect to start when embedded"):(this.setState({$data:void 0,$detectedFieldsData:void 0,$detectedLabelsData:void 0,$logsCount:void 0,$patternsData:void 0,body:void 0,fieldsCount:void 0,labelsCount:void 0,logsCount:void 0,patternsCount:void 0,totalLogsCount:void 0}),(0,S.JO)().setServiceSceneState(this.state),this._subs.unsubscribe(),(0,P.Ns)())}showVariables(){o.jh.findByKeyAndType(this,F.kz,F.qV).setState({visible:!0}),(0,x.YS)(this).setState({hide:l.zL.dontHide})}getMetadata(){const e=(0,S.JO)().getServiceSceneState();e&&this.setState(K({},e))}getUrlState(){return{drillDownLabel:this.state.drillDownLabel,pageSlug:this.state.pageSlug}}updateFromUrl(e){const t={};if(!this.state.embedded)return;if(e&&"string"==typeof e.pageSlug&&e.pageSlug!==this.state.pageSlug){const n=(0,C.Wf)(e.pageSlug);n&&(t.pageSlug=n)}const n=e.drillDownLabel,r=e.drillDownLabel&&"string"==typeof n?n:void 0;(e&&"string"==typeof n&&r!==this.state.drillDownLabel||null===e.drillDownLabel&&e.drillDownLabel!==this.state.drillDownLabel)&&(t.drillDownLabel=r),Object.keys(t).length&&(this.setState(t),this.updateContentScene())}updateContentScene(){const e=o.jh.getAncestor(this,O.P);e.setState({contentScene:e.getContentScene()})}onActivate(){let e={};this.state.body||(e.body=this.buildGraphScene()),this.state.$data||(e.$data=le(this)),Object.keys(e).length&&this.setState(e);o.jh.findByKeyAndType(this,O.y,D.H).setState({hidden:!0}),this.showVariables(),this.getMetadata(),this.resetBodyAndData(),this.setBreakdownView(),this.setDefaultColumns(),this.runQueries(),this._subs.add(this.subscribeToLokiConfig()),this._subs.add(this.subscribeToPatternsProvider()),this._subs.add(this.subscribeToPatternsQuery()),this._subs.add(this.subscribeToDetectedLabelsQuery()),this._subs.add(this.subscribeToDetectedFieldsQuery(this.getPageSlug()!==f.G3.fields)),this._subs.add(this.subscribeToLogsQuery()),this._subs.add(this.subscribeToLogsCountQuery()),this.setSubscribeToLabelsVariable(),this._subs.add(this.subscribeToFieldsVariable()),this._subs.add(this.subscribeToMetadataVariable()),this._subs.add(this.subscribeToLevelsVariableChangedEvent()),this._subs.add(this.subscribeToLevelsVariableFiltersState()),this._subs.add(this.subscribeToDataSourceVariable()),this._subs.add(this.subscribeToPatternsVariable()),this._subs.add(this.subscribeToLineFiltersVariable()),this._subs.add(this.subscribeToIndexSceneState()),this._subs.add(this.subscribeToTimeRange()),this._subs.add(this.subscribeToEvent(V.jF,this.subscribeToAddToDashboard)),function(e){const t=i.urlUtil.getUrlSearchParams(),n=t["var-lineFilter"];if(!Array.isArray(n)||!n.length)return;const r=n[0];if("string"!=typeof r||!r)return;const a=o.jh.getAncestor(e,O.P),s=(0,x.Gk)(e),l=null==r?void 0:r.match(/\|=.`(.+?)`/);var c,u;l&&2===l.length&&(null===(u=a.state.body)||void 0===u||null===(c=u.state.lineFilterRenderer)||void 0===c||c.addActivationHandler(()=>{s.setState({filters:[{key:E.ld.caseSensitive,keyLabel:"0",operator:E.cK.match,value:_(l[1],!0)}]})}));const d=null==r?void 0:r.match(/`\(\?i\)(.+)`/);var p,g;d&&2===d.length&&(null===(g=a.state.body)||void 0===g||null===(p=g.state.lineFilterRenderer)||void 0===p||p.addActivationHandler(()=>{s.updateFilters([{key:E.ld.caseInsensitive,keyLabel:"0",operator:E.cK.match,value:_(d[1],!1)}])}));const h=w.locationService.getLocation();delete t["var-lineFilter"],w.locationService.replace(i.urlUtil.renderUrl(h.pathname,t))}(this)}subscribeToPatternsProvider(){return this.subscribeToState((e,t)=>{e.$patternsData&&void 0===t.$patternsData&&(e.$patternsData.addActivationHandler(()=>{var t;null===(t=e.$patternsData)||void 0===t||t.runQueries()}),e.$patternsData.activate())})}subscribeToLokiConfig(){return o.jh.getAncestor(this,O.P).subscribeToState((e,t)=>{var n;e.lokiConfig&&e.lokiConfig!==t.lokiConfig&&(e.lokiConfig===h.X||!1!==(null===(n=e.lokiConfig)||void 0===n?void 0:n.pattern_ingester_enabled)?void 0===this.state.$patternsData&&(this.setState({$patternsData:se()}),this._subs.add(this.subscribeToPatternsQuery())):this.setState({$patternsData:null}))})}subscribeToPatternsVariable(){return(0,x.Ku)(this).subscribeToState((e,t)=>{var n,r;e.value!==t.value&&(null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries(),null===(r=this.state.$logsCount)||void 0===r||r.runQueries())})}subscribeToIndexSceneState(){return o.jh.getAncestor(this,O.P).subscribeToState((e,t)=>{(0,g.B)(e.defaultColumnsRecords,t.defaultColumnsRecords)||this.setDefaultColumns()})}subscribeToLineFiltersVariable(){return(0,x.Gk)(this).subscribeToEvent(o.oh,()=>{var e,t;null===(e=this.state.$logsCount)||void 0===e||e.runQueries(),null===(t=this.state.$detectedFieldsData)||void 0===t||t.runQueries()})}subscribeToDataSourceVariable(){return(0,x.S9)(this).subscribeToState(()=>{this.redirectToStart()})}resetTabCount(){this.setState({fieldsCount:void 0,labelsCount:void 0,patternsCount:void 0}),(0,S.JO)().setServiceSceneState(this.state)}subscribeToFieldsVariable(){return(0,x.ir)(this).subscribeToState((e,t)=>{var n,r;(0,g.B)(e.filters,t.filters)||(this.removeInactiveJsonParserProps(e,t),null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries(),null===(r=this.state.$logsCount)||void 0===r||r.runQueries())})}removeInactiveJsonParserProps(e,t){const n=(0,x.U2)(this);if(e.filters.length||n.state.filters.length){if(e.filters.length<t.filters.length){t.filters.filter(t=>!e.filters.find(e=>e.key===t.key)).length&&(0,b.AY)(this)}}else(0,m.Ak)(this)}subscribeToMetadataVariable(){return(0,x.oY)(this).subscribeToState((e,t)=>{var n,r;(0,g.B)(e.filters,t.filters)||(null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries(),null===(r=this.state.$logsCount)||void 0===r||r.runQueries())})}subscribeToLevelsVariableChangedEvent(){return(0,x.iw)(this).subscribeToEvent(o.oh,()=>{var e;null===(e=this.state.$detectedFieldsData)||void 0===e||e.runQueries()})}subscribeToLevelsVariableFiltersState(){return(0,x.iw)(this).subscribeToState((e,t)=>{var n;(0,g.B)(e.filters,t.filters)||(null===(n=this.state.$logsCount)||void 0===n||n.runQueries())})}runQueries(){const e=this.getPageSlug(),t=this.getDrilldownPageSlug();var n,r,a,s;e!==f.G3.patterns&&void 0!==this.state.patternsCount||(null===(n=this.state.$patternsData)||void 0===n||n.runQueries());e!==f.G3.labels&&t!==f._J.label&&void 0!==this.state.labelsCount||(null===(r=this.state.$detectedLabelsData)||void 0===r||r.runQueries());e!==f.G3.fields&&t!==f._J.field&&void 0!==this.state.fieldsCount||(null===(a=this.state.$detectedFieldsData)||void 0===a||a.runQueries());void 0===this.state.logsCount&&(null===(s=this.state.$logsCount)||void 0===s||s.runQueries())}subscribeToPatternsQuery(){var e;return null===(e=this.state.$patternsData)||void 0===e?void 0:e.subscribeToState(e=>{var t;if(this.updateLoadingState(e,f.ob.patterns),(null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done){const t=e.data.series;void 0!==(null==t?void 0:t.length)&&(this.setState({patternsCount:t.length}),(0,S.JO)().setPatternsCount(t.length))}})}subscribeToDetectedLabelsQuery(){var e;return null===(e=this.state.$detectedLabelsData)||void 0===e?void 0:e.subscribeToState(e=>{var t;if(this.updateLoadingState(e,f.ob.labels),(null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done){const t=e.data,n=t.series[0].fields;if(void 0!==t.series.length&&void 0!==n.length){const e=t.series[0].fields.filter(e=>W.e4!==e.name);this.setState({labelsCount:e.length+1}),(0,S.JO)().setLabelsCount(n.length)}}})}updateLoadingState(e,t){var n;const r=this.state.loadingStates;r[t]=(null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Loading;const a=Object.values(r).some(e=>e);this.setState({loading:a,loadingStates:r})}subscribeToLogsQuery(){var e;return null===(e=this.state.$data)||void 0===e?void 0:e.subscribeToState((e,t)=>{var n,r;if(this.updateLoadingState(e,f.ob.logs),(null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Done||(null===(r=e.data)||void 0===r?void 0:r.state)===i.LoadingState.Streaming){var a,s;const t=null!==(s=null===(a=e.data.series[0])||void 0===a?void 0:a.length)&&void 0!==s?s:0;t!==this.state.logsCount&&this.setState({logsCount:t})}!function(e,t){var n,r,a;if((null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Done)(0,p.EE)(p.NO.service_details,p.ir.service_details.logs_on_query_complete,{vizType:null===(a=(0,j.UX)(t,e=>e instanceof I.i,I.i))||void 0===a?void 0:a.state.visualizationType,tab:t.getPageSlug()});else if((null===(r=e.data)||void 0===r?void 0:r.state)===i.LoadingState.Error){var s,o,l,c,u,d,g;(0,p.EE)(p.NO.service_details,p.ir.service_details.logs_on_query_error,{vizType:null===(s=(0,j.UX)(t,e=>e instanceof I.i,I.i))||void 0===s?void 0:s.state.visualizationType,errorCount:null===(l=e.data)||void 0===l||null===(o=l.errors)||void 0===o?void 0:o.length,error:null===(u=e.data)||void 0===u||null===(c=u.errors)||void 0===c?void 0:c.map(e=>e.message).join(", "),status:null===(g=e.data)||void 0===g||null===(d=g.errors)||void 0===d?void 0:d.map(e=>e.status).join(", "),tab:t.getPageSlug()})}}(e,this)})}subscribeToLogsCountQuery(){var e;return null===(e=this.state.$logsCount)||void 0===e?void 0:e.subscribeToState(e=>{var t;if((null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done){var n,r,a,s;const t=null===(s=e.data.series[0])||void 0===s||null===(a=s.fields)||void 0===a||null===(r=a[1])||void 0===r||null===(n=r.values)||void 0===n?void 0:n[0];this.setState({totalLogsCount:t})}})}subscribeToDetectedFieldsQuery(e){var t;return null===(t=this.state.$detectedFieldsData)||void 0===t?void 0:t.subscribeToState(t=>{var n;this.updateLoadingState(t,f.ob.fields);const r=t.data,a=null==r?void 0:r.series[0];e&&(null===(n=t.data)||void 0===n?void 0:n.state)===i.LoadingState.Done&&void 0!==a&&a.length!==this.state.fieldsCount&&(this.setState({fieldsCount:a.length}),(0,S.JO)().setFieldsCount(a.length))})}subscribeToTimeRange(){return o.jh.getTimeRange(this).subscribeToState(()=>{var e,t,n,r;null===(e=this.state.$patternsData)||void 0===e||e.runQueries(),null===(t=this.state.$detectedLabelsData)||void 0===t||t.runQueries(),null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries(),null===(r=this.state.$logsCount)||void 0===r||r.runQueries()})}buildGraphScene(){return new o.G1({children:[new o.vA({body:new $.g({}),ySizing:"content"})],direction:"column"})}setBreakdownView(){const{body:e}=this.state,t=this.getPageSlug(),n=B._.find(e=>e.value===t);if(!e){const e=new Error("body is not defined in setBreakdownView!");throw y.v.error(e,{msg:"ServiceScene setBreakdownView error"}),e}if(n)e.setState({children:[...e.state.children.slice(0,1),n.getScene(e=>{"fields"===n.value&&this.setState({fieldsCount:e})})]});else{const t=this.getDrilldownPageSlug(),n=B.n.find(e=>e.value===t);if(n&&this.state.drillDownLabel)e.setState({children:[...e.state.children.slice(0,1),n.getScene(this.state.drillDownLabel)]});else if(this.state.embedded){const t=B._[0];e.setState({children:[...e.state.children.slice(0,1),t.getScene(e=>{})]})}else y.v.error(new Error("not setting breakdown view"),{msg:"setBreakdownView error"})}}constructor(e){var t;super(K({$data:void 0,$detectedFieldsData:oe(),$detectedLabelsData:ie(),$logsCount:ce(),body:null!==(t=e.body)&&void 0!==t?t:new o.G1({children:[new o.vA({body:new $.g({}),ySizing:"content"})],direction:"column"}),loading:!0,loadingStates:{[f.ob.patterns]:!1,[f.ob.labels]:!1,[f.ob.fields]:!1,[f.ob.logs]:!1}},e)),Q(this,"_variableDependency",new o.Sh(this,{variableNames:[W.EY,W.MB,W.mB,W.uw,W._Y]})),Q(this,"_urlSync",new o.So(this,{keys:[R.Z,R.o]})),Q(this,"subscribeToAddToDashboard",e=>{this.setState({addToDashboardData:e.payload})}),Q(this,"hideAddToDashboard",()=>{this.setState({addToDashboardData:void 0})}),Q(this,"resetBodyAndData",()=>{let e={};if(this.state.$data||(e.$data=le(this)),!this.state.$patternsData){const t=o.jh.getAncestor(this,O.P);t.state.lokiConfig&&(e.$patternsData=se(t.state.lokiConfig),this._subs.add(this.subscribeToPatternsQuery()))}this.state.$detectedLabelsData||(e.$detectedLabelsData=ie()),this.state.$detectedFieldsData||(e.$detectedFieldsData=oe()),this.state.$logsCount||(e.$logsCount=ce()),this.state.body||(e.body=this.buildGraphScene()),Object.keys(e).length&&this.setState(e)}),this.addActivationHandler(this.onActivate.bind(this))}}function se(e){const{jsonData:t}=d.plugin.meta;return(null==t?void 0:t.patternsDisabled)||e!==h.X&&!1===(null==e?void 0:e.pattern_ingester_enabled)?null:(0,q.FH)([(0,G.BM)(`{${W.S1}}`,"patterns",{refId:"patterns"})],{runQueriesMode:"manual"})}function ie(){return(0,q.FH)([(0,G.BM)(`{${W.S1}}`,"detected_labels",{refId:"detectedLabels"})],{runQueriesMode:"manual"})}function oe(){return(0,q.FH)([(0,G.BM)(W.Do,"detected_fields",{refId:"detectedFields"})],{runQueriesMode:"manual"})}function le(e){const t=H(K({},(0,G.l)(W.SA,{refId:J})),{get direction(){return((0,M.PY)()||(0,U.YM)("sortOrder",c.uH.Descending))===c.uH.Descending?z.t.Backward:z.t.Forward},get maxLines(){return(0,U.w0)(e)}});return(0,q.rS)([t],void 0)}function ce(){const e=(0,q.rS)([(0,G.l)(`sum(count_over_time(${W.SA}[$__auto]))`,{queryType:"instant",refId:Y})],{runQueriesMode:"manual"});if(e instanceof o.dt)return e;const t=new Error("log count query provider is not query runner!");throw y.v.error(t,{msg:"getLogCountQueryRunner: invalid return type"}),t}Q(ae,"Component",({model:e})=>{const{body:t,addToDashboardData:n}=e.useState(),r=o.jh.getAncestor(e,O.P),{filters:i}=(0,x.cR)(e).useState(),l=e.getLabelFiltersStatus(i);return l.isValid||l.newPrimaryLabel?t?a().createElement(a().Fragment,null,n&&a().createElement(A,{data:n,onClose:e.hideAddToDashboard}),a().createElement(t.Component,{model:t})):a().createElement(u.LoadingPlaceholder,{text:"Loading..."}):a().createElement(u.Alert,{title:"empty"===l.reason?"No labels selected":"Invalid labels selected",severity:"info"},a().createElement("div",{className:(0,s.css)({display:"flex",justifyContent:"space-between",alignItems:"center"})},"primary_label_removed"===l.reason&&a().createElement("p",null,"You need at least one label with inclusive matching."),"empty"===l.reason&&a().createElement("p",null,"Please select at least one label to see the logs breakdown."),a().createElement(T.$,{indexScene:r})))})},10577:(e,t,n)=>{n.d(t,{p:()=>g});var r,a,s,i=n(85959),o=n.n(i),l=n(46089),c=n(76644),u=n(82007),d=n(40696),p=n(66732);class g extends c.Bs{setHover(e){this.setState({hover:e})}onClick(e){e?(0,d.wy)(this.state.labelName,this.state.labelValue,this):(0,d._J)(this.state.labelName,this.state.labelValue,this)}}s=({model:e})=>{const{ds:t,hover:n,labelName:r,labelValue:a}=e.useState(),s=(0,p.eT)(t,r).includes(a),i=(0,u.useStyles2)(e=>({wrapper:(0,l.css)({alignSelf:"center",display:"flex",flexDirection:"column",justifyContent:"center"})})),c=s?`Remove  ${a} from favorites`:`Add ${a} to favorites`;return o().createElement("span",{className:i.wrapper},o().createElement(u.ToolbarButton,{onMouseOver:()=>{e.setHover(!0)},onMouseOut:()=>{e.setHover(!1)},icon:o().createElement(u.Icon,{name:s?"favorite":"star",size:"lg",type:s?"mono":"default"}),color:s?"rgb(235, 123, 24)":"#ccc",onClick:()=>e.onClick(s),name:"star","aria-label":c,tooltip:c}))},(a="Component")in(r=g)?Object.defineProperty(r,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[a]=s},173:(e,t,n)=>{n.d(t,{X:()=>de,y:()=>he});var r=n(85959),a=n.n(r),s=n(46089),i=n(93241),o=n(87781),l=n(18531),c=n(76644),u=n(42245),d=n(82007),p=n(21532),g=n(34702),h=n(28057),f=n(67478),v=n(88100),m=n(45553),b=n(41745),y=n(17796),S=n(39731),w=n(7243),O=n(34509),E=n(66854),x=n(53571),_=n(90020),C=n(79405);function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){P(e,t,n[t])})}return e}function L(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}class j extends c.Bs{onActivate(){this.setState(k({},this.isSelected())),this._subs.add((0,m.cR)(this).subscribeToState(()=>{const e=this.isSelected();this.state.included!==e.included&&this.setState(k({},e))}))}getFilter(){return{name:this.state.name,value:this.state.value}}constructor(e){super(L(k({},e),{included:null})),P(this,"isSelected",()=>{const e=(0,m.cR)(this).state.filters.find(e=>{const t=(0,m.z2)(_.MB,e);return e.key===this.state.name&&t.value===this.state.value});return e?{included:e.operator===E.w7.Equal}:{included:!1}}),P(this,"onClick",e=>{const t=this.getFilter();(0,C.Qt)(t.name,t.value,e,this,_.MB);const n=(0,m.cR)(this);(0,O.EE)(O.NO.service_selection,O.ir.service_selection.add_to_filters,{action:e,filtersLength:(null==n?void 0:n.state.filters.length)||0,filterType:"index-filters",key:t.name}),this.setState(k({},this.isSelected()))}),this.addActivationHandler(this.onActivate.bind(this))}}P(j,"Component",({model:e})=>{const{included:t,value:n}=e.useState(),r=(0,d.useStyles2)(F);return a().createElement("span",{className:r.wrapper},a().createElement(d.Button,{tooltip:!0===t?`Remove ${n} from filters`:`Add ${n} to filters`,variant:t?"destructive":"secondary",fill:"outline",size:"sm","aria-selected":!0===t,onClick:()=>!0===t?e.onClick("clear"):e.onClick("include"),"data-testid":x.b.exploreServiceDetails.buttonFilterInclude},t?"Remove":"Include"))});const F=()=>({container:(0,s.css)({display:"flex",justifyContent:"center"}),wrapper:(0,s.css)({alignSelf:"center",display:"flex",flexDirection:"column",justifyContent:"center"})});var T=n(47191);const D=()=>a().createElement(T.R,null,a().createElement("p",null,"Log volume has not been configured."),a().createElement("p",null,a().createElement(d.TextLink,{href:"https://grafana.com/docs/loki/latest/reference/api/#query-log-volume",external:!0},"Instructions to enable volume in the Loki config:")),a().createElement(d.Text,{textAlignment:"left"},a().createElement("pre",null,a().createElement("code",null,"limits_config:",a().createElement("br",null),"Â Â volume_enabled: true"))));var $=n(10577);const N=()=>a().createElement(T.R,null,a().createElement("p",null,"No service matched your search.")),A=e=>a().createElement(T.R,null,a().createElement("p",null,"No logs found in ",a().createElement("strong",null,e.labelName),".",a().createElement("br",null),"Please adjust time range or select another label."));var B=n(40696);function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class I extends c.Bs{onActivate(){const e=(0,m.cR)(this);this.setState({hidden:e.state.filters.length>0}),e.subscribeToState(e=>{this.setState({hidden:e.filters.length>0})})}constructor(e){super(e),M(this,"getLink",()=>{if(this.state.labelValue)return V(this.state.labelName,this.state.labelValue,this)}),M(this,"onClick",()=>{R(this.state.labelName,this.state.labelValue,this)}),this.addActivationHandler(this.onActivate.bind(this))}}function R(e,t,n){(0,O.EE)(O.NO.service_selection,O.ir.service_selection.service_selected,{label:e,value:t}),(0,B._J)(e,t,n)}function V(e,t,n){var r;const a=(0,m.cR)(n),s=[...a.state.filters.filter(n=>!(n.key===e&&n.value===t)),{key:e,operator:E.w7.Equal,value:t}];e===_.OX&&(e=_.ky);const i=a.clone({filters:s});return(0,f.k9)(e,t,null===(r=i.urlSync)||void 0===r?void 0:r.getUrlState())}function z(e){return{button:(0,s.css)({alignSelf:"center"})}}M(I,"Component",({model:e})=>{const t=(0,d.useStyles2)(z);(0,m.cR)(e).useState();const{hidden:n}=e.useState();if(n)return null;const r=e.getLink();return a().createElement(d.LinkButton,{"data-testid":x.b.index.selectServiceButton,tooltip:`View logs for ${e.state.labelValue}`,className:t.button,variant:"primary",fill:"outline",size:"sm",disabled:!r,href:e.getLink(),onClick:e.onClick},"Show logs")});var q=n(66732);function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class U extends c.Bs{}function W(e){return{icon:(0,s.css)({color:e.colors.text.disabled,marginLeft:e.spacing.x1}),searchFieldPlaceholderText:(0,s.css)({alignItems:"center",color:e.colors.text.disabled,display:"flex",flex:"1 0 auto",fontSize:e.typography.bodySmall.fontSize,textWrapMode:"nowrap"}),searchPageCountWrap:(0,s.css)({alignItems:"center",display:"flex"}),select:(0,s.css)({marginLeft:e.spacing(1),marginRight:e.spacing(1),maxWidth:"65px"})}}G(U,"PageCount",({model:e,totalCount:t})=>{const n=(0,d.useStyles2)(W),s=c.jh.getAncestor(e,he),{countPerPage:i}=s.useState(),o=function(e){const t=20,n=60,r=Math.ceil(e/t)*t,a=[];for(let s=t;s<=n&&s<=r;s+=t){let n=s.toString();s<t?n=s.toString():s>e&&(n=e.toString()),a.push({label:n,value:s.toString()})}return a}(t);return(0,r.useEffect)(()=>{var e,t;const n=null!==(t=null===(e=o[o.length-1])||void 0===e?void 0:e.value)&&void 0!==t?t:i.toString();i.toString()>n&&s.setState({countPerPage:parseInt(n,10)})},[i,o,s]),a().createElement("span",{className:n.searchPageCountWrap},a().createElement("span",{className:n.searchFieldPlaceholderText},"Showing"," ",a().createElement(d.Select,{className:n.select,onChange:e=>{if(e.value){const t=parseInt(e.value,10);s.setState({countPerPage:t,currentPage:1}),s.updateBody(),(0,q.uF)(t)}},options:o,value:i.toString()})," ","of ",t," ",a().createElement(d.IconButton,{className:n.icon,"aria-label":"Count info",name:"info-circle",tooltip:`${t} labels have values for the selected time range. Total label count may differ`})))}),G(U,"Component",({model:e,totalCount:t})=>{const n=c.jh.getAncestor(e,he),{countPerPage:r,currentPage:i}=n.useState(),o=(0,d.useStyles2)(e=>({pagination:(0,s.css)({float:"none"}),paginationWrap:(0,s.css)({[e.breakpoints.up("lg")]:{display:"none"},[e.breakpoints.down("lg")]:{display:"flex",flex:"1 0 auto",justifyContent:"flex-end"}}),paginationWrapMd:(0,s.css)({[e.breakpoints.down("lg")]:{display:"none"},[e.breakpoints.up("lg")]:{display:"flex",flex:"1 0 auto",justifyContent:"flex-end"}})}));return t>r?a().createElement(a().Fragment,null,a().createElement("span",{className:o.paginationWrapMd},a().createElement(d.Pagination,{className:o.pagination,currentPage:i,numberOfPages:Math.ceil(t/r),onNavigate:e=>{n.setState({currentPage:e}),n.updateBody()}})),a().createElement("span",{className:o.paginationWrap},a().createElement(d.Pagination,{showSmallVersion:!0,className:o.pagination,currentPage:i,numberOfPages:Math.ceil(t/r),onNavigate:e=>{n.setState({currentPage:e}),n.updateBody()}}))):null});var Q=n(34907),K=n(57985),H=n(95002);function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}class X extends c.Bs{}J(X,"Component",({model:e})=>{const t=c.jh.getAncestor(e,he),n=c.jh.getAncestor(e,re),{showPopover:r,tabOptions:s}=n.useState(),i=(0,d.useStyles2)(Z),o=s.map(e=>Y(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){J(e,t,n[t])})}return e}({},e),{icon:e.saved?"save":void 0,label:`${e.label}`}));return a().createElement(d.Stack,{direction:"column",gap:0,role:"tooltip"},a().createElement("div",{className:i.card.body},a().createElement(d.Select,{menuShouldPortal:!1,menuPosition:"absolute",width:50,onBlur:()=>{n.toggleShowPopover()},autoFocus:!0,isOpen:r,placeholder:"Search labels",options:o,isSearchable:!0,openMenuOnFocus:!0,onChange:e=>{e.value&&(n.toggleShowPopover(),t.setSelectedTab(e.value))}})))});const Z=e=>({card:{body:(0,s.css)({padding:e.spacing(1)}),p:(0,s.css)({maxWidth:300})}});function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ee(e,t,n[t])})}return e}function ne(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}class re extends c.Bs{getLabelsFromQueryRunnerState(e=(()=>{var e;return null===(e=this.state.$labelsData)||void 0===e?void 0:e.state})()){var t,n,r;return null===(r=e.data)||void 0===r||null===(n=r.series)||void 0===n||null===(t=n[0])||void 0===t?void 0:t.fields.map(e=>({cardinality:e.values[0],label:e.name}))}populatePrimaryLabelsVariableOptions(e){const t=c.jh.getAncestor(this,he).getSelectedTab(),n=(0,q.sj)((0,m.S9)(this).getValue().toString()),r=e.map(e=>{const r=n.indexOf(e.label);return{active:t===e.label,label:e.label===_.OX?_.ky:e.label,saved:-1!==r,savedIndex:r,value:e.label}}).sort((e,t)=>e.value===_.OX||t.value===_.OX?e.value===_.OX?-1:1:e.label<t.label?-1:e.label>t.label?1:0);this.setState({tabOptions:r})}runDetectedLabels(){this.state.$labelsData.runQueries()}runDetectedLabelsSubs(){this._subs.add(c.jh.getTimeRange(this).subscribeToState(()=>{this.runDetectedLabels()})),this._subs.add((0,m.S9)(this).subscribeToState(()=>{this.runDetectedLabels()}))}onActivate(){this.runDetectedLabels(),this.setState({popover:new X({})}),this.runDetectedLabelsSubs(),this._subs.add((0,m.S9)(this).subscribeToState(()=>{this.state.$labelsData.runQueries()})),this._subs.add((0,m.El)(this).subscribeToState(()=>{var e;const t=this.getLabelsFromQueryRunnerState(null===(e=this.state.$labelsData)||void 0===e?void 0:e.state);t&&this.populatePrimaryLabelsVariableOptions(t)})),this._subs.add(this.state.$labelsData.subscribeToState(e=>{var t;if((null===(t=e.data)||void 0===t?void 0:t.state)===o.LoadingState.Done){const t=this.getLabelsFromQueryRunnerState(e),n=c.jh.getAncestor(this,he);t&&this.populatePrimaryLabelsVariableOptions(t);const r=n.getSelectedTab();(null==t?void 0:t.some(e=>e.label===r))||n.selectDefaultLabelTab()}}))}constructor(e){super(te({$labelsData:(0,Q.HF)({queries:[(0,K.BM)("","detected_labels")],runQueriesMode:"manual"}),showPopover:!1,tabOptions:[{label:_.ky,saved:!0,value:_.OX}]},e)),ee(this,"removeSavedTab",e=>{(0,q.Gg)((0,m.S9)(this).getValue().toString(),e);const t=this.getLabelsFromQueryRunnerState();t&&this.populatePrimaryLabelsVariableOptions(t);const n=c.jh.getAncestor(this,he);n.getSelectedTab()===e&&n.selectDefaultLabelTab()}),ee(this,"toggleShowPopover",()=>{this.setState({showPopover:!this.state.showPopover})}),this.addActivationHandler(this.onActivate.bind(this))}}ee(re,"Component",({model:e})=>{const{$labelsData:t,popover:n,showPopover:l,tabOptions:u}=e.useState(),{data:p}=t.useState(),g=c.jh.getAncestor(e,he);(0,m.El)(e).useState();const h=(0,d.useStyles2)(ae),f=(0,r.useRef)(null);return a().createElement(d.TabsBar,{className:h.tabs},u.filter(e=>e.saved||e.active||e.value===_.OX).sort((e,t)=>{return e.value===_.OX||t.value===_.OX?e.value===_.OX?-1:1:(null!==(n=e.savedIndex)&&void 0!==n?n:0)-(null!==(r=t.savedIndex)&&void 0!==r?r:0);var n,r}).map(t=>{const n=a().createElement(d.Tab,{key:t.value,onChangeTab:()=>{g.setSelectedTab(t.value)},label:(0,H.EJ)(t.label,15,!0),active:t.active,suffix:t.value!==_.OX?n=>a().createElement(a().Fragment,null,a().createElement(d.Tooltip,{content:"Remove tab"},a().createElement(d.Icon,{onKeyDownCapture:n=>{"Enter"===n.key&&e.removeSavedTab(t.value)},onClick:n=>{n.stopPropagation(),e.removeSavedTab(t.value)},name:"times",className:(0,s.cx)(n.className)}))):void 0});return t.label.length>15?a().createElement(d.Tooltip,{key:t.value,content:t.label},n):n}),(null==p?void 0:p.state)===o.LoadingState.Loading&&a().createElement(d.Tab,{label:"Loading tabs",icon:"spinner"}),(null==p?void 0:p.state)===o.LoadingState.Done&&a().createElement("span",{className:h.addTab},a().createElement(d.Tab,{onChangeTab:e.toggleShowPopover,label:"Add label",ref:f,icon:"plus-circle"})),n&&a().createElement(d.PopoverController,{content:a().createElement(n.Component,{model:n})},(e,t,n)=>{const r={onBlur:t,onFocus:e};return a().createElement(a().Fragment,null,f.current&&a().createElement(a().Fragment,null,a().createElement(d.Popover,te(ne(te({},n,i.rest),{show:l,wrapperClassName:h.popover,referenceElement:f.current,renderArrow:!0}),r))))}))});const ae=e=>({addTab:(0,s.css)({"& button":{color:e.colors.primary.text},color:e.colors.primary.text,label:"add-label-tab"}),popover:(0,s.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`,borderRadius:e.shape.radius.default,boxShadow:e.shadows.z3}),tabs:(0,s.css)({overflowY:"hidden"})});var se=n(5570);function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ie(e,t,n[t])})}return e}function le(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const ce=l.config.featureToggles.exploreLogsAggregatedMetrics,ue="__aggregated_metric__",de=(0,o.dateTime)("2024-08-30","YYYY-MM-DD");const pe="var-primary_label",ge="var-ds";class he extends c.Bs{getUrlState(){const{key:e}=fe(),t=(0,m.El)(this).state.filters[0];return t.key&&t.key!==e&&(0,m.El)(this).setState({filters:[le(oe({},t),{key:null!=e?e:t.key})]}),{}}updateFromUrl(e){}addDatasourceChangeToBrowserHistory(e){const t=l.locationService.getLocation(),n=new URLSearchParams(t.search),r=n.get(ge);if(r&&e!==r){const r=t.pathname+t.search;n.set(ge,e);const a=t.pathname+"?"+n.toString();r!==a&&(0,f.ad)(a)}}addLabelChangeToBrowserHistory(e,t=!1){const{key:n,location:r,search:a}=fe();if(n){const s=null==n?void 0:n.split("|");if((null==s?void 0:s[0])!==e){s[0]=e,a.set(pe,s.join("|"));const n=r.pathname+r.search,i=r.pathname+"?"+a.toString();n!==i&&(t?l.locationService.replace(i):(0,f.ad)(i))}}}getSelectedTab(){var e;return null===(e=(0,m.El)(this).state.filters[0])||void 0===e?void 0:e.key}selectDefaultLabelTab(){this.addLabelChangeToBrowserHistory(_.OX,!0),this.setSelectedTab(_.OX)}setSelectedTab(e,t="manual"){(0,q.cO)((0,m.S9)(this).getValue().toString(),e),(0,m.h)(this),(0,m.BL)(e,this),(0,O.EE)(O.NO.service_selection,O.ir.service_selection.add_new_tab,{newTab:e,type:t})}buildServiceLayout(e,t,n,r,a){var s;const i=[];var l;this.isAggregatedMetricsActive()||i.push(new j({name:e,value:t})),i.push(new I({labelName:e,labelValue:t}));const u=c.d0.timeseries().setTitle(t).setData((0,Q.rS)([(0,K.l)(this.getMetricExpression(t,n,r),{legendFormat:`{{${_.e4}}}`,refId:`ts-${t}`,step:n.state.value===ue?"10s":void 0})],{runQueriesMode:"manual"})).setCustomFieldConfig("stacking",{mode:d.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",d.DrawStyle.Bars).setUnit("short").setOverrides(Q.jC).setOption("legend",{calcs:["sum"],displayMode:d.LegendDisplayMode.Table,placement:"right",showLegend:!0}).setHeaderActions([new $.p({ds:null!==(l=null===(s=a.getValue())||void 0===s?void 0:s.toString())&&void 0!==l?l:"",labelName:e,labelValue:t}),...i]).build();u.setState({extendPanelContext:(n,r)=>this.extendTimeSeriesLegendBus(e,t,r,u)});const p=new c.xK({$behaviors:[new c.Gg.K2({key:"serviceCrosshairSync",sync:o.DashboardCursorSync.Crosshair})],body:u});return p.addActivationHandler(()=>{var e;(null===(e=(0,v.oh)(p)[0].state.data)||void 0===e?void 0:e.state)!==o.LoadingState.Done&&this.runPanelQuery(p)}),p}isAggregatedMetricsActive(){const e=this.getQueryOptionsToolbar();return!(null==e?void 0:e.state.options.aggregatedMetrics.disabled)&&(null==e?void 0:e.state.options.aggregatedMetrics.active)}hasDefaultColumnsSet(){return void 0!==c.jh.getAncestor(this,b.P).state.defaultColumnsRecords}getDefaultColumns(e,t){const n=c.jh.getAncestor(this,b.P).state.defaultColumnsRecords;if(n){const a=n.find(n=>1===n.labels.length&&n.labels.every(n=>n.key===e&&n.value===t));var r;return null!==(r=null==a?void 0:a.columns)&&void 0!==r?r:[]}return[]}formatPrimaryLabelForUI(){const e=this.getSelectedTab();return e===_.OX?_.ky:e}setVolumeQueryRunner(){this.setState({$data:(0,Q.HF)({queries:[(0,K.$k)(`{${_.kl}, ${_.ll}}`,"volume",this.getSelectedTab())],runQueriesMode:"manual"})}),this.subscribeToVolume()}doVariablesNeedSync(){const e=(0,m.cR)(this),t=(0,m.aW)(this),n=this.getSelectedTab(),r=e.state.filters.filter(e=>e.key!==n);return{filters:r,needsSync:!(0,p.B)(r,t.state.filters)}}syncVariables(){const e=(0,m.aW)(this),{filters:t,needsSync:n}=this.doVariablesNeedSync();n&&e.setState({filters:t})}onActivate(){var e;this.fixRequiredUrlParams(),this.syncVariables(),this.setVolumeQueryRunner(),this.subscribeToPrimaryLabelsVariable(),this.subscribeToLabelFilterChanges(),this.subscribeToActiveTabVariable((0,m.El)(this)),(null===(e=this.state.$data.state.data)||void 0===e?void 0:e.state)!==o.LoadingState.Done&&this.runVolumeOnActivate(),this.subscribeToTimeRange(),this.subscribeToDatasource(),this.subscribeToAggregatedMetricToggle(),this.subscribeToAggregatedMetricVariable()}runVolumeOnActivate(){var e,t;this.isTimeRangeTooEarlyForAggMetrics()?(this.onUnsupportedAggregatedMetricTimeRange(),(null===(e=this.state.$data.state.data)||void 0===e?void 0:e.state)!==o.LoadingState.Done&&this.runVolumeQuery()):(this.onSupportedAggregatedMetricTimeRange(),(null===(t=this.state.$data.state.data)||void 0===t?void 0:t.state)!==o.LoadingState.Done&&this.runVolumeQuery())}subscribeToAggregatedMetricToggle(){var e;this._subs.add(null===(e=this.getQueryOptionsToolbar())||void 0===e?void 0:e.subscribeToState((e,t)=>{e.options.aggregatedMetrics.userOverride!==t.options.aggregatedMetrics.userOverride&&this.runVolumeQuery(!0)}))}subscribeToDatasource(){this._subs.add((0,m.S9)(this).subscribeToState(e=>{this.setState({body:new c.gF({children:[]})}),this.addDatasourceChangeToBrowserHistory(e.value.toString()),this.runVolumeQuery()}))}subscribeToActiveTabVariable(e){this._subs.add(e.subscribeToState((e,t)=>{if(e.filterExpression!==t.filterExpression){const t=e.filters[0].key;this.addLabelChangeToBrowserHistory(t);const{needsSync:n}=this.doVariablesNeedSync();n?this.syncVariables():this.runVolumeQuery(!0)}}))}subscribeToAggregatedMetricVariable(){this._subs.add((0,m.vm)(this).subscribeToState((e,t)=>{e.value!==t.value&&(this.setState({body:new c.gF({children:[]})}),this.updateBody(!0))}))}subscribeToPrimaryLabelsVariable(){const e=(0,m.cR)(this);this._subs.add(e.subscribeToState((e,t)=>{var n,r,a;(null===(n=e._wip)||void 0===n?void 0:n.key)&&(null===(r=e._wip)||void 0===r?void 0:r.key)!==(null===(a=t._wip)||void 0===a?void 0:a.key)&&0===e.filters.length&&this.setSelectedTab(e._wip.key,"auto"),(0,p.B)(e.filters,t.filters)||this.syncVariables()}))}subscribeToLabelFilterChanges(){const e=(0,m.aW)(this);this._subs.add(e.subscribeToState((e,t)=>{(0,p.B)(e.filters,t.filters)||this.runVolumeQuery(!0)}))}subscribeToVolume(){this._subs.add(this.state.$data.subscribeToState((e,t)=>{var n,r,a;(null===(n=e.data)||void 0===n?void 0:n.state)!==o.LoadingState.Done||(0,p.B)(null==t||null===(r=t.data)||void 0===r?void 0:r.series,null==e||null===(a=e.data)||void 0===a?void 0:a.series)||this.updateBody(!0)}))}subscribeToTimeRange(){this._subs.add(c.jh.getTimeRange(this).subscribeToState(()=>{this.isTimeRangeTooEarlyForAggMetrics()?this.onUnsupportedAggregatedMetricTimeRange():this.onSupportedAggregatedMetricTimeRange(),this.runVolumeQuery()}))}fixRequiredUrlParams(){const{key:e}=fe();e||this.selectDefaultLabelTab()}isTimeRangeTooEarlyForAggMetrics(){return c.jh.getTimeRange(this).state.value.from.isBefore((0,o.dateTime)(de))}onUnsupportedAggregatedMetricTimeRange(){const e=this.getQueryOptionsToolbar();null==e||e.setState({options:{aggregatedMetrics:le(oe({},null==e?void 0:e.state.options.aggregatedMetrics),{disabled:!0})}})}getQueryOptionsToolbar(){var e;return null===(e=c.jh.getAncestor(this,b.P).state.controls)||void 0===e?void 0:e.find(e=>e instanceof S.s)}onSupportedAggregatedMetricTimeRange(){const e=this.getQueryOptionsToolbar();null==e||e.setState({options:{aggregatedMetrics:le(oe({},null==e?void 0:e.state.options.aggregatedMetrics),{disabled:!1})}})}runVolumeQuery(e=!1){e&&this.setVolumeQueryRunner(),this.updateAggregatedMetricVariable(),this.state.$data.runQueries()}updateAggregatedMetricVariable(){const e=(0,m.vm)(this),t=(0,m.cR)(this);if(this.isTimeRangeTooEarlyForAggMetrics()&&ce||!this.isAggregatedMetricsActive()){e.changeValueTo(_.OX),t.setState({hide:u.zL.dontHide}),e.changeValueTo(_.OX);c.jh.findByKeyAndType(this,b.y,y.H).setState({hidden:!1})}else{e.changeValueTo(ue),t.setState({filters:[],hide:u.zL.hideVariable});c.jh.findByKeyAndType(this,b.y,y.H).setState({hidden:!0})}}updateTabs(){if(!this.state.tabs){const e=new re({});this.setState({tabs:e})}}getGridItems(){return this.state.body.state.children}getVizPanel(e){return e.state.body instanceof c.Eb?e.state.body:void 0}runPanelQuery(e){if(e.isActive){const n=(0,v.oh)(e);if(1===n.length){var t;const e=n[0],r=e.state.queries[0],a=null===(t=e.state.data)||void 0===t?void 0:t.timeRange,s=c.jh.getTimeRange(this),i=a?Math.abs(s.state.value.from.diff(null==a?void 0:a.from,"s")):1/0,o=a?Math.abs(s.state.value.to.diff(null==a?void 0:a.to,"s")):1/0,l=c.jh.interpolate(this,r.expr);(e.state.key!==l||i>0||o>0)&&(e.setState({key:l}),e.runQueries())}}}updateBody(e=!1){var t;const{labelsToQuery:n}=this.getLabels(null===(t=this.state.$data.state.data)||void 0===t?void 0:t.series),r=this.getSelectedTab();if(this.updateTabs(),this.state.paginationScene||this.setState({paginationScene:new U({})}),n&&0!==n.length){const t=[],a=this.getGridItems(),s=(0,m.vm)(this),i=(0,m.El)(this),o=(0,m.S9)(this),l=(this.state.currentPage-1)*this.state.countPerPage,c=l+this.state.countPerPage;for(const u of n.slice(l,c)){const n=a.filter(e=>{const t=this.getVizPanel(e);return(null==t?void 0:t.state.title)===u});if(2===n.length)t.push(n[0],n[1]),n[0].isActive&&e&&this.runPanelQuery(n[0]),n[1].isActive&&e&&this.runPanelQuery(n[1]);else{const e=this.buildServiceLayout(r,u,s,i,o),n=this.buildServiceLogsLayout(r,u);t.push(e,n)}}this.state.body.setState({autoRows:"200px",children:t,isLazy:!0,md:{columnGap:1,rowGap:1,templateColumns:"1fr"},templateColumns:"repeat(auto-fit, minmax(350px, 1fr) minmax(300px, calc(70vw - 100px)))"})}else this.state.body.setState({children:[]})}updateServiceLogs(e,t){var n;if(!this.state.body)return void this.updateBody();const{labelsToQuery:r}=this.getLabels(null===(n=this.state.$data.state.data)||void 0===n?void 0:n.series),a=null==r?void 0:r.indexOf(t);if(void 0===a||a<0)return;let s=[...this.getGridItems()];s.splice(2*a+1,1,this.buildServiceLogsLayout(e,t)),this.state.body.setState({children:s})}getLogExpression(e,t,n){if(l.config.featureToggles.kubernetesLogsDrilldown){if(this.hasDefaultColumnsSet()){return this.getDefaultColumns(e,t).length>0?`{${e}=\`${t}\` , ${_.ll} }${n} ${_.gp}`:`{${e}=\`${t}\` , ${_.ll} }${n}`}return`{${e}=\`${t}\` , ${_.ll} }${n} ${_.gp}`}return`{${e}=\`${t}\` , ${_.ll} }${n}`}getMetricExpression(e,t,n){const r=n.state.filters[0];return t.state.value===ue?r.key===_.OX?`sum by (${_.e4}) (sum_over_time({${ue}=\`${e}\` } | logfmt | unwrap count [$__auto]))`:`sum by (${_.e4}) (sum_over_time({${ue}=~\`.+\` } | logfmt | ${r.key}=\`${e}\` | unwrap count [$__auto]))`:`sum by (${_.e4}) (count_over_time({ ${r.key}="${(0,h.Q)(e)}", ${_.ll} } [$__auto]))`}getLabels(e){var t,n,r;const a=null!==(r=null==e||null===(t=e[0])||void 0===t?void 0:t.fields[0].values)&&void 0!==r?r:[],s=null===(n=(0,m.S9)(this).getValue())||void 0===n?void 0:n.toString(),i=(0,m.eY)(this).getValue(),o=this.getSelectedTab(),l=function(e,t,n,r){if(!(null==e?void 0:e.length))return[];".+"===n&&(n="");const a=(0,q.eT)(t,r).filter(t=>t.toLowerCase().includes(n.toLowerCase())&&e.includes(t));return Array.from(new Set([...a,...e]))}(a,s,String(i),o);return{labelsByVolume:a,labelsToQuery:l}}constructor(e){var t,n;super(oe({$data:(0,Q.HF)({queries:[],runQueriesMode:"manual"}),$variables:new c.Pj({variables:[new g.m({hide:u.zL.hideVariable,label:"Service",name:_.Du,skipUrlSync:!0,value:".+"}),new g.m({hide:u.zL.hideLabel,label:"",name:_.Wi,options:[{label:_.OX,value:_.OX},{label:ue,value:ue}],skipUrlSync:!0,value:_.OX}),new c.H9({expressionBuilder:e=>function(e){if(e.length){const t=e[0];return`${t.key}${t.operator}\`${t.value}\``}return""}(e),filters:[{key:null!==(t=fe().key)&&void 0!==t?t:_.OX,operator:"=~",value:".+"}],hide:u.zL.hideLabel,name:_.Gb}),new c.H9({datasource:_.eL,expressionBuilder:K.VW,filters:[],hide:u.zL.hideVariable,key:"adhoc_service_filter_replica",layout:"vertical",name:_.fi,skipUrlSync:!0})]}),body:new c.gF({children:[]}),countPerPage:null!==(n=(0,q.KH)())&&void 0!==n?n:20,currentPage:1,serviceLevel:new Map,showPopover:!1,tabOptions:[{label:_.ky,value:_.OX}]},e)),ie(this,"_urlSync",new c.So(this,{keys:[pe]})),ie(this,"onSearchServicesChange",(0,i.debounce)(e=>{const t=(0,m.eY)(this);(e?(0,K.vC)(e):".+")!==t.state.value&&t.setState({label:null!=e?e:"",value:e?(0,K.vC)(e):".+"});const n=(0,m.El)(this),r=n.state.filters[0];(0,K.vC)(t.state.value.toString())!==r.value&&n.setState({filters:[le(oe({},r),{value:(0,K.vC)(t.state.value.toString())})]}),this.setState({currentPage:1}),(0,O.EE)(O.NO.service_selection,O.ir.service_selection.search_services_changed,{searchQuery:e})},500)),ie(this,"getLevelFilterForService",e=>{let t=this.state.serviceLevel.get(e)||[];if(0===t.length)return"";return` | ${t.map(e=>(e===Q.Iu&&(e=""),`${_.e4}=\`${e}\``)).join(" or ")} `}),ie(this,"buildServiceLogsLayout",(e,t)=>{const n=this.getLevelFilterForService(t),r=this.getDefaultColumns(e,t),a=new c.xK({$behaviors:[new c.Gg.K2({sync:o.DashboardCursorSync.Off})],body:c.d0.logs().setHoverHeader(!0).setData((0,Q.rS)([(0,K.l)(this.getLogExpression(e,t,n),{maxLines:100,refId:`logs-${t}`})],{runQueriesMode:"manual"})).setTitle(t).setOption("showTime",!0).setOption("enableLogDetails",!1).setOption("fontSize","small").setOption("displayedFields",r).build()});return a.addActivationHandler(()=>{var e;(null===(e=(0,v.oh)(a)[0].state.data)||void 0===e?void 0:e.state)!==o.LoadingState.Done&&this.runPanelQuery(a)}),a}),ie(this,"extendTimeSeriesLegendBus",(e,t,n,r)=>{const a=n.onToggleSeriesVisibility;n.onToggleSeriesVisibility=(n,s)=>{var i,o,l;null==a||a(n,s);const c=(0,se.vX)(null!==(l=null===(o=r.state.$data)||void 0===o||null===(i=o.state.data)||void 0===i?void 0:i.series)&&void 0!==l?l:[]),u=(0,se.pC)(n,this.state.serviceLevel.get(t),s,c);this.state.serviceLevel.set(t,u),this.updateServiceLogs(e,t)}}),this.addActivationHandler(this.onActivate.bind(this))}}function fe(){const e=l.locationService.getLocation(),t=new URLSearchParams(e.search),n=t.get(pe),r=null==n?void 0:n.split("|");return{key:null==r?void 0:r[0],location:e,search:t}}function ve(e){return{body:(0,s.css)({display:"flex",flexDirection:"column",flexGrow:1}),bodyWrapper:(0,s.css)({display:"flex",flexDirection:"column",flexGrow:1}),container:(0,s.css)({display:"flex",flexDirection:"column",flexGrow:1,position:"relative"}),header:(0,s.css)({position:"absolute",right:0,top:"4px",zIndex:2}),headingWrapper:(0,s.css)({marginTop:e.spacing(1)}),loadingText:(0,s.css)({margin:0}),searchField:(0,s.css)({marginTop:e.spacing(1),position:"relative"}),searchPaginationWrap:(0,s.css)({[e.breakpoints.down("md")]:{marginTop:e.spacing(1),width:"100%"},alignItems:"center",display:"flex",flex:"1 0 auto",flexWrap:"wrap",label:"search-pagination-wrap"}),searchWrapper:(0,s.css)({[e.breakpoints.down("md")]:{alignItems:"flex-start",flexDirection:"column"},alignItems:"center",display:"flex",flexWrap:"wrap",label:"search-wrapper"})}}ie(he,"Component",({model:e})=>{var t;const n=(0,d.useStyles2)(ve),{$data:r,body:s,paginationScene:i,tabs:l}=e.useState(),{data:c}=r.useState(),u=e.getSelectedTab(),p=(0,m.eY)(e),{label:g,value:h}=p.useState(),v=h&&".+"!==h,{labelsByVolume:b,labelsToQuery:y}=e.getLabels(null==c?void 0:c.series),S=(null==c?void 0:c.state)===o.LoadingState.Loading||(null==c?void 0:c.state)===o.LoadingState.Streaming||void 0===c,O=(null===(t=r.state.data)||void 0===t?void 0:t.state)===o.LoadingState.Error,E=e.formatPrimaryLabelForUI();let x=p.getValue().toString();".+"===x&&(x="");const _=(0,K.sT)(x);var C;return a().createElement("div",{className:n.container},a().createElement("div",{className:n.bodyWrapper},l&&a().createElement(l.Component,{model:l}),a().createElement(d.Field,{className:n.searchField},a().createElement("div",{className:n.searchWrapper},a().createElement(w.f,{initialFilter:{icon:"filter",label:_,value:x},isLoading:S,value:x||g,onChange:t=>(t=>{e.onSearchServicesChange(t)})(t),selectOption:t=>{!function(e,t,n){const r=V(e,t,n);R(e,t,n),(0,f.ad)(r)}(u,t,e)},label:E,options:null!==(C=null==y?void 0:y.map(e=>({label:e,value:e})))&&void 0!==C?C:[]}),!S&&a().createElement("span",{className:n.searchPaginationWrap},i&&a().createElement(U.PageCount,{model:i,totalCount:y.length}),i&&a().createElement(U.Component,{model:i,totalCount:y.length})))),!S&&O&&a().createElement(D,null),!S&&!O&&v&&!(null==b?void 0:b.length)&&a().createElement(N,null),!S&&!O&&!v&&!(null==b?void 0:b.length)&&a().createElement(A,{labelName:u}),!(!S&&O)&&a().createElement("div",{className:n.body},a().createElement(s.Component,{model:s}),a().createElement("div",{className:n.headingWrapper},i&&a().createElement(U.Component,{totalCount:y.length,model:i})))))})},28544:(e,t,n)=>{n.d(t,{Wg:()=>f,lI:()=>y,nz:()=>m});var r=n(85959),a=n.n(r),s=n(15091),i=n(25953),o=n(52165),l=n(88428),c=n(9598),u=n(66732);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){d(e,t,n[t])})}return e}function g(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const h=`${c.s_}.tableColumnWidths`;var f=function(e){return e.text="text",e.labels="labels",e.auto="auto",e}({});const v=(0,r.createContext)({bodyState:"text",clearSelectedLine:()=>{},columns:{},columnWidthMap:{},filteredColumns:{},setBodyState:()=>{},setColumns:()=>{},setColumnWidthMap:()=>{},setFilteredColumns:()=>{}});const m=({children:e,clearSelectedLine:t,initialColumns:n,logsFrame:c,urlColumns:d,displayFields:g,setUrlColumns:f,setUrlTableBodyState:m,urlTableBodyState:y})=>{const[S,w]=(0,r.useState)(b(n)),[O,E]=(0,r.useState)(null!=y?y:"text"),[x,_]=(0,r.useState)(void 0),C=function(){let e={};const t=localStorage.getItem(h);if(t)try{return e=(0,l.Zt)(JSON.parse(t)),!1===e&&i.v.error(new l.QX("getColumnWidthsFromLocalStorage: unable to validate values in local storage"),{msg:"NarrowingError: error parsing table column widths from local storage"}),e}catch(e){i.v.error(e,{msg:"error parsing table column widths from local storage"})}return e}(),[P,k]=(0,r.useState)(C),L=e=>{let t=[];return Object.keys(e).forEach(n=>{e[n].active&&void 0!==e[n].index&&t.push(n)}),t.sort((t,n)=>{const r=e[t],a=e[n];return r.index-a.index}),t},j=(0,r.useCallback)(e=>{if(e){const t=b(e);w(t);let n=[];if(d.length<=0){const e=t[s.mJ]?s.mJ:t[s.Bk]?s.Bk:null;e&&n.push(e),g.length>0&&n.push(...g)}f([...L(t),...n])}},[f,d,g]),F=(0,r.useCallback)(e=>{E(e),m(e),(0,u.bq)(e)},[m]);return(0,r.useEffect)(()=>{n&&j(n)},[n,j]),(0,r.useEffect)(()=>{y&&E(y)},[y]),(0,r.useEffect)(()=>{const e=function(e,t){if(!t)return void i.v.warn("missing dataframe, cannot set url state");const n=Object.keys(e).filter(t=>{var n;return null===(n=e[t])||void 0===n?void 0:n.active}).sort((t,n)=>{const r=e[t],a=e[n];return void 0!==r.index&&void 0!==a.index?r.index-a.index:0}),r=t.timeField,a=t.bodyField;if(r&&a||n.length){const e=[];return(null==r?void 0:r.name)&&e.push(r.name),(null==a?void 0:a.name)&&e.push(a.name),n.length?n:e}return[]}(S,c);if(null==e?void 0:e.length){0===Object.keys(S).filter(e=>S[e].active).length&&function(e,t,n){const r=p({},e);r[(0,o.fF)(n)]={active:!0,cardinality:1/0,index:0,percentOfLinesWithLabel:100,type:"TIME_FIELD"},r[(0,o.Il)(n)]={active:!0,cardinality:1/0,index:1,percentOfLinesWithLabel:100,type:"BODY_FIELD"},t(r)}(S,j,c),_(void 0)}},[S,c,_,j]),a().createElement(v.Provider,{value:{bodyState:O,clearSelectedLine:()=>{t()},columns:S,columnWidthMap:P,filteredColumns:x,setBodyState:F,setColumns:j,setColumnWidthMap:e=>{localStorage.setItem(h,JSON.stringify(e)),k(e)},setFilteredColumns:_}},e)},b=e=>{if("labelTypes"in e){const t=p({},e),{labelTypes:n}=t;return g(t,["labelTypes"])}return e};const y=()=>(0,r.useContext)(v)},9641:(e,t,n)=>{n.d(t,{C:()=>l});var r=n(85959),a=n.n(r),s=n(46089),i=n(82007),o=n(34907);function l(e){return a().createElement("div",{className:o.CT?c.container:void 0},a().createElement(i.RadioButtonGroup,{options:[{description:"Show results in logs visualisation",label:"Logs",value:"logs"},{description:"Show results in table visualisation",label:"Table",value:"table"},{description:"Show results in json visualisation",label:"JSON",value:"json"}],size:"sm",value:e.vizType,onChange:e.onChange}))}const c={container:(0,s.css)({paddingRight:6})}},15091:(e,t,n)=>{n.d(t,{Bk:()=>a,OG:()=>s,ir:()=>i,mJ:()=>r});const r="detected_level",a="level",s=["timestamp","body","Time","Line"],i=["detected_level","level"]},79213:(e,t,n)=>{n.d(t,{TP:()=>a,ss:()=>i});var r=n(18531);const a=(e,t)=>`/apis/${e}/${t}/namespaces/${s()}`,s=()=>r.config.namespace;function i(e){return(0,r.isFetchError)(e)||e instanceof Error?{error:e}:{error:new Error("Unknown error")}}},34702:(e,t,n)=>{n.d(t,{m:()=>i});var r=n(31269),a=n(76644);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i extends a.n8{getValueOptions(e){return(0,r.of)(this.state.options)}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){s(e,t,n[t])})}return e}({name:"",options:[],text:"",type:"custom",value:""},e))}}s(i,"Component",({model:e})=>(0,a.WY)({model:e}))},36464:(e,t,n)=>{n.d(t,{K:()=>g});var r=n(93241),a=n(76644),s=n(66854),i=n(88428),o=n(90708),l=n(66732),c=n(45553),u=n(90020);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){d(e,t,n[t])})}return e}class g{getJoinedLabelsFilters(){let{equalsFilters:e,notEqualsFilters:t,regexEqualFilters:n,regexNotEqualFilters:r}=this.getCombinedLabelFilters();const a=[];return[e,t,n,r].filter(e=>e).forEach(e=>{const t=this.joinCombinedFiltersValues(e,"|");for(const n in e){const r=e[n].operator;a.push({key:n,operator:r,value:t[n]})}}),a}getExpr(){let{equalsFilters:e,gteFilters:t,gtFilters:n,lteFilters:r,ltFilters:a,notEqualsFilters:s,regexEqualFilters:i,regexNotEqualFilters:o}=this.getCombinedLabelFilters();this.options.debug;const l=this.buildLabelsLogQLFromFilters({equalsFilters:e,gteFilters:t,gtFilters:n,lteFilters:r,ltFilters:a,notEqualsFilters:s,regexEqualFilters:i,regexNotEqualFilters:o});var c;return l?(null!==(c=this.options.prefix)&&void 0!==c?c:"")+l:""}getLabelsExpr(e){return this.options=p({},{decodeFilters:!1,filterType:"indexed",joinMatchFilters:!0},e),this.getExpr()}getMetadataExpr(e){return this.options=p({},{decodeFilters:!1,filterSeparator:" |",filterType:"field",joinMatchFilters:!1,prefix:"| "},e),this.getExpr()}getLevelsExpr(e){return this.options=p({},{decodeFilters:!1,filterSeparator:" |",filterType:"field",joinMatchFilters:!1,prefix:"| "},e),this.getExpr()}getFieldsExpr(e){return this.options=p({},{decodeFilters:!0,filterSeparator:" |",filterType:"field",joinMatchFilters:!1,prefix:"| "},e),this.getExpr()}buildLabelsLogQLFromFilters({equalsFilters:e,gteFilters:t,gtFilters:n,lteFilters:a,ltFilters:i,notEqualsFilters:o,regexEqualFilters:l,regexNotEqualFilters:c}){let u,d,p,g,h,f,v,m;const b=[];var y;this.options.joinMatchFilters?(u=this.joinCombinedFiltersValues(e,"|"),d=this.joinCombinedFiltersValues(o,"|"),p=this.joinCombinedFiltersValues(l,"|"),g=this.joinCombinedFiltersValues(c,"|"),b.push(...this.buildJoinedFilters(u,s.KQ.Equal)),b.push(...this.buildJoinedFilters(d,s.KQ.NotEqual)),b.push(...this.buildJoinedFilters(p,s.KQ.RegexEqual)),b.push(...this.buildJoinedFilters(g,s.KQ.RegexNotEqual))):(u=this.getFilterValues(e),d=this.getFilterValues(o),p=this.getFilterValues(l),g=this.getFilterValues(c),b.push(...this.buildFilter(u,s.KQ.Equal)),b.push(...this.buildFilter(d,s.KQ.NotEqual)),b.push(...this.buildFilter(p,s.KQ.RegexEqual)),b.push(...this.buildFilter(g,s.KQ.RegexNotEqual))),h=this.getFilterValues(i),f=this.getFilterValues(a),v=this.getFilterValues(n),m=this.getFilterValues(t),b.push(...this.buildFilter(h,s.Rk.lt)),b.push(...this.buildFilter(f,s.Rk.lte)),b.push(...this.buildFilter(v,s.Rk.gt)),b.push(...this.buildFilter(m,s.Rk.gte)),this.options.debug;const S=(0,r.trim)(this.combineValues(b,`${null!==(y=this.options.filterSeparator)&&void 0!==y?y:","} `));return this.options.debug,S}getCombinedLabelFilters(){const{[s.KQ.Equal]:e,[s.KQ.NotEqual]:t,[s.KQ.RegexEqual]:n,[s.KQ.RegexNotEqual]:r,[s.Rk.lt]:a,[s.Rk.lte]:i,[s.Rk.gt]:o,[s.Rk.gte]:l}=this.groupFiltersByKey(this.filters);let c,u,d,p,g,h,f,v;return this.options.joinMatchFilters?(c=this.combineFiltersValues(e,s.KQ.RegexEqual),u=this.combineFiltersValues(t,s.KQ.RegexNotEqual),d=this.combineFiltersValues(n),p=this.combineFiltersValues(r)):(c=this.combineFiltersValues(e),u=this.combineFiltersValues(t),d=this.combineFiltersValues(n),p=this.combineFiltersValues(r)),g=this.combineFiltersValues(a),h=this.combineFiltersValues(i),f=this.combineFiltersValues(o),v=this.combineFiltersValues(l),this.options.debug,this.options.joinMatchFilters&&(c&&(d=this.mergeFilters(s.KQ.RegexEqual,c,d),c=this.removeStaleOperators(c,s.KQ.Equal)),u&&(p=this.mergeFilters(s.KQ.RegexNotEqual,u,p),u=this.removeStaleOperators(u,s.KQ.NotEqual))),{equalsFilters:c,gteFilters:v,gtFilters:f,lteFilters:h,ltFilters:g,notEqualsFilters:u,regexEqualFilters:d,regexNotEqualFilters:p}}buildFilter(e,t){const n=[];for(const r in e){const a=[],s=e[r];(0,o.iu)(t)?s.forEach(e=>a.push(this.buildFilterString(r,t,e,""))):s.forEach(e=>a.push(this.buildFilterString(r,t,e))),(0,o.BG)(t)?n.push(a.join(` ${this.positiveFilterValueSeparator} `)):n.push(a.join(` ${this.negativeFilterValueSeparator} `))}return n}buildJoinedFilters(e,t){const n=[];for(const r in e)n.push(this.buildFilterString(r,t,e[r]));return n}removeStaleOperators(e,t){const n={};return Object.keys(e).forEach(r=>{e[r].operator===t&&(n[r]=e[r])}),n}mergeFilters(e,t,n){return Object.keys(t).filter(n=>t[n].operator===e).map(e=>({key:e,values:t[e].values})).forEach(r=>{void 0===n&&(n={[r.key]:{operator:e,values:[]}}),void 0===n[r.key]&&(n[r.key]={operator:e,values:[]}),n[r.key].values.push(...this.mergeCombinedFiltersValues(t[r.key],e))}),n}mergeCombinedFiltersValues(e,t){var n;const r=[];return e.operator===t&&(null===(n=e.values)||void 0===n?void 0:n.length)&&r.push(...e.values),r}joinCombinedFiltersValues(e,t){const n={};for(const r in e)e[r].values.length&&(n[r]=this.combineValues(e[r].values,t));return n}getFilterValues(e){const t={};for(const n in e)e[n].values.length&&(t[n]=e[n].values);return t}combineValues(e,t){return e.join(`${t}`)}combineFiltersValues(e,t){let n={};for(const s in e){if(!e[s].length)continue;const o=(0,i.kR)(e[s][0].operator),l=null!=t?t:o,c=e[s][0];if(n[s]={operator:l,values:[]},1===e[s].length){var r;const e=this.escapeFieldValue(c.operator,c.value,null!==(r=c.valueLabels)&&void 0!==r?r:[]);n[s]={operator:o,values:[e]},this.options.debug}else{const t=this.escapeFieldValues(s,e,l);var a;if(void 0===n[s].operator)n[s]={operator:l,values:t};else null===(a=n[s].values)||void 0===a||a.push(...t)}}return n}escapeFieldValues(e,t,n){return t[e].map(e=>{var t;return this.escapeFieldValue(n,e.value,null!==(t=e.valueLabels)&&void 0!==t?t:[])})}escapeFieldValue(e,t,n){const r=(0,u.zE)(t);if(this.options.decodeFilters){t=(0,c.bu)({value:t,valueLabels:n}).value}return t===u.ZO?(this.options.debug,t):r?(this.options.debug,a.Go.escapeLabelValueInExactSelector((0,u.Dx)(t))):(0,o.SM)(e)?(this.options.debug,a.Go.escapeLabelValueInRegexSelector(t)):(this.options.debug,a.Go.escapeLabelValueInExactSelector(t))}buildFilterString(e,t,n,r='"'){if(n===u.ZO)return`${e}${t}${n}`;const a=`${e}${t}${r}${n}${r}`;return this.options.debug,a}groupFiltersByKey(e){let t=e.filter(e=>{var t;return!(null===(t=this.options.ignoreKeys)||void 0===t?void 0:t.includes(e.key))||(0,o.SM)(e.operator)});"indexed"===this.options.filterType&&t.length<1&&(t=e);const n=t.filter(e=>(0,o.BG)(e.operator)&&!(0,o.SM)(e.operator)),a=t.filter(e=>(0,o.BG)(e.operator)&&(0,o.SM)(e.operator)),i=t.filter(e=>(0,o.Lw)(e.operator)&&!(0,o.SM)(e.operator)),l=t.filter(e=>(0,o.Lw)(e.operator)&&(0,o.SM)(e.operator)),c=t.filter(e=>e.operator===s.w7.gt),u=t.filter(e=>e.operator===s.w7.gte),d=t.filter(e=>e.operator===s.w7.lt),p=t.filter(e=>e.operator===s.w7.lte),g=(0,r.groupBy)(n,e=>e.key),h=(0,r.groupBy)(a,e=>e.key),f=(0,r.groupBy)(i,e=>e.key),v=(0,r.groupBy)(l,e=>e.key),m=(0,r.groupBy)(c,e=>e.key),b=(0,r.groupBy)(u,e=>e.key),y=(0,r.groupBy)(d,e=>e.key),S=(0,r.groupBy)(p,e=>e.key);return{[s.w7.Equal]:g,[s.w7.RegexEqual]:h,[s.w7.NotEqual]:f,[s.w7.RegexNotEqual]:v,[s.w7.gt]:m,[s.w7.gte]:b,[s.w7.lt]:y,[s.w7.lte]:S}}constructor(e,t={decodeFilters:!1,filterType:"field",joinMatchFilters:!0}){d(this,"filters",void 0),d(this,"options",void 0),d(this,"positiveFilterValueSeparator","or"),d(this,"negativeFilterValueSeparator","|"),this.filters=e,this.options=t,this.options.debug||(this.options.debug=(0,l.Rb)())}}},84586:(e,t,n)=>{n.d(t,{IR:()=>s,K4:()=>d,N0:()=>u,Rl:()=>p,VM:()=>l,nu:()=>o,tZ:()=>c,yC:()=>i});var r=n(46089),a=n(87781);function s(e,t){if(1===t.length)return e[t[0]];const n=t.shift();return void 0!==n?s(e[n],t):void 0}const i=(e,t)=>(0,a.dateTimeFormat)(e,{defaultWithMS:!0,timeZone:t}),o=e=>({labelButtonsWrap:(0,r.css)({color:"var(--json-tree-label-color)",display:"inline-flex",marginLeft:e.spacing(.5)}),JSONNestedLabelWrapStyles:(0,r.css)({alignItems:"center",color:"var(--json-tree-label-color)",display:"inline-flex",marginLeft:e.spacing(.5)}),JSONLabelWrapStyles:(0,r.css)({alignItems:"center",color:"var(--json-tree-label-color)",display:"inline-flex",marginLeft:e.spacing(1.25)})}),l=(0,r.css)({alignItems:"center",display:"inline-flex"}),c=(0,r.css)({alignItems:"center",display:"flex",overflowX:"auto"}),u=(0,r.css)({marginLeft:"0.5em",marginRight:"0.5em"}),d=(0,r.css)({marginLeft:"0.5em"}),p=(0,r.css)({display:"flex",flexWrap:"nowrap",fontSize:"12px",textWrap:"nowrap"})},78363:(e,t,n)=>{n.d(t,{cd:()=>h,eY:()=>p,f$:()=>g,ld:()=>f});var r=n(87781),a=n(18531),s=n(36464),i=n(48502),o=n(25953),l=n(88100),c=n(90020);function u(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function d(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var s=e.apply(t,n);function i(e){u(s,r,a,i,o,"next",e)}function o(e){u(s,r,a,i,o,"throw",e)}i(void 0)})}}const p=(e,t)=>d(function*(){const n={filters:new s.K(e).getJoinedLabelsFilters()},r=yield t.getTagKeys(n);return(Array.isArray(r)?r:[]).filter(e=>!i.rm.includes(e.text))})();function g(e){return d(function*(){const t=yield(0,a.getDataSourceSrv)().get((0,l.U4)(e));if(!(t instanceof a.DataSourceWithBackend))throw o.v.error(new Error("getTagKeysProvider: Invalid datasource!")),new Error("Invalid datasource!");const n=t,r=e.state.filters;if(n){return{replace:!0,values:yield p(r,n)}}return o.v.error(new Error("getTagKeysProvider: missing or invalid datasource!")),{replace:!0,values:[]}})()}const h=e=>{const t=e.languageProvider;return e&&"function"==typeof t.fetchDetectedFields&&t.fetchDetectedFields.bind(t)||function(t){return function(e,t,n){return d(function*(){if(!("interpolateString"in e)||"function"!=typeof(null==e?void 0:e.interpolateString))throw new Error("Datasource missing interpolateString method");const a=t.expr&&t.expr!==v?e.interpolateString(t.expr,t.scopedVars):void 0;if(!a)throw new Error("fetchDetectedFields requires query expression");const s="detected_fields";var i;const o=null!==(i=null==t?void 0:t.timeRange)&&void 0!==i?i:(0,r.getDefaultTimeRange)(),l=e.getTimeRangeParams(o),{end:c,start:u}=l;var p;const g={end:c,limit:null!==(p=null==t?void 0:t.limit)&&void 0!==p?p:1e3,start:u};return g.query=a,new Promise((t,r)=>d(function*(){try{const r=yield e.getResource(s,g,n);t(r.fields)}catch(e){console.error("error",e),r(e)}})())})()}(e,t)}};function f(e){return d(function*({expr:e,limit:t,sceneRef:n,scopedVars:r,timeRange:s,variableType:i}){const u=yield(0,a.getDataSourceSrv)().get((0,l.U4)(n));if(!(u instanceof a.DataSourceWithBackend))throw o.v.error(new Error("getTagKeysProvider: Invalid datasource!")),new Error("Invalid datasource!");const d={expr:e,limit:t,scopedVars:r,timeRange:s},p=h(u);if(p&&"function"==typeof p){const e=yield p(d);if(e instanceof Error)throw o.v.error(e,{msg:"Failed to fetch detected fields"}),e;const t=e.filter(e=>i===c._Y?e.label===c.e4:i===c.sL&&e.label!==c.e4||null!==e.parsers).map(e=>{if(i===c.sL){var t;let n=1===(null===(t=e.parsers)||void 0===t?void 0:t.length)?e.parsers[0]:"mixed";null===e.parsers&&(n="structuredMetadata");return{group:n,meta:{parser:n,type:e.type},text:e.label,value:e.label}}return{text:e.label,value:e.label}});return t.sort((e,t)=>"structuredMetadata"===e.group&&"structuredMetadata"!==t.group?-1:"structuredMetadata"!==e.group&&"structuredMetadata"===t.group?1:0),{replace:!0,values:t}}return o.v.error(new Error("getTagKeysProvider: missing or invalid datasource!")),{replace:!0,values:[]}}).apply(this,arguments)}const v="{}"},10405:(e,t,n)=>{n.d(t,{Ne:()=>v,O2:()=>f,jw:()=>m});var r=n(93241),a=n(18531),s=n(36464),i=n(66854),o=n(25953),l=n(90708),c=n(88100),u=n(66732),d=n(45553),p=n(90020);function g(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function h(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var s=e.apply(t,n);function i(e){g(s,r,a,i,o,"next",e)}function o(e){g(s,r,a,i,o,"throw",e)}i(void 0)})}}const f=(e,t,n,s,i,u)=>h(function*(){const g=yield(0,a.getDataSourceSrv)().get((0,c.U4)(s));if(!(g instanceof a.DataSourceWithBackend))throw o.v.error(new Error("getTagValuesProvider: Invalid datasource!")),new Error("Invalid datasource!");const h=g.languageProvider;let f=[];if(h&&h.fetchDetectedLabelValues){const a={expr:n,limit:1e3,throwError:!0,timeRange:i},s={showErrorAlert:!1};try{let n=yield h.fetchDetectedLabelValues(e.key,a,s);if(n&&(0,r.isArray)(n)){var v;if(u===p._Y)return{replace:!0,values:n.map(e=>({text:e}))};const r=t.state.filters;let a=[];r.forEach(e=>{var t,n;const r=null!==(n=null===(t=e.valueLabels)||void 0===t?void 0:t[0])&&void 0!==n?n:e.value;(0,l.SM)(e.operator)?r.split("|").forEach(e=>a.push(e)):a.push(r)});const s=n.filter(e=>!a.includes(e));if("structuredMetadata"!==(null===(v=e.meta)||void 0===v?void 0:v.parser)){if(e.value){const t=(0,d.bu)(e,u);return{replace:!0,values:s.map(e=>({text:e,value:JSON.stringify({parser:t.parser,value:e})}))}}return{replace:!0,values:s.map(t=>{var n,r;return{text:t,value:JSON.stringify({parser:null!==(r=null===(n=e.meta)||void 0===n?void 0:n.parser)&&void 0!==r?r:"mixed",value:t})}})}}f=s.map(e=>({text:e}))}else f=[],o.v.error(n,{msg:"fetchDetectedLabelValues error!"})}catch(e){o.v.error(e,{msg:"getDetectedFieldValuesTagValuesProvider: loki missing detected_field/.../values endpoint. Upgrade to Loki 3.3.0 or higher."}),f=[]}}else o.v.warn("getDetectedFieldValuesTagValuesProvider: fetchDetectedLabelValues is not defined in Loki datasource. Upgrade to Grafana 11.4 or higher."),f=[];return{replace:!0,values:f}})();const v=(e,t,n,a)=>h(function*(){const o=function(e,t){let n=e.filter(e=>!((0,l.BG)(t.operator)&&e.key===t.key));return n.some(e=>(0,l.BG)(e.operator))||(n=[]),n}(new s.K(e).getJoinedLabelsFilters(),t),c={filters:o,key:t.key};let d=yield n.getTagValues(c);if((0,r.isArray)(d)){d=d.filter(n=>!e.filter(e=>e.key===t.key).some(e=>{if((0,l.SM)(e.operator)){return e.value.split("|").some(e=>e===n.text)}return e.operator===i.w7.Equal&&e.value===n.text}));const n=(0,u.eT)(a,t.key),r=new Set(n);n.length&&d.sort((e,t)=>(r.has(t.text)?1:-1)-(r.has(e.text)?1:-1))}return d})();function m(e,t){return h(function*(){var n;const r=yield(0,a.getDataSourceSrv)().get((0,c.U4)(e));if(!(r instanceof a.DataSourceWithBackend))throw o.v.error(new Error("getTagValuesProvider: Invalid datasource!")),new Error("Invalid datasource!");const s=r,i=null===(n=(0,d.S9)(e).getValue())||void 0===n?void 0:n.toString(),l=e.state.filters;if(s){return{replace:!0,values:yield v(l,t,s,i)}}return o.v.error(new Error("getTagValuesProvider: missing or invalid datasource!")),{replace:!0,values:[]}})()}},34509:(e,t,n)=>{n.d(t,{EE:()=>s,NO:()=>i,ir:()=>o});var r=n(18531),a=n(62533);const s=(e,t,n,s=!1)=>{const i=((e,t)=>`${a.id.replace(/-/g,"_")}_${e}_${t}`)(e,t);if(s){if(sessionStorage.getItem(i))return;sessionStorage.setItem(i,"1")}(0,r.reportInteraction)(i,n)},i={all:"all",service_details:"service_details",service_selection:"service_selection",default_columns_config:"default_columns_config"},o={[i.service_selection]:{add_to_filters:"add_to_filters",aggregated_metrics_toggled:"aggregated_metrics_toggled",search_services_changed:"search_services_changed",service_selected:"service_selected",add_new_tab:"add_new_tab"},[i.service_details]:{action_view_changed:"action_view_changed",add_to_filters_in_breakdown_clicked:"add_to_filters_in_breakdown_clicked",add_to_filters_in_json_panel:"add_to_filters_in_json_panel",change_line_format_in_json_panel:"change_line_format_in_json_panel",change_viz_type:"change_viz_type",change_query_type:"change_query_type",label_in_panel_summary_clicked:"label_in_panel_summary_clicked",layout_type_changed:"layout_type_changed",level_in_logs_volume_clicked:"level_in_logs_volume_clicked",logs_clear_displayed_fields:"logs_clear_displayed_fields",logs_show_backend_fields:"logs_show_backend_fields",logs_on_query_complete:"logs_on_query_complete",logs_on_query_error:"logs_on_query_error",logs_detail_filter_applied:"logs_detail_filter_applied",logs_popover_line_filter:"logs_popover_line_filter",logs_toggle_displayed_field:"logs_toggle_displayed_field",logs_visualization_toggle:"logs_visualization_toggle",open_in_explore_clicked:"open_in_explore_clicked",pattern_field_clicked:"pattern_field_clicked",pattern_removed:"pattern_removed",pattern_selected:"pattern_selected",search_string_in_logs_changed:"search_string_in_logs_changed",search_string_in_variables_changed:"search_string_in_variables_changed",select_field_in_breakdown_clicked:"select_field_in_breakdown_clicked",toggle_error_panels:"toggle_error_panels",value_breakdown_sort_change:"value_breakdown_sort_change",wasm_not_supported:"wasm_not_supported",embedded_go_to_explore_clicked:"embedded_go_to_explore_clicked",visualization_init:"visualization_init",fields_panel_type_toggle:"fields_panel_type_toggle",table_columns_header_button_reset_width:"table_columns_header_button_reset_width",table_columns_header_button_show_labels:"table_columns_header_button_show_labels",table_columns_header_button_show_text:"table_columns_header_button_show_text",table_columns_header_menu_show:"table_columns_header_menu_show",table_columns_header_menu_reset_width:"table_columns_header_menu_reset_width",table_columns_header_menu_show_labels:"table_columns_header_menu_show_labels",table_columns_header_menu_show_text:"table_columns_header_menu_show_text",table_columns_header_menu_slide_left:"table_columns_header_menu_slide_left",table_columns_header_menu_slide_right:"table_columns_header_menu_slide_right",table_columns_header_menu_hide_column:"table_columns_header_menu_hide_column",embedded_init:"embedded_init",embedded_error:"embedded_error",link_button_click:"link_button_click"},[i.all]:{interval_too_long:"interval_too_long",open_in_explore_menu_clicked:"open_in_explore_menu_clicked"},[i.default_columns_config]:{add_record:"add_record",add_column:"add_column",add_label:"add_label",remove_label:"remove_label",remove_column:"remove_column",delete_record:"delete_record",undo:"undo",save:"save"}}},21532:(e,t,n)=>{n.d(t,{B:()=>s,n:()=>i});var r=n(93241),a=n.n(r);const s=(e,t)=>{if(typeof e!=typeof t)return!1;const n=new Set(e),r=new Set(t);return n.size===r.size&&a().isEqual(n,r)},i=(e,t)=>typeof e==typeof t&&a().isEqual(e,t)},41296:(e,t,n)=>{n.r(t),n.d(t,{DETECTED_FIELDS_CARDINALITY_NAME:()=>O,DETECTED_FIELDS_NAME_FIELD:()=>w,DETECTED_FIELDS_PARSER_NAME:()=>E,DETECTED_FIELDS_PATH_NAME:()=>_,DETECTED_FIELDS_TYPE_NAME:()=>x,MAX_PATTERNS_LIMIT:()=>C,WRAPPED_LOKI_DS_UID:()=>S,WrappedLokiDatasource:()=>P,default:()=>j,mergeLokiSamples:()=>k});var r=n(31269),a=n(87781),s=n(18531),i=n(76644),o=n(48502),l=n(25953),c=n(99330),u=n(9598),d=n(57985),p=n(88100),g=n(89594),h=n(90020);function f(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function v(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var s=e.apply(t,n);function i(e){f(s,r,a,i,o,"next",e)}function o(e){f(s,r,a,i,o,"throw",e)}i(void 0)})}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){m(e,t,n[t])})}return e}function y(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const S="wrapped-loki-ds-uid",w="name",O="cardinality",E="parser",x="type",_="jsonPath",C=500;class P extends i.UU{query(e){return new r.Observable(t=>{var n;if(!(null===(n=e.scopedVars)||void 0===n?void 0:n.__sceneObject))throw new Error("Scene object not found in request");(0,s.getDataSourceSrv)().get((0,p.U4)(e.scopedVars.__sceneObject.valueOf())).then(n=>v(function*(){var r;if(!(n instanceof s.DataSourceWithBackend&&"interpolateString"in n&&"getTimeRangeParams"in n))throw new Error("Invalid datasource!");const a=n;e.targets=null===(r=e.targets)||void 0===r?void 0:r.map(e=>(e.datasource=a,e));const i=new Set;if(e.targets.forEach(e=>{var t;i.add(null!==(t=e.resource)&&void 0!==t?t:"")}),1!==i.size)throw new Error("A request cannot contain queries to multiple endpoints");switch(e.targets[0].resource){case"volume":yield this.getVolume(e,a,t);break;case"patterns":yield this.getPatterns(e,a,t);break;case"detected_labels":yield this.getDetectedLabels(e,a,t);break;case"detected_fields":yield this.getDetectedFields(e,a,t);break;case"labels":yield this.getLabels(e,a,t);break;case"config":yield this.getConfig(e,a,t);break;default:this.getData(e,a,t)}}).call(this))})}getData(e,t,n){const r=s.config.featureToggles.exploreLogsShardSplitting,a=y(b({},e),{targets:t.interpolateVariablesInQueries(e.targets,e.scopedVars).map(e=>y(b({},e),{expr:(0,d.VT)(e.expr),resource:void 0}))});return(!1!==(0,c.E2)(a)&&r?(0,g.C)(t,a):t.query(a)).subscribe(n),n}getPatterns(e,t,n){return v(function*(){const r=e.targets.filter(e=>"patterns"===e.resource);if(1!==r.length)throw new Error("Patterns query can only have a single target!");const{expression:s,interpolatedTarget:i}=this.interpolate(t,r,e);n.next({data:[],state:a.LoadingState.Loading});try{var o;const r=t.getResource("patterns",{end:e.range.to.utc().toISOString(),query:s,start:e.range.from.utc().toISOString(),step:e.interval},{headers:{"X-Query-Tags":`Source=${u.s_}`},showErrorAlert:!1,requestId:null!==(o=e.requestId)&&void 0!==o?o:"patterns"}),l=yield r,c=null==l?void 0:l.data.slice(0,C);let d=-1/0,p=0,g={};c.forEach(e=>{g[e.pattern]?(e.level&&g[e.pattern].levels.push(e.level),g[e.pattern].samples=k(e.samples,g[e.pattern].samples)):g[e.pattern]={samples:e.samples,levels:e.level?[e.level]:[]}});const h=Object.keys(g).map(e=>{const t=[],n=[];let r=0;const s=g[e];return s.samples.forEach(([e,a])=>{t.push(1e3*e),n.push(a),a>d&&(d=a),a<p&&(p=a),a>d&&(d=a),a<p&&(p=a),r+=a}),(0,a.createDataFrame)({fields:[{config:{},name:"time",type:a.FieldType.time,values:t},{config:{},name:e,type:a.FieldType.number,values:n}],meta:{custom:{sum:r,level:s.levels},preferredVisualisationType:"graph"},name:e,refId:i.refId})});h.sort((e,t)=>{var n,r,a,s;return(null===(r=t.meta)||void 0===r||null===(n=r.custom)||void 0===n?void 0:n.sum)-(null===(s=e.meta)||void 0===s||null===(a=s.custom)||void 0===a?void 0:a.sum)}),n.next({data:h,state:a.LoadingState.Done})}catch(e){n.next({data:[],state:a.LoadingState.Error})}return n}).call(this)}interpolate(e,t,n){const r=e.interpolateVariablesInQueries(t,n.scopedVars);if(!r.length)throw new Error("Datasource failed to interpolate query!");const a=r[0];return{expression:(0,d.VT)(a.expr),interpolatedTarget:a}}getDetectedLabels(e,t,n){return v(function*(){const r=e.targets.filter(e=>"detected_labels"===e.resource);if(1!==r.length)throw new Error("Detected labels query can only have a single target!");let{expression:s,interpolatedTarget:i}=this.interpolate(t,r,e);"{}"===s&&(s=""),n.next({data:[],state:a.LoadingState.Loading});try{var l,c,d;const r=null===(c=(yield t.getResource("detected_labels",{end:e.range.to.utc().toISOString(),query:s,start:e.range.from.utc().toISOString()},{headers:{"X-Query-Tags":`Source=${u.s_}`},requestId:null!==(d=e.requestId)&&void 0!==d?d:"detected_labels"})).detectedLabels)||void 0===c||null===(l=c.filter(e=>!o.rm.includes(e.label)))||void 0===l?void 0:l.sort((e,t)=>(0,o.p_)(e,t)),p=null==r?void 0:r.map(e=>({name:e.label,values:[e.cardinality]})),g=(0,a.createDataFrame)({fields:null!=p?p:[],refId:i.refId});n.next({data:[g],state:a.LoadingState.Done})}catch(e){n.next({data:[],state:a.LoadingState.Error})}return n}).call(this)}getDetectedFields(e,t,n){return v(function*(){const r=e.targets.filter(e=>"detected_fields"===e.resource);if(1!==r.length)throw new Error("Detected fields query can only have a single target!");n.next({data:[],state:a.LoadingState.Loading});const{expression:s,interpolatedTarget:i}=this.interpolate(t,r,e);try{var c,d;const r=yield t.getResource("detected_fields",{end:e.range.to.utc().toISOString(),query:s,start:e.range.from.utc().toISOString()},{headers:{"X-Query-Tags":`Source=${u.s_}`},requestId:null!==(d=e.requestId)&&void 0!==d?d:"detected_fields"}),l={config:{},name:w,type:a.FieldType.string,values:[]},p={config:{},name:O,type:a.FieldType.number,values:[]},g={config:{},name:E,type:a.FieldType.string,values:[]},h={config:{},name:x,type:a.FieldType.string,values:[]},f={config:{},name:_,type:a.FieldType.string,values:[]};null===(c=r.fields)||void 0===c||c.forEach(e=>{var t;o.$R.includes(e.label)||(l.values.push(e.label),p.values.push(e.cardinality),g.values.push((null===(t=e.parsers)||void 0===t?void 0:t.length)?e.parsers.join(", "):"structuredMetadata"),h.values.push(e.type),f.values.push(e.jsonPath))});const v=(0,a.createDataFrame)({fields:[l,p,g,h,f],refId:i.refId});n.next({data:[v],state:a.LoadingState.Done})}catch(e){l.v.error(e,{msg:"Detected fields error"}),n.next({data:[],state:a.LoadingState.Error})}return n}).call(this)}getVolume(e,t,n){return v(function*(){if(1!==e.targets.length)throw new Error("Volume query can only have a single target!");const r=e.targets[0],s=r.primaryLabel;if(!s)throw new Error("Primary label is required for volume queries!");const i=t.interpolateVariablesInQueries([r],e.scopedVars),o=(0,d.VT)(i[0].expr.replace(".*.*",".+"));n.next({data:[],state:a.LoadingState.Loading});try{var c,p,g;const r=yield t.getResource("index/volume",{end:e.range.to.utc().toISOString(),limit:5e3,query:o,start:e.range.from.utc().toISOString()},{headers:{"X-Query-Tags":`Source=${u.s_}`},requestId:null!==(g=e.requestId)&&void 0!==g?g:"volume"});null==r||r.data.result.sort((e,t)=>{const n=e.value[1],r=t.value[1];return Number(r)-Number(n)});const i=(0,a.createDataFrame)({fields:[{name:h.OX,values:null==r||null===(c=r.data.result)||void 0===c?void 0:c.map(e=>e.metric[s])},{name:"volume",values:null==r||null===(p=r.data.result)||void 0===p?void 0:p.map(e=>Number(e.value[1]))}]});n.next({data:[i]})}catch(e){l.v.error(e),n.next({data:[],state:a.LoadingState.Error})}return n.complete(),n})()}getConfig(e,t,n){return v(function*(){try{const e=yield t.getResource("drilldown-limits",{},{showErrorAlert:!1,headers:{"X-Grafana-Cache":"private, max-age=86400","X-Query-Tags":`Source=${u.s_}`},requestId:t.uid}),r=(0,a.createDataFrame)({fields:[{name:"drilldown-limits",values:[e]}]});n.next({data:[r],state:a.LoadingState.Done})}catch(e){n.next({data:[],state:a.LoadingState.Error})}return n.complete(),n})()}getLabels(e,t,n){return v(function*(){if(1!==e.targets.length)throw new Error("Volume query can only have a single target!");try{var r;const s=yield t.getResource("labels",{end:e.range.to.utc().toISOString(),start:e.range.from.utc().toISOString()},{headers:{"X-Query-Tags":`Source=${u.s_}`},requestId:null!==(r=e.requestId)&&void 0!==r?r:"labels"}),i=(0,a.createDataFrame)({fields:[{name:"labels",values:null==s?void 0:s.data}]});n.next({data:[i],state:a.LoadingState.Done})}catch(e){n.next({data:[],state:a.LoadingState.Error})}return n.complete(),n})()}testDatasource(){return Promise.resolve({message:"Data source is working",status:"success",title:"Success"})}constructor(e,t){super(e,t)}}function k(e,t){const n=new Map;e.forEach(e=>{n.set(e[0],e[1])}),t.forEach(e=>{if(n.has(e[0])){const t=n.get(e[0]);n.set(e[0],e[1]+(null!=t?t:0))}else n.set(e[0],e[1])});const r=Array.from(n);return r.sort((e,t)=>e[0]-t[0]),r}let L=!1;const j=function(){L||(L=!0,i.Go.registerRuntimeDataSource({dataSource:new P("wrapped-loki-ds",S)}))}},11263:(e,t,n)=>{n.d(t,{X:()=>r});const r="Not supported"},36838:(e,t,n)=>{n.d(t,{O:()=>l,m:()=>o});var r=n(20376),a=n(25953),s=n(45553),i=n(90020);function o(e,t,n=!0){const a=(0,s.ir)(e);let o="";n&&t===i.e4&&(o=`| ${i.e4} != ""`);const l=a.state.filters,c=(0,r.k$)(a);if(l.length){if("mixed"===c)return`sum(count_over_time({${i.S1}} ${o} ${i.S6} ${i.sC} ${i.rl} ${i.YN} ${i.Oc} ${i.jf} [$__auto])) by (${t})`;if("json"===c)return`sum(count_over_time({${i.S1}} ${o} ${i.S6} ${i.sC} ${i.rl} ${i.VL} ${i.Oc} ${i.jf} [$__auto])) by (${t})`;if("logfmt"===c)return`sum(count_over_time({${i.S1}} ${o} ${i.S6} ${i.sC} ${i.rl} ${i.mF} ${i.Oc} ${i.jf} [$__auto])) by (${t})`}return`sum(count_over_time({${i.S1}} ${o} ${i.S6} ${i.sC} ${i.rl} ${i.Oc} ${i.jf} [$__auto])) by (${t})`}function l(e){switch(e){case i._Y:return i.Sy;case i.sL:return i.fJ;default:const t=new Error(`Unknown variable type: ${e}`);throw a.v.error(t,{msg:`getFieldsTagValuesExpression: Unknown variable type: ${e}`,variableType:e}),t}}},3657:(e,t,n)=>{n.d(t,{b:()=>s});var r=n(76644),a=n(41745);function s(e,t){var n,s;if(!function(e){const t=r.jh.getAncestor(e,a.P);return Boolean(null==t?void 0:t.state.embedded)}(t))return;const i=r.jh.getAncestor(t,a.P);return null==i||null===(s=i.state.embeddedOptions)||void 0===s||null===(n=s.emptyStates)||void 0===n?void 0:n[e]}},40696:(e,t,n)=>{n.d(t,{_J:()=>u,wy:()=>d});var r=n(76644),a=n(41745),s=n(10577),i=n(173),o=n(66732),l=n(45553);function c(e){const t=r.jh.getAncestor(e,a.P);r.jh.findAllObjects(t,e=>e instanceof s.p).forEach(e=>e.forceRender());r.jh.findDescendents(t,i.y).forEach(e=>e.forceRender())}function u(e,t,n){const r=(0,l.S9)(n).getValue();(0,o.OB)(r,e,t),c(n)}function d(e,t,n){const r=(0,l.S9)(n).getValue();(0,o.cC)(r,e,t),c(n)}},20376:(e,t,n)=>{n.d(t,{$1:()=>O,Ak:()=>I,JI:()=>j,Jl:()=>$,Mz:()=>R,OE:()=>k,Qg:()=>S,Ri:()=>C,VN:()=>x,Z6:()=>N,Zp:()=>P,at:()=>B,gE:()=>A,k$:()=>L,kz:()=>_,ph:()=>D,vF:()=>M});var r=n(31269),a=n(87781),s=n(76644),i=n(82007),o=n(89924),l=n(61402),c=n(74247),u=n(25953),d=n(52165),p=n(83142),g=n(34907),h=n(45553),f=n(90020),v=n(79405);const m=e=>{if(e){if(Object.values(a.ReducerID).includes(e))return e}};function b(e){switch(e){case"json":return"json";case"logfmt":return"logfmt";case"":case"structuredMetadata":return"structuredMetadata";default:return"mixed"}}function y(e){switch(e){case"int":case"float":case"duration":case"boolean":case"bytes":return e;default:return"string"}}function S(e){var t;const n=new Set(null!==(t=null==e?void 0:e.map(e=>e.toString()))&&void 0!==t?t:[]);n.delete("structuredMetadata");const r=Array.from(n);return 1===r.length?b(r[0]):0===n.size?"structuredMetadata":"mixed"}function w(e){return null==e?void 0:e.fields[0]}function O(e){return null==e?void 0:e.fields[2]}function E(e){return null==e?void 0:e.fields[3]}function x(e){return null==e?void 0:e.fields[4]}function _(e,t){var n;const r=s.jh.getAncestor(e,l.Mn),a=(0,l.tn)(null===(n=r.state.$data)||void 0===n?void 0:n.state.data),i=null==a?void 0:a.fields.find(e=>"labels"===e.name),o=null==i?void 0:i.values.reduce((e,n)=>((null==n?void 0:n[t])&&e++,e),0);if(void 0!==o&&a&&a.length>0){const n=(o/a.length*100).toLocaleString();let r=`${t} exists on ${n}% of ${null==a?void 0:a.length} sampled log lines`;const s=(0,l.rD)(e),i=function(e,t){const n=w(t),r=function(e){return null==e?void 0:e.fields[1]}(t),a=null==n?void 0:n.values.findIndex(t=>t===e);var s;if(void 0!==a&&-1!==a)return null==r||null===(s=r.values)||void 0===s?void 0:s[a]}(t,s);return void 0!==i&&(r+=`, and contains ${i} unique values`),{cardinality:i?parseInt(i,10):void 0,description:r,sparsity:parseInt(n,10)}}return{cardinality:void 0,description:void 0,sparsity:void 0}}function C(e,t){var n;const r=(0,l.rD)(t),a=O(r),s=w(r),i=null==s?void 0:s.values.indexOf(e);var o;const c=void 0!==i&&-1!==i?b(null!==(o=null==a||null===(n=a.values)||void 0===n?void 0:n[i])&&void 0!==o?o:""):void 0;return void 0===c?(u.v.warn("missing parser, using mixed format for",{fieldName:e}),"mixed"):c}function P(e,t,n,a,l){return(c,u)=>{const d=m(a.state.sortBy),p=s.d0.timeseries().setOption("legend",{showLegend:!1}).setCustomFieldConfig("fillOpacity",9).setTitle(e(c)).setShowMenuAlways(!0).setData(new s.Es({transformations:[()=>function(e){return t=>t.pipe((0,r.map)(()=>[e]))}(c)]})).setOverrides(g.jC).setMenu(new o.GD({})).setHeaderActions([new v.oR({frame:c,hideExclude:l===f.e4,variableName:n})]);return t===i.DrawStyle.Bars&&p.setCustomFieldConfig("stacking",{mode:i.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setOverrides(g.jC).setCustomFieldConfig("drawStyle",i.DrawStyle.Bars),d&&(p.setOption("legend",{calcs:[d],showLegend:!0}),p.setDisplayName(" ")),new s.xK({body:p.build()})}}function k(e,t,n){const r=e?(0,p.E)(t,e):c.H.Parsed;if(r)return function(e,t){switch(e){case c.H.Indexed:return f.MB;case c.H.Parsed:return f.mB;case c.H.StructuredMetadata:return t===f.e4?f._Y:f._P;default:{const n=new Error(`Invalid label type for ${t}`);throw u.v.error(n,{msg:`Invalid label type for ${t}`,type:e}),n}}}(r,t);const a=C(t,n);return"structuredMetadata"===a?f._P:(u.v.warn("unable to determine label variable, falling back to parsed field",{key:t,parserForThisField:null!=a?a:""}),f.mB)}function L(e){return S(e.state.filters.map(e=>(0,h.bu)(e).parser))}function j(e){return"duration"===e||"bytes"===e||"float"===e}const F=(e,t)=>`avg_over_time(${(0,h.DX)(e)} | unwrap `+t+' | __error__="" [$__auto]) by ()',T=(e,t)=>`sum by (${e}) (count_over_time(${(0,h.DX)(t)} [$__auto]))`;function D(e,t){var n;const r=w(t),a=E(t),s=null==r?void 0:r.values.indexOf(e);return void 0!==s&&-1!==s?y(null==a||null===(n=a.values)||void 0===n?void 0:n[s]):void 0}function $(e,t,n,r,a){var s,i,o;const l=w(n),c=E(n),d=O(n),p=x(n),g=null==l?void 0:l.values.indexOf(e),f=void 0!==g&&-1!==g?b(null==d||null===(s=d.values)||void 0===s?void 0:s[g]):"mixed",v=void 0!==g&&-1!==g?y(null==c||null===(i=c.values)||void 0===i?void 0:i[g]):void 0,m=void 0!==g&&-1!==g?null==p||null===(o=p.values)||void 0===o?void 0:o[g]:void 0,_=t.state.filters.map(e=>{var t;const n=null==l?void 0:l.values.indexOf(e.key),r=(0,h.bu)(e);if(r.parser)return r.parser;var a;const s=void 0!==n&&-1!==n?b(null!==(a=null==d||null===(t=d.values)||void 0===t?void 0:t[n])&&void 0!==a?a:"mixed"):void 0;return null!=s?s:"mixed"}),C=S([..._,f]);let P="",k="";"structuredMetadata"===f?k=`| ${e}!=""`:P=`| ${e}!=""`;const L={fieldExpressionToAdd:P,fieldType:v,parser:C,structuredMetadataToAdd:k,queryType:a};if(("json"===C||"mixed"===C)&&m){const n=R(m),a=t.state.filters,s=null==r?void 0:r.state.filters;a.every(e=>null==s?void 0:s.some(t=>e.key===t.key))?L.jsonParserPropToAdd=(null==r?void 0:r.state.filters.length)?`${e}="${n}",`:`${e}="${n}"`:u.v.warn("missing json path for field filters",{fieldFilters:JSON.stringify(a),jsonFilters:JSON.stringify(s)})}return function(e,t){return t.fieldType&&["bytes","duration"].includes(t.fieldType)?`avg_over_time(${(0,h.DX)(t)} | unwrap `+t.fieldType+`(${e}) | __error__="" [$__auto]) by ()`:!t.fieldType||"float"!==t.fieldType&&"avg"!==t.queryType?T(e,t):F(t,e)}(e,L)}function N(e){return e===d.wu||e===d.eB}function A(e){return e===d.bz}function B(e){return e===d.wd}function M(e){return e===d.BR}function I(e){const t=(0,h.ir)(e),n=(0,h.Gc)(e),r=(0,h.U2)(e);t.state.filters.length||r.state.filters.length||n.setState({filters:[]})}function R(e){var t;return null===(t=e.map(e=>`[\\"${e}\\"]`))||void 0===t?void 0:t.join("")}},48502:(e,t,n)=>{n.d(t,{$R:()=>u,AY:()=>v,OH:()=>f,Oc:()=>y,X:()=>m,dD:()=>p,gR:()=>b,p_:()=>d,rd:()=>h,rm:()=>g,uE:()=>c});var r=n(93241),a=n(20376),s=n(66854),i=n(80042),o=n(45553),l=n(90020);const c=" ",u=["level_extracted",l.e4,"level"];function d(e,t){return 1===e.cardinality?1:1===t.cardinality?-1:e.cardinality-t.cardinality}function p(e){const t=[...e];e.includes(l.e4)||t.unshift(l.e4);const n=t.map(e=>({label:e,value:String(e)}));return[{label:"All",value:l.To},...n]}const g=["__aggregated_metric__","__stream_shard__"];function h(e){const t=[...e].map(e=>({label:e,value:String(e)}));return[{label:"All",value:l.To},...t]}function f(e){var t;return((0,l.zE)(e.value)?(0,l.Dx)(e.value):e.value)===(null===(t=e.valueLabels)||void 0===t?void 0:t[0])}function v(e){const t=(0,o.U2)(e).state.filters,n=(0,o.ir)(e),r=(0,o.Gc)(e),a=new Set;t.forEach(e=>{a.add(e.key)});const s=new Set;n.state.filters.forEach(e=>s.add(e.key));const i=r.state.filters.filter(e=>{let n=!1,r=[];n=t.some(t=>{r.push(t.key);return r.join("_")===e.key});return s.has(e.key)||n});r.setState({filters:i})}function m(e){const t=(0,o.U2)(e);v(e),t.setState({filters:[]})}function b(e,t){const n=(0,o.Gc)(e),l=S(t),c=function(e){return e.match(i.HO)&&(e=e.replace(i.HO,"_")),e}(y(t)),u=[...t];let d=u.shift(),p=[...n.state.filters.filter(e=>e.key!==c),{key:c,operator:s.w7.Equal,value:l}];for(;d&&!(0,a.Z6)(d.toString())&&!(0,r.isNumber)(d)&&"root"!==d;){const e=y(u),t=S(u);e&&!p.find(n=>n.key===e&&n.value===t&&n.operator===s.w7.Equal)&&(p=[...p.filter(t=>t.key!==e),{key:e,operator:s.w7.Equal,value:t}]),d=u.shift()}n.setState({filters:p})}function y(e){return w(e).join("_")}function S(e){const t=w(e);return(0,a.Mz)(t)}function w(e){let t;const n=[...e],s=[];for(;(t=n.shift())&&!(0,a.Z6)(t.toString())&&!(0,r.isNumber)(t)&&"root"!==t;)s.unshift(t);return s}},38839:(e,t,n)=>{n.d(t,{K:()=>s,Q:()=>a});var r=n(87781);function a(e){return e===r.LogsSortOrder.Ascending||e===r.LogsSortOrder.Descending}function s(e){const t=Object.values(r.LogsDedupStrategy).map(e=>e.toString());return"string"==typeof e&&t.includes(e)}},80042:(e,t,n)=>{n.d(t,{CP:()=>y,HO:()=>w,R7:()=>v,_t:()=>b,de:()=>h,di:()=>d,ec:()=>m,fx:()=>O,oj:()=>p,uV:()=>g,zr:()=>f});var r=n(79405),a=n(20376),s=n(5570),i=n(90708),o=n(57985),l=n(45553),c=n(90020),u=n(15091);const d="repeat(auto-fit, minmax(400px, 1fr))";function p(e,t,n){let r="",s="";const i=(0,l.ir)(e),u=(0,a.k$)(i);return n&&n!==c.e4?r=` ,${n} != ""`:n&&n===c.e4&&(s=` | ${n} != ""`),(0,o.l)(`sum(count_over_time(${(0,l.DX)({labelExpressionToAdd:r,parser:u,structuredMetadataToAdd:s})} [$__auto])) by (${t})`,{legendFormat:`{{${t}}}`,refId:"LABEL_BREAKDOWN_VALUES"})}function g(e){const t=new Set;for(const n of e){const e=n.fields.find(e=>"labels"===e.name&&e.values);if(e&&e.values&&e.values.length>0)for(const n of e.values)if(n&&"object"==typeof n){Object.keys(n).forEach(e=>t.add(e))}}return Array.from(t)}function h(e){return e.map(e=>(0,s.H7)(e)).flatMap(e=>e?[e]:[])}function f(e,t,n){const s=(0,l.YS)(n),o=0===s.state.filters.length,u="structuredMetadata"===(0,a.Ri)(e,n),d=s.state.filters.find(e=>u?(0,i.BG)(e.operator)&&e.value===t:(0,i.BG)(e.operator)&&(0,l.bu)(e).value===t);return o||!d?((0,r.Qt)(e,t,"include",n,u?c._P:c.mB),"include"):((0,r.Qt)(e,t,"toggle",n,u?c._P:c.mB),"toggle")}function v(e,t,n){const a=(0,l.cR)(n),s=0===a.state.filters.length,o=a.state.filters.find(e=>e.value===t&&(0,i.BG)(e.operator));return s||!o?((0,r.Qt)(e,t,"include",n,c.MB),"include"):((0,r.Qt)(e,t,"toggle",n,c.MB),"toggle")}function m(e,t,n){return S(e,t,(0,l.cR)(n))}function b(e,t,n){return S(e,t,(0,l.ir)(n))}function y(e,t,n){return S(e,t,(0,l.oY)(n))}function S(e,t,n){const r=n.state.filters.filter(t=>t.key===e&&(0,i.BG)(t.operator)).map(e=>n.state.name===c.mB?(0,l.bu)(e).value:e.value),a=n.state.filters.filter(t=>t.key===e&&(0,i.Lw)(t.operator)).map(e=>n.state.name===c.mB?(0,l.bu)(e).value:e.value);return t.filter(e=>!a.includes(e)&&(0===r.length||r.includes(e)))}const w=/[^a-zA-Z0-9_:]/g;function O(e){return e===u.mJ||e===u.Bk}},5570:(e,t,n)=>{n.d(t,{Bi:()=>g,Ex:()=>p,H7:()=>d,PE:()=>h,pC:()=>c,vX:()=>u});var r=n(82007),a=n(90708),s=n(34907),i=n(45553),o=n(90020),l=n(79405);function c(e,t,n,a){if(n===r.SeriesVisibilityChangeMode.ToggleSelection){const n=null!=t?t:[];return 1===n.length&&n.includes(e)?[]:[e]}let s=(null==t?void 0:t.length)?t:a;return s.includes(e)?s.filter(t=>t!==e):[...s,e]}function u(e){return e.map(e=>{var t;return null!==(t=d(e))&&void 0!==t?t:s.Iu})}function d(e){var t;const n=null===(t=e.fields[1])||void 0===t?void 0:t.labels;if(!n)return null;const r=Object.keys(n);return 0===r.length?null:n[r[0]]}function p(e,t){const n=(0,i.iw)(t),r=n.state.filters.filter(e=>(0,a.BG)(e.operator)).map(e=>e.value.split("|").map(g)).join("|"),s=n.state.filters.filter(e=>(0,a.Lw)(e.operator)).map(e=>e.value.split("|").map(g)).join("|");return e.filter(e=>!s.includes(e)&&(0===r.length||r.includes(e)))}function g(e){return'""'===e?s.Iu:e}function h(e,t){e===s.Iu&&(e='""');const n=(0,i.iw)(t),r=0===n.state.filters.length,c=n.state.filters.find(t=>t.value===e&&(0,a.BG)(t.operator));return r||!c?((0,l.Qt)(o.e4,e,"include",t,o._Y),"include"):((0,l.Qt)(o.e4,e,"toggle",t,o._Y),"toggle")}},99330:(e,t,n)=>{n.d(t,{Bg:()=>p,E2:()=>c,Yb:()=>d,sI:()=>l,tO:()=>g});var r=n(12344),a=n(73257);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){s(e,t,n[t])})}return e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function l(e){return e.trim().length>2&&!function(e,t){let n=!1;return r.K3.parse(e).iterate({enter:({type:e})=>{if(e.id===t)return n=!0,!1}}),n}(e,r.Yw)}function c(e){if(function(e){return void 0!==e.targets.find(e=>l(e.expr))}(e))return!1;if(function(e){return e.targets.find(e=>"instant"===e.queryType)}(e))return!1;for(let n=0;n<e.targets.length;n++){var t;if(null===(t=e.targets[n].expr)||void 0===t?void 0:t.includes("avg_over_time"))return!1}return!0}const u="__stream_shard_number__",d=e=>e.replace("}",`, __stream_shard__=~"${u}"}`),p=(e,t)=>{if(void 0===t||0===t.length)return e.map(e=>o(i({},e),{expr:e.expr.replace(`, __stream_shard__=~"${u}"}`,"}")}));let n=t.join("|");return"-1"===n||1===t.length?(n="-1"===n?"":n,e.map(e=>o(i({},e),{expr:e.expr.replace(`, __stream_shard__=~"${u}"}`,`, __stream_shard__="${n}"}`)}))):e.map(e=>o(i({},e),{expr:e.expr.replace(new RegExp(`${u}`,"g"),n)}))},g=e=>{const t=(0,a.QH)(e,[r.MD]);return t.length>0?e.substring(t[0].from,t[0].to).replace(`, __stream_shard__=~"${u}"}`,"}"):""}},52165:(e,t,n)=>{n.d(t,{BR:()=>c,Il:()=>f,Os:()=>g,bz:()=>u,eB:()=>i,fF:()=>h,hy:()=>y,po:()=>v,wd:()=>d,wu:()=>o,y2:()=>S,z5:()=>m});var r=n(87781);function a(e,t,n){const r=e.getFieldByName(t);if(void 0!==r)return r.type===n?r:void 0}const s="timestamp",i="body",o="Line",l="severity",c="id",u="labels",d="labelTypes";function p(e){const t={};return Object.entries(e).forEach(([e,n])=>{t[e]="string"==typeof n?n:JSON.stringify(n)}),t}function g(e){var t;return(null===(t=e.meta)||void 0===t?void 0:t.type)===r.DataFrameType.LogLines?function(e){const t=new r.FieldCache(e),n=a(t,s,r.FieldType.time),o=a(t,i,r.FieldType.string);if(void 0===n||void 0===o)return null;var d;const g=null!==(d=a(t,l,r.FieldType.string))&&void 0!==d?d:null;var h;const f=null!==(h=a(t,c,r.FieldType.string))&&void 0!==h?h:null;var v;const m=null!==(v=a(t,u,r.FieldType.other))&&void 0!==v?v:null,b=null===m?null:m.values,y=t.fields.filter((e,t)=>t!==n.index&&t!==o.index&&t!==(null==g?void 0:g.index)&&t!==(null==f?void 0:f.index)&&t!==(null==m?void 0:m.index));return{bodyField:o,extraFields:y,getLabelFieldName:()=>null!==m?m.name:null,getLogFrameLabels:()=>b,getLogFrameLabelsAsLabels:()=>null!==b?b.map(p):null,idField:f,raw:e,severityField:g,timeField:n,timeNanosecondField:null}}(e):function(e){const t=new r.FieldCache(e),n=t.getFirstFieldOfType(r.FieldType.time),a=t.getFirstFieldOfType(r.FieldType.string);if(void 0===n||void 0===a)return null;var s;const i=null!==(s=t.getFieldByName("tsNs"))&&void 0!==s?s:null;var o;const l=null!==(o=t.getFieldByName("level"))&&void 0!==o?o:null;var c;const u=null!==(c=t.getFieldByName("id"))&&void 0!==c?c:null,[d,g]=function(e,t,n){const a=e.getFieldByName("labels");if(void 0!==a&&a.type===r.FieldType.other){const e=a.values.map(p);return[a,()=>e]}return[null,()=>function(e,t){const n=e.labels;if(void 0!==n){const e=new Array(t);return e.fill(n),e}return null}(t,n.length)]}(t,a,e),h=t.fields.filter((e,t)=>t!==n.index&&t!==a.index&&t!==(null==i?void 0:i.index)&&t!==(null==l?void 0:l.index)&&t!==(null==u?void 0:u.index)&&t!==(null==d?void 0:d.index));return{bodyField:a,extraFields:h,getLabelFieldName:()=>{var e;return null!==(e=null==d?void 0:d.name)&&void 0!==e?e:null},getLogFrameLabels:g,getLogFrameLabelsAsLabels:g,idField:u,raw:e,severityField:l,timeField:n,timeNanosecondField:i}}(e)}function h(e){var t;return null!==(t=null==e?void 0:e.timeField.name)&&void 0!==t?t:s}function f(e){var t;return null!==(t=null==e?void 0:e.bodyField.name)&&void 0!==t?t:i}function v(e){var t,n;return null!==(n=null==e||null===(t=e.idField)||void 0===t?void 0:t.name)&&void 0!==n?n:c}function m(e){var t;let n=0,a=0;const s=null===(t=e[0])||void 0===t?void 0:t.fields.find(e=>e.type===r.FieldType.time);if(s){const e=[...s.values].sort(),t=e[0]<e[e.length-1];n=t?e[0]:e[e.length-1],a=t?e[e.length-1]:e[0]}return{end:a,start:n}}const b="Visible range";function y(e,t){const n=(0,r.arrayToDataFrame)([{color:"rgba(58, 113, 255, 0.3)",isRegion:!0,text:"Range from oldest to newest logs in display",time:e,timeEnd:t}]);return n.name=b,n.meta={dataTopic:r.DataTopic.Annotations},n}function S(e){return 0===e.length||0===e[0].fields[0].values.length}},72152:(e,t,n)=>{function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let a;function s(e=!1){a&&!e||(a=new i)}n.d(t,{JO:()=>o,rX:()=>s});class i{getServiceSceneState(){return this.serviceSceneState}setPatternsCount(e){this.serviceSceneState||(this.serviceSceneState={}),this.serviceSceneState.patternsCount=e}setLabelsCount(e){this.serviceSceneState||(this.serviceSceneState={}),this.serviceSceneState.labelsCount=e}setEmbedded(e){this.serviceSceneState||(this.serviceSceneState={}),this.serviceSceneState.embedded=e}setFieldsCount(e){this.serviceSceneState||(this.serviceSceneState={}),this.serviceSceneState.fieldsCount=e}setServiceSceneState(e){this.serviceSceneState={embedded:e.embedded,fieldsCount:e.fieldsCount,labelsCount:e.labelsCount,loading:e.loading,logsCount:e.logsCount,patternsCount:e.patternsCount,totalLogsCount:e.totalLogsCount}}setLokiConfig(e){this.lokiConfig=e}getLokiConfig(){return this.lokiConfig}setDefaultColumns(e,t){this.defaultColumns[t]=e}getDefaultColumns(e){return this.defaultColumns[e]}constructor(){r(this,"serviceSceneState",void 0),r(this,"lokiConfig",void 0),r(this,"defaultColumns",{})}}function o(){return a}},67478:(e,t,n)=>{n.d(t,{FB:()=>m,Ns:()=>x,Vt:()=>w,ad:()=>O,bN:()=>E,fg:()=>b,k9:()=>y,rs:()=>S});var r=n(87781),a=n(18531),s=n(76644),i=n(41745),o=n(88469),l=n(77839),c=n(47389),u=n(72152),d=n(9598),p=n(69683),g=n(90020);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let f;function v(e,t){return r.urlUtil.renderUrl(e,function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){h(e,t,n[t])})}return e}({},Object.entries(r.urlUtil.getUrlSearchParams()).reduce((e,[t,n])=>(p.tm.includes(t)&&(e[t]=n),e),{}),e)}(t))}function m(e,t,n){var p,h;const f=s.jh.getAncestor(n,i.P),m=null===(p=f.state.routeMatch)||void 0===p?void 0:p.params.labelName,b=null===(h=f.state.routeMatch)||void 0===h?void 0:h.params.labelValue;if(!f.state.embedded&&m&&b){let r=function(e,t,n,r="service"){return e===g.To&&t===l._J.label?(0,d._F)(`${l.G3.explore}/${r}/${(0,c.uu)(n)}/${l.G3.labels}`):e===g.To&&t===l._J.field?(0,d._F)(`${l.G3.explore}/${r}/${(0,c.uu)(n)}/${l.G3.fields}`):(0,d._F)(`${l.G3.explore}/${r}/${(0,c.uu)(n)}/${t}/${(0,c.uu)(e)}`)}(t,e,b,m);const a=v(r);if(n){(0,u.JO)().setServiceSceneState(n.state)}return a}return function(e,t,n){return n[o.Z]=t,n[o.o]=e,v(a.locationService.getLocation().pathname,n)}(t,e,r.urlUtil.getUrlSearchParams())}function b(e,t,n){const r=m(e,t,n);r&&O(r)}function y(e,t,n){return v(p.bw.logs(t,e),n)}function S(e,t,n){var u,p;const g=s.jh.getAncestor(t,i.P),h=null===(u=g.state.routeMatch)||void 0===u?void 0:u.params.labelValue,f=null===(p=g.state.routeMatch)||void 0===p?void 0:p.params.labelName;if(h&&!t.state.embedded){return v((0,d._F)(`${l.G3.explore}/${f}/${(0,c.uu)(h)}/${e}`),n)}if(t.state.embedded){const t=a.locationService.getLocation();return void 0===n&&(n=r.urlUtil.getUrlSearchParams()),n[o.Z]=e,n[o.o]=void 0,v(t.pathname,n)}throw new Error("Unable to build drilldown tab link!")}function w(e,t,n){const r=S(e,t,n);if(r){if(t){(0,u.JO)().setServiceSceneState(t.state)}O(r)}else;}function O(e){f=e,a.locationService.push(e)}function E(){const e=a.locationService.getLocation();a.locationService.push(e.pathname+e.search)}function x(){const e=a.locationService.getLocation(),t=(0,p.qe)(p.bw.explore()),n=e.pathname+e.search,r=a.locationService.getSearch();var s,i,o;t===n||n.includes(t)||null!==(o=null===(i=(0,u.JO)())||void 0===i||null===(s=i.getServiceSceneState())||void 0===s?void 0:s.embedded)&&void 0!==o&&o||(r.get("var-filters")?O(t):(f&&a.locationService.replace(f),a.locationService.push(t)))}},34907:(e,t,n)=>{n.d(t,{C6:()=>F,CT:()=>V,FH:()=>A,FY:()=>k,HF:()=>I,Iu:()=>y,Nr:()=>D,V6:()=>B,dO:()=>T,jC:()=>P,qi:()=>R,rS:()=>M,wx:()=>C});var r=n(31269),a=n(87781),s=n(35591),i=n(18531),o=n(76644),l=n(82007),c=n(61402),u=n(41296),d=n(20376),p=n(80042),g=n(5570),h=n(57985),f=n(89594);function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){v(e,t,n[t])})}return e}function b(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const y="logs",S=/^(info|information)$/i,w=/^debug$/i,O=/^(warn|warning)$/i,E=/^(error|errors)$/i,x=/^(crit|critical|fatal|severe)$/i,_=/^(logs|unknown)$/i,C={"log-token-info":S,"log-token-debug":w,"log-token-warning":O,"log-token-error":E,"log-token-critical":x,"log-token-unknown":_};function P(e){e.matchFieldsWithNameByRegex(S.toString()).overrideColor({fixedColor:"semi-dark-green",mode:"fixed"}),e.matchFieldsWithNameByRegex(w.toString()).overrideColor({fixedColor:"semi-dark-blue",mode:"fixed"}),e.matchFieldsWithNameByRegex(O.toString()).overrideColor({fixedColor:"semi-dark-orange",mode:"fixed"}),e.matchFieldsWithNameByRegex(E.toString()).overrideColor({fixedColor:"semi-dark-red",mode:"fixed"}),e.matchFieldsWithNameByRegex(x.toString()).overrideColor({fixedColor:"#705da0",mode:"fixed"}),e.matchFieldsWithNameByRegex(_.toString()).overrideColor({fixedColor:"darkgray",mode:"fixed"})}function k(e){return e.setOverrides(P)}function L(e){return e.setCustomFieldConfig("stacking",{mode:l.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",l.DrawStyle.Bars)}function j(e,t){t.match({id:a.FieldMatcherID.byNames,options:{mode:"exclude",names:e,prefix:"All except:",readOnly:!0}}).overrideCustomFieldConfig("hideFrom",{legend:!1,tooltip:!1,viz:!0});const n=t.build();n[n.length-1].__systemRef="hideSeriesFrom"}function F(e,t,n){const r=(0,g.Ex)((0,g.vX)(t),n),a=k(o.No.timeseries()).setOverrides(j.bind(null,r));if(a instanceof o.OS&&e.getPlugin()){const t={overrides:a.build().overrides,defaults:e.state.fieldConfig.defaults};e.onFieldConfigChange(t,!0)}}function T(e,t,n,r){const a=(0,p.de)(n),s=(0,p.ec)(e,a,r),i=L(o.No.timeseries());s.length&&i.setOverrides(j.bind(null,s)),i instanceof o.OS&&t.onFieldConfigChange(i.build(),!0)}function D(e,t,n,r){const a=(0,p.de)(n),s="structuredMetadata"===(0,d.Ri)(e,r)?(0,p.CP)(e,a,r):(0,p._t)(e,a,r),i=L(o.No.timeseries());s.length&&i.setOverrides(j.bind(null,s)),i instanceof o.OS&&t.onFieldConfigChange(i.build(),!0)}function $(){return e=>e.pipe((0,r.map)(e=>e.map((t,n)=>b(m({},t),{fields:t.fields.map((n,r)=>{if(n.type===a.FieldType.time)return n;const s=(0,a.getFieldDisplayName)(n,t,e);return b(m({},n),{config:b(m({},n.config),{color:{mode:a.FieldColorModeId.PaletteClassicByName},displayName:s})})})}))))}function N(){return e=>e.pipe((0,r.map)(e=>e.map(e=>(e.fields.length<2||e.fields[1].config.displayNameFromDS||(e.fields[1].config.displayNameFromDS=y),e)).sort((e,t)=>{if(e.fields.length<2||t.fields.length<2)return 0;const n=e.fields[1].config.displayNameFromDS,r=(null==n?void 0:n.match(x))?5:(null==n?void 0:n.match(E))?4:(null==n?void 0:n.match(O))?3:(null==n?void 0:n.match(w))||(null==n?void 0:n.match(S))?2:1,a=t.fields[1].config.displayNameFromDS;return r-((null==a?void 0:a.match(x))?5:(null==a?void 0:a.match(E))?4:(null==a?void 0:a.match(O))?3:(null==a?void 0:a.match(w))||(null==a?void 0:a.match(S))?2:1)})))}function A(e,t){return new o.dt(m({datasource:{uid:u.WRAPPED_LOKI_DS_UID},queries:e},t))}function B(){return A([(0,h.BM)("","config",{})],{runQueriesMode:"manual"})}function M(e,t){const n=e.find(e=>{var t;return null===(t=e.legendFormat)||void 0===t?void 0:t.toLowerCase().includes("level")}),r=e.find(e=>e.refId===c.DS||e.refId===c.AA);return n?new o.Es({$data:I(m({datasource:{uid:u.WRAPPED_LOKI_DS_UID},queries:e},t)),transformations:[N]}):r?I(m({datasource:{uid:u.WRAPPED_LOKI_DS_UID},queries:e},t)):new o.Es({$data:I(m({datasource:{uid:u.WRAPPED_LOKI_DS_UID},queries:e},t)),transformations:[$]})}function I(e){return new o.dt(m({datasource:{uid:u.WRAPPED_LOKI_DS_UID},queries:[]},e))}function R(e,t){(0,f.m)(e.data.series)?t.setState({_pluginLoadError:(0,s.t)("drilldown-logs.notices.max-series-reached","Maximum limit of results reached. Displaying partial results.")}):t.state._pluginLoadError&&t.setState({_pluginLoadError:void 0})}const V=i.config.featureToggles.logsPanelControls&&(i.config.buildInfo.version>"12.1"||i.config.buildInfo.version.includes("12.1"))},9598:(e,t,n)=>{n.d(t,{Gy:()=>a,_F:()=>s,s_:()=>r});const r=n(62533).id,a=`/a/${r}`;function s(e,t=a){return`${t}/${e}`}},57985:(e,t,n)=>{n.d(t,{$k:()=>f,BM:()=>p,CY:()=>O,E3:()=>S,Hs:()=>P,PP:()=>b,Sh:()=>C,VT:()=>_,VW:()=>v,ZX:()=>w,_q:()=>y,by:()=>L,c0:()=>m,l:()=>g,lg:()=>F,qp:()=>j,sT:()=>x,tR:()=>k,vC:()=>E});var r=n(76644),a=n(81459),s=n(36464),i=n(66854),o=n(9598),l=n(90020);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}function d(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}const p=(e,t,n,r)=>d(u(d(u({},h),{refId:t,resource:t}),n),{datasource:{uid:l.gR},expr:e,primaryLabel:r}),g=(e,t)=>d(u({},h,t),{expr:e}),h={editorMode:"code",queryType:"range",refId:"A",supportingQueryType:o.s_},f=(e,t,n,r)=>p(e,t,u({},r),n);function v(e,t){return new s.K(e).getLabelsExpr({ignoreKeys:t})}function m(e){var t,n,r;return e.value?{value:(0,l.OQ)(e.value),valueLabels:[null!==(t=e.label)&&void 0!==t?t:e.value]}:{value:e.value,valueLabels:[null!==(r=null!==(n=e.label)&&void 0!==n?n:e.value)&&void 0!==r?r:""]}}function b(e,t){var n,r,a;const s={parser:null!==(r=null==t||null===(n=t.meta)||void 0===n?void 0:n.parser)&&void 0!==r?r:"mixed",value:null!==(a=e.value)&&void 0!==a?a:""};var i,o;return"structuredMetadata"===s.parser?{value:(0,l.OQ)(s.value),valueLabels:[null!==(i=e.label)&&void 0!==i?i:s.value]}:{value:(0,l.OQ)(JSON.stringify(s)),valueLabels:[null!==(o=e.label)&&void 0!==o?o:s.value]}}function y(e,t){return new s.K(e).getLevelsExpr({ignoreKeys:t})}function S(e,t){return new s.K(e).getMetadataExpr({ignoreKeys:t})}function w(e,t){return new s.K(e).getFieldsExpr({ignoreKeys:t})}function O(e){return(0,a.F)(e),e.map(e=>{if(!e.value)return"";const t=function(e){var t,n,a;return e.operator===i.cK.match||e.operator===i.cK.negativeMatch?e.key===i.ld.caseInsensitive?r.Go.escapeLabelValueInRegexSelector(null!==(t=e.value)&&void 0!==t?t:""):r.Go.escapeLabelValueInExactSelector(null!==(n=e.value)&&void 0!==n?n:""):r.Go.escapeLabelValueInExactSelector(null!==(a=e.value)&&void 0!==a?a:"")}(e);return function(e,t){return e.key===i.ld.caseInsensitive?e.operator===i.cK.negativeRegex||e.operator===i.cK.negativeMatch?`${i.cK.negativeRegex} "(?i)${t}"`:`${i.cK.regex} "(?i)${t}"`:`${e.operator} "${t}"`}(e,t)}).join(" ")}function E(e){return".+"===e?e:"(?i).*"!==e.substring(0,6)?`(?i).*${e}.*`:e}function x(e){return"(?i).*"===e.substring(0,6)&&".*"===e.slice(-2)?e.slice(6).slice(0,-2):e}function _(e){return e.replace(/\s*,\s*}/,"}")}function C(e,t){let n=r.jh.interpolate(e,t);return n.includes(l.fK)&&(n=r.jh.interpolate(e,n)),n}function P(){return e=>{let t=e.map(e=>`${e.key}${e.operator}"${e.value}"`).join(",");return t.length&&(t+="| json"),t}}function k(){return e=>{if(e.length){return`| line_format "{{.${e.map(e=>e.key).join("_")}}}"`}return""}}const L=1e3;function j(e){const t=r.jh.getData(e),n=t instanceof r.dt?t:r.jh.findDescendents(t,r.dt)[0];n&&n.runQueries()}function F(e){return e.includes("avg_over_time")}},16979:(e,t,n)=>{n.d(t,{B:()=>c});var r=n(76644),a=n(42969),s=n(6887),i=n(25953),o=n(57985),l=n(88100);const c=e=>{let t=function(e){const t=r.jh.getData(e);let n=t instanceof r.dt?t:(0,l.oh)(t)[0];if(!n){const t=r.jh.findObject(e,e=>e instanceof a.u||e instanceof s.u);if(t){const e=r.jh.getData(t);n=e instanceof r.dt?e:(0,l.oh)(e)[0]}else i.v.error(new Error("Unable to locate query runner!"),{msg:"getQueryRunnerFromSceneGraph: Unable to locate query runner!"})}return n}(e);const n=t.state.queries[0].expr;return(0,o.Sh)(e,n)}},69683:(e,t,n)=>{n.d(t,{FT:()=>S,HU:()=>v,KL:()=>m,MC:()=>_,UU:()=>w,XJ:()=>x,Zt:()=>b,bw:()=>h,er:()=>O,mC:()=>f,qe:()=>E,tm:()=>y});var r=n(87781),a=n(18531),s=n(76644),i=n(61402),o=n(77839),l=n(47389),c=n(88428),u=n(9598),d=n(75548),p=n(90020);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const h={embed:()=>(0,u._F)(o.G3.embed),explore:()=>(0,u._F)(o.G3.explore),fields:(e,t="service")=>(0,u._F)(`${o.G3.explore}/${t}/${(0,l.uu)(e)}/${o.G3.fields}`),labels:(e,t="service")=>(0,u._F)(`${o.G3.explore}/${t}/${(0,l.uu)(e)}/${o.G3.labels}`),logs:(e,t="service")=>(0,u._F)(`${o.G3.explore}/${t}/${(0,l.uu)(e)}/${o.G3.logs}`),patterns:(e,t="service")=>(0,u._F)(`${o.G3.explore}/${t}/${(0,l.uu)(e)}/${o.G3.patterns}`)},f={field:(e,t="service",n)=>(0,u._F)(`${o.G3.explore}/${t}/${(0,l.uu)(e)}/${o._J.field}/${n}`),label:(e,t="service",n)=>(0,u._F)(`${o.G3.explore}/${t}/${(0,l.uu)(e)}/${o._J.label}/${n}`)},v={embed:`${o.G3.embed}/*`,explore:`${o.G3.explore}/*`,fields:`:labelName/:labelValue/${o.G3.fields}`,labels:`:labelName/:labelValue/${o.G3.labels}`,logs:`:labelName/:labelValue/${o.G3.logs}`,patterns:`:labelName/:labelValue/${o.G3.patterns}`},m={field:`:labelName/:labelValue/${o._J.field}/:breakdownLabel`,label:`:labelName/:labelValue/${o._J.label}/:breakdownLabel`},b=["from","to",`var-${p.EY}`,`var-${p.MB}`],y=["from","to","mode","urlColumns","visualizationType","selectedLine","displayedFields","panelState",p.uw,`var-${p.uw}`,`var-${p.MB}`,`var-${p.mB}`,`var-${p._Y}`,`var-${p.LI}`,`var-${p.Jg}`,`var-${p.EY}`,`var-${p.WM}`,`var-${p._P}`,`var-${p.NW}`,`var-${p.lV}`,`var-${p.pw}`];function S(){const e=a.locationService.getLocation();return e.pathname.slice(e.pathname.lastIndexOf("/")+1,e.pathname.length)}function w(e){return e===p.OX&&(e=p.ky),e}function O(){const e=a.locationService.getLocation().pathname.split("/");return(0,c.EP)(e[e.length-2])}function E(e,t){return r.urlUtil.renderUrl(e,function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){g(e,t,n[t])})}return e}({},Object.entries(r.urlUtil.getUrlSearchParams()).reduce((e,[t,n])=>(b.includes(t)&&(e[t]=n),e),{}),e)}(t))}function x(e){return{breakdownLabel:e.params.breakdownLabel,labelName:e.params.labelName,labelValue:e.params.labelValue}}function _(e){let t,n,r,o;try{o=s.jh.getAncestor(e,i.Mn)}catch(t){o=s.jh.findDescendents(e,i.Mn)[0]}return o&&o.state.embedded?({breakdownLabel:t,labelName:n,labelValue:r}=(0,d.xb)(o)):({breakdownLabel:t,labelName:n,labelValue:r}=function(){const e=a.locationService.getLocation(),t="/a/grafana-lokiexplore-app/explore",n=e.pathname.indexOf(t);if(-1===n)throw new Error("Cannot get primary label from URL! getPrimaryLabelFromUrl should not be called when the app is embedded");const r=e.pathname.slice(n+34+1).split("/");let s=r[0];const i=decodeURIComponent(r[1]);return{breakdownLabel:r[3],labelName:w(s),labelValue:i}}()),{breakdownLabel:t,labelName:n,labelValue:r}}},88100:(e,t,n)=>{n.d(t,{Ti:()=>u,U4:()=>d,UX:()=>f,hJ:()=>g,m0:()=>v,nb:()=>m,oh:()=>h,u9:()=>p});n(87781);var r=n(18531),a=n(76644),s=n(25953),i=(n(69683),n(66732)),o=n(90020),l=n(41745);function c(e,t,n,r,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function u(e){return a.jh.getAncestor(e,l.P)}function d(e){return a.jh.interpolate(e,o.gR)}function p(e){return a.jh.interpolate(e,o.SA).replace(/\s+/g," ")}function g(e){return(t=function*(){return yield(0,r.getDataSourceSrv)().get(o.gR,{__sceneObject:{value:e}})},function(){var e=this,n=arguments;return new Promise(function(r,a){var s=t.apply(e,n);function i(e){c(s,r,a,i,o,"next",e)}function o(e){c(s,r,a,i,o,"throw",e)}i(void 0)})})();var t}function h(e){return a.jh.findDescendents(e,a.dt)}function f(e,t,n){const r=a.jh.findObject(e,t);return r instanceof n?r:(null!==r&&s.v.warn(`invalid return type: ${n.toString()}`),null)}function v(e){var t;return null===(t=e.state.controls)||void 0===t?void 0:t.find(e=>e instanceof a.KE)}function m(e){const t=(0,i.IL)("controlsExpanded",!1);e.state.controlsExpanded!==t&&e.setState({controlsExpanded:t})}},49193:(e,t,n)=>{n.d(t,{E:()=>o,X:()=>i});var r=n(87993),a=n(93241);const s=new r.default({intraDel:1,intraIns:1,intraMode:1,intraSub:1,intraTrn:1});function i(e,t,n){const[a,i,o]=s.search(e,t,0,1e5);let l=[],c=new Set;if(a&&o){const t=(e,t)=>{t&&c.add(e)};for(let n=0;n<o.length;n++){let a=o[n];r.default.highlight(e[i.idx[a]],i.ranges[a],t),l.push(e[i.idx[a]])}n([l,[...c]])}else t||n([])}const o=(0,a.debounce)(i,300)},89594:(e,t,n)=>{n.d(t,{m:()=>C,C:()=>_});var r=n(31269),a=n(75745),s=n(87781),i=n(42524),o=n(62533),l=n(25953);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}function d(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function p(e){const t=e.fields.find(e=>e.type===s.FieldType.number);if(!t)throw new Error("Unable to find number field on sharded dataframe!");if(!e.name)if(t.labels){var n;e.name=(null!==(n=e.refId)&&void 0!==n?n:"")+JSON.stringify(t.labels)}else{if(!e.refId)throw new Error("Unable to find refId field on sharded dataframe!");e.name=e.refId}return e.name}function g(e,t){if(!e)return d(u({},n=t),{data:n.data.map(y)});var n;const r=new Map;var a,i;e.data.forEach(e=>{r.set(p(e),e)}),t.data.forEach(t=>{var n;let a;var i;if((null===(n=t.meta)||void 0===n?void 0:n.type)!==s.DataFrameType.TimeSeriesMulti)throw new Error(`Invalid data frame type: ${null===(i=t.meta)||void 0===i?void 0:i.type}`);{const n=p(t);r.has(n)?(a=r.get(n),function(e,t){var n,r;const a=e.fields.find(e=>e.type===s.FieldType.time),i=e.fields.find(e=>e.type===s.FieldType.string&&"id"===e.name),o=t.fields.find(e=>e.type===s.FieldType.time),c=t.fields.find(e=>e.type===s.FieldType.string&&"id"===e.name);if(!a||!o)return void l.v.error(new Error("Time fields not found in the data frames"));var p;const g=null!==(p=null==o?void 0:o.values.slice(0))&&void 0!==p?p:[],m=Math.max(e.fields.length,t.fields.length);for(let n=0;n<g.length;n++){const r=h(a,o,n),l=f(a,i,r,o,c,n);for(let a=0;a<m;a++){if(!e.fields[a])continue;const i=v(e.fields[a],t.fields,a);if(i)if(l){if(e.fields[a].type===s.FieldType.time)continue;var y;e.fields[a].type===s.FieldType.number?e.fields[a].values[r]=(null!==(y=e.fields[a].values[r])&&void 0!==y?y:0)+i.values[n]:e.fields[a].type===s.FieldType.other?"object"==typeof i.values[n]?e.fields[a].values[r]=u({},e.fields[a].values[r],i.values[n]):null!=i.values[n]&&(e.fields[a].values[r]=i.values[n]):e.fields[a].values[r]=i.values[n]}else if(void 0!==i.values[n]){var S,w;if(e.fields[a].values.splice(r,0,i.values[n]),i.nanos)e.fields[a].nanos=null!==(w=e.fields[a].nanos)&&void 0!==w?w:new Array(e.fields[a].values.length-1).fill(0),null===(S=e.fields[a].nanos)||void 0===S||S.splice(r,0,i.nanos[n])}}}var O,E;e.length=e.fields[0].values.length,e.meta=d(u({},e.meta),{stats:b(null!==(O=null===(n=e.meta)||void 0===n?void 0:n.stats)&&void 0!==O?O:[],null!==(E=null===(r=t.meta)||void 0===r?void 0:r.stats)&&void 0!==E?E:[])})}(a,t)):e.data.push(y(t))}});const o=[...null!==(a=e.errors)&&void 0!==a?a:[],...null!==(i=t.errors)&&void 0!==i?i:[]];var c;o.length>0&&(e.errors=o);const g=null!==(c=e.error)&&void 0!==c?c:t.error;var m,S;null!=g&&(e.error=g);const w=[...null!==(m=e.traceIds)&&void 0!==m?m:[],...null!==(S=t.traceIds)&&void 0!==S?S:[]];return w.length>0&&(e.traceIds=w),e}function h(e,t,n){const r=(0,s.closestIdx)(t.values[n],e.values);return r<0?0:t.values[n]===e.values[r]&&null!=t.nanos&&null!=e.nanos?t.nanos[n]>e.nanos[r]?r+1:r:t.values[n]>e.values[r]?r+1:r}function f(e,t,n,r,a,s){const i=function(e,t,n,r){if(e.nanos&&n.nanos)return void 0!==e.values[t]&&e.values[t]===n.values[r]&&void 0!==e.nanos[t]&&e.nanos[t]===n.nanos[r];return void 0!==e.values[t]&&e.values[t]===n.values[r]}(e,n,r,s);return!!i&&(null==t||null==a||void 0!==t.values[n]&&t.values[n]===a.values[s])}function v(e,t,n){const r=t.filter(t=>t.name===e.name);return 1===r.length?r[0]:t[n]}const m="Summary: total bytes processed";function b(e,t){const n=e.find(e=>e.displayName===m),r=t.find(e=>e.displayName===m);if(null!=r&&null!=n)return[{displayName:m,unit:n.unit,value:r.value+n.value}];const a=null!=r?r:n;return null!=a?[a]:[]}function y(e){return d(u({},e),{fields:e.fields.map(e=>d(u({},e),{values:e.values}))})}var S=n(99330),w=n(73257);function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){O(e,t,n[t])})}return e}function x(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function _(e,t){const n=e.interpolateVariablesInQueries(t.targets,t.scopedVars).filter(e=>e.expr).map(e=>x(E({},e),{expr:(0,S.Yb)(e.expr)}));return function(e,t,n){let o=!1,c={data:[],key:(0,a.A)(),state:s.LoadingState.Streaming},u=null,d=new Map,p=null;const h=(r,a,f,v)=>{let m=v,b=!1;null!=u&&(u.unsubscribe(),u=null);const y=()=>{c.state=o?s.LoadingState.Error:s.LoadingState.Done,r.next(c),r.complete()};if(o)return void y();const w=()=>{const e=Math.min(a+v,f.length);a<f.length&&e<=f.length?h(r,e,f,m):y()},O=e=>{try{if(e&&!function(e){var t,n,r;const a=e.errors?(null!==(n=e.errors[0].message)&&void 0!==n?n:"").toLowerCase():null!==(r=null===(t=e.error)||void 0===t?void 0:t.message)&&void 0!==r?r:"";if(a.includes("timeout"))return!0;if(a.includes("parse error")||a.match(i.j4))throw new Error(a);return!1}(e))return!1}catch(r){var t,n,s,c,u,g;return l.v.error(r,{error:null!==(c=null==e||null===(t=e.error)||void 0===t?void 0:t.message)&&void 0!==c?c:"",errors:null!==(u=null==e||null===(n=e.errors)||void 0===n?void 0:n.map(e=>e.message).join(" | "))&&void 0!==u?u:"",msg:"sharding retry error",traces:null!==(g=null==e||null===(s=e.traceIds)||void 0===s?void 0:s.join("|"))&&void 0!==g?g:""}),o=!0,!1}if(v>1)return P(`Possible time out, new group size ${v=Math.floor(Math.sqrt(v))}`),b=!0,h(r,a,f,v),!0;var m;const y=null!==(m=d.get(a))&&void 0!==m?m:0;return y>3?(o=!0,!1):(d.set(a,y+1),p=setTimeout(()=>{l.v.info(`Retrying ${a} (${y+1})`),h(r,a,f,v),p=null},1500*Math.pow(2,y)),b=!0,!0)},_=function(e,t,n){if(t===e.length)return[-1];return e.slice(t,t+n)}(f,a,v);P(`Querying ${_.join(", ")}`);const k=x(E({},t),{targets:(0,S.Bg)(n,_)});t.requestId&&(k.requestId=`${t.requestId}_shard_${a}_${v}`),u=e.runQuery(k).subscribe({complete:()=>{b||(c.data.length&&r.next(c),C(c.data)?y():w())},error:e=>{l.v.error(e,{msg:"failed to shard"}),r.next(c),O()||w()},next:e=>{var t;if(!((null!==(t=e.errors)&&void 0!==t?t:[]).length>0||null!=e.error)||!O(e)){m=function(e,t,n){const r=.7;return Math.min(t,Math.max(Math.floor((n-e)*r),1))}(a+v,function(e,t){var n,r;if(!e.data.length)return t+1;const a=null===(r=e.data[0].meta)||void 0===r||null===(n=r.stats)||void 0===n?void 0:n.find(e=>"Summary: exec time"===e.displayName);if(a){const e=Math.round(a.value);return P(`${a.value}`),e<=1?Math.floor(1.5*t):e<6?Math.ceil(1.1*t):1===t?t:e<20?Math.ceil(.9*t):Math.floor(t/2)}return t}(e,v),f.length),m!==v&&P(`New group size ${m}`);try{c=g(c,e)}catch(t){l.v.error(t,{msg:"shardQuerySplitting::combineResponses error!"}),c=c.data.length>e.data.length?c:e,y()}}}})},f=n=>{u=e.query(t).subscribe({complete:()=>{n.next(c)},error:e=>{l.v.error(e,{msg:"runNonSplitRequest subscription error"}),n.error(c)},next:e=>{c=e}})},v=new r.Observable(r=>{const a=(0,S.tO)(n[0].expr);return(0,w.T0)(a)?(e.languageProvider.fetchLabelValues("__stream_shard__",{streamSelector:a||void 0,timeRange:t.range}).then(e=>{const t=e.map(e=>parseInt(e,10));t&&t.length?(t.sort((e,t)=>t-e),P(`Querying ${t.join(", ")} shards`),h(r,0,t,function(e){return Math.floor(Math.sqrt(e.length))}(t))):(l.v.warn("Shard splitting not supported. Issuing a regular query."),f(r))}).catch(e=>{l.v.error(e,{msg:"failed to fetch label values for __stream_shard__"}),f(r)}),()=>{o=!0,p&&clearTimeout(p),null!=u&&(u.unsubscribe(),u=null)}):(P(`Skipping invalid selector: ${a}`),void r.complete())});return v}(e,t,n)}function C(e){var t,n;const r=/maximum number of series/,a=e.find(e=>{var t,n,a;return(null===(n=e.meta)||void 0===n||null===(t=n.notices)||void 0===t?void 0:t.length)&&(null===(a=e.meta)||void 0===a?void 0:a.notices.some(e=>e.text.match(r)))});return a&&Boolean(null===(n=a.meta)||void 0===n||null===(t=n.notices)||void 0===t?void 0:t.length)}Boolean(localStorage.getItem(`${o.id}.sharding_debug_enabled`));function P(e){}},52601:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_SORT_BY:()=>u,calculateDataFrameChangepoints:()=>p,calculateOutlierValue:()=>v,sortSeries:()=>d,sortSeriesByName:()=>g,wasmSupported:()=>m});var r=n(81854),a=n(16944),s=n(93241),i=n(87781),o=n(34509),l=n(5570),c=n(25953);const u="changepoint",d=(0,s.memoize)((e,t,n)=>{if("alphabetical"===t)return g(e,n);"outliers"===t&&h(e);const r=n=>{var r;try{if("changepoint"===t)return p(n);if("outliers"===t)return v(e,n)}catch(e){c.v.error(e,{msg:"failed to sort"}),t=i.ReducerID.stdDev}const a=i.fieldReducers.get(t);var s;var o;return null!==(o=(null!==(s=null===(r=a.reduce)||void 0===r?void 0:r.call(a,n.fields[1],!0,!0))&&void 0!==s?s:(0,i.doStandardCalcs)(n.fields[1],!0,!0))[t])&&void 0!==o?o:0},a=e.map(e=>({dataFrame:e,value:r(e)}));return a.sort((e,t)=>void 0!==e.value&&void 0!==t.value?t.value-e.value:0),"asc"===n&&a.reverse(),a.map(({dataFrame:e})=>e)},(e,t,n)=>{const r=e.length>0?e[0].fields[0].values[0]:0,a=e.length>0?e[e.length-1].fields[0].values[e[e.length-1].fields[0].values.length-1]:0,s=e.length>0?(0,l.H7)(e[0]):"",i=e.length>0?(0,l.H7)(e[e.length-1]):"",o=e.map(e=>e.length+"_"+e.fields.map(e=>e.name+"_"+e.values[0]+"_"+e.values[e.values.length-1]));return`${s}_${i}_${r}_${a}_${e.length}_${o}_${t}_${n}`}),p=e=>{if(!m())throw new Error("WASM not supported, fall back to stdDev");const t=e.fields.filter(e=>e.type===i.FieldType.number),n=t[0].values.length;let a=Math.floor(n/100)||1;a>1&&(a=Math.ceil(a/2));const s=t[0].values.filter((e,t)=>t%a===0),o=new Float64Array(s);return r.ChangepointDetector.defaultArgpcp().detectChangepoints(o).indices.length},g=(e,t)=>{const n=[...e];return n.sort((e,t)=>{const n=(0,l.H7)(e),r=(0,l.H7)(t);return n&&r&&null!==(a=null==n?void 0:n.localeCompare(r))&&void 0!==a?a:0;var a}),"desc"===t&&n.reverse(),n},h=e=>{if(!m())return;const t=(0,i.outerJoinDataFrames)({frames:e});if(!t)return;const n=t.fields.filter(e=>e.type===i.FieldType.number).flatMap(e=>new Float64Array(e.values));try{const e=a.OutlierDetector.dbscan({sensitivity:.4}).preprocess(n);f=e.detect()}catch(e){c.v.error(e,{msg:"initOutlierDetector: OutlierDetector error"})}};let f;const v=(e,t)=>{if(!m())throw new Error("WASM not supported, fall back to stdDev");if(!f)throw new Error("Initialize outlier detector first");const n=e.indexOf(t);return f.seriesResults[n].isOutlier?f.seriesResults[n].outlierIntervals.length:0},m=()=>{const e="object"==typeof WebAssembly;return e||(0,o.EE)(o.NO.service_details,o.ir.service_details.wasm_not_supported),e}},66732:(e,t,n)=>{n.d(t,{B:()=>I,BS:()=>Ae,Bq:()=>me,Bz:()=>G,D8:()=>Me,Dy:()=>Le,FD:()=>ue,GL:()=>ve,Gg:()=>E,Hn:()=>ie,IL:()=>W,IW:()=>Ee,JA:()=>Te,KH:()=>Pe,MZ:()=>ce,NM:()=>De,OB:()=>S,QB:()=>P,Qi:()=>ae,RN:()=>H,Rb:()=>_e,Rf:()=>J,Vt:()=>te,WO:()=>z,Xo:()=>fe,YK:()=>Q,YM:()=>U,Zs:()=>Se,_2:()=>oe,bq:()=>Ie,cC:()=>w,cO:()=>O,eT:()=>y,ex:()=>Oe,fq:()=>T,hp:()=>be,k5:()=>X,ke:()=>L,ki:()=>ge,nV:()=>Ne,o3:()=>$,o5:()=>Z,og:()=>ye,rg:()=>ne,sB:()=>V,sj:()=>x,uF:()=>ke,vC:()=>pe,vR:()=>q,vs:()=>F,vt:()=>R,w0:()=>A,wQ:()=>B,x0:()=>k,zu:()=>je});var r=n(87781),a=n(18531),s=n(76644),i=n(62533),o=n(47389),l=n(38839),c=n(25953),u=n(88428),d=n(69683),p=n(45553),g=n(90020),h=n(41745);const f=`${i.id}.services.favorite`,v=`${i.id}.primarylabels.tabs.favorite`,m=`${i.id}.datasource`,b=`${i.id}.scene.layout`;function y(e,t){if(!e||"string"!=typeof e)return[];const n=_(e,t);let r=[];try{r=(0,u.aJ)(JSON.parse(localStorage.getItem(n)||"[]"))}catch(e){c.v.error(e,{msg:"Error parsing favorite services from local storage"})}return Array.isArray(r)||(r=[]),r}function S(e,t,n){if(!e||"string"!=typeof e)return;const r=_(e,t);let a=[];try{a=(0,u.aJ)(JSON.parse(localStorage.getItem(r)||"[]"))}catch(e){c.v.error(e,{msg:"Error parsing favorite services from local storage"})}Array.isArray(a)||(a=[]);const s=a.filter(e=>e!==n);s.unshift(n),localStorage.setItem(r,JSON.stringify(s))}function w(e,t,n){if(!e||!t||!n||"string"!=typeof e)return;const r=_(e,t);let a=[];try{a=(0,u.aJ)(JSON.parse(localStorage.getItem(r)||"[]"))}catch(e){c.v.error(e,{msg:"Error parsing favorite services from local storage"})}Array.isArray(a)||(a=[]);const s=a.filter(e=>e!==n);localStorage.setItem(r,JSON.stringify(s))}function O(e,t){if(!e||!t)return;const n=C(e);let r=[];try{r=(0,u.aJ)(JSON.parse(localStorage.getItem(n)||"[]"))}catch(e){c.v.error(e,{msg:"Error parsing saved tabs from local storage"})}if(Array.isArray(r)||(r=[]),-1===r.indexOf(t)){const e=r.filter(e=>e!==t);e.unshift(t),localStorage.setItem(n,JSON.stringify(e))}}function E(e,t){if(!e||!t)return;const n=C(e);let r=[];try{r=(0,u.aJ)(JSON.parse(localStorage.getItem(n)||"[]"))}catch(e){c.v.error(e,{msg:"Error parsing favorite services from local storage"})}Array.isArray(r)||(r=[]);const a=r.filter(e=>e!==t);localStorage.setItem(n,JSON.stringify(a))}function x(e){if(!e||"string"!=typeof e)return[];const t=C(e);let n=[];try{n=(0,u.aJ)(JSON.parse(localStorage.getItem(t)||"[]"))}catch(e){c.v.error(e,{msg:"Error parsing favorite services from local storage"})}return Array.isArray(n)||(n=[]),n}function _(e,t){return t=t===g.OX?"":`_${t}`,`${f}_${e}${t}`}function C(e){return`${v}_${e}`}function P(){var e;return null!==(e=localStorage.getItem(m))&&void 0!==e?e:void 0}function k(){var e;const t=(0,a.getDataSourceSrv)().getList({type:"loki"}),n=t.find(e=>e.isDefault);var r;return null!==(r=null==n?void 0:n.uid)&&void 0!==r?r:null==t||null===(e=t[0])||void 0===e?void 0:e.uid}function L(e){localStorage.setItem(m,e)}const j=`${i.id}.values.sort`;function F(e,t,n){var r;const a=(null!==(r=localStorage.getItem(`${j}.${e}.by`))&&void 0!==r?r:"").split(".");if(!a[0]||!a[1])return{direction:n,sortBy:t};const s=a[0];return{direction:a[1],sortBy:s}}function T(e,t,n){t&&n&&localStorage.setItem(`${j}.${e}.by`,`${t}.${n}`)}function D(e){const{labelName:t,labelValue:n}=(0,d.MC)(e);return $(e,t,n)}function $(e,t,n){const r=(0,p.nH)(e);return t===g.OX||t===g.ky?`${r}.${(0,o.uu)(n)}`:`${r}.${t}.${(0,o.uu)(n)}`}const N=1e3;function A(e){const t=D(e);var n;const r=parseInt(null!==(n=localStorage.getItem(`${i.id}.${t}.logs.maxLines`))&&void 0!==n?n:"0",10);if(r>0)return r;const a=s.jh.getAncestor(e,h.P).state.ds;var o;return null!==(o=null==a?void 0:a.maxLines)&&void 0!==o?o:N}function B(e,t){const n=D(e);localStorage.setItem(`${i.id}.${n}.logs.maxLines`,t.toString())}const M=(e,t,n)=>{const r=null!=n?n:D(e),a=t?"logs.user.fields":"logs.fields";return`${i.id}.${r}.${a}`};function I(e,t=!1,n){const r=M(e,t,null==n?void 0:n.prefix),a=localStorage.getItem(r);return"null"!==a&&a?a?(0,u.aJ)(JSON.parse(a)):[]:null}function R(e,t,n=!1){const r=M(e,n);localStorage.setItem(r,JSON.stringify(t))}function V(e){const t=D(e),n=localStorage.getItem(`${i.id}.${t}.logs.dedupStrategy`);return n&&(0,l.K)(n)?n:r.LogsDedupStrategy.none}function z(e,t){const n=D(e);localStorage.setItem(`${i.id}.${n}.logs.dedupStrategy`,t)}const q="grafana.explore.logs",G="grafana.explore.logs.patterns";function U(e,t){const n=localStorage.getItem(`${q}.${e}`);return n||t}function W(e,t){const n=localStorage.getItem(`${q}.${e}`);return null===n?t:!(""===n||"false"===n)}function Q(e,t){let n=t.toString();localStorage.setItem(`${q}.${e}`,n)}const K="grafana.explore.logs.logsVolume";function H(e,t){const n=`${K}.${e}`;void 0!==t?localStorage.setItem(n,t):localStorage.removeItem(n)}function J(e){return Boolean(localStorage.getItem(`${K}.${e}`))}const Y="grafana.explore.logs.visualisationType";function X(){var e;const t=null!==(e=localStorage.getItem(Y))&&void 0!==e?e:"";switch(t){case"table":case"logs":return t;case"json":return"json";default:return"logs"}}function Z(e){localStorage.setItem(Y,e)}const ee=`${i.id}.panelOptions.showErrors`;function te(){return!!localStorage.getItem(ee)}function ne(e){localStorage.setItem(ee,e?"true":"")}const re=`${i.id}.jsonParser.visible`;function ae(){return!!localStorage.getItem(re)}const se=`${i.id}.jsonViz.metadata`;function ie(){return!!localStorage.getItem(se)}function oe(e){localStorage.setItem(se,e?"true":"")}const le=`${i.id}.jsonViz.highlight`;function ce(){return!!localStorage.getItem(le)}function ue(e){localStorage.setItem(le,e?"true":"")}const de=`${i.id}.jsonViz.labels`;function pe(){return!!localStorage.getItem(de)}function ge(e){localStorage.setItem(de,e?"true":"")}const he=`${i.id}.linefilter.option`;function fe(e){let t=e.toString();e||(t=""),localStorage.setItem(`${he}.caseSensitive`,t)}function ve(e){let t=e.toString();e||(t=""),localStorage.setItem(`${he}.regex`,t)}function me(e){let t=e.toString();e||(t=""),localStorage.setItem(`${he}.exclusive`,t)}function be(e){return"true"===localStorage.getItem(`${he}.caseSensitive`)||e}function ye(e){return"true"===localStorage.getItem(`${he}.regex`)||e}function Se(e){return"true"===localStorage.getItem(`${he}.exclusive`)||e}const we=`${i.id}.panel.option`;function Oe(e,t){const n=localStorage.getItem(`${we}.${e}`);var r;return null!==n&&null!==(r=t.find(e=>n===e))&&void 0!==r?r:null}function Ee(e,t){localStorage.setItem(`${we}.${e}`,t)}const xe=`${i.id}.expressionBuilder.debug`;function _e(){return!!localStorage.getItem(xe)}const Ce=`${i.id}.serviceSelection.pageCount`;function Pe(){const e=localStorage.getItem(Ce);return e?parseInt(e,10):void 0}function ke(e){localStorage.setItem(Ce,e.toString(10))}function Le(){return localStorage.getItem(b)}function je(e){localStorage.setItem(b,e)}const Fe=`${i.id}.fieldsBreakdown.fieldsPanelType`;function Te(){const e=localStorage.getItem(Fe);return"text"===e||"timeseries"===e?e:null}function De(e){localStorage.setItem(Fe,e)}const $e=`${i.id}.filters.collapsed`;function Ne(){return!!localStorage.getItem($e)}function Ae(e){localStorage.setItem($e,e?"true":"")}const Be=`${i.id}.table.logLine`;function Me(){return localStorage.getItem(Be)}function Ie(e){localStorage.setItem(Be,e)}},53571:(e,t,n)=>{n.d(t,{b:()=>r});const r={appConfig:{apiKey:"data-testid ac-api-key",apiUrl:"data-testid ac-api-url",container:"data-testid ac-container",submit:"data-testid ac-submit-form",defaultColumns:{labels:{key:"data-testid ac-dc-label-name-input",value:"ac-dc-labels-value-input"}}},breakdowns:{common:{filterButton:"data-testid filter-button",filterButtonGroup:"data-testid filter-button-group",filterNumericPopover:{cancelButton:"data-testid filter-numeric-cancel",inputGreaterThan:"data-testid filter-numeric-gt",inputGreaterThanInclusive:"data-testid filter-numeric-gte",inputGreaterThanUnit:"data-testid filter-numeric-gtu",inputLessThan:"data-testid filter-numeric-lt",inputLessThanInclusive:"data-testid filter-numeric-lte",inputLessThanUnit:"data-testid filter-numeric-ltu",removeButton:"data-testid filter-numeric-remove",submitButton:"data-testid filter-numeric-submit"},filterSelect:"data-testid filter-select",sortByDirection:"data-testid SortBy direction",sortByFunction:"data-testid SortBy function"},fields:{},labels:{}},exploreServiceDetails:{buttonFilterExclude:"data-testid button-filter-exclude",buttonFilterInclude:"data-testid button-filter-include",buttonRemovePattern:"data-testid button-remove-pattern",openExplore:"data-testid open-explore",searchLogs:"data-testid search-logs",tabFields:"data-testid tab-fields",tabLabels:"data-testid tab-labels",tabLogs:"data-testid tab-logs",tabPatterns:"data-testid tab-patterns"},exploreServiceSearch:{search:"data-testid search-services"},header:{refreshPicker:"data-testid RefreshPicker run button"},index:{addNewLabelTab:"data-testid Tab Add label",aggregatedMetricsMenu:"data-testid aggregated-metrics-menu",aggregatedMetricsToggle:"data-testid aggregated-metrics-toggle",header:{showLogsButton:"data-testid Show logs header"},searchLabelValueInput:"data-testid search-services-input",selectServiceButton:"data-testid button-select-service",showLogsButton:"data-testid button-filter-include"},logsPanelHeader:{header:"data-testid Panel header Logs",radio:"data-testid radio-button"},patterns:{buttonExcludedPattern:"data-testid button-excluded-pattern",buttonIncludedPattern:"data-testid button-included-pattern",tableWrapper:"data-testid table-wrapper"},table:{inspectLine:"data-testid inspect",rawLogLine:"data-testid raw-log-line",wrapper:"data-testid table-wrapper"},variables:{combobox:{},datasource:{label:"data-testid Dashboard template variables submenu Label Data source"},levels:{inputWrap:"data-testid detected_level filter variable"},serviceName:{label:"data-testid Dashboard template variables submenu Label Labels"}}}},95002:(e,t,n)=>{n.d(t,{Dk:()=>i,EJ:()=>c,Ki:()=>u,Zr:()=>l,gW:()=>o});var r=n(87781),a=n(18531),s=n(25953);const i=e=>{if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}};const o=(e,t,n)=>{const s=a.locationService.getLocation(),i=r.urlUtil.getUrlSearchParams();return i.from=n.from.toISOString(),i.to=n.to.toISOString(),i[e]=JSON.stringify(t),o=r.urlUtil.renderUrl(s.pathname,i),`${window.location.protocol}//${window.location.host}${a.config.appSubUrl}${o}`;var o};function l(e){return e.length?(null==e?void 0:e.charAt(0).toUpperCase())+e.slice(1):(s.v.warn("invalid string argument"),e)}function c(e,t,n){return e.substring(0,t)+(n&&e.length>t?"â€¦":"")}function u(e){const t=(0,r.dateTime)(e.timeEpochMs-1),n=(0,r.dateTime)(e.timeEpochMs+1);return{from:t,raw:{from:t,to:n},to:n}}},45553:(e,t,n)=>{n.d(t,{BL:()=>P,DX:()=>c,El:()=>C,Gc:()=>L,Gk:()=>O,Hj:()=>S,Ku:()=>u,P4:()=>b,Rr:()=>m,S9:()=>w,U2:()=>k,YS:()=>h,aW:()=>p,bY:()=>E,bu:()=>F,cR:()=>d,eY:()=>x,h:()=>_,ir:()=>f,iw:()=>v,n5:()=>j,nH:()=>D,oY:()=>g,vm:()=>y,z2:()=>T});var r=n(76644),a=n(34702),s=n(48502),i=n(25953),o=n(88428),l=n(90020);function c(e){const{fieldExpressionToAdd:t="",jsonParserPropToAdd:n="",labelExpressionToAdd:r="",parser:a,structuredMetadataToAdd:s=""}=e;switch(a){case"structuredMetadata":return`{${l.S1}${r}} ${s} ${l.qZ} ${l.S6} ${l.sC} ${l.rl} ${t} ${l.Oc}`;case"json":return`{${l.S1}${r}} ${s} ${l.qZ} ${l.S6} ${l.sC} ${l.rl} | json ${n} ${l.fK} | drop __error__, __error_details__ ${t} ${l.Oc}`;case"logfmt":return`{${l.S1}${r}} ${s} ${l.qZ} ${l.S6} ${l.sC} ${l.rl} ${l.mF} ${t} ${l.Oc}`;default:return`{${l.S1}${r}} ${s} ${l.qZ} ${l.S6} ${l.sC} ${l.rl} | json ${n} ${l.fK} | logfmt | drop __error__, __error_details__  ${t} ${l.Oc}`}}function u(e){const t=r.jh.lookupVariable(l.uw,e);if(!(t instanceof r.yP))throw new Error("VAR_PATTERNS not found");return t}function d(e){return E(l.MB,e)}function p(e){return E(l.fi,e)}function g(e){return E(l._P,e)}function h(e){return E(l.sL,e)}function f(e){return E(l.mB,e)}function v(e){return E(l._Y,e)}function m(e){const t=r.jh.lookupVariable(l.WM,e);if(!(t instanceof r.H9))throw new Error("VAR_LINE_FILTER not found");return t}function b(e){const t=r.jh.lookupVariable(l.Jg,e);if(!(t instanceof a.m))throw new Error("VAR_LABEL_GROUP_BY not found");return t}function y(e){const t=r.jh.lookupVariable(l.Wi,e);if(!(t instanceof a.m))throw new Error("SERVICE_LABEL_VAR not found");return t}function S(e){const t=r.jh.lookupVariable(l.LI,e);if(!(t instanceof a.m))throw new Error("VAR_FIELD_GROUP_BY not found");return t}function w(e){const t=r.jh.lookupVariable(l.EY,e);if(!(t instanceof r.mI))throw new Error("VAR_DATASOURCE not found");return t}function O(e){const t=r.jh.lookupVariable(l.NW,e);if(!(t instanceof r.H9))throw new Error("VAR_LINE_FILTERS not found");return t}function E(e,t){const n=r.jh.lookupVariable(e,t);if(!(n instanceof r.H9))throw new Error(`Could not get AdHocFiltersVariable ${e}. Variable not found.`);return n}function x(e){const t=r.jh.lookupVariable(l.Du,e);if(!(t instanceof a.m))throw new Error("VAR_PRIMARY_LABEL_SEARCH not found");return t}function _(e){x(e).setState({label:"",value:".+"})}function C(e){const t=r.jh.lookupVariable(l.Gb,e);if(!(t instanceof r.H9))throw new Error("VAR_PRIMARY_LABEL not found");return t}function P(e,t){C(t).setState({filters:[{key:e,operator:"=~",value:".+"}]})}function k(e){const t=r.jh.lookupVariable(l.pw,e);if(!(t instanceof r.H9))throw new Error("VAR_JSON_PARSER not found!");return t}function L(e){const t=r.jh.lookupVariable(l.lV,e);if(!(t instanceof r.H9))throw new Error("VAR_JSON_FIELDS not found!");return t}function j(e){return`var-${e}`}function F(e,t=l.mB){if((0,s.OH)(e))return{parser:"structuredMetadata",value:e.value};try{const t=(0,l.zE)(e.value)?(0,l.Dx)(e.value):e.value,n=(0,o.fS)(JSON.parse(t));if(!1!==n)return n;throw new o.QX("getValueFromFieldsFilter: invalid filter value!")}catch(n){if(n instanceof o.QX?i.v.error(n,{msg:`getValueFromFieldsFilter: Failed to validate ${t}`,value:e.value}):i.v.error(n,{msg:`getValueFromFieldsFilter: Failed to parse ${t}`,value:e.value}),e.value)return{parser:"mixed",value:e.value};throw n}}function T(e,t){return e===l.mB&&t?F(t):{value:null==t?void 0:t.value}}function D(e){return w(e).getValue()}},75548:(e,t,n)=>{n.d(t,{E1:()=>b,Ht:()=>v,mE:()=>g,rA:()=>h,xb:()=>m});var r=n(76644),a=n(41745),s=n(21532),i=n(34702),o=n(66854),l=n(90708),c=n(74532),u=n(69683),d=n(45553),p=n(90020);function g(e,t){const n=r.jh.getVariables(e);let a=[];for(const s of n.state.variables)if(!t||s.state.name===t){if(s instanceof r.H9&&s.state.filters.length){const t=s.state.filters.some(t=>f(s,t,e));(!t||t&&s.state.filters.length>1)&&a.push(s)}s instanceof i.m&&s.state.value&&"logsFormat"!==s.state.name&&a.push(s)}return a}function h(e){const t=r.jh.getAncestor(e,a.P);t.setState({patterns:[]});g(t).forEach(t=>{if(t instanceof r.H9){const n=t.state.filters.filter(n=>f(t,n,e));t.setState({filters:n})}else t instanceof i.m&&t.setState({text:"",value:""})})}function f(e,t,n){if(e.state.name!==p.MB)return!1;let{labelName:r,labelValue:a}=(0,u.MC)(n);return!(!(0,l.BG)(t.operator)&&t.value===a)&&(t.key===r||r===p.ky&&t.key===p.OX)}const v=function(e){const t=e.state._wip;if(t&&e.state.filters.some(e=>e.key===t.key&&e.operator===o.w7.Equal))return c._i;const n=e.state.name===p.MB,r=e.state.filters.filter(e=>(0,l.BG)(e.operator)).length,a=!(null==t?void 0:t.key)&&1===r,s=(null==t?void 0:t.key)&&r<1;if(n&&(a||s))return c._i;if(null==t?void 0:t.meta){const e=t.meta.type;if("int"===e)return[...c.II,...c.hI];if("float"===e||"bytes"===e||"duration"===e)return c.hI}return c.II};function m(e,t=(0,d.cR)(e)){var n,r;if(!e.state.embedded)throw new Error("getPrimaryLabelFromUrl should be used instead when embedded!");return{breakdownLabel:e.state.drillDownLabel,labelName:null===(n=t.state.filters[0])||void 0===n?void 0:n.key,labelValue:null===(r=t.state.filters[0])||void 0===r?void 0:r.value}}function b(e,t){const n=e=>({key:e.key,operator:e.operator,value:e.value});return(0,s.B)(e.map(n),t.map(n))}}}]);
//# sourceMappingURL=553.js.map?_cache=1e25d8e34dc8a2cf151d