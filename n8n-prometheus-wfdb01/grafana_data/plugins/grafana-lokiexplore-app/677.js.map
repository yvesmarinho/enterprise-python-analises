{"version":3,"file":"677.js?_cache=9c738f7e43f686e7202d","mappings":"wwCAeO,SAASA,EAA8B,G,IAAA,kBAC5CC,EAAiB,MACjBC,EAAK,eACLC,EAAc,eACdC,EAAc,QACdC,EAAO,eACPC,GAN4C,EAOzCC,EAAAA,EAPyC,GAC5CN,oBACAC,QACAC,iBACAC,iBACAC,UACAC,mBAGA,MAAME,EAAa,IAAIC,EAAAA,GAAeL,GAOtC,GANAI,EAAWE,iBAAkBH,IACvBN,GACFA,EAAkBM,EAAMI,UAIvBT,EAKH,OAJAU,QAAQC,MAAM,uGAGdC,EAAAA,EAAAA,IAAqBC,EAAAA,GAAkBC,gBAAiBC,EAAAA,GAAoBD,gBAAgBE,gBACrF,MAGTC,EAAAA,EAAAA,WAEA,MAAM,aAAEC,EAAY,YAAEC,EAAW,OAAEC,IAAWC,EAAAA,EAAAA,IAAoBrB,GAC5DsB,GAAmBD,EAAAA,EAAAA,IAAoBpB,QAAAA,EAAkB,IAEzDsB,EAAyCL,EAAaM,IAAKC,IAAY,CAC3EC,IAAKD,EAAOC,IACZC,SAAUF,EAAOE,SACjBlB,OAAOmB,EAAAA,EAAAA,IAAgBH,EAAOE,WAAYE,EAAAA,EAAAA,IAA8BJ,EAAOhB,OAASgB,EAAOhB,MAC/FqB,YAAa,CAACL,EAAOhB,UAGjBsB,EAA2CT,EAAiBJ,aAAaM,IAAKC,IAAY,CAC9FC,IAAKD,EAAOC,IACZC,SAAUF,EAAOE,SACjBlB,OAAOmB,EAAAA,EAAAA,IAAgBH,EAAOE,WAAYE,EAAAA,EAAAA,IAA8BJ,EAAOhB,OAASgB,EAAOhB,MAC/FqB,YAAa,CAACL,EAAOhB,UAGjBuB,EAA6DZ,aAAAA,EAAAA,EAAQI,IAAKS,IAC9E,MAAMC,EAAWD,EAAExB,M,IAETwB,EADV,MAAME,EAAyB,CAC7BC,OAAgB,QAARH,EAAAA,EAAEG,cAAFH,IAAAA,EAAAA,EAAY,QACpBxB,MAAOyB,GAGHzB,EAAqB,uBAAbwB,EAAEG,OAAkCF,EAAWG,KAAKC,UAAUH,GAC5E,MAAO,CACLT,IAAKO,EAAEP,IACPC,SAAUM,EAAEN,SACZG,YAAa,CAACG,EAAExB,OAChBA,OAAOmB,EAAAA,EAAAA,IAAgBK,EAAEN,WAAYE,EAAAA,EAAAA,IAA8BpB,GAASA,EAC5E8B,KAAM,CACJH,OAAQH,EAAEG,WAQhB,OAFAxB,EAAAA,EAAAA,IAAqBC,EAAAA,GAAkBC,gBAAiBC,EAAAA,GAAoBD,gBAAgB0B,eAErF,IAAIC,EAAAA,EAAW,E,kUAAA,IACjBpC,GAAAA,CACHC,aACAoC,mBAAoBvB,EACpBwB,UAAU,EACVC,gBAAiBzC,EACjB6B,gBACAT,gBACAQ,kBACA3B,mBAEJ,CAEO,MAAMyC,EAAqB,KAEnB,SAASC,EAAwBC,GAC9C,MAAOC,EAAaC,IAAkBC,EAAAA,EAAAA,UAA4B,MASlE,OAPAC,EAAAA,EAAAA,WAAU,KACHH,KACHI,EAAAA,EAAAA,KAA0B,GAC1BH,EAAenD,EAA8BiD,MAE9C,CAACC,EAAaD,IAEZC,EAKH,kBAACK,EAAAA,GAAsBA,CACrBC,MAAON,EACPO,iBAAiB,EACjBC,2BAA2B,EAC3BC,UAA0B,QAAfV,EAAAA,EAAMU,iBAANV,IAAAA,EAAAA,EAAmBF,EAC9Ba,qBAAsB,CAAC,OAAQ,KAAM,WAAYC,EAAAA,EAAsBC,EAAAA,IAEvE,kBAACZ,EAAYa,UAAS,CAACC,MAAOd,KAXzB,K,IAQMD,CAMjB,C","sources":["webpack://grafana-lokiexplore-app/./Components/EmbeddedLogsExploration/EmbeddedLogs.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\n\nimport { AdHocFilterWithLabels, SceneTimeRange, UrlSyncContextProvider } from '@grafana/scenes';\n\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { isOperatorRegex } from '../../services/operatorHelpers';\nimport { AdHocFiltersWithLabelsAndMeta, FieldValue } from '../../services/variables';\nimport { drilldownLabelUrlKey, pageSlugUrlKey } from '../ServiceScene/ServiceSceneConstants';\nimport { EmbeddedLogsExplorationProps } from './types';\nimport { IndexScene } from 'Components/IndexScene/IndexScene';\nimport initRuntimeDs from 'services/datasource';\nimport { getMatcherFromQuery } from 'services/logqlMatchers';\nimport { initializeMetadataService } from 'services/metadata';\nimport { addAdHocFilterUserInputPrefix } from 'services/variables';\n\nexport function buildLogsExplorationFromState({\n  onTimeRangeChange,\n  query,\n  referenceQuery,\n  timeRangeState,\n  options,\n  hideTimePicker,\n  ...state\n}: EmbeddedLogsExplorationProps) {\n  const $timeRange = new SceneTimeRange(timeRangeState);\n  $timeRange.subscribeToState((state) => {\n    if (onTimeRangeChange) {\n      onTimeRangeChange(state.value);\n    }\n  });\n\n  if (!query) {\n    console.error('No query parameter found! Please pass in a valid logQL query string when embedding Logs Drilldown.');\n\n    // Report invalid init\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.embedded_error);\n    return null;\n  }\n\n  initRuntimeDs();\n\n  const { labelFilters, lineFilters, fields } = getMatcherFromQuery(query);\n  const referenceFilters = getMatcherFromQuery(referenceQuery ?? '');\n\n  const initialLabels: AdHocFilterWithLabels[] = labelFilters.map((filter) => ({\n    key: filter.key,\n    operator: filter.operator,\n    value: isOperatorRegex(filter.operator) ? addAdHocFilterUserInputPrefix(filter.value) : filter.value,\n    valueLabels: [filter.value],\n  }));\n\n  const referenceLabels: AdHocFilterWithLabels[] = referenceFilters.labelFilters.map((filter) => ({\n    key: filter.key,\n    operator: filter.operator,\n    value: isOperatorRegex(filter.operator) ? addAdHocFilterUserInputPrefix(filter.value) : filter.value,\n    valueLabels: [filter.value],\n  }));\n\n  const initialFields: AdHocFiltersWithLabelsAndMeta[] | undefined = fields?.map((f) => {\n    const rawValue = f.value;\n    const fieldValue: FieldValue = {\n      parser: f.parser ?? 'mixed',\n      value: rawValue,\n    };\n\n    const value = f.parser === 'structuredMetadata' ? rawValue : JSON.stringify(fieldValue);\n    return {\n      key: f.key,\n      operator: f.operator,\n      valueLabels: [f.value],\n      value: isOperatorRegex(f.operator) ? addAdHocFilterUserInputPrefix(value) : value,\n      meta: {\n        parser: f.parser,\n      },\n    };\n  });\n\n  // Report valid init\n  reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.embedded_init);\n\n  return new IndexScene({\n    ...state,\n    $timeRange,\n    defaultLineFilters: lineFilters,\n    embedded: true,\n    embeddedOptions: options,\n    initialFields,\n    initialLabels,\n    referenceLabels,\n    hideTimePicker,\n  });\n}\n\nexport const VARIABLE_NAMESPACE = 'ld';\n\nexport default function EmbeddedLogsExploration(props: EmbeddedLogsExplorationProps) {\n  const [exploration, setExploration] = useState<IndexScene | null>(null);\n\n  useEffect(() => {\n    if (!exploration) {\n      initializeMetadataService(true);\n      setExploration(buildLogsExplorationFromState(props));\n    }\n  }, [exploration, props]);\n\n  if (!exploration) {\n    return null;\n  }\n\n  return (\n    <UrlSyncContextProvider\n      scene={exploration}\n      updateUrlOnInit={false}\n      createBrowserHistorySteps={true}\n      namespace={props.namespace ?? VARIABLE_NAMESPACE}\n      excludeFromNamespace={['from', 'to', 'timezone', drilldownLabelUrlKey, pageSlugUrlKey]}\n    >\n      <exploration.Component model={exploration} />\n    </UrlSyncContextProvider>\n  );\n}\n"],"names":["buildLogsExplorationFromState","onTimeRangeChange","query","referenceQuery","timeRangeState","options","hideTimePicker","state","$timeRange","SceneTimeRange","subscribeToState","value","console","error","reportAppInteraction","USER_EVENTS_PAGES","service_details","USER_EVENTS_ACTIONS","embedded_error","initRuntimeDs","labelFilters","lineFilters","fields","getMatcherFromQuery","referenceFilters","initialLabels","map","filter","key","operator","isOperatorRegex","addAdHocFilterUserInputPrefix","valueLabels","referenceLabels","initialFields","f","rawValue","fieldValue","parser","JSON","stringify","meta","embedded_init","IndexScene","defaultLineFilters","embedded","embeddedOptions","VARIABLE_NAMESPACE","EmbeddedLogsExploration","props","exploration","setExploration","useState","useEffect","initializeMetadataService","UrlSyncContextProvider","scene","updateUrlOnInit","createBrowserHistorySteps","namespace","excludeFromNamespace","drilldownLabelUrlKey","pageSlugUrlKey","Component","model"],"sourceRoot":""}