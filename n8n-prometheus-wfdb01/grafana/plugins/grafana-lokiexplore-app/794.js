"use strict";(self.webpackChunkgrafana_lokiexplore_app=self.webpackChunkgrafana_lokiexplore_app||[]).push([[794,398],{40677:(e,r,t)=>{t.r(r),t.d(r,{VARIABLE_NAMESPACE:()=>y,buildLogsExplorationFromState:()=>m,default:()=>O});var n=t(85959),a=t.n(n),o=t(15056),i=t(34509),l=t(90708),u=t(88469),c=t(41745),s=t(41296),f=t(73257),p=t(72152),d=t(90020);function g(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function v(e,r){return r=null!=r?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):function(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}),e}function b(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}function m(e){var{onTimeRangeChange:r,query:t,referenceQuery:n,timeRangeState:a,options:u,hideTimePicker:p}=e,m=b(e,["onTimeRangeChange","query","referenceQuery","timeRangeState","options","hideTimePicker"]);const y=new o.JZ(a);if(y.subscribeToState(e=>{r&&r(e.value)}),!t)return console.error("No query parameter found! Please pass in a valid logQL query string when embedding Logs Drilldown."),(0,i.EE)(i.NO.service_details,i.ir.service_details.embedded_error),null;(0,s.default)();const{labelFilters:O,lineFilters:w,fields:j}=(0,f.BW)(t),P=(0,f.BW)(null!=n?n:""),h=O.map(e=>({key:e.key,operator:e.operator,value:(0,l.SM)(e.operator)?(0,d.OQ)(e.value):e.value,valueLabels:[e.value]})),k=P.labelFilters.map(e=>({key:e.key,operator:e.operator,value:(0,l.SM)(e.operator)?(0,d.OQ)(e.value):e.value,valueLabels:[e.value]})),E=null==j?void 0:j.map(e=>{const r=e.value;var t;const n={parser:null!==(t=e.parser)&&void 0!==t?t:"mixed",value:r},a="structuredMetadata"===e.parser?r:JSON.stringify(n);return{key:e.key,operator:e.operator,valueLabels:[e.value],value:(0,l.SM)(e.operator)?(0,d.OQ)(a):a,meta:{parser:e.parser}}});return(0,i.EE)(i.NO.service_details,i.ir.service_details.embedded_init),new c.P(v(function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.forEach(function(r){g(e,r,t[r])})}return e}({},m),{$timeRange:y,defaultLineFilters:w,embedded:!0,embeddedOptions:u,initialFields:E,initialLabels:h,referenceLabels:k,hideTimePicker:p}))}const y="ld";function O(e){const[r,t]=(0,n.useState)(null);return(0,n.useEffect)(()=>{r||((0,p.rX)(!0),t(m(e)))},[r,e]),r?a().createElement(o.$L,{scene:r,updateUrlOnInit:!1,createBrowserHistorySteps:!0,namespace:null!==(i=e.namespace)&&void 0!==i?i:y,excludeFromNamespace:["from","to","timezone",u.o,u.Z]},a().createElement(r.Component,{model:r})):null;var i}},25398:(e,r,t)=>{t.d(r,{O7:()=>v,jj:()=>y,g:()=>w,ev:()=>O});var n=t(77909),a=t(75561),o=t(18531);const i={experiment_fake_flag:null};class l{after(e,r){v[e.flagKey]&&(i[v[e.flagKey]]=r.value)}constructor(){}}var u=t(25953);function c(e,r,t,n,a,o,i){try{var l=e[o](i),u=l.value}catch(e){return void t(e)}l.done?r(u):Promise.resolve(u).then(n,a)}function s(e){return function(){var r=this,t=arguments;return new Promise(function(n,a){var o=e.apply(r,t);function i(e){c(o,n,a,i,l,"next",e)}function l(e){c(o,n,a,i,l,"throw",e)}i(void 0)})}}function f(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}const p={exploreLogsAggregatedMetrics:{valueType:"boolean",value:!1,reason:"static provider evaluation result",variant:"default"},"drilldown.logs.fake_flag":{valueType:"string",values:["treatment","control","excluded"],defaultValue:"excluded",trackingKey:"experiment_fake_flag"}},d=(g=p,Object.keys(g));var g;const v=Object.fromEntries(d.reduce((e,r)=>{const t=p[r];return"trackingKey"in t&&e.push([r,t.trackingKey]),e},[])),b="logs-drilldown",m=new Map;function y(e){if(m.has(e))return m.get(e);const r=p[e];return"value"in r?r.value:r.defaultValue}function O(){return s(function*(){yield Promise.all(d.map(e=>s(function*(){const r=yield function(e){return s(function*(){try{const r=a.B0.getClient(b);yield function(e){if(e.providerStatus===a.$l.READY)return Promise.resolve();if(e.providerStatus===a.$l.ERROR||e.providerStatus===a.$l.FATAL)return Promise.reject(new Error("OpenFeature provider failed to initialize"));return new Promise((r,t)=>{e.addHandler(a.Nm.Ready,()=>r()),e.addHandler(a.Nm.Error,()=>t(new Error("OpenFeature provider error")))})}(r),r.addHooks(new l);const t=p[e],n=j(t);switch(t.valueType){case"boolean":return r.getBooleanValue(e,n);case"number":return r.getNumberValue(e,n);case"object":return r.getObjectValue(e,n);case"string":return r.getStringValue(e,n);default:throw new Error(`Invalid flag value type for flag ${e}`)}}catch(r){u.v.error(new Error(`Error evaluating ${e} flag.`,{cause:r}));const t=function(e){if("exploreLogsAggregatedMetrics"===e)return o.config.featureToggles.exploreLogsAggregatedMetrics;return}(e);if(void 0!==t)return t;return j(p[e])}})()}(e);m.set(e,r)})()))})()}function w(){return a.B0.setProviderAndWait(b,new n.S({baseUrl:`/apis/features.grafana.app/v0alpha1/namespaces/${o.config.namespace}`,pollInterval:-1,timeoutMs:1e4}),function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.forEach(function(r){f(e,r,t[r])})}return e}({targetingKey:o.config.namespace,namespace:o.config.namespace},o.config.openFeatureContext)).catch(e=>{u.v.warn("OpenFeature provider initialization failed, using config.featureToggles fallback",{error:e instanceof Error?e.message:String(e)})})}function j(e){return"value"in e?e.value:e.defaultValue}}}]);
//# sourceMappingURL=794.js.map?_cache=0ca898ffbe64cddef706