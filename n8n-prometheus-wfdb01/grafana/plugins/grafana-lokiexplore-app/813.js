"use strict";(self.webpackChunkgrafana_lokiexplore_app=self.webpackChunkgrafana_lokiexplore_app||[]).push([[813,398],{36826:(e,t,r)=>{r.r(t),r.d(t,{default:()=>E,updatePlugin:()=>O});var n=r(85959),a=r.n(n),i=r(46089),o=r(93241),l=r(31269),c=r(87781),s=r(18531),u=r(82007),d=r(25953),p=r(66732);function f(e,t,r,n,a,i,o){try{var l=e[i](o),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,a)}function g(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function o(e){f(i,n,a,o,l,"next",e)}function l(e){f(i,n,a,o,l,"throw",e)}o(void 0)})}}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){v(e,t,r[t])})}return e}function b(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}const y=e=>({colorWeak:i.css`
    color: ${e.colors.text.secondary};
  `,icon:(0,i.css)({marginLeft:e.spacing(1)}),label:(0,i.css)({alignItems:"center",display:"flex",marginBottom:e.spacing(.75)}),marginTop:i.css`
    margin-top: ${e.spacing(3)};
  `,marginTopXl:i.css`
    margin-top: ${e.spacing(6)};
  `,note:(0,i.css)({color:e.colors.text.secondary,marginBottom:e.spacing(1),marginTop:e.spacing(1)})}),h=(e,t)=>g(function*(){try{yield O(e,t),s.locationService.reload()}catch(e){d.v.error(e,{msg:"Error while updating the plugin"})}})(),w={appConfig:{container:"data-testid ac-container",datasource:"data-testid ac-datasource-input",interval:"data-testid ac-interval-input",pattern:"data-testid ac-patterns-disabled",submit:"data-testid ac-submit-form"}},O=(e,t)=>g(function*(){const r=(0,s.getBackendSrv)().fetch({data:t,method:"POST",url:`/api/plugins/${e}/settings`});return(yield(0,l.lastValueFrom)(r)).data})(),k=e=>{try{if(e){const t=c.rangeUtil.intervalToSeconds(e);return(0,o.isNumber)(t)&&t>=3600}return!0}catch(e){}return!1},E=({plugin:e})=>{const t=(0,u.useStyles2)(y),{enabled:r,jsonData:i,pinned:o}=e.meta;var l,c,d,f,g,v;const[O,E]=(0,n.useState)({dataSource:null!==(d=null!==(c=null!==(l=null==i?void 0:i.dataSource)&&void 0!==l?l:(0,p.x0)())&&void 0!==c?c:(0,p.QB)())&&void 0!==d?d:"",interval:null!==(f=null==i?void 0:i.interval)&&void 0!==f?f:"",isValid:k(null!==(g=null==i?void 0:i.interval)&&void 0!==g?g:""),patternsDisabled:null!==(v=null==i?void 0:i.patternsDisabled)&&void 0!==v&&v});return a().createElement("div",{"data-testid":w.appConfig.container},a().createElement(u.FieldSet,{label:"Settings"},a().createElement(u.Field,{description:a().createElement("span",null,"The default data source to be used for new Logs Drilldown users. Each user can override their default by setting another data source in Logs Drilldown."),label:"Default data source"},a().createElement(s.DataSourcePicker,{width:60,filter:e=>"loki"===e.type,current:O.dataSource,onChange:e=>{E(b(m({},O),{dataSource:e.uid}))}})),a().createElement(u.Field,{invalid:!k(O.interval),error:'Interval is invalid. Please enter an interval longer then "60m". For example: 3d, 1w, 1m',description:a().createElement("span",null,"The maximum interval that can be selected in the time picker within the Grafana Logs Drilldown app. If empty, users can select any time range interval in Grafana Logs Drilldown. ",a().createElement("br",null),"Example values: 7d, 24h, 2w"),label:"Maximum time picker interval",className:t.marginTop},a().createElement(u.Input,{width:60,id:"interval","data-testid":w.appConfig.interval,label:"Max interval",value:null==O?void 0:O.interval,placeholder:"7d",onChange:e=>{const t=e.target.value.trim();E(b(m({},O),{interval:t,isValid:k(t)}))}})),a().createElement(u.Field,{className:t.marginTop,description:a().createElement("span",null,"Disables Logs Drilldown's usage of the"," ",a().createElement("a",{className:"external-link",href:"https://grafana.com/docs/loki/latest/reference/loki-http-api/#patterns-detection",target:"_blank",rel:"noreferrer"},"Loki Patterns API")," ","endpoint, and removes the Patterns tab."),label:"Disable Loki patterns"},a().createElement(u.Checkbox,{id:"disable-patterns","data-testid":w.appConfig.interval,label:"Disable patterns",value:null==O?void 0:O.patternsDisabled,placeholder:"7d",onChange:e=>{const t=e.currentTarget.checked;E(b(m({},O),{patternsDisabled:t}))}})),a().createElement("div",{className:t.marginTop},a().createElement(u.Button,{type:"submit","data-testid":w.appConfig.submit,onClick:()=>h(e.meta.id,{enabled:r,jsonData:{dataSource:O.dataSource,interval:O.interval,patternsDisabled:O.patternsDisabled},pinned:o}),disabled:!k(O.interval)},"Save settings")),a().createElement("p",{className:t.note},"Active users must refresh the app to update configuration.")))}},25398:(e,t,r)=>{r.d(t,{O7:()=>v,jj:()=>y,g:()=>w,ev:()=>h});var n=r(77909),a=r(75561),i=r(18531);const o={experiment_fake_flag:null};class l{after(e,t){v[e.flagKey]&&(o[v[e.flagKey]]=t.value)}constructor(){}}var c=r(25953);function s(e,t,r,n,a,i,o){try{var l=e[i](o),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,a)}function u(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function o(e){s(i,n,a,o,l,"next",e)}function l(e){s(i,n,a,o,l,"throw",e)}o(void 0)})}}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const p={exploreLogsAggregatedMetrics:{valueType:"boolean",value:!1,reason:"static provider evaluation result",variant:"default"},"drilldown.logs.fake_flag":{valueType:"string",values:["treatment","control","excluded"],defaultValue:"excluded",trackingKey:"experiment_fake_flag"}},f=(g=p,Object.keys(g));var g;const v=Object.fromEntries(f.reduce((e,t)=>{const r=p[t];return"trackingKey"in r&&e.push([t,r.trackingKey]),e},[])),m="logs-drilldown",b=new Map;function y(e){if(b.has(e))return b.get(e);const t=p[e];return"value"in t?t.value:t.defaultValue}function h(){return u(function*(){yield Promise.all(f.map(e=>u(function*(){const t=yield function(e){return u(function*(){try{const t=a.B0.getClient(m);yield function(e){if(e.providerStatus===a.$l.READY)return Promise.resolve();if(e.providerStatus===a.$l.ERROR||e.providerStatus===a.$l.FATAL)return Promise.reject(new Error("OpenFeature provider failed to initialize"));return new Promise((t,r)=>{e.addHandler(a.Nm.Ready,()=>t()),e.addHandler(a.Nm.Error,()=>r(new Error("OpenFeature provider error")))})}(t),t.addHooks(new l);const r=p[e],n=O(r);switch(r.valueType){case"boolean":return t.getBooleanValue(e,n);case"number":return t.getNumberValue(e,n);case"object":return t.getObjectValue(e,n);case"string":return t.getStringValue(e,n);default:throw new Error(`Invalid flag value type for flag ${e}`)}}catch(t){c.v.error(new Error(`Error evaluating ${e} flag.`,{cause:t}));const r=function(e){if("exploreLogsAggregatedMetrics"===e)return i.config.featureToggles.exploreLogsAggregatedMetrics;return}(e);if(void 0!==r)return r;return O(p[e])}})()}(e);b.set(e,t)})()))})()}function w(){return a.B0.setProviderAndWait(m,new n.S({baseUrl:`/apis/features.grafana.app/v0alpha1/namespaces/${i.config.namespace}`,pollInterval:-1,timeoutMs:1e4}),function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){d(e,t,r[t])})}return e}({targetingKey:i.config.namespace,namespace:i.config.namespace},i.config.openFeatureContext)).catch(e=>{c.v.warn("OpenFeature provider initialization failed, using config.featureToggles fallback",{error:e instanceof Error?e.message:String(e)})})}function O(e){return"value"in e?e.value:e.defaultValue}}}]);
//# sourceMappingURL=813.js.map?_cache=a0647ebfec1def251fa4